(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","lodash","punycode","./symmetry-jnap","./errorstring-mappings","./util-guest-access","./util-wireless","./util-wan","./util-monitors","./util-nodes","./util-firmware-update","./util-lan","./util-network-security"],b)}else{if(typeof module==="object"&&module.exports){module.exports=b(require("jquery"),require("lodash"),require("punycode"),require("./symmetry-jnap"),require("./errorstring-mappings"),require("./util-guest-access"),require("./util-wireless"),require("./util-wan"),require("./util-monitors"),require("./util-nodes"),require("./util-firmware-update"),require("./util-lan"),require("./util-network-security"))}else{a.symmetryUtil=b(a.$,(a.lodash||a._),a.punycode,a.JNAP,a.errorStringMappings,a.utilGuestAccess,a.utilWireless,a.utilWAN,a.utilMonitors,a.utilNodes,a.utilFirmwareUpdate,a.utilLAN,a.utilNetworkSecurity)}}}(this,function(Z,L,m,O,X,x,ag,R,ad,p,W,an,h){var H;L.padEnd=L.padEnd||L.padRight;var N=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];var q=/[+-]\d{4}$/;var g=/\d+|[\u0660-\u0669]+/;var at=/ (AM|PM)\b/;var b=["sortWeight"];var r=[];function ab(aw){aw=aw||"";var av=encodeURIComponent(aw).match(/%[89ABab]/g);return aw.length+(av?av.length:0)}function j(ay,av){var ax=m.ucs2.decode(ay),az=ab(ay);for(var aw=ax.length-1;aw>=0&&az>av;aw--){ax.splice(aw,1);ay=m.ucs2.encode(ax);az=ab(ay)}return ay}function af(av){return function(ax){ax.attr("maxlength",av);var aw=function(){if(ab(ax.val())>av){ax.val(j(ax.val(),av)).change()}};ax.keyup(aw);ax.blur(aw)}}function ac(aw){var av=aw.split(".");return(((((parseInt(av[0],10)*256)+parseInt(av[1],10))*256)+parseInt(av[2],10))*256)+parseInt(av[3],10)}function J(aw){var av=aw%256;L.range(0,3).forEach(function(){aw=Math.floor(aw/256);av=aw%256+"."+av});return av}function aq(aw,av,ax){return ac(aw)>=ac(av)&&ac(aw)<=ac(ax)}function ao(ay,aw,av){if(L.isEmpty(ay)){return false}if(!aw){aw=8}else{if(aw<1||aw>31){throw"Invalid minNetworkPrefixLength passed, must be between 1 and 31"}}if(!av){av=30}else{if(av<1||av>31){throw"Invalid maxNetworkPrefixLength passed, must be between 1 and 31"}}if(av<aw){throw"maxNetworkPrefixLength cannot be less than minNetworkPrefixLength"}var az=ac(ay).toString(2),ax=az.indexOf("0"),aA=L.padEnd(L.repeat("1",ax),32,"0");if(az!==aA||ax<aw||ax>av){return false}return true}function C(av){var aw=L.padEnd(L.repeat("1",av),32,"0");return aw.match(/.{1,8}/g).map(function(ax){return parseInt(ax,2)}).join(".")}function f(aw){var av=ac(aw).toString(2).indexOf("0");if(!ao(aw,1,31)){throw"Invalid subnet mask passed"}return av===-1?32:av}function s(av){if(L.isDate(av)){return av}if(L.isEmpty(av)||!L.isString(av)){throw"routerTimeToDate - Need to pass in timeString or a Date obj"}if(q.test(av)){av=av.replace(/(..$)/,":$1")}return new Date(av)}function w(av){return new Date(Date.UTC(av.getUTCFullYear(),av.getUTCMonth(),av.getUTCDate(),av.getUTCHours(),av.getUTCMinutes(),av.getUTCSeconds())+av.getTimezoneOffset()*60*1000)}function ae(av){av=av.replace(q,"+0000");return w(s(av))}function i(av){var ay=new Date(),az,aw,ax;ay.setHours(av);aw=ay.toLocaleTimeString();ax=aw.match(g);if(ax&&ax.length){az=ax[0];ax=aw.match(at);if(ax&&ax.length){az+=ax[0].toLowerCase()}}else{throw"Error attempting to call toLocaleTimeString, please verify that hour passed in is a # 0 - 23"}return az}function ai(av){av++;if(av>6){av=0}return av}function T(av){var aw=ai(N.indexOf(av));return N[aw]}function u(av){av--;if(av<0){av=6}return av}function P(av){var aw=u(N.indexOf(av));return N[aw]}function S(aw){var ay=aw/1000,av;if(ay>=60){var aA=L.words(L.round(ay/60,2)),az=aA[0],ax=L.round(aA[1]/60,2);av=az+"m "+(L.isNaN(ax)?0:ax)+"s"}else{av=L.round(ay,2)+"s"}return av}function I(av){return(new Date()).getTime()-av}function F(av){return S(I(av))}function ak(aw,av){return aw[N[av.getDay()]].split("")}function o(av){var aw=L.union(L.map(av));return aw.length===1&&L.uniq(aw[0]).length===1}function au(av){return o(av)&&av.sunday[0]==="0"}function k(av){return o(av)&&av.sunday[0]==="1"}function M(aA,aw,ax){var ay,az=0,av;aw.setMinutes(0);aw.setSeconds(0);while(true){if(!ay||aw.getHours()===0){ay=ak(aA,aw)}av={date:L.clone(aw),day:aw.getDay(),hour:aw.getHours(),hourText:i(aw.getHours()),isBlocked:ay[aw.getHours()*2]==="0"};if(!ax(av,az)){break}aw.setUTCHours(aw.getUTCHours()+1);az++}}function Q(aC,aA){var av,az,aB=0,ay,aw,ax;if(L.isEmpty(aC)){throw"getNextSchedulerEvent - Need to pass the schedule-JSON as first parameter"}if(!L.isDate(aA)&&(!L.isString(aA)||L.isEmpty(aA))){throw"getNextSchedulerEvent - Need to pass the routerLocalTime as a String or Date as second parameter"}av=s(aA);M(aC,L.clone(av),function(aD,aE){if(az===undefined){az=aD.isBlocked}if(aE>0&&(aD.hour===0||aD.hour===12)){aB++}if(!az&&!ay&&aD.isBlocked){ay=aD;ay.hourOffset=aE;ay.meridiemOffset=aB;aB=0}else{if((ay||az)&&!aw&&!aD.isBlocked){aw=aD;aw.hourOffset=aE;aw.meridiemOffset=aB}}if((az&&aw)||(ay&&aw)||aE===168){return false}return true});ax={currentDay:av.getDay(),isCurrentlyBlocked:az};if(ay||aw){if(ay){ax.startBlock={day:ay.day,hour:ay.hour,hourText:ay.hourText,hourOffset:ay.hourOffset,dayOfWeekShown:ay.meridiemOffset>1}}if(aw){ax.endBlock={day:aw.day,hour:aw.hour,hourText:aw.hourText,hourOffset:aw.hourOffset,dayOfWeekShown:aw.meridiemOffset>1}}}return ax}function c(az,ax){var ay,aB=1,aC=[],aw=new Date("2016-02-01T00:00:00-00:00"),av;if(L.isEmpty(az)){throw"getScheduleRangesForWeek - Need to pass the schedule-JSON as first parameter"}if(ax&&!L.isString(ax)&&!L.isDate(ax)){throw"getScheduleRangesForWeek - Need to pass the routerLocalTime as a String or Date"}if(ax){av=s(ax)}aw=w(aw);M(az,aw,function(aE,aF){if(aB!==aE.day){if(ay){ay.end=-1;if(av&&av.getDay()===ay.day&&av.getHours()>=ay.start){ay.isRangeActive=true}aC.push(ay);ay=null}aB=aE.day}if(!ay&&aE.isBlocked){ay={day:aE.day,start:aE.hour};if(av){ay.startDate=aE.date}}else{if(ay&&!aE.isBlocked){ay.end=aE.hour;if(av&&av.getDay()===ay.day&&av.getHours()>=ay.start&&av.getHours()<ay.end){ay.isRangeActive=true}aC.push(ay);ay=null}}if(aF===168){return false}return true});if(av){if(!o(az)&&!L.compact(L.map(aC,"isRangeActive")).length){var aD,aA;av=new Date(Date.UTC(aw.getUTCFullYear(),aw.getUTCMonth(),av.getDay(),av.getHours(),0,0)+aw.getTimezoneOffset()*60*1000);aC.forEach(function(aE){if(aE.startDate<av){aE.startDate.setTime(aE.startDate.getTime()+168*60*60*1000)}});aD=L.sortBy(aC,"startDate");aA=L.findIndex(aC,aD[0]);aC[aA].isNextActiveRange=true}aC.forEach(function(aE){delete aE.startDate})}return aC}function z(aA){var aJ=[],aK=[],aF=[],aB,av;var aD=c(aA);function aG(aL){return aK.indexOf(aL)===-1}function az(aL){av=aE(aL);return aL.end===-1&&av!==-1}function aw(aL){return aL.start===0&&aL.end===-1}function aI(aL){return aL.day<5&&aL.start>11&&az(aL)}function ay(aL){return aL.day>4&&aL.start>11&&az(aL)}function ax(aL,aM){return aG(aM)}aF.push({title:"Multiple All-day Blocked ranges",fnRule:aw,requireMatches:true});aF.push({title:"Multiple Weekday, overlapping to next day, Blocked ranges",fnRule:aI,requireMatches:true});aF.push({title:"Multiple Weekend, overlapping to next day, Blocked ranges",fnRule:ay,requireMatches:true});aF.push({title:"Remaining Multiple and Unique Blocked ranges",sortWeight:3,fnRule:ax,requireMatches:false});function aE(aM,aO){var aL;var aN={day:ai(aM.day),start:0};if(aO){aN.end=aO}aL=L.findIndex(aD,aN);return aL!==-1&&aG(aL)&&aD[aL].end!==-1?aL:-1}function aC(aM){var aL=false;if(aB.startHour===aM.start&&(aB.endHour===aM.end||(aB.endNextDay&&aM.end===-1))){aL=true;if(aB.endNextDay){av=aE(aM,aB.endHour);if(av!==-1){aK.push(av)}else{aL=false}}}return aL}function aH(aM){var aL;aD.forEach(function(aN,aO){if(aG(aO)&&aM.fnRule(aN,aO)){aK.push(aO);aB={days:[N[aN.day]],startHour:aN.start,endHour:aN.end,endNextDay:aN.end===-1&&aN.start!==0,sortWeight:10};if(aB.endNextDay){av=aE(aN);if(av!==-1){aB.endHour=aD[av].end;aK.push(av)}else{aB.endNextDay=false}}aD.forEach(function(aP,aQ){if(aG(aQ)&&aC(aP)){aK.push(aQ);aB.days.push(N[aP.day])}});if(!aM.requireMatches||aB.days.length>1){if(aB.endHour===-1){aB.endHour=24}if(aB.days.length===7){aB.sortWeight=0}if(aB.days.length>1){aB.days=L.sortBy(aB.days,function(aP){return N.indexOf(aP)})}aJ.push(aB)}else{aL=aB.endNextDay?2:1;aK.splice(-aL,aL)}}})}aD=L.sortBy(aD,"day");aF.forEach(aH);aJ=L.sortBy(aJ,function(aL){return aL.sortWeight*10000+N.indexOf(aL.days[0])*1000+aL.startHour*10+aL.days.length});aJ.forEach(function(aL,aM){aJ[aM]=L.omit(aL,b)});return aJ}function B(aw,ay,aC){var az=L.clone(aw),av=ay.startHour*2,ax=ay.endHour*2,aA=ax,aD,aB;if(ay.endNextDay){ax=48}ay.days.forEach(function(aE){aD=az[aE].split("");L.fill(aD,aC,av,ax);az[aE]=aD.join("");if(ay.endNextDay){aB=T(aE);aD=az[aB].split("");L.fill(aD,aC,0,aA);az[aB]=aD.join("")}});return az}function U(aw,av){return B(aw,av,"0")}function K(aw,av){return B(aw,av,"1")}function l(ax,aw,av){ax=K(ax,aw);return U(ax,av)}function A(aA,az){var ax=false,ay,aE=az.startHour*2,aC=az.endHour*2-2,aD,aw,av=aE-2,aB=aC+2;if(az.startHour===0){av=47}if(az.endHour===24){aB=0}L.each(az.days,function(aF){ay=az.endNextDay?T(aF):aF;aD=az.startHour===0?P(aF):aF;aw=az.endHour===24?T(aF):ay;if(aA[aD][av]==="0"||aA[aF][aE]==="0"||aA[aw][aB]==="0"||aA[ay][aC]==="0"){ax=true;return false}});return ax}function aa(aw,ay,av){var ax=L.clone(aw);ax=K(ax,ay);return A(ax,av)}function E(aw,ay){var av=O.Deferred(),ax=O.transaction();ax.add("/macfilter/SetMACFilterSettings",aw);y(ay.enabled,aw.macFilterMode,null,ax);ax.send().success(function(){av.resolve(aw)}).error(function(az){av.reject(az)});return av}function aj(av){av=L.trim(av);if(av.indexOf("://")>0){av=av.substring(av.indexOf("://")+3)}av=av.replace(/^www\./,"");return av}function D(aw,av){return L.findIndex(aw,function(ax){return L.isEqual(ax.macAddresses,av.knownMACAddresses)})}function t(aw,ax){var az=[],ay=aw.rules,av;ax.forEach(function(aA){av=D(ay,aA);if(av!==-1){az.push(ay[av])}});return az}function G(aw,ax){var ay=L.cloneDeep(aw.rules),av;ax.forEach(function(az){av=D(ay,az);if(av!==-1){ay.splice(av,1)}});return ay}function Y(av){var aw=["WEP","WPA-Personal","WPA-Enterprise"];return aw.indexOf(av.settings.security)===-1}function ah(av){return !H.wireless.isSecondaryBandRadio(av)&&(!av.settings.isEnabled||!av.settings.broadcastSSID||!Y(av))}function d(av){return av!=="Disabled"}function ap(aw,az,aA,ay){var av=0,ax=0;if(aw&&d(aw)){return false}if(az){az.radios.forEach(function(aB){if(!H.wireless.isSecondaryBandRadio(aB)){av++;if(ah(aB)){ax++}}});if(ax===av){return false}}if(aA&&H.wireless.isWirelessDisabledBySchedule(aA,ay)){return false}return true}function a(av,ax,ay,aw){var az=[];if(d(av)){az.push("SYM-MAC_FILTER_ENABLED")}if(ay&&H.wireless.isWirelessDisabledBySchedule(ay,aw)){az.push("SYM-WIRELESS_SCHEDULER_BLOCKING")}ax.radios.forEach(function(aA){if(ah(aA)){if(!aA.settings.isEnabled){az.push("SYM-"+aA.radioID+"_DISABLED")}if(!aA.settings.broadcastSSID){az.push("SYM-"+aA.radioID+"_NOT_VISIBLE")}if(!Y(aA)){az.push("SYM-"+aA.radioID+"_INVALID_SECURITY-"+aA.settings.security)}}});return az}function y(ax,aA,aB,ay){var aw=O.Deferred(),av={enabled:false},az=ay?ay.add:O.send;if(ax&&!ap(aA,aB)){az("/wirelessap/SetWPSServerSettings",av).success(function(){aw.resolve(av)}).error(function(aC){aw.reject(aC)})}else{aw.resolve()}return aw}function al(aw){var av=["CHN","HKG","IND","IDN","JPN","KOR","PHL","SGP","TWN","THA","XAH","AUS","CAN","EEE","BHR","EGY","KWT","OMN","QAT","SAU","TUR","ARE","XME","NZL","USA"],ax={CHN:"{{Asia - China}}",HKG:"{{Asia - Hong Kong}}",IND:"{{Asia - India}}",IDN:"{{Asia - Indonesia}}",JPN:"{{Asia - Japan}}",KOR:"{{Asia - Korea}}",PHL:"{{Asia - Philippines}}",SGP:"{{Asia - Singapore}}",TWN:"{{Asia - Taiwan}}",THA:"{{Asia - Thailand}}",XAH:"{{Asia - Rest of Asia}}",AUS:"{{Australia}}",CAN:"{{Canada}}",EEE:"{{Europe}}",BHR:"{{Middle East - Bahrain}}",EGY:"{{Middle East - Egypt}}",KWT:"{{Middle East - Kuwait}}",OMN:"{{Middle East - Oman}}",QAT:"{{Middle East - Qatar}}",SAU:"{{Middle East - Saudi Arabia}}",TUR:"{{Middle East - Turkey}}",ARE:"{{Middle East - United Arab Emirates}}",XME:"{{Middle East}}",NZL:"{{New Zealand}}",USA:"{{United States}}"};return L.intersection(av,aw).map(function(ay){return{country:ay,text:ax[ay]}})}function v(aA,aC,aw,aD){var aB=L.drop(arguments,4),ay=aA+(aA.substr(aA.length-1)===" "?"":" ")+aD;ay+=aB.length?" ":"";if(aB.length===1&&L.isPlainObject(aB[0])&&aB[0]["log-keys"]){var az=aB[0],av=L.size(az)-1,ax=[];delete az["log-keys"];ay+="(";L.each(az,function(aF,aE){ax.push(aF);ay+=aE+(ax.length<av?", ":"")});ay+="): ";aB=ax}aB.forEach(function(aE,aF){ay+=JSON.stringify(aE,null,2);if(aF<aB.length-1){ay+=", "}});ay=ay.replace(/\\n/g,"\n").replace(/\\t/g,"\t");console[aw](ay);if(aC){r[aA]+=(r[aA].length?"\n":"")+ay}}function e(ax,az){var aw=L.isPlainObject(ax),av=aw?{}:[],ay;if(aw){ax=[ax]}L.each(ax,function(aA){ay={};L.each(az,function(aC){var aB=L.last(L.words(aC,/[^.]+/g));ay[aB]=L.result(aA,aC)});if(aw){av=ay}else{av.push(ay)}});return av}function ar(ay,aB){var aw="\n\t",ax="\n",az=aB.length,av=L.fill(az,0),aA=new Array(az);if(L.isPlainObject(ay)){ay=[ay]}L.each(aB,function(aE,aD){var aC=[],aF="";L.each(ay,function(aG){aC.push(L.result(aG,aE))});aA[aD]=aC;aF=L.last(L.words(aE,/[^.]+/g));av[aD]=(aD===az-1)?0:Math.max(aF.length,L.sortBy(aC,function(aG){return -aG.length})[0].length)+2;aw+=L.padEnd(aF,av[aD]," ")});L.range(0,ay.length).forEach(function(aC){ax+="\t";L.range(0,az).forEach(function(aD){ax+=L.padEnd(aA[aD][aC],av[aD]," ")});ax+="\n"});return aw+"\n\t"+L.repeat("-",aw.length+2)+ax+"\n"}function n(aw,av){if(av){V(aw)}return L.partial(v,aw,av)}function am(av){return r[av]||"[key not present]"}function V(av){r[av]=""}H={stringFormat:function(aw){var av=L.drop(arguments,1);return aw.replace(/{(\d+)}/g,function(ax,ay){return typeof av[ay]!=="undefined"?av[ay]:ax})},errors:{errorStringToCode:function(av){return L.result(X,av)}},formatter:{filterJsonByPaths:e,jsonToTable:ar},maxBytes:{lengthInBytes:ab,truncateToMaxByte:j,limitPasswordHint:af(512),limitSsid:af(32),limitApplicationName:af(32),limitInputField:function(av,ax){var aw=af(ax);aw(av)}},ip:{ipToNum:ac,numToIP:J,ipInRange:aq,isValidSubnetMask:ao,prefixLengthToSubnetMask:C,subnetMaskToPrefixLength:f,notZero:function(av){return av&&av!=="0.0.0.0"}},time:{routerTimeToDate:s,routerTimeToLocalShiftedDate:ae,shiftUTCDateToLocalTZ:w,isScheduleAlwaysBlocked:au,isScheduleAlwaysUnblocked:k,getSimplifiedLocaleHour:i,getNextDayNum:ai,getNextDay:T,getPreviousDayNum:u,getPreviousDay:P,getNextSchedulerEvent:Q,getDayFromSchedule:ak,getScheduleRangesForWeek:c,addBlockedRange:U,removeBlockedRange:K,editBlockedRange:l,isAddAdjacentOrOverlapping:A,isEditAdjacentOrOverlapping:aa,msToReadableTime:S,getElapsedMs:I,getElapsedMsReadable:F},macFilter:{setMACFilterSettings:E},parentalControls:{trimBlockedDomain:aj,getUpdatedRules:t,getOrphanedRules:G,getUniqueWeekRanges:z},powerTable:{getCountriesList:al},wps:{isWPSAvailable:ap,getWPSUnavailableReasons:a,checkAndDisableWPS:y},logging:{setup:n,message:v,getLogKey:am,clearLogKey:V}};H.guestAccess=x(H);H.wireless=ag(H);H.wan=R(H);H.monitors=ad;H.nodes=p;H.firmwareUpdate=W(H);H.lan=an(H);H.networkSecurity=h(H);return H}));