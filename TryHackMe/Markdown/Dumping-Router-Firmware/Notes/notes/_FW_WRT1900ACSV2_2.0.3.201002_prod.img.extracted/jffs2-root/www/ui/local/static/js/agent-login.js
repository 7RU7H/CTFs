$(document).ready(function(){var b=$("#username"),n=$("#password"),k=$("#serial-number"),f=$("#customer-pin"),o=null,c=null,h={};function d(r){if(!h.username.isValid(true)||!h.password.isValid(true)||!h.serialNumber.isValid(true)){return}function p(s){$(".login-container input").blur();if(s){if(s==="INVALID_PARAMETER"||s==="DUPLICATE_ASSISTANCE_SESSION"){c.show()}else{$.cookie("agent-user-name",$("#agent-remember-me:checked").length>0?q.username:"",{expires:new Date().addYears(10),path:"/"});f.val("");o.show()}}}var q={username:$.trim(b.val()),password:$.trim(n.val()),serialnumber:$.trim(k.val())};Account.onlineLogin(q.username,q.password,null,function(){RAINIER.remote.assistance.createRemoteAssistanceSession(q,r,p)})}function e(){c.close();if($.cookie("agent-remote-assistance-session")){var p=RAINIER.util.parseJSON($.cookie("agent-remote-assistance-session"));if(p){RAINIER.remote.assistance.deleteRemoteAssistanceSession(p.id)}}d(true)}function a(){if(!h.customerPin.isValid(true)){return}o.close();RAINIER.ui.wait();RAINIER.remote.assistance.startRemoteAccessSession(f.val(),function(){f.val("");o.show()})}function g(){o.close();RAINIER.ui.wait();var p=RAINIER.util.parseJSON($.cookie("agent-remote-assistance-session"));if(p){RAINIER.remote.assistance.deleteRemoteAssistanceSession(p.id,function(){RAINIER.remote.assistance.deleteUserSessions(true)})}else{RAINIER.ui.hideWaiting()}}function j(){$("#login-agent-btn").click(a);$("#customer-pin-dialog .close-button").click(g);$("#duplicate-session-dialog .close").click(c.close);$("#override-session").click(e);$("#submit-login").click(function(){d(false)});RAINIER.util.trapEnter(k,d,function(){RAINIER.ui.inputBalloon.hide(100)});RAINIER.util.trapEnter(f,a)}function l(){RAINIER.ui.hideMasterWaiting();$("#applet-container").css("visibility","visible");RAINIER.ui.placeholders.init();if(RAINIER.network.uiLoadedFromCloud()){if($.cookie("agent-user-name")){b.val($.cookie("agent-user-name"));$("#agent-remember-me").attr("checked","checked");setTimeout(function(){n.click()},50)}}$("#dialog-overlay").hide();RAINIER.event.fire("uiInitCompleted")}function m(){h.username=RAINIER.ui.buildInputValidBalloon({els:b,isRequired:true});h.password=RAINIER.ui.buildInputValidBalloon({els:n,isRequired:true});h.serialNumber=RAINIER.ui.buildInputValidBalloon({els:k,isRequired:true,minLen:14,maxLen:14,validCharSet:"alpha"});h.customerPin=RAINIER.ui.buildInputValidBalloon({els:f,isRequired:true,validCharSet:"numeric",minLen:4,maxLen:4})}function i(){m();o=RAINIER.ui.dialog($("#customer-pin-dialog"));c=RAINIER.ui.dialog($("#duplicate-session-dialog"));$.cookie("agent-remote-assistance-session",null,{path:"/"});j();RAINIER.ui.associateButtons("input[type=text], input[type=password]","#submit-login");RAINIER.event.connect("initialInternetCheckCompleted",l);window.onbeforeunload=function(){RAINIER.event.fire("rainier.preventDialogs");RAINIER.event.fire("router.interruptionStarted");if($.cookie("user-auth-token")&&$.cookie("admin-auth")){RAINIER.network.clearUIProxyPathCookie()}};RAINIER.network.getDeviceInfo(RAINIER.ui.init)}i()});