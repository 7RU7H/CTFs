window.RAINIER=window.RAINIER||{};RAINIER.setup.resendEmailButtonVisible=false;function sendEmailFailed(b,a){document.getElementById("emailInput").focus();showView("email");if(b){RAINIER.setup.resendEmailButtonVisible=false;switch(b){case RAINIER.simple.account.errorCode.ACCOUNT_LOCKED_OUT:window.location.href="/ui/dynamic/setup/account-lockout-simple.html";break;case RAINIER.simple.account.errorCode.ACCOUNT_SECURITY_LOCK:window.location.href="/ui/dynamic/setup/account-security-lock-simple.html";break;case RAINIER.simple.account.errorCode.ACCOUNT_DISABLED:showInputValidationError("emailInputValidation",true,RAINIER.login.strings.accountDisabled.replace("{username}",a));break;case RAINIER.simple.account.errorCode.ACCOUNT_PENDING:showInputValidationError("emailInputValidation",true,RAINIER.login.strings.accountPending);document.getElementById("resendEmailButton").style.display="block";RAINIER.setup.resendEmailButtonVisible=true;break;case RAINIER.simple.account.errorCode.INVALID_PARAMETER:case RAINIER.simple.account.errorCode.INVALID_ACCOUNT_CREDENTIALS:case RAINIER.simple.account.errorCode.ACCOUNT_NOT_FOUND:showInputValidationError("emailInputValidation",true,RAINIER.login.strings.accountNotFound.replace("{username}",a));break;default:showGeneralError(RAINIER.login.strings.unexpectedCloudError);break}}}function sendEmailRequest(b,c){var a=document.getElementById("emailInput").value;if(a.length===0){showInputValidationError("emailInputValidation",true,RAINIER.setup.ui.inputRequired);return}else{if(!RAINIER.shared.util.isValidEmail(a)){showInputValidationError("emailInputValidation",true,RAINIER.setup.ui.invalidEmail);return}}showView("verifyingEmail");clearAllInputErrors();RAINIER.cloud.send({url:b,data:c,type:"POST",request:{},cb:function(){showView("emailVerified")},cbError:function(d){RAINIER.simple.account.getErrorCode(d,function(e){sendEmailFailed(e,a)})}})}function sendEmail(){var b=RAINIER.shared.util.getURLParameter("callback");var a="/cloud/user-service/rest/accounts/"+document.getElementById("emailInput").value+"/passwordresets";if(b){a=a+"?caller="+b}sendEmailRequest(a)}function resendEmail(){sendEmailRequest("/cloud/user-service/rest/verifications",{verification:{type:"ACCOUNT_CREATION",parameters:[{parameter:{name:"username",value:document.getElementById("emailInput").value}}]}})}function submitPassword(){var e=document.getElementById("newPassword").value,b=document.getElementById("newPasswordAgain").value;if(e.length<8||e.length>128||!RAINIER.shared.util.isAscii(e)||RAINIER.shared.util.beginsOrEndsWithSpace(e)){showInputValidationError("passwordInputValidation",false);return}else{if(e!==b){showInputValidationError("passwordConfirmInputValidation",true);return}}showView("verifyingPassword");clearAllInputErrors();var a={};a.parameter={};a.parameter.name="password";a.parameter.value=e;var d={};d.verification={};d.verification.status="ACCEPTED";d.verification.parameters=[];d.verification.parameters.push(a);var c=RAINIER.shared.util.getURLParameter("callback");RAINIER.cloud.send({url:"/cloud/user-service/rest/verifications/"+RAINIER.shared.util.getURLParameter("verificationToken")+"/status/",type:"PUT",data:d,cb:function(){if(c){showGeneralMessage(RAINIER.ui.myAccountStrings.successMessage.replace("{url}",c))}else{showGeneralMessage(RAINIER.ui.myAccountStrings.successMessageNoCallback)}showView("passwordChanged")},cbError:function(f){var g={};if((f.status===409&&f.statusText==="Conflict")||(f.status===404&&f.statusText==="Not Found")){try{g.result=JSON.parse(f.responseText).errors[0].error.code}catch(h){}if(g.result==="PASSWORD_REUSED"){showGeneralError(RAINIER.login.strings.changePasswordReusedPassword);showView("newPassword")}else{showGeneralError()}}else{if(f.status===400&&f.statusText==="Bad Request"){showGeneralError();showEmailView()}else{try{g.result=JSON.parse(f.responseText).errors[0].error.message}catch(h){}RAINIER.shared.ui.showGenericError()}}}})}function showEmailView(){showView("email");if(!RAINIER.setup.resendEmailButtonVisible){document.getElementById("resendEmailButton").style.display="none"}if(username){document.getElementById("emailInput").value=username}}window.onload=function(){document.getElementById("sendEmailButton").onclick=sendEmail;document.getElementById("resendEmailButton").onclick=resendEmail;document.getElementById("submitPasswordButton").onclick=submitPassword;function a(){var d=RAINIER.shared.util.getURLParameter("verificationToken");var f=RAINIER.shared.util.getURLParameter("username");if(!d){showEmailView()}else{showView("newPassword");try{document.getElementById("newPassword").focus()}catch(c){}}}var b=RAINIER.shared.util.getURLParameter("lang");if(b){RAINIER.shared.ui.reviewHtmlLang(b,a)}else{a()}};