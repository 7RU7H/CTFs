(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","lodash","./symmetry-jnap"],b)}else{if(typeof module==="object"&&module.exports){module.exports=b(require("jquery"),require("lodash"),require("./symmetry-jnap"))}else{a.utilGuestAccess=b(a.$,(a.lodash||a._),a.JNAP)}}}(this,function(h,m,i){var c;var f=["canEnableGuestNetwork","guestPasswordRestrictions","maxSimultaneousGuestsLimit","unavailableReasons","maxSimultaneousGuestsValues"];var a=["isEnabled","canEnableRadio"];function o(s){var q=0,r=0;if(i.isServiceSupported("/guestnetwork/GuestNetwork3")){s.radios.forEach(function(t){if(!c.wireless.isSecondaryBandRadio(t)){q++;if(!j(t.radioID,s)){r++}}});if(q===r){return true}}else{if(!j("RADIO_2.4GHz",s)){return true}}return false}function j(r,s){var q=m.find(s.radios,{radioID:r});if(q&&q.settings.isEnabled){return true}return false}function g(r,s,q){if(o(r)){return false}if(s&&c.wireless.isWirelessDisabledBySchedule(s,q)){return false}return true}function d(r,s,q){var t=[];if(s&&c.wireless.isWirelessDisabledBySchedule(s,q)){t.push("SYM-WIRELESS_SCHEDULER_BLOCKING")}if(o(r)){r.radios.forEach(function(u){if(!j(u.radioID,r)){t.push("SYM-"+u.radioID+"_MAIN_NETWORK_DISABLED")}})}return t}function b(r,s){var q=m.find(s.radios,{radioID:r}),t=[];if(q&&!q.settings.isEnabled){t.push("SYM-MAIN_NETWORK_DISABLED")}return t}function n(r,q){return !i.isServiceSupported("/guestnetwork/GuestNetwork3")&&r&&r.isGuestNetworkEnabled&&q.isGuestNetworkEnabled&&r.radios[0].guestSSID!==q.radios[0].guestSSID}function l(u,v,t){var q=i.Deferred(),r,s;i.send("/guestnetwork/GetGuestNetworkSettings",{}).success(function(w){r=m.cloneDeep(w.output);r.unavailableReasons=d(u,v,t);if(i.isServiceSupported("/guestnetwork/GuestNetwork3")){r.canEnableGuestNetwork=g(u,v,t);if(r.radios.length===1){r.isGuestNetworkEnabled=r.radios[0].isEnabled;r.radios[0]=m.omit(r.radios[0],a)}else{r.radios.forEach(function(x){x.unavailableReasons=b(x.radioID,u)})}}else{r.radios=[{radioID:"RADIO_2.4GHz",broadcastGuestSSID:r.broadcastGuestSSID,guestSSID:r.guestSSID,guestPassword:r.guestPassword}]}s=r.maxSimultaneousGuestsLimit/10;r.maxSimultaneousGuestsValues=m.range(s,s*10+1,s);q.resolve(r)}).error(function(w){q.reject(w)});return q}function p(v,s,r){var q=i.Deferred(),u=m.cloneDeep(s),t=r?r.add:i.send;if(i.isServiceSupported("/guestnetwork/GuestNetwork3")){if(u.radios.length===1){u.radios[0].canEnableRadio=u.canEnableGuestNetwork;u.radios[0].isEnabled=u.isGuestNetworkEnabled}u.radios.forEach(function(w){w.broadcastGuestSSID=w.isEnabled;delete w.unavailableReasons})}else{u.guestSSID=u.radios[0].guestSSID;u.guestPassword=u.radios[0].guestPassword;u.broadcastGuestSSID=u.isGuestNetworkEnabled;u=m.omit(u,"radios")}u=m.omit(u,f);t("/guestnetwork/SetGuestNetworkSettings",u).success(function(){if(n(v,s)){setTimeout(function(){i.send("/core/Reboot").success(function(){q.resolve(u)}).error(function(w){q.reject(w)})},5000)}else{q.resolve(u)}}).error(function(w){q.reject(w)});return q}function k(t,w,s){var q=i.Deferred(),v=m.cloneDeep(t),u=m.cloneDeep(v),r;if(i.isServiceSupported("/guestnetwork/GuestNetwork3")){v.radios.forEach(function(x){r=j(x.radioID,w);if(x.canEnableRadio&&!r){x.isEnabled=false;x.canEnableRadio=false}else{if(!x.canEnableRadio&&r){x.canEnableRadio=true}}})}else{if(o(w)){v.isGuestNetworkEnabled=false}}if(!m.isEqual(v,u)){p(null,v,s).success(function(x){q.resolve(x)}).error(function(x){q.reject(x)})}else{q.resolve()}return q}function e(q){return !i.isServiceSupported("/guestnetwork/GuestNetwork4")||q.isGuestNetworkACaptivePortal}return function(q){c=q;return{isGuestAccessAvailable:g,isGuestRadioAvailable:j,isCaptivePortal:e,getGuestAccessUnavailableReasons:d,getGuestRadioUnavailableReasons:b,getGuestAccessSettings:l,willSetCauseManualReboot:n,setGuestAccessSettings:p,checkAndConfigureGuestAccess:k}}}));