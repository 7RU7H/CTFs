(function(){var T=$("#troubleshooting-applet"),B=T.find("#status"),o=T.find("#dhcpclienttabledialog"),t=o.find("#dhcpclienttable"),aI=RAINIER.ui.dialog(o,{}),Y=T.find("#diagnostics"),av=T.find("#diagnostics-ping"),L=T.find("#diagnostics-trace"),aT=T.find("#share-diagnostics"),aA=T.find("#ping-log"),h=T.find("#trace-log"),ac=T.find("#devices-ipv4"),aa=T.find("#devices-ipv6"),Z=T.find("#logs"),R=$("#diagnostics-restore-configuration"),S=B.find("#lan-ports-wrapper"),aK=null,s=RAINIER.ui.buildInputValidBalloon,aM=RAINIER.ui.dialogWarning,w=null,b=null,aH=null,X=null,z=null,e=null,aq=false,r=null,k=false,V=null,ax=60*1000;var ae=RAINIER.ui.template.createTemplate(T.find("#templateStatusRow tr")),ah=RAINIER.ui.template.createTemplate(T.find("#templateStatusRowIPv6 tr")),A=RAINIER.ui.template.createTemplate(T.find("#templateDHCPClientRow tr")),ao=RAINIER.ui.template.createTemplate(T.find("#template-radio tr")),Q=RAINIER.network.isLinkAggregationPresent()?'<tr class="port"><td>{0}</td><td name="port{1}_100"></td><td name="port{1}_1gbps"></td><td name="port{1}_linkagg"></td></tr>':'<tr class="port"><td>{0}</td><td name="port{1}_100"></td><td name="port{1}_1gbps"></td></tr>';var M={devices:[],wireless:{radios:[]},time:{},localtime:{},wan:{},wanStatus:{},ipv6:{},router5IPv6:{},routerManagement:{},lanSettings:{},info:{},connections:{},ports:{},dhcpLease:{},cloneSettings:{},linkAggregation:{},logs:{isLoggingEnabled:false,incoming:{},outgoing:{},dhcp:{},security:{}},authorityDevice:{},powerModem:{},adslLineStatus:{},wirelessScheduler:{},openVpn:{},dataUpload:{}};var aS={"labels.wirelessNetwork":"display-only"};var P={};var x={onRestorePreviousFirmware:function(){aM({msg:T.find("#restorePreviousFirmware").html(),onSubmit:ay})},onReboot:function(){aM({msg:T.find("#rebootRouter").html(),onSubmit:K,submit:RAINIER.ui.button.strings.restart,cancel:RAINIER.ui.button.strings.cancel})},onFactoryReset:function(){aM({msg:T.find("#factoryReset").html(),onSubmit:y})},onRestoreBackup:function(){aM({msg:T.find("#restoreBackup").html(),onSubmit:aN})}};var W={isLocale2Supported:false,isRouter5Supported:false,isDiagnostics3Supported:false,isCore4Supported:false,isNodesRebootSupported:false};function N(){if(W.isLocale2Supported){var aV=M.localtime.currentTime.replace(/\d{4}\-\d{2}\-\d{2}T\d{2}\:\d{2}\:\d{2}(.+)(\d{2})(\d{2})/,"$1"),aW=parseInt(M.localtime.currentTime.replace(/\d{4}\-\d{2}\-\d{2}T\d{2}\:\d{2}\:\d{2}(.+)(\d{2})(\d{2})/,"$2"),10),aY=parseInt(M.localtime.currentTime.replace(/\d{4}\-\d{2}\-\d{2}T\d{2}\:\d{2}\:\d{2}(.+)(\d{2})(\d{2})/,"$3"),10);return parseInt(aV+(aW*60+aY),10)}else{for(var aX=0;aX<M.time.supportedTimeZones.length;aX++){if(M.time.timeZoneID===M.time.supportedTimeZones[aX].timeZoneID){return M.time.supportedTimeZones[aX].utcOffsetMinutes}}}return null}function aG(aX){var aV=aX>=0?"+":"-",aW=Math.floor(Math.abs(aX/60));aX=RAINIER.util.addALeadingZero(Math.abs(aX%60));return"("+RAINIER.ui.common.strings.GMT+" "+aV+RAINIER.util.addALeadingZero(aW)+":"+aX+")"}function aQ(aV){var aW=N();return RAINIER.util.utcTimeWithOffsetToString(RAINIER.util.utcTimeToDate(aV),aW*60000)+" "+aG(aW)}function ag(aW,aV){if(aW!==null){aW.add({action:RAINIER.jnapActions.getWANStatus(),data:{},cb:function(aX){if(typeof aV==="function"){aV(aX)}}})}else{RAINIER.jnap.send({action:RAINIER.jnapActions.getWANStatus(),data:{},cb:function(aX){if(aX.output){if(typeof aV==="function"){aV(aX)}}else{}}})}}function p(aW,aX,aV){if(aW.document.readyState==="complete"){aW.document.writeln(aX);if(aV){setTimeout(function(){aW.print();if($.browser.msie){setTimeout(function(){aW.location.reload()},550)}},550)}}else{setTimeout(function(){p(aW,aX,aV)},500)}}function aw(aV){ag(aV,function(aW){if(aW.result==="OK"){M.wanStatus=aW.output||{}}else{}});aV.add({action:RAINIER.jnapActions.getRadioInfo(),data:{},cb:function(aW){M.wireless=aW.output||{};if(aW.result==="OK"){RAINIER.applets.wireless.sortRadios(M.wireless.radios);M.wireless.radios.reverse()}else{}}});aV.add({action:RAINIER.jnapActions.getWANSettings(),data:{},cb:function(aW){if(aW.result==="OK"){M.wan=aW.output||{}}else{}}});aV.add({action:"/jnap/locale/GetTimeSettings",data:{},cb:function(aW){if(aW.result==="OK"){M.time=aW.output||{}}else{}}});aV.add({action:"/jnap/core/GetDeviceInfo",data:{},cb:function(aW){if(aW.result==="OK"){M.info=aW.output||{}}else{}}});aV.add({action:"/jnap/router/GetEthernetPortConnections",data:{},cb:function(aW){if(aW.result==="OK"){M.ports=aW.output||{}}else{}}});aV.add({action:"/jnap/router/GetLANSettings",data:{},cb:function(aW){if(aW.result==="OK"){M.lanSettings=aW.output||{};if(aW.output){M.lanSettings.isDHCPEnabled=M.lanSettings.isDHCPEnabled?RAINIER.ui.common.strings.enabled:RAINIER.ui.common.strings.disabled}else{}}else{}}});aV.add({action:"/jnap/router/GetIPv6Settings",data:{},cb:function(aW){if(aW.result==="OK"){if(aW.output){M.ipv6=aW.output}else{}}else{}}});if(W.isRouter5Supported){aV.add({action:"/jnap/router/GetIPv6Settings2",data:{},cb:function(aW){if(aW.result==="OK"){if(aW.output){M.router5IPv6=aW.output}else{}}else{}}})}aV.add({action:"/jnap/router/GetMACAddressCloneSettings",data:{},cb:function(aW){if(aW.result==="OK"){if(aW.output){M.cloneSettings=aW.output}else{}}else{}}});if(RAINIER.shared.util.areServicesSupported(["/jnap/routermanagement/RouterManagement"])){aV.add({action:"/jnap/routermanagement/GetRemoteManagementStatus",data:{},cb:function(aW){if(aW.result==="OK"){M.routerManagement=aW.output||{};if(aW.output){M.routerManagement.serviceState=RAINIER.ui.common.strings.remoteManagementServiceState[M.routerManagement.serviceState]}else{}}else{}}})}if(W.isLocale2Supported){aV.add({action:"/jnap/locale/GetLocalTime",data:{},cb:function(aW){if(aW.result==="OK"){M.localtime=aW.output||{};if(aW.output){}else{}}else{}}})}if(RAINIER.network.isPowerModemSupported()){aV.add({action:"/jnap/powermodem/GetDSLSettings",data:{},cb:function(aW){if(aW.result==="OK"){M.powerModem=aW.output||{};if(aW.output){}else{}}else{}}})}else{B.find(".powerModem").hide()}if(RAINIER.network.isWirelessSchedulerSupported()){RAINIER.network.updateWirelessSchedulerSettings(function(){M.wirelessScheduler=$.extend(true,{},RAINIER.network.getWirelessSchedulerSettings());RAINIER.network.areRadiosDisabledByWFS(function(aW){M.wirelessScheduler.radiosStatus=aW});RAINIER.event.fire("wireless.updated")})}else{B.find(".wirelessScheduler").hide()}if(RAINIER.network.isOpenVPNSupported()){aV.add({action:"/jnap/openvpn/GetOpenVPNSettings",data:{},cb:function(aW){if(aW.result==="OK"){M.openVpn=aW.output||{};if(aW.output){}else{}}else{}}})}else{B.find(".openVpn").hide()}if(RAINIER.network.isLinkAggregationPresent()){S.append(T.find("#templateLANPortsLinkAgg").html());aK=S.find("#lan-ports-linkaggregation");aV.add({action:"/jnap/linkaggregation/GetLinkAggregationSettings",data:{},cb:function(aW){if(aW.result==="OK"){M.linkAggregation=$.extend(true,{},aW.output||{});if(!aW.output){}}else{}}})}else{S.append(T.find("#templateLANPorts").html());aK=S.find("#lan-ports")}}function aR(aV){RAINIER.jnap.send({action:"/jnap/powermodem/GetADSLLineStatus",data:{},timeoutMs:15000,cb:function(aW){if(aW.result==="OK"){M.adslLineStatus=aW.output||{};if(aW.output){}else{}}else{}aV(aW)}})}function j(aV){function aW(a2,a1){if(a1){a2.physInterface=RAINIER.ui.common.strings.offline;if(a1.data.connections.length>0){for(var a0=0;a0<a1.data.connections.length;a0++){console.warn(a1.data);if(a1.data.connections[a0].macAddress===a2.macAddress){if(a1.data.connections[a0].wireless){a2.physInterface=RAINIER.ui.common.strings.netType.wireless}else{a2.physInterface=RAINIER.ui.common.strings.netType.lan}break}}}a2.friendlyName=a1.friendlyName();var a3=RAINIER.ui.template.createBlock(A,a2);t.find("tbody").append(a3)}}function aY(a1,a3){var a2=new RAINIER.util.utcTimeToDate(a1),a4=new RAINIER.util.utcTimeToDate(a3),a8=a4.getTime()-a2.getTime();if(a8>0){var a6=Math.floor(a8/3600000),a7=Math.floor(a8%3600000/60000),a5=Math.floor(a8%3600000%60000/1000);if(a8>86400000){var a9=Math.floor(a6/24);if(a6%24>=12){a9+=1}var a0=RAINIER.ui.common.strings.day;if(a9>1){a0=RAINIER.ui.common.strings.days}return"~"+a9+" "+a0}else{return RAINIER.util.addALeadingZero(a6)+":"+RAINIER.util.addALeadingZero(a7)+":"+RAINIER.util.addALeadingZero(a5)}}else{return RAINIER.ui.common.strings.expired}}RAINIER.ui.clearTbl(t);for(var aX=0;aX<M.dhcpLease.leases.length;aX++){var aZ={hostName:M.dhcpLease.leases[aX].hostName,ipAddress:M.dhcpLease.leases[aX].ipAddress,macAddress:M.dhcpLease.leases[aX].macAddress,expiration:M.dhcpLease.leases[aX].expiration,clientID:M.dhcpLease.leases[aX].clientID};aZ.leaseTimeLeft=aY(M.time.currentTime,aZ.expiration);RAINIER.deviceManager.getDeviceByMACAddress({cb:aW.curry(aZ),macAddress:aZ.macAddress})}if(typeof aV==="function"){aV()}}function aO(aV){RAINIER.ui.clearTbl(ac);RAINIER.ui.clearTbl(aa);$.each(aV,function(){af(this);if(this.ipAddress){U(ac,this,ae)}if(this.ipv6Address){U(aa,this,ah)}})}function ar(){var aW=$.extend(true,{},M.wireless),a2=null,a0,aY=true,aX;B.find("#report-wrapper").scrollTop(0);if(!M.authorityDevice.macAddress){RAINIER.deviceManager.getAuthorityDevice(function(a3){M.authorityDevice.macAddress=a3.data.knownMACAddresses[0];B.find("#status-report-content").find('td[name="authorityDevice.macAddress"]').text(M.authorityDevice.macAddress)},-1)}RAINIER.deviceManager.getDevices(aO,{excludeAuthority:true},-1);var a1=$.extend({},M.info);a1.currentRouterTime=aQ(M.time.currentTime);a1.currentBrowserTime=RAINIER.util.currentDateString()+" "+aG(new Date().getTimezoneOffset()*-1);a1.ipv6=M.ipv6;a1.routerManagement=M.routerManagement;a1.wan=M.wan;a1.wanStatus=M.wanStatus;a1.authorityDevice=M.authorityDevice;a1.powerModem=M.powerModem;a1.adslLineStatus=M.adslLineStatus;if(a1.powerModem.isPowerModemEnabled){a1.powerModem.dslSettings.wanType=RAINIER.ui.common.strings.wanType[a1.powerModem.dslSettings.wanType];a1.powerModem.dslSettings.multiplexing=RAINIER.ui.common.strings.powerModemStatus.multiplexing[a1.powerModem.dslSettings.multiplexing];a1.powerModem.dslSettings.qosType=RAINIER.ui.common.strings.powerModemStatus.qosType[a1.powerModem.dslSettings.qosType];a1.powerModem.dslSettings.pcr=a1.powerModem.dslSettings.pcr+" "+RAINIER.ui.common.strings.powerModemStatus.cps;a1.powerModem.dslSettings.scr=a1.powerModem.dslSettings.scr+" "+RAINIER.ui.common.strings.powerModemStatus.cps;a1.powerModem.dslSettings.vpi=a1.powerModem.dslSettings.vpi;a1.powerModem.dslSettings.vci=a1.powerModem.dslSettings.vci;a1.powerModem.dslSettings.modulation=RAINIER.ui.common.strings.powerModemStatus.modulation[a1.powerModem.dslSettings.modulation];if(a1.adslLineStatus.status==="Up"){a1.adslLineStatus.downDataRateBps=parseFloat(Math.round((a1.adslLineStatus.downDataRateBps/1024)*100)/100).toFixed(2)+" "+RAINIER.ui.common.strings.adslLineStatus.kbps;a1.adslLineStatus.upDataRateBps=parseFloat(Math.round((a1.adslLineStatus.upDataRateBps/1024)*100)/100).toFixed(2)+" "+RAINIER.ui.common.strings.adslLineStatus.kbps;a1.adslLineStatus.downOutputPowerdBm=a1.adslLineStatus.downOutputPowerdBm+" "+RAINIER.ui.common.strings.adslLineStatus.dBm;a1.adslLineStatus.upOutputPowerdBm=a1.adslLineStatus.upOutputPowerdBm+" "+RAINIER.ui.common.strings.adslLineStatus.dBm;a1.adslLineStatus.downNoiseMargindB=a1.adslLineStatus.downNoiseMargindB+" "+RAINIER.ui.common.strings.adslLineStatus.dB;a1.adslLineStatus.upNoiseMargindB=a1.adslLineStatus.upNoiseMargindB+" "+RAINIER.ui.common.strings.adslLineStatus.dB;a1.adslLineStatus.downAttenuationdB=a1.adslLineStatus.downAttenuationdB+" "+RAINIER.ui.common.strings.adslLineStatus.dB;a1.adslLineStatus.upAttenuationdB=a1.adslLineStatus.upAttenuationdB+" "+RAINIER.ui.common.strings.adslLineStatus.dB}}if(a1.adslLineStatus.status){a1.adslLineStatus.status=RAINIER.ui.common.strings.adslLineStatus.status[a1.adslLineStatus.status]}a1.wirelessScheduler=M.wirelessScheduler;if(a1.wirelessScheduler.isWirelessSchedulerEnabled!==undefined){a1.wirelessScheduler.isWirelessSchedulerEnabled=a1.wirelessScheduler.isWirelessSchedulerEnabled?RAINIER.ui.common.strings.enabled:RAINIER.ui.common.strings.disabled;a1.wirelessScheduler.radiosStatus=a1.wirelessScheduler.radiosStatus?RAINIER.ui.common.strings.off:RAINIER.ui.common.strings.on}a1.openVpn=M.openVpn;if(a1.openVpn.isOpenVPNEnabled!==undefined){var aZ=a1.openVpn.clientIPStartAddress.split(".");aZ[3]="2 - 6";a1.openVpn.clientIPStartAddress=aZ.join(".");a1.openVpn.isOpenVPNEnabled=a1.openVpn.isOpenVPNEnabled?RAINIER.ui.common.strings.enabled:RAINIER.ui.common.strings.disabled;a1.openVpn.serverIPAddress=a1.openVpn.hostname||a1.openVpn.serverIPAddress;a1.openVpn.protocol=RAINIER.ui.common.strings.ipProtocol[a1.openVpn.protocol];B.find(".openVpn-users-table .userRow").remove();$.each(a1.openVpn.profiles,function(){B.find(".openVpn-users-table").append('<tr class="userRow"><td>'+this.username+"</td></tr>")})}a1.lanSettings=M.lanSettings;if(M.cloneSettings.isMACAddressCloneEnabled){a1.internetMacAddress=M.cloneSettings.macAddress}else{a1.internetMacAddress=M.wanStatus.macAddress}a1.lanSettings.subnetMask=RAINIER.util.fromPrefixLengthToSubnet(M.lanSettings.networkPrefixLength);if(typeof M.wanStatus.wanConnection!=="undefined"&&M.wanStatus.wanConnection.mtu===0){a1.wanStatus.wanConnection.mtu=RAINIER.ui.common.strings.auto}B.find("#lease-mins").text("");if(a1.wanStatus.wanConnection){if(a1.wanStatus.wanConnection.dhcpLeaseMinutes){if(a1.wanStatus.wanConnection.dhcpLeaseMinutes===1){B.find("#lease-mins").text(RAINIER.ui.common.strings.minute)}else{B.find("#lease-mins").text(RAINIER.ui.common.strings.minutes)}}a1.wanStatus.wanConnection.subnetMask=RAINIER.util.fromPrefixLengthToSubnet(M.wanStatus.wanConnection.networkPrefixLength);a1.ipv4Type=RAINIER.ui.common.strings.wanType[M.wanStatus.wanConnection.wanType]}else{a1.ipv4Type=RAINIER.ui.common.strings.wanType[M.wanStatus.detectedWANType]}if(a1.powerModem.isPowerModemEnabled){a1.ipv4Type=RAINIER.ui.common.strings.wanType[a1.powerModem.dslSettings.wanType]}if(M.wanStatus.detectedWANType==="PPPoE"||M.wanStatus.detectedWANType==="PPTP"||M.wanStatus.detectedWANType==="L2TP"){B.find("#ppp-status").show();a1.wanStatus.currentState=RAINIER.ui.common.strings.wanStatus[a1.wanStatus.state]||RAINIER.ui.common.strings.wanStatus[M.wanStatus.wanStatus]}if(M.wanStatus.wanIPv6Status==="Connected"){a1.ipv6Type=RAINIER.ui.common.strings.wanIpv6Type[M.wanStatus.wanIPv6Connection.wanType];if(M.wanStatus.wanIPv6Connection.wanType==="DHCPv6"){if(a1.wanStatus.wanIPv6Connection.networkInfo.dhcpLeaseMinutes===1){B.find("#ipv6-lease-mins").html(RAINIER.ui.common.strings.minute)}else{B.find("#ipv6-lease-mins").html(RAINIER.ui.common.strings.minutes)}}else{B.find("#ipv6-lease-mins").empty()}if(W.isRouter5Supported){var aV=a1.wanStatus.lanPrefixAddress;if(!aV&&a1.wanStatus.wanIPv6Connection.networkInfo){aV=a1.wanStatus.wanIPv6Connection.networkInfo.lanPrefixAddress}if(a1.ipv6.ipv6rdTunnelSettings){a1.ipv6.ipv6rdTunnelSettings.prefix=aV}else{a1.ipv6.ipv6rdTunnelSettings={prefix:aV}}}}else{a1.ipv6Type=RAINIER.ui.common.strings.wanStatus[M.wanStatus.wanIPv6Status]}switch(M.ports.wanPortConnection){case"1Gbps":a1.internet1gbps="X";break;case"100Mbps":a1.internet100="X";break;case"10Mbps":a1.internet100="X";break}aK.find("tr.port").remove();for(aX=0;aX<M.ports.lanPortConnections.length;aX++){a1["port"+aX+"_1gbps"]="";a1["port"+aX+"_100"]="";switch(M.ports.lanPortConnections[aX]){case"1Gbps":a1["port"+aX+"_1gbps"]="X";break;case"100Mbps":a1["port"+aX+"_100"]="X";break;case"10Mbps":a1["port"+aX+"_100"]="X";break}if(RAINIER.network.isLinkAggregationPresent()){a0=_.contains(M.linkAggregation.aggregatedPorts,aX);if(M.linkAggregation.isEnabled&&a0&&a1["port"+aX+"_1gbps"]!=="X"){aY=false}}}for(aX=0;aX<M.ports.lanPortConnections.length;aX++){if(RAINIER.network.isLinkAggregationPresent()){a0=_.contains(M.linkAggregation.aggregatedPorts,aX);if(M.linkAggregation.isEnabled&&a0&&aY){a1["port"+aX+"_1gbps"]="";a1["port"+aX+"_100"]="";a1["port"+aX+"_linkagg"]="X"}}aK.append(Q.format(aX+1,aX));if(RAINIER.network.isLinkAggregationPresent()&&!a0){aK.find('[name="port'+aX+'_linkagg"]').addClass("not-aggregated")}}if((RAINIER.shared.util.areServicesSupported(["/jnap/wirelessap/WirelessAP3"])&&!RAINIER.shared.util.areServicesSupported(["/jnap/wirelessap/WirelessAP4"]))||(RAINIER.shared.util.areServicesSupported(["/jnap/wirelessap/WirelessAP4"])&&M.wireless.isBandSteeringSupported)){a1.wireless=$.extend(true,{},M.wireless);a1.wireless.isBandSteeringEnabled=(a1.wireless.isBandSteeringEnabled)?RAINIER.ui.common.strings.enabled:RAINIER.ui.common.strings.disabled}else{B.find(".bandSteeringInfo").hide()}RAINIER.binder.toDom(a1,$("#status-report-content"),{},null,true);B.find(".radioInfoReport").remove();aW.isBandSteeringEnabled=false;$.each(M.wireless.radios,function(){a2=RAINIER.shared.util.getLabeledRadio(aW,this.radioID);if(a2.settings.channel===0){a2.settings.channel=RAINIER.ui.common.strings.auto}a2.settings.isEnabled=a2.settings.isEnabled?RAINIER.ui.common.strings.enabled:RAINIER.ui.common.strings.disabled;a2.settings.channelWidth=RAINIER.ui.common.strings.wirelessChannelWidth[a2.settings.channelWidth];a2.settings.security=RAINIER.ui.common.strings.wirelessSecurity[a2.settings.security];var a3=RAINIER.ui.template.createBlock(ao,a2,aS);B.find("#bandSteeringEnabled").after(a3)});B.find("[tooltip]").each(function(){$(this).attr("tooltip",$(this).text())});RAINIER.ui.tooltip.add(B.find("[tooltip]"),"top")}function aP(){function aV(){ar();RAINIER.ui.hideWaiting()}RAINIER.ui.showWaiting();RAINIER.ui.clearTbl(ac);RAINIER.ui.clearTbl(aa);B.find("#lan-ports-wrapper").empty();var aW=RAINIER.jnap.Transaction({onComplete:function(){if(RAINIER.network.isPowerModemSupported()){aR(aV)}else{aV()}}});aw(aW);aW.send()}function aE(){function aV(){var aW=RAINIER.jnap.Transaction({onComplete:j.curry(RAINIER.ui.hideWaiting)});aW.add({action:"/jnap/locale/GetTimeSettings",data:{},cb:function(aX){if(aX.result==="OK"){M.time=aX.output||{}}else{}}});aW.add({action:"/jnap/router/GetDHCPClientLeases",data:{},cb:function(aX){if(aX.result==="OK"){M.dhcpLease=aX.output||{}}else{}}});aW.send()}RAINIER.ui.showWaiting();RAINIER.ui.clearTbl(t);RAINIER.deviceManager.getDevices({threshold:-1,exclusions:{excludeAuthority:true},cb:aV})}function ak(){B.find("#refresh-status").click(function(){aP()});B.find("#open-status").click(function(){am(false)});B.find("#print-status").click(function(){am(true)});B.find("#open-dhcpclienttable").click(function(){aI.show();aE()});B.find("#ppp-connect").click(E);B.find("#ppp-disconnect").click(m);o.find(".refresh").click(function(){aE()});o.find(".cancel, .close-button").click(function(){aI.close();RAINIER.ui.clearTbl(t)})}function i(){ar();ak();if(RAINIER.network.isBridgeMode()){B.find("#devices-sub-tab").remove();B.find("#status-devices").remove();B.find("#report-sub-tab").click()}}function U(aZ,aW,aV){var aX=$.extend(true,aW,{name:aW.friendlyName()});if(aX.ipAddress){var aY=RAINIER.ui.template.createBlock(aV,aX);aZ.append(aY);RAINIER.util.trapEnter(aZ.find("input[type=text]"))}}function af(aW){var aV=aW.connections();if(aV.length>0){aW.macAddress=aV[0].macAddress;aW.ipAddress=aV[0].ipAddress;aW.ipv6Address=aV[0].ipv6Address;if(aV[0].wireless){aW.netType=RAINIER.ui.common.strings.netType.wireless}else{aW.netType=RAINIER.ui.common.strings.netType.lan}}}function am(aW){var a0=null,aY=window.open("/ui/dynamic/applets/troubleshooting/status-report.html"),aX,aZ="",aV="";if(e!=="status-report"){aX=B.find("#devices-wrapper").parent().clone();a0=T.find("#device-status-report-title").text()}else{aX=B.find("#status-report-content").parent().clone();a0=T.find("#router-status-report-title").text()}$.ajax({url:"/ui/static/cache/applets/troubleshooting/css/troubleshooting-print.css",success:function(a1){aV=a1;aZ+='<html dir="'+RAINIER.ui.getDirection()+'"><head>';aZ+='<style type="text/css">'+aV+"</style>";aZ+="<title>"+a0+"</title>";aZ+="</head><body>";aZ+='<article id="troubleshooting-applet">';if(e!=="status-report"){aZ+='<div id="status-devices" class="print">'}aZ+=aX.html();if(e!=="status-report"){aZ+="</div>"}aZ+="</article>";aZ+="</body></html>";setTimeout(function(){p(aY,aZ,aW)},500)}})}function f(){var aX,aW;function aV(){var aY=M.wanStatus.state||M.wanStatus.wanStatus,aZ;ag(null,function(a0){if(a0.result==="OK"){aZ=a0.output.wanStatus;if(aZ&&aZ!==aY&&aZ!=="Connecting"){clearInterval(aW);M.wanStatus=a0.output;aP();H()}else{if(aZ==="Connecting"){T.find('label[name="wanStatus.currentState"]').text("Connecting")}}}});if(aX.getElapsedTimeMs()>ax){clearInterval(aW);aP();H()}}aX=new RAINIER.util.timer();aX.start();aW=setInterval(aV,3000)}function E(){RAINIER.ui.showWaiting();RAINIER.jnap.send({action:"/jnap/router/ConnectPPPWAN",data:{},cb:function(aV){if(aV.result==="OK"){f()}else{}}})}function m(){RAINIER.ui.showWaiting();RAINIER.jnap.send({action:"/jnap/router/DisconnectPPPWAN",data:{},cb:function(aV){if(aV.result==="OK"){f()}else{}}})}function aU(aV){ag(aV,function(aW){if(aW.result==="OK"){M.wanStatus=aW.output||{}}});if(W.isCore4Supported){aV.add({action:"/jnap/core/GetDataUploadUserConsent",data:{},cb:function(aW){if(aW.result==="OK"){M.dataUpload=aW.output||{}}else{}}})}}function I(){var aZ={validationType:"domainOrIpAddress",whiteSpace:false},aX={errors:[{test:RAINIER.ui.validation.tests.isEmail,when:false,message:RAINIER.ui.validation.strings.invalidEmailAddress}]},aY=Y.find("#ping-address"),aW=Y.find("#trace-address"),aV={};RAINIER.util.trapEnter("#upload-configuration");aV.ping=s($.extend(true,{},aZ,{els:aY,groupContainer:"#ping-ipv4"}));aV.trace=s($.extend(true,{},aZ,{els:aW,groupContainer:"#trace-route"}));aV.shareEmail=s($.extend(true,{},aX,{els:aT.find("#send-router-info")}));P.diagnostics=aV}function aj(){return P.diagnostics.ping.isValid(true)}function H(){RAINIER.binder.toDom(M.dataUpload,T.find("#diagnostics-info"),{});RAINIER.binder.toDom(M.wanStatus,T.find("#router-address"),{});if(M.wanStatus.wanStatus!=="Connected"){T.find("#router-address #ip-addr").text("0.0.0.0")}if(M.wanStatus.wanIPv6Status!=="Connected"){T.find("#router-address #ipv6-addr").text("")}if($.cookie("user-auth-token")){Y.find("#router-configuration #backup-user-auth-token").attr("value",$.cookie("user-auth-token"));Y.find("#router-configuration #backup-admin-auth").detach();R.find("#restore-user-auth-token").attr("value",$.cookie("user-auth-token"));R.find("#restore-admin-auth").detach()}else{Y.find("#router-configuration #backup-admin-auth").attr("value",$.cookie("admin-auth"));Y.find("#router-configuration #backup-user-auth-token").detach();R.find("#restore-admin-auth").attr("value",$.cookie("admin-auth"));R.find("#restore-user-auth-token").detach()}}function O(){return(RAINIER.network.getCurrentWanType()==="DHCP")}function u(){Y.find("#restore-previous-firmware").click(x.onRestorePreviousFirmware);if(!O()){Y.find("#renew-ip").prop("disabled","disabled").addClass("disabled");Y.find("#renew-ipv6").prop("disabled","disabled").addClass("disabled")}else{Y.find("#renew-ip").click(function(){aF("RenewDHCPWANLease")});if(W.isRouter5Supported&&M.router5IPv6.wanType==="Pass-through"){Y.find("#renew-ipv6").prop("disabled","disabled").addClass("disabled")}else{Y.find("#renew-ipv6").click(function(){aF("RenewDHCPIPv6WANLease")})}}Y.find(".reboot-router").click(x.onReboot);Y.find("#factory-reset").click(x.onFactoryReset);Y.find("#ping-ipv4 #start-ping").click(an);av.find(".close-button").click(function(){w.close()});RAINIER.util.trapEnter("#ping-address",an);RAINIER.util.trapEnter("#trace-address",q);av.find("#stop-ping").click(g);Y.find("#trace-route #start-trace").click(q);L.find(".close-button").click(function(){b.close()});L.find("#stop-trace").click(aB);if(R.find("#upload-configuration").attr("disabled")){Y.find("#router-configuration #restore").attr("disabled","disabled");Y.find("#router-configuration #backup-config").attr("disabled","disabled")}Y.find("#router-configuration #restore").click(function(){k=true;aH.show()});R.find("#start-to-restore").click(x.onRestoreBackup);R.find(".close-button").click(function(){aH.close()});R.find("#upload-configuration-button").click(function(){if(!$.browser.msie){R.find("#upload-configuration").click()}});if($.browser.msie){R.find("#upload-configuration").hover(function(){R.find("#upload-configuration-button").addClass("hover")},function(){R.find("#upload-configuration-button").removeClass("hover")});R.find("#upload-configuration").mousedown(function(){R.find("#upload-configuration-button").addClass("active")});R.find("#upload-configuration").mouseup(function(){R.find("#upload-configuration-button").removeClass("active")});R.find("#upload-configuration").mouseout(function(){R.find("#upload-configuration-button").removeClass("active")})}R.find("#upload-configuration").change(function(){if($(this).val()){R.find("#start-to-restore").removeAttr("disabled");var aV=$(this).val().replace(/^.*[\\\/]/,"");R.find("#upload-file-name").text(aV)}else{R.find("#start-to-restore").attr("disabled","disabled")}});R.find("#restore-form").submit(function(){if(aq){aq=false;return true}return false});$("#form-target").load(function(){var aX=this.contentWindow.document.body.innerHTML,aW=$(aX),aY=aW?aW.text():"[no response]",aZ=RAINIER.util.parseJSON(aY),aV="2123";console.warn("JCGI call complete - response: "+aW.text());if(aZ){aV=aZ.result}if(aV==="OK"){if(k===true){RAINIER.event.connect("router.interruptionCompleted",function(){RAINIER.network.signOut()});RAINIER.connect.handleSideEffects(["DeviceRestart"]);RAINIER.ui.showMasterWaiting()}}else{RAINIER.ui.dialogError({result:aV,action:"JCGI return: "+aY})}});aT.find(".close-button").click(X.close);aT.find("button").click(al);T.find("#success-share-diagnostics .close").click(z.close);T.find("#share-info").click(ap)}function aN(){aq=true;R.find("#restore-form").submit()}function v(){H();u();I();if(W.isDiagnostics3Supported){T.find("#diagnostics-info").removeClass("hidden")}if(W.isCore4Supported){T.find("#auto-upload-div").removeClass("hidden");T.find("#diagnostics-upload").change(function(){RAINIER.ui.showWaiting();RAINIER.jnap.send({action:"/jnap/core/SetDataUploadUserConsent",data:{userConsent:$(this).prop("checked")},cb:function(aV){RAINIER.ui.wait(false);if(aV.result!=="OK"){}}})})}if(RAINIER.network.isBehindNode()&&!W.isNodesRebootSupported){T.find("#reboot").hide()}}function a(aV){if(aV){aT.find(".working").removeClass("hidden");aT.find(".landing").addClass("hidden");aT.find(".close-button").hide();aT.find("div.textArea").text("");$("#send-router-info").val("")}else{aT.find(".working").addClass("hidden");aT.find(".landing").removeClass("hidden");aT.find(".close-button").show()}aT.find("button").attr("disabled",aV)}function ap(){var aV="/jnap/diagnostics/GetSysinfoData";a(true);X.show();RAINIER.jnap.send({action:aV,data:{},cb:function(aW){if(aW.result==="OK"){aT.find("div.textArea").text(aW.output.sysinfo);a(false)}else{X.close();if(aW.result==="_AjaxError"){aW.result="ErrorGetFailed"}if(RAINIER.ui.validation.strings.errors[aW.result]){RAINIER.ui.alert("",RAINIER.ui.validation.strings.errors[aW.result])}else{RAINIER.ajax().executeDefaultJnapErrorHandler(aW,aV)}}},disableDefaultJnapErrHandler:true,timeoutMs:45000})}function al(){var aW="/jnap/diagnostics/SendSysinfoEmail",aV={addressList:["sysinfoupload@belkin.com"]},aX=$("#send-router-info").val();if(aX){aV.addressList.push(aX)}if(!P.diagnostics.shareEmail.isValid(true)){return}X.close();RAINIER.ui.showWaiting();RAINIER.jnap.send({action:aW,data:aV,cb:function(aY){if(aY.result==="OK"){z.show()}else{if(RAINIER.ui.validation.strings.errors[aY.result]){RAINIER.ui.alert("",RAINIER.ui.validation.strings.errors[aY.result])}else{RAINIER.ajax().executeDefaultJnapErrorHandler(aY,aW)}}},disableDefaultJnapErrHandler:true,timeoutMs:60000})}function J(){var aX,aW;function aV(){ag(null,function(aY){if(aY.result==="OK"){if(aY.output.wanStatus&&(aY.output.wanStatus==="Connected"||aY.output.wanIPv6Status==="Connected")){clearInterval(aW);M.wanStatus=aY.output;setTimeout(function(){aP();H();RAINIER.event.fire("connection.enableCheck");RAINIER.ui.hideWaiting()},10000)}}});if(aX.getElapsedTimeMs()>ax){clearInterval(aW);RAINIER.event.fire("connection.enableCheck");RAINIER.ui.hideWaiting()}}aX=new RAINIER.util.timer();aX.start();aW=setInterval(aV,3000)}function aF(aV){aM({msg:T.find("#renewWANIp").html(),onSubmit:function(){aJ(aV)}})}function aJ(aV){if(aV==="RenewDHCPWANLease"){T.find("#router-address #ip-addr").text("0.0.0.0")}if(aV==="RenewDHCPIPv6WANLease"){T.find("#router-address #ipv6-addr").text("")}RAINIER.ui.showWaiting();RAINIER.event.fire("connection.disableCheck");RAINIER.jnap.send({action:"/jnap/router/"+aV,data:{},cb:function(aW){if(aW.result!=="OK"){}J()}})}function ay(){RAINIER.jnap.send({action:"/jnap/diagnostics/RestorePreviousFirmware",data:{},cb:function(aV){if(aV.result==="OK"){RAINIER.connect.startInterruptionPolling(function(){RAINIER.network.signOut()})}else{}},disableDefaultRebootErrHandler:true,disableDefaultAjaxErrHandler:true})}function K(){function aV(){RAINIER.ui.hideMasterWaiting();RAINIER.event.disconnect("router.interruptionCompleted",aV)}RAINIER.jnap.send({action:"/jnap/core/Reboot",data:{},cb:function(aW){if(aW.result==="OK"){RAINIER.connect.startInterruptionPolling(aV)}else{}},disableDefaultRebootErrHandler:true,disableDefaultAjaxErrHandler:true})}function y(){RAINIER.jnap.send({action:"/jnap/core/FactoryReset",data:{},cb:function(aV){if(aV.result==="OK"){RAINIER.event.connect("router.interruptionCompleted",function(){RAINIER.network.signOut()});RAINIER.ui.showMasterWaiting()}else{}}})}function d(){RAINIER.jnap.send({action:"/jnap/diagnostics/GetTracerouteStatus",data:{},cb:function(aV){if(aV.output){h.text(aV.output.tracerouteLog);if(!aV.output.isRunning){}else{clearTimeout(r);r=setTimeout(d,100)}}else{}}})}function aC(){clearTimeout(r);r=null;aB();h.empty()}function an(){if(aj()){Y.find("#ping-ipv4 #start-ping").attr("disabled","true");var aY=RAINIER.binder.fromDom($("#ping-ipv4"));var aX={};aX.host=aY.pingAddress.host;aX.packetSizeBytes=32;var aV=(aY.pingAddress.pingCount==="five")?5:(aY.pingAddress.pingCount==="ten")?10:(aY.pingAddress.pingCount==="fifteen")?15:0;if(aV>0){aX.pingCount=aV}var aW="/jnap/diagnostics/StartPing";RAINIER.jnap.send({action:aW,data:aX,cb:function(aZ){if(aZ&&aZ.result==="OK"){aA.empty();w.show()}else{if(aZ&&aZ.result&&aZ.result!=="_AjaxError"&&RAINIER.ui.validation.strings.errors[aZ.result]){RAINIER.ui.alert("",RAINIER.ui.validation.strings.errors[aZ.result])}else{RAINIER.ajax().executeDefaultJnapErrorHandler(aZ,aW)}}Y.find("#ping-ipv4 #start-ping").removeAttr("disabled")},disableDefaultJnapErrHandler:true})}}function g(){av.find("#stop-ping").attr("disabled","true");RAINIER.jnap.send({action:"/jnap/diagnostics/StopPing",data:{},cb:function(aV){}});av.find("#stop-ping").removeAttr("disabled")}function n(){RAINIER.jnap.send({action:"/jnap/diagnostics/GetPingStatus",data:{},cb:function(aV){if(aV.output){aA.text(aV.output.pingLog);if(!aV.output.isRunning){}else{setTimeout(n,100)}}else{}}})}function F(){g();aA.empty()}function az(){return P.diagnostics.trace.isValid(true)}function q(){if(az()){Y.find("#trace-route #start-trace").attr("disabled","true");var aX=RAINIER.binder.fromDom($("#trace-route"));var aW={host:aX.traceAddress.host};var aV="/jnap/diagnostics/StartTraceroute";RAINIER.jnap.send({action:aV,data:aW,cb:function(aY){if(aY&&aY.result==="OK"){h.empty();b.show()}else{if(aY&&aY.result&&aY.result!=="_AjaxError"&&RAINIER.ui.validation.strings.errors[aY.result]){RAINIER.ui.alert("",RAINIER.ui.validation.strings.errors[aY.result])}else{RAINIER.ajax().executeDefaultJnapErrorHandler(aY,aV)}}Y.find("#trace-route #start-trace").removeAttr("disabled")},disableDefaultJnapErrHandler:true})}}function aB(){av.find("#stop-trace").attr("disabled","true");RAINIER.jnap.send({action:"/jnap/diagnostics/StopTraceroute",data:{},cb:function(aV){}});av.find("#stop-trace").removeAttr("disabled")}function ab(aV){var aW={firstEntryIndex:1,entryCount:255};aV.add({action:"/jnap/routerlog/GetLogSettings",data:{},cb:function(aX){if(aX.result==="OK"){M.logs.isLoggingEnabled=aX.output.isLoggingEnabled}}});aV.add({action:"/jnap/routerlog/GetIncomingLogEntries",data:aW,cb:function(aX){if(aX.result==="OK"){M.logs.incoming=aX.output}else{}}});aV.add({action:"/jnap/routerlog/GetOutgoingLogEntries",data:aW,cb:function(aX){if(aX.result==="OK"){M.logs.outgoing=aX.output}else{}}});aV.add({action:"/jnap/routerlog/GetSecurityLogEntries",data:aW,cb:function(aX){if(aX.result==="OK"){M.logs.security=aX.output}else{}}});aV.add({action:"/jnap/routerlog/GetDHCPLogEntries",data:aW,cb:function(aX){if(aX.result==="OK"){M.logs.dhcp=aX.output}else{}}})}function C(){var aV=null,aW;V=Z.find(".panel-form").clone();console.warn(["logTbl",V]);Z.find("#enable-logs").attr("checked",M.logs.isLoggingEnabled);if(M.logs.isLoggingEnabled){aV=Z.find("#log-content #incoming");$.each(M.logs.incoming.entries,function(){aW=this;aV.after("<tr><td>{source}</td><td></td><td>{destinationPort}</td><td></td></tr>".formatObj(aW))});aV=Z.find("#log-content #outgoing");$.each(M.logs.outgoing.entries,function(){aW=this;if(aW.service){aW.destinationPort=aW.service}aV.after("<tr><td>{source}</td><td></td><td>{destination}</td><td></td><td>{destinationPort}</td></tr>".formatObj(aW))});aV=Z.find("#log-content #security");$.each(M.logs.security.entries,function(){aW=this;if(aW.authSucceeded){aW.authResult=RAINIER.ui.validation.strings.successful}else{aW.authResult=RAINIER.ui.validation.strings.failed}aV.after("<tr><td>{ipAddress}</td><td></td><td>{macAddress}</td><td></td><td>{timestamp}</td><td></td><td>{authResult}</td></tr>".formatObj(aW))});aV=Z.find("#log-content #dhcp");$.each(M.logs.dhcp.entries,function(){aV.after("<tr><td>{ipAddress}</td><td></td><td>{macAddress}</td><td></td><td>{timestamp}</td><td></td><td>{messageType}</td></tr>".formatObj(this))})}}function aL(){if(M.logs.isLoggingEnabled){RAINIER.ui.showWaiting();Z.find(".panel-form").html(V.html());var aV=RAINIER.jnap.Transaction({onComplete:function(){RAINIER.ui.hideWaiting();C()}});ab(aV);aV.send()}}function ad(){RAINIER.ui.showWaiting();Z.find(".panel-form").html(V.html());RAINIER.jnap.send({action:"/jnap/routerlog/DeleteLogEntries",data:{},cb:function(aV){if(aV.result!=="OK"){}RAINIER.ui.hideWaiting()}})}function G(){Z.find("#refresh-logs").click(function(){aL()});Z.find("#open-logs").click(function(){D(false)});Z.find("#print-logs").click(function(){D(true)});Z.find("#clear-logs").click(function(){ad()})}function aD(){C();G();Z.find("#enable-logs").click(c)}function D(aW){var aY=window.open("/ui/dynamic/applets/troubleshooting/status-report.html"),aX,aZ="",aV="";$.ajax({url:"/ui/static/cache/applets/troubleshooting/css/troubleshooting-print.css",success:function(a0){aV=a0;aX=Z.find(".panel-form").clone();aZ+='<html dir="'+RAINIER.ui.getDirection()+'"><head>';aZ+="<title>"+RAINIER.ui.common.strings.troubleshooting.routerLogs+"</title>";aZ+='<style type="text/css">'+aV+"</style>";aZ+="</head><body>";aZ+='<article id="troubleshooting-applet">';aZ+=aX.html();aZ+="</article>";aZ+="</body></html>";setTimeout(function(){p(aY,aZ,aW)},500)}})}function au(){RAINIER.event.disconnect("connection.enableCheck",au);setTimeout(aL,4000)}function c(){var aV={isLoggingEnabled:Z.find("#enable-logs").is(":checked")};RAINIER.ui.showWaiting();RAINIER.jnap.send({action:"/jnap/routerlog/SetLogSettings",data:aV,cb:function(aW){if(aW.result==="OK"){M.logs.isLoggingEnabled=aV.isLoggingEnabled;if(M.logs.isLoggingEnabled){RAINIER.event.connect("connection.enableCheck",au)}RAINIER.ui.hideWaiting()}else{}}})}function at(){function aV(){i();v();aD();RAINIER.event.fire("applet.loaded")}if(RAINIER.network.isPowerModemSupported()){aR(aV)}else{aV()}}function l(){if(RAINIER.network.isBehindNode()){RAINIER.deviceManager.stopUpdateNodeConnections()}RAINIER.event.disconnect("applet.unloaded",l)}function ai(){RAINIER.deviceManager.getDevices({cb:function(aX){M.devices=aX}});if(RAINIER.network.isBehindNode()){RAINIER.deviceManager.updateNodeConnections(function(){RAINIER.deviceManager.getDevices(aO,{excludeAuthority:true},-1)})}RAINIER.event.connect("applet.unloaded",l);RAINIER.event.connect("tab.changed",function(aX,aY){switch(aY.destTabId){case"diagnostics":RAINIER.ui.fixIeForm("#"+aY.destTabId);break}});var aW=RAINIER.ui.tabs.init({fireEvents:true,initialTab:$.cookie("initial-tab")});aW.connect(function(aY,aX){if(aX.type==="subtab"){e=aX.destTabId}});w=RAINIER.ui.dialog(av,{onShow:n,onClose:F});b=RAINIER.ui.dialog(L,{onShow:d,onClose:aC});aH=RAINIER.ui.dialog(R,{});X=RAINIER.ui.dialog(aT);z=RAINIER.ui.dialog(T.find("#success-share-diagnostics"));W.isLocale2Supported=RAINIER.shared.util.areServicesSupported(["/jnap/locale/Locale2"]);W.isRouter5Supported=RAINIER.shared.util.areServicesSupported(["/jnap/router/Router5"]);W.isDiagnostics3Supported=RAINIER.shared.util.areServicesSupported(["/jnap/diagnostics/Diagnostics3"]);W.isCore4Supported=RAINIER.shared.util.areServicesSupported(["/jnap/core/Core4"]);W.isNodesRebootSupported=RAINIER.shared.util.areServicesSupported(["/jnap/nodes/setup/Setup3"]);var aV=RAINIER.jnap.Transaction({onComplete:at});aw(aV);aU(aV);ab(aV);aV.send()}ai()}());