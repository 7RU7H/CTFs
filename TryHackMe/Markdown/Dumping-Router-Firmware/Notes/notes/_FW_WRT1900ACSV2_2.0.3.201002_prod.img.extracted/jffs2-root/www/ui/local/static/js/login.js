$(document).ready(function(){var b=$("#username"),i=$("#password");var e={username:RAINIER.ui.buildInputValidBalloon({els:b,isRequired:true}),password:RAINIER.ui.buildInputValidBalloon({els:i,isRequired:true})};var a={deviceMode:{},isAdminPasswordDefault:false,isAdminPasswordSetByUser:false};function k(){var q=$("#adminPass").val();if(!RAINIER.shared.util.isAdminPasswordValid(q)){RAINIER.ui.inputBalloon.message({els:$("#adminPass"),message:RAINIER.login.strings.invalidRouterPassword,autoHide:true});return}RAINIER.ui.wait();var p=true;RAINIER.jnap.send({action:"/jnap/core/CheckAdminPassword",data:{},cb:function(s,r){if(s.result==="OK"){$.cookie("admin-auth","Basic "+window.btoa("admin:"+q),{expires:null,path:"/"});$.cookie("user-auth-token",null,{path:"/"});$.cookie("current-network-id",null,{path:"/"});RAINIER.network.setRemoteSetting(false,function(){window.location.replace("/ui/dynamic/index.html")})}else{var t;switch(s.result){case"_ErrorUnauthorized":t=RAINIER.login.strings.invalidRouterPassword;break;case"_AjaxError":if(p){}else{t=RAINIER.login.strings.unexpectedError}break;default:t=RAINIER.login.strings.unexpectedError;break}if(t){RAINIER.ui.wait(false);setTimeout(function(){RAINIER.ui.inputBalloon.message({els:$("#adminPass"),message:t,autoHide:true})},150);return false}}return true},forceLocal:true,disableDefaultJnapErrHandler:true,useAdminAuth:true,adminPasswordOverride:"Basic "+window.btoa("admin:"+q)})}function m(){if($("body").hasClass("connection-remote")){$("#submit-login").click(d)}else{if($("body").hasClass("connection-local")){$("#submit-login").click(k);$(".showPasswordHint a").click(function(){o(true)});$(".hidePasswordHint a").click(function(){o(false)})}}}function o(p){if(p){$(".showPasswordHint").hide();$(".hidePasswordHint").show()}else{$(".showPasswordHint").show();$(".hidePasswordHint").hide()}}function h(p){$("#submit-login").unbind("click");$("body").removeClass("connection-remote");$("body").removeClass("connection-local");if(p==="local"){$("body").addClass("connection-local")}else{if(p==="remote"){$("body").addClass("connection-remote")}}m()}function d(){var q=e.username.isValid(true);if(q){q=e.password.isValid(true)}if(!q){return}RAINIER.ui.wait();var r=$.trim(b.val()),p=$.trim(i.val());Account.onlineLogin(r,p)}function l(){if(!$("body").hasClass("embedded-ui-available")||$("body").hasClass("connection-remote")){RAINIER.ui.showSlides(RAINIER.ui.slideResources.captionLogin)}else{RAINIER.ui.showSlides(RAINIER.ui.slideResources.captionLocalLogin)}}function g(){RAINIER.ui.hideMasterWaiting();RAINIER.ui.showAppletContainer();RAINIER.ui.placeholders.init();if(RAINIER.network.uiLoadedFromCloud()){if($.cookie("user-name")){b.val($.cookie("user-name"));$("#remember-me").attr("checked","checked");setTimeout(function(){i.click()},50)}}else{c()}$("#dialog-overlay").hide();RAINIER.event.fire("uiInitCompleted")}function c(){if(RAINIER.network.isBehindNode()){var p=RAINIER.jnap.Transaction({onComplete:function(q){if(q.result==="OK"){if(a.deviceMode.mode==="Slave"){$("#reset-password").hide()}else{if(!a.isAdminPasswordDefault&&!a.isAdminPasswordSetByUser){window.location.replace("/ui/dynamic/recovery-pin.html")}}}h("local");RAINIER.ui.hideWaiting()},useAdminAuth:true,forceLocal:true,disableDefaultJnapErrHandler:true});p.add({action:"/jnap/nodes/smartmode/GetDeviceMode",data:{},cb:function(q){if(q.result==="OK"){a.deviceMode=q.output||{}}}});p.add({action:"/jnap/core/IsAdminPasswordDefault",data:{},cb:function(q){if(q.result==="OK"){a.isAdminPasswordDefault=q.output.isAdminPasswordDefault}}});p.add({action:"/jnap/nodes/setup/IsAdminPasswordSetByUser",data:{},cb:function(q){if(q.result==="OK"){a.isAdminPasswordSetByUser=q.output.isAdminPasswordSetByUser}}});RAINIER.ui.showWaiting();p.send()}else{h("local")}}function f(){RAINIER.util.trapEnter("#adminPass",k,function(){RAINIER.ui.inputBalloon.hide(100)});RAINIER.util.trapEnter("#password",d,function(){RAINIER.ui.inputBalloon.hide(100)});$("#local-login").click(c);$("#remote-login").click(function(){h("remote")});RAINIER.ui.associateButtons("input[type=text], input[type=password]","#submit-login");RAINIER.event.connect("rainier.cloudDown",function(){if(!RAINIER.network.isBehindNode()||window.location.hash==="#casupport"){h("local")}else{$("#slide-show p + p").hide()}});RAINIER.event.connect("initialInternetCheckCompleted",g);window.onbeforeunload=function(){RAINIER.event.fire("rainier.preventDialogs");RAINIER.event.fire("router.interruptionStarted");if($.cookie("user-auth-token")&&$.cookie("admin-auth")){RAINIER.network.clearUIProxyPathCookie()}};RAINIER.ui.init(m)}function j(){function p(r){var q=r.passwordHint;if(q.length>0){$(".showPasswordHint").show();$("#passwordHint").text(q)}}if(RAINIER.shared.util.areServicesSupported(["/jnap/core/Core3"])){RAINIER.network.getPasswordHint(p)}}function n(){RAINIER.event.connect("RAINIER.network.deviceInfoCache:Set",function(){if(JNAP.cache.data["/core/GetDeviceInfo"]&&!RAINIER.network.isBehindNode()){RAINIER.jnap.send({action:"/jnap/core/IsAdminPasswordDefault",data:{},cb:function(p){if(p.output.isAdminPasswordDefault){RAINIER.network.checkIfSetupInProgress(f,"admin")}else{f()}},forceLocal:true,disableDefaultJnapErrHandler:true})}else{f()}RAINIER.ui.showLinksysAppContent();l()});RAINIER.network.getDeviceInfo(j)}n()});