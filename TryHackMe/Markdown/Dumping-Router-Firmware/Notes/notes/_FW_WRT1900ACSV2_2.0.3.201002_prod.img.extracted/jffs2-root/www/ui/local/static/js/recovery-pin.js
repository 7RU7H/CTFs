$(document).ready(function(){var h=RAINIER.ui.buildInputValidBalloon,g=$("#recovery-pin");function c(j,k){RAINIER.network.getRouterCurrentTime(function(n){var l=symmetryUtil.time.routerTimeToDate(n),p=symmetryUtil.time.routerTimeToDate(j),o=p.getTime()-l.getTime(),m=Math.ceil((o/(1000*60*60))%24);k(m)})}function d(k){var n=g.find("#invalidResetCode"),j=g.find("#attemptsRemaining"),m=g.find("#retriesReached"),l=g.find("#lockoutExpirationTime");RAINIER.ui.hideWaiting();switch(k){case"ErrorInvalidResetCode":m.addClass("hidden");l.addClass("hidden");n.removeClass("hidden");j.removeClass("hidden");break;case"ErrorConsecutiveInvalidResetCodeEntered":n.addClass("hidden");j.addClass("hidden");m.removeClass("hidden");l.removeClass("hidden");break;default:g.find("label").addClass("hidden")}}function f(){if(!a()){return}var k="/jnap/nodes/setup/VerifyRouterResetCode",j={resetCode:g.find("input").val()};RAINIER.ui.wait();RAINIER.jnap.send({action:k,data:j,cb:function(m,l){if(m&&m.result==="ErrorConsecutiveInvalidResetCodeEntered"){c(m.output.lockoutExpirationTime,function(n){d(m.result);g.find("#lockoutExpirationTime span").text(n)})}else{d(m.result);if(m&&m.result==="OK"){RAINIER.shared.util.setCookie("reset-code",j.resetCode,1,"/");window.location.href="/ui/dynamic/change-admin-password.html"}else{if(m&&m.result==="ErrorInvalidResetCode"){g.find("#attemptsRemaining span").text(m.output.attemptsRemaining)}else{RAINIER.ajax().executeDefaultJnapErrorHandler(m,k)}}}},useAdminAuth:true,forceLocal:true,disableDefaultJnapErrHandler:true})}function b(j){return !j||RAINIER.ui.validation.tests.isLengthInRange(5,5,j)}function a(){var k={validCharSet:"numeric",whiteSpace:false,isRequired:true},j=h($.extend(true,{},k,{els:g.find("input"),errors:[{test:b,when:false,message:RAINIER.ui.validation.strings.digit5}]}));return j.isValid(true)}function e(){RAINIER.ui.wait();if(!RAINIER.network.uiLoadedFromCloud()){RAINIER.network.setRemoteSetting(true,function(){window.location.replace("/ui/dynamic/login.html")})}else{window.location.replace("/ui/dynamic/login.html")}}function i(){RAINIER.network.getDeviceInfo(function(){var m=JNAP.cache.data["/core/GetDeviceInfo"].output,j=RAINIER.network.getBaseNetworkModelNumber(),l="/ui/static/cache/images/recovery_pin/",k=l+j+".png";if(symmetryUtil.nodes.isMeshRouter(j)){k=l+"MRxxxx.png"}g.find("#velop-img").attr("src",k);g.find("#submit").click(f);g.find("#remote-login").click(e);RAINIER.ui.associateButtons("input[type=text]","#submit");RAINIER.ui.placeholders.init();RAINIER.jnap.send({action:"/jnap/nodes/setup/IsAdminPasswordSetByUser",data:{},cb:function(n){RAINIER.ui.init();RAINIER.ui.showAppletContainer();if(n&&n.result==="OK"&&!n.output.isAdminPasswordSetByUser){g.find("header h4").removeClass("hidden")}},useAdminAuth:true,forceLocal:true})})}i()});