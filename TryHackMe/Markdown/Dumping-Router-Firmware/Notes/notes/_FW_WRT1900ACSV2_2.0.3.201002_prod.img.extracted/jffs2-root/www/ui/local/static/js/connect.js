window.RAINIER=window.RAINIER||{};RAINIER.connect=(function(){var z=null,G=0,H={},M={},b=null,K=true,a=true,l=null,n=30*1000,y=5*1000,P=n,u=30*1000,L=null,m=true,R=false,I=false,i=false,C=null,t=null,w=2*60*1000,d=4*60*1000;var g=(function(){var T=null,S=false;return{get:function(){return T},set:function(U){T=U;if(U){S=true}},isOrWasConnected:function(){return S}}}());function Q(){var S=B(window.location.hash.substr(1));if(!S||!RAINIER.connect.AppletManager.getAppletById(S)){S=$.cookie("current-applet")}return S}function B(U){var S=RAINIER.connect.AppletManager.getAppletList(),T=U;$.each(S,function(W,V){if(V.urlAccess===U){T=V.appletId;return false}});return T}function o(S){$.cookie("current-applet",S,{expires:null,path:"/"})}function N(){return false}function A(){if(N()){RAINIER.internetRestoredDialog.show()}}function c(){var S;function T(V){if(!V){if(C.getElapsedTimeMs()<=w){var U=15000-(C.getElapsedTimeMs()-S);setTimeout(function(){S=C.getElapsedTimeMs();RAINIER.network.checkInternetConnection(T,true)},U);return}if(RAINIER.network.uiLoadedFromCloud()){RAINIER.ui.dialogSigningOut()}else{RAINIER.ui.hideWaiting()}}I=false;RAINIER.event.fire("connection.enableCheck");C.stop();C=null;RAINIER.ui.hideWaiting();RAINIER.event.fire("router.interruptionCompleted")}if(!I){RAINIER.event.fire("connection.disableCheck");RAINIER.ui.showWaiting();I=true;C=new RAINIER.util.timer();setTimeout(function(){C.start();S=C.getElapsedTimeMs();RAINIER.network.checkInternetConnection(T,true,true)},5000)}}function O(S){var T="";$.each(S,function(U,V){T+=V+" "});if(T.indexOf("DeviceRestart")>-1){RAINIER.event.fire("router.interruptionStarted");H.show();k(true,false)}else{if(T!==""){if(!$("body").hasClass("waiting-overlay-only")){RAINIER.routerInterruptionDialog.show()}if(T.indexOf("WANInterruption")>-1&&RAINIER.connect.isOrWasWanConnected()){c()}}}}function q(S){if(typeof S==="function"){RAINIER.event.connect("router.interruptionCompleted",function(){S()})}RAINIER.event.fire("router.interruptionStarted");setTimeout(function(){RAINIER.connect.checkRouterConnectionForRestoration(true,false)},4000);RAINIER.ui.showMasterWaiting()}function h(S){if(RAINIER.routerInterruptionDialog.isShowing()){RAINIER.routerInterruptionDialog.close()}RAINIER.ui.showWaiting();if(K){k(S,false)}}function E(S){RAINIER.jnap.send({action:"/jnap/core/IsAdminPasswordDefault",data:{},cb:function(T,U){if(typeof S==="function"){S(T,U)}},disableDefaultAjaxErrHandler:true,disableDefaultJnapErrHandler:true,disableDefaultRebootErrHandler:true})}function s(){if(a){E(function(T,U){if(P===n){P=y;clearInterval(l);l=setInterval(x,P)}if(T&&T.result==="_ErrorSessionVerification"){RAINIER.ajax().executeDefaultJnapErrorHandler(T)}else{console.warn("checking for state - jqXHR.status: "+U.status);if(U.status===200){if(!m){RAINIER.event.fire("rainier.lanConnected")}}else{if(RAINIER.network.isAuthorityRemote()){RAINIER.network.handleRemoteConnectionProblem(U.statusText)}else{var S="isAdminPasswordDefault()";if(U.getAllResponseHeaders().length>0){S+=" -- "+U.getAllResponseHeaders()}RAINIER.event.fire("rainier.lanDisconnected",S);RAINIER.event.fire("rainier.wanDisconnected")}}}})}}function p(S){if(S){if(P===y){P=n;clearInterval(l);l=setInterval(x,P)}if(!g.get()){RAINIER.event.fire("rainier.lanConnected");RAINIER.event.fire("rainier.wanConnected")}if(RAINIER.routerNotFoundDialog.isShowing()){RAINIER.routerNotFoundDialog.close()}A()}else{if(g.get()===null||g.get()===true){RAINIER.event.fire("rainier.wanDisconnected")}s()}}function x(){if(K){RAINIER.network.checkInternetConnection(p)}}function J(){var S=new $.Deferred(),T=RAINIER.jnapActions.getWANStatus();RAINIER.jnap.send({action:T,data:{},cb:function(U){S.resolve(U,T)},forceLocal:!RAINIER.network.isAuthorityRemote(),disableDefaultAjaxErrHandler:true,disableDefaultJnapErrHandler:true});return S}function v(T,S){E(function(W,U){if(W&&W.result!=="OK"&&(new Date()).getTime()>G){var V=J();console.warn("timeout expired!");RAINIER.event.fire("router.interruptionCompleted");clearInterval(z);$.when(V).then(function(Y,X){if(Y.result==="_AjaxError"){if(!RAINIER.routerNotFoundDialog.isShowing()){RAINIER.routerNotFoundDialog.show(X)}}else{if(Y.output&&Y.output.wanStatus){if(Y.output.wanStatus!=="Connecting"&&Y.output.wanStatus!=="Connected"){if(RAINIER.network.uiLoadedFromCloud()){RAINIER.ui.dialogSigningOut()}else{RAINIER.ui.hideWaiting()}}else{if(S){RAINIER.network.signOut()}else{c()}}}else{RAINIER.ajax().executeDefaultJnapErrorHandler(Y,X)}}});return}if(T&&(U.status!==200||W.result==="_AjaxError"||W.result==="_ErrorNotReady"||(!i&&!S&&W.result!=="OK"))){i=true}else{if((!T&&U.status===200)||(i&&(W.result==="OK"||(S&&W.result==="_ErrorUnknownSession")))){clearInterval(z);if(S){setTimeout(function(){RAINIER.network.signOut()},30000)}else{i=false;RAINIER.event.fire("router.interruptionCompleted");if(RAINIER.connect.isOrWasWanConnected()){c()}else{setTimeout(function(){RAINIER.event.fire("connection.enableCheck");RAINIER.ui.hideWaiting()},5000)}}}else{}}})}function k(T,S){if(T){G=(new Date()).getTime()+d}else{G=(new Date()).getTime()+w}z=setInterval(function(){v(T,S)},5000)}function F(S){RAINIER.jnap.send({action:"/jnap/core/IsAdminPasswordDefault",data:{},cb:function(T,U){if(typeof S==="function"){S(U)}if(U.status===200){if(RAINIER.routerNotFoundDialog.isShowing()){RAINIER.routerNotFoundDialog.close()}}},disableDefaultAjaxErrHandler:true,disableDefaultJnapErrHandler:true})}function r(){var T=Q();if($.cookie("agent-remote-assistance-session")&&!T){T="CD34B015-6EA6-4FE3-89CA-B47B6F18EF92"}if(T){var S=RAINIER.connect.AppletManager.getAppletById(T);if(S){RAINIER.ui.MainMenu.launchApplet(S)}else{console.warn("Cannot locate "+T)}}}function j(){return m}function e(){return g.get()}function D(){return R}function f(){var S={};if(RAINIER.network.uiLoadedFromCloud()){$("body").addClass("connection-remote")}else{$("body").addClass("connection-local")}RAINIER.applets.guestNetwork.getSettings(S,function(U){RAINIER.event.fire("guestNetwork.updated",U)});RAINIER.event.connect("router.interruptionStarted",function(){RAINIER.event.fire("connection.disableCheck");a=false});RAINIER.event.connect("router.interruptionCompleted",function(){a=true;RAINIER.event.fire("connection.enableCheck");T()});RAINIER.event.connect("connection.disableCheck",function(){K=false});RAINIER.event.connect("connection.enableCheck",function(){K=true});RAINIER.event.connect("rainier.lanConnected",function(){m=true;if(RAINIER.routerNotFoundDialog.isShowing()){RAINIER.routerNotFoundDialog.close()}});RAINIER.event.connect("rainier.lanDisconnected",function(V,U){m=false;if(K&&!RAINIER.routerNotFoundDialog.isShowing()){RAINIER.routerNotFoundDialog.show(U)}});RAINIER.event.connect("rainier.wanConnected",function(){g.set(true);if(L!==null){clearTimeout(L);L=null}});RAINIER.event.connect("rainier.wanDisconnected",function(){g.set(false);if(K&&RAINIER.network.uiLoadedFromCloud()&&L===null){L=setTimeout(function(){RAINIER.ui.dialogSigningOut()},u)}});RAINIER.event.connect("rainier.cloudDown",function(){s()});l=setInterval(x,P);t=setInterval(function(){if(K){RAINIER.deviceManager.getDevices()}},30*1000);$.extend(H,RAINIER.ui.dialog($("#router-reboot"),{onClose:function(){RAINIER.event.fire("dialog.routerRebootClosed")}}));b=$("#radio-disconnect-warning");$.extend(M,RAINIER.ui.dialog(b,{}));function T(){if(H.isShowing()){H.close()}}$("#router-reboot #confirm").click(function(){T();if(!a){RAINIER.ui.showWaiting()}});RAINIER.event.connect("applet.launched",function(){RAINIER.ui.tooltip.remove("#main-menu > li > ul > li");RAINIER.ui.tooltip.add("#main-menu > li > ul > li > span")});RAINIER.event.connect("applet.closed",function(){RAINIER.ui.tooltip.add("#main-menu > li > ul > li");RAINIER.ui.tooltip.remove("#main-menu > li > ul > li > span")});RAINIER.network.checkInternetConnection(function(){R=true})}return{initialize:f,initializeWidgets:function(){RAINIER.connect.widgetManager.setupWidgets()},launchInitialApplet:r,appletWillClose:RAINIER.event.builder("RAINIER.connect.appletWillClose"),appletLaunched:RAINIER.event.builder("RAINIER.connect.appletLaunched"),getCurrentAppletId:Q,setCurrentAppletId:o,checkRouterConnectionForRestoration:k,checkRouterConnection:F,startInterruptionPolling:q,handleRouterInterruption:h,shouldShowInternetRestoredDialog:N,showInternetRestoredDialogIfNecessary:A,routerRebootDialog:H,disconnectWarningDialog:M,elDisconnectWarning:function(){return b},handleSideEffects:O,hasDoneInitialInternetCheck:D,isLanConnected:j,isWanConnected:e,isOrWasWanConnected:function(){return g.isOrWasConnected()},isRouterRebooting:function(){return i}}}());window.RAINIER.connect.ready=(function(){function a(){RAINIER.event.disconnect("ui.RetrievedRemoteSetting",a);RAINIER.network.initializeApplication(function(){RAINIER.ui.tooltip.add("#main-menu > li > ul > li","side");RAINIER.event.connect("applet.widgetsSetup",RAINIER.connect.launchInitialApplet);RAINIER.event.fire("initializeApplicationFinished");if(RAINIER.network.isBehindNode()){var b="BDBC8297-8982-4BCF-84EC-91783FF9013C",c=RAINIER.connect.AppletManager.getAppletById(b);$("#update-nodes").click(function(){RAINIER.ui.herald.close("firmware-update");RAINIER.ui.MainMenu.launchApplet(c,"","update-firmware")});RAINIER.network.checkNodesCurrentFirmwareVersions();if(window.location.hash!=="#casupport"){if(RAINIER.network.isBehindAuthority()||RAINIER.shared.util.areServicesSupported(["/jnap/debug/Debug"])){$("#widget-container .copyright-content div:first").append('<span class="pipe">|</span><a onclick="window.location.replace(\'home.html#casupport\');window.location.reload();" href="#casupport">CA</a>')}}}})}$(function(){RAINIER.event.connect("ui.RetrievedRemoteSetting",a);$(window).bind("beforeunload",function(){RAINIER.event.fire("rainier.preventDialogs");RAINIER.event.fire("router.interruptionStarted");return});if(!RAINIER.network.isBehindNode()){RAINIER.network.checkIfSetupInProgress(RAINIER.network.getDeviceInfo)}else{RAINIER.network.getDeviceInfo()}})})();