if(!window.RAINIER){window.RAINIER={}}window.RAINIER.Device=(function(){var e="userDeviceName",f="userDeviceType",d="userDeviceLocation";var b=RAINIER.ui.strings.deviceList.networkDevice;var a=["e4200","ea2700","ea2750","ea3500","ea4500","ea6100","ea6200","ea6300","ea6350","ea6400","ea6500","ea6700","ea6900","ea7300","ea7400","ea7500","ea8100","ea8300","ea8500","ea9200","ea9300","ea9400","ea9500","whw01","whw01b","whw03","whw03b","wrt1200ac","wrt1900ac","wrt1900acs","wrt3200acm","xac1200","xac1900"];var c={init:function(g){this.data=g},deviceID:function(){var g=function(){return this.data.deviceID}.bind(this);return g()},knownMACAddresses:function(){var g=function(){return this.data.knownMACAddresses}.bind(this);return g()},manufacturer:function(){var g=function(){var h=this.data.model.manufacturer;if(!h){if(this.operatingSystem()==="OS X"){h="Apple"}else{h=""}}return h}.bind(this);return g()},modelNumber:function(){var g=function(){return this.data.model.modelNumber||""}.bind(this);return g()},nodeType:function(){var g=function(){var h=this.firmwareVersion()?this.data.nodeType:null;if(!RAINIER.shared.util.areServicesSupported(["/jnap/devicelist/DeviceList4"])&&_.isEmpty(h)&&(this.getCustomProperty(d)||symmetryUtil.nodes.treatAsModel(this.modelNumber()))){if(this.isAuthority()){h="Master"}else{h="Slave"}}return h||null}.bind(this);return g()},hardwareVersion:function(){var g=function(){return this.data.model.hardwareVersion}.bind(this);return g()},description:function(){var g=function(){return this.data.model.description}.bind(this);return g()},serialNumber:function(){var g=function(){return this.data.unit.serialNumber}.bind(this);return g()},firmwareVersion:function(){var g=function(){return this.data.unit.firmwareVersion}.bind(this);return g()},firmwareDate:function(){var g=function(){return this.data.unit.firmwareDate}.bind(this);return g()},operatingSystem:function(){var g=function(){return this.data.unit.operatingSystem}.bind(this);return g()},connections:function(){var g=function(){return this.data.connections}.bind(this);return g()},isAuthority:function(){var g=function(){return this.data.isAuthority}.bind(this);return g()},friendlyName:function(){var g=function(){var h=deviceManager.findDeviceName(this.data);return h}.bind(this);return g()},defaultName:function(){return b},deviceType:function(){var g=function(){var l=this.getCustomProperty(f)||this.data.model.deviceType,h=this.data.friendlyName?this.data.friendlyName.toLowerCase():"",n=this.operatingSystem()?this.operatingSystem().toLowerCase():"",k=this.manufacturer()?this.manufacturer().toLowerCase():"",j=this.modelNumber()?this.modelNumber().toLowerCase():"";function i(){if(n.indexOf("os x")>-1){if(j.indexOf("book")>-1){l="laptop-mac"}else{l="desktop-mac"}}else{if(n.indexOf("windows")>-1){if(j.indexOf("book")>-1){l="laptop-pc"}else{l="desktop-pc"}}else{if(n.indexOf("android")>-1){l="smartphone"}else{m()}}}}function m(){if(h.indexOf("iphone")>-1||h.indexOf("android")>-1){l="smartphone"}else{if((h.indexOf("apple")>-1&&h.indexOf("tv")>-1)||h.indexOf("ipod")>-1){l="digital-media-player"}else{if(h.indexOf("ipad")>-1||h.indexOf("kindle")>-1){l="tablet-ereader"}else{if(h.indexOf("laptop")>-1||h.indexOf("book")>-1){if(k.indexOf("apple")>-1){l="laptop-mac"}else{l="laptop-pc"}}else{if(h.indexOf("imac")>-1){l="desktop-mac"}else{l="generic-device"}}}}}}if(RAINIER.util.isNoE(l)||l==="Infrastructure"){if(this.isAuthority()){l="this-router"}else{if(k.indexOf("cisco")>-1||k.indexOf("linksys")>-1||k.indexOf("belkin")>-1){if(this.nodeType()){j=symmetryUtil.nodes.treatAsModel(j)||j;j=j.toLowerCase()}if($.inArray(j,a)>-1){l="router-"+j}else{if(j==="re7000"){l="extender-re7000"}else{if(j.indexOf("re")>-1||j.indexOf("extender")>-1){l="linksys-extender"}else{if(j.indexOf("wet")>-1){l="linksys-bridge"}else{i()}}}}}else{if(h.indexOf("wumc710")>-1){l="linksys-bridge"}else{i()}}}}else{if(l==="Computer"){if(k.indexOf("apple")>-1){if(j.indexOf("book")>-1){l="laptop-mac"}else{if(j.indexOf("mac")>-1){l="desktop-mac"}else{i()}}}else{i()}}else{if(l==="Mobile"||l==="Phone"){if(j.indexOf("ipad")>-1){l="tablet-ereader"}else{if(j.indexOf("iphone")>-1){l="smartphone"}else{if(j.indexOf("ipod")>-1){l="digital-media-player"}else{if(j.indexOf("kindle")>-1){l="tablet-pc"}else{i()}}}}}else{if(l==="Tablet"){if(j.indexOf("ipad")>-1){l="tablet-ereader"}}else{if(l==="MediaPlayer"){if(j.indexOf("chromecast")>-1){l="media-stick"}}else{if(l==="DigitalAssistant"){if(j.indexOf("echo")>-1){l="amazon-echo"}else{if(j.indexOf("google home")>-1){l="google-home"}}}}}}}}if(RAINIER.util.isNoE(l)){l="generic-device"}return l}.bind(this);return g()},isOnline:function(){var g=function(){return this.data.connections.length>0}.bind(this);return g()},isGuest:function(){var g=function(){if(!this.isOnline()){return false}return this.data.connections.every(function(h){if(RAINIER.shared.util.areServicesSupported(["/jnap/guestnetwork/GuestNetwork4"])){return h.isGuest}else{return h.wireless&&h.wireless.isGuest}})}.bind(this);return g()},setUserName:function(h,g){this.setCustomProperty(e,h);if(typeof g==="function"){g()}},setUserType:function(h,g){this.setCustomProperty(f,h);if(typeof g==="function"){g()}},removeMe:function(g){var i="/jnap/devicelist/DeleteDevice",h=this.deviceID();if(RAINIER.deviceManager.checkDeviceID(h)){RAINIER.jnap.send({action:i,data:{deviceID:h},cb:function(j){if(j.result==="OK"){RAINIER.deviceManager.deleteDevice(h)}if(typeof g==="function"){g(j,i)}},disableDefaultJnapErrHandler:true})}else{console.info("Device already removed:",h)}},getCustomProperty:function(g){var h=function(){var j,k=null;for(j=0;j<this.data.properties.length;j++){if(this.data.properties[j].name===g){k=this.data.properties[j].value;break}}return k}.bind(this);return h()},setCustomProperty:function(h,j,g){var i=this;RAINIER.jnap.send({action:"/jnap/devicelist/SetDeviceProperties",data:{deviceID:i.deviceID(),propertiesToModify:[{name:h,value:j}]},cb:function(k){if(k&&k.result==="OK"){RAINIER.deviceManager.getDevices(function(l){$.each(l,function(){if(this.deviceID()===i.deviceID()){var m=false;$.each(this.data.properties,function(n){if(this.name===h){i.data.properties[n].value=j;m=true;return}});if(!m){i.data.properties.push({name:h,value:j})}return}})})}if(typeof g==="function"){g(k)}},disableDefaultJnapErrHandler:true})},removeCustomProperty:function(h,g){var j=this;function i(k){if(typeof g==="function"){g(k)}}if(!j.getCustomProperty(h)){i();return}RAINIER.jnap.send({action:"/jnap/devicelist/SetDeviceProperties",data:{deviceID:j.deviceID(),propertiesToRemove:[h]},cb:function(k){if(k&&k.result==="OK"){RAINIER.deviceManager.getDevices(function(l){$.each(l,function(){if(this.deviceID()===j.deviceID()){$.each(this.data.properties,function(m){if(this.name===h){j.data.properties.splice(m,1);return false}});return false}})})}i(k)},disableDefaultJnapErrHandler:true})}};return function(){var g=Object.create(c);g.init.apply(g,arguments);return g}})();window.RAINIER.deviceManager=(function(){var q=0,w=0,l=0,H=0,c=30000,t={},s=[],f=2500,A=60000,z=A/f,m=-1,E=RAINIER.jnapActions.getDevices(),r,d=false,B=true;if(RAINIER.event){RAINIER.event.connect("router.interruptionStarted",function(){B=false});RAINIER.event.connect("router.interruptionCompleted",function(){B=true})}function x(J,K){var I=null;$.each(K.connections(),function(){if(this.macAddress===J){I=this;return}});return I}function v(I){var J={deviceID:I.macAddress,isAuthority:false,friendlyName:"",knownMACAddresses:[I.macAddress],connections:[{macAddress:I.macAddress,ipAddress:I.ipAddress}],model:{deviceType:""},unit:{},properties:[]};return RAINIER.Device(J)}function j(I,L){function M(T){var R=null,P=[],S,Q=false;if(T&&T.result==="OK"){var N,O;$.each(s,function(){N=this;$.each(t,function(){O=x(N.macAddress,this);if(O){O.negotiatedMbps=N.negotiatedMbps;O.wireless=N.wireless}})});if(r===false){S=false;$.each(t,function(U,V){if(V.isGuest()){S=true;delete t[U]}});if(S){RAINIER.event.fire("devices.guestNetworkUpdated")}}else{if(r||RAINIER.shared.util.areServicesSupported(["/jnap/devicelist/DeviceList4"])){if(d){i(function(U){Q=false;l=U.output.clients.length;$.each(U.output.clients,function(){R=v(this);function V(W){return $.grep(W,function(X){return X===R.data.knownMACAddresses[0]}).length}$.each(t,function(){if(!this.isGuest()&&this.isOnline()){if(V(this.knownMACAddresses())>0){l--;Q=true}}});if(!Q&&!t[this.macAddress]){R.isGuest=function(){return true};$.each(t,function(W,X){if(!X.isGuest()&&!X.isOnline()){if(V(X.knownMACAddresses())>0){R.data.friendlyName=X.friendlyName();R.data.properties=X.data.properties.clone();delete t[W]}}});t[R.deviceID()]=R;if(R.friendlyName()===R.defaultName()){P.push(R)}}});$.each(t,function(W,V){if(V.isOnline()){$.each(t,function(Y,X){if(W!==Y&&t[Y].isGuest()){if($.grep(V.knownMACAddresses(),function(Z){return Z===X.data.knownMACAddresses[0]}).length>0){console.warn("Removing Guest client moved to main network");delete t[Y];l--;return false}}})}else{if(V.isGuest()){S=true;$.each(U.output.clients,function(){R=v(this);if($.grep(V.knownMACAddresses(),function(X){return X===R.data.knownMACAddresses[0]}).length>0){S=false}});if(S){delete t[W];l--}}}});if(l<0){l=0}})}else{l=_.filter(t,function(U){return U.isGuest()}).length;P=_.filter(t,function(U){return U.isGuest()&&U.friendlyName()===U.defaultName()})}if(H!==l){H=l;RAINIER.event.fire("devices.guestNetworkUpdated")}if(P.length>0){RAINIER.jnap.send({action:"/jnap/router/GetDHCPClientLeases",data:{},cb:function(U){if(U.result==="OK"){$.each(P,function(){R=this;$.each(U.output.leases,function(){if(R.data.knownMACAddresses[0]===this.macAddress&&this.hostName){R.data.friendlyName=this.hostName;t[R.deviceID()]=R}})})}},disableDefaultAjaxErrHandler:true})}}}I()}else{if(typeof L==="function"){L(T,E)}else{if(T.result!=="_AjaxError"){RAINIER.ajax().executeDefaultJnapErrorHandler(T,E)}}}}if(B){var J=RAINIER.jnap.Transaction({onComplete:M,disableDefaultJnapErrHandler:true,disableDefaultAjaxErrHandler:true,disableDefaultRebootErrHandler:true}),K=false;J.add({action:E,data:{sinceRevision:q},cb:function(N){if(N.result==="OK"){N.output.devices.forEach(function(O){if(!K&&!t[O.deviceID]){K=true}t[O.deviceID]=RAINIER.Device(O);if(!t[O.deviceID].data.knownMACAddresses){t[O.deviceID].data.knownMACAddresses=_.map(O.knownInterfaces,"macAddress")}});N.output.deletedDeviceIDs.forEach(function(O){delete t[O]});if(q!==N.output.revision){q=N.output.revision;RAINIER.event.fire("devices.revisionUpdated")}if(K){RAINIER.event.fire("devices.newDevices")}w=(new Date()).getTime()}}});J.add({action:RAINIER.jnapActions.getNetworkConnections(),data:{},cb:function(N){if(N.result==="OK"){s=N.output.connections}}});J.send()}}function C(K){if(typeof K!=="object"){K={cb:arguments[0],threshold:arguments[1],cbJNAPError:arguments[2]}}var J=K.cb,I=K.threshold,L=K.cbJNAPError;I=I||c;if((new Date()).getTime()>(w+I)||0===w){j(J,L)}else{J()}}function k(L){if(typeof L!=="object"){L={cb:arguments[0],exclusions:arguments[1],threshold:arguments[2],cbError:arguments[3],doPollForChange:arguments[4]}}var J=L.cb,K=L.exclusions||{},I=L.threshold,N=L.cbError,M=!!L.doPollForChange,O=L.currentRevision||-1;if(M&&m===-1&&O===-1){L.currentRevision=O=q;m=0}C(function(){if(M&&O===q&&m<z){m++;setTimeout(function(){k(L)},f)}else{var P=[];if(M){m=-1}$.each(t,function(){if((K.excludeAuthority&&this.isAuthority())||(K.excludeOffline&&this.data.connections.length<1)||(K.excludeMainNetwork&&!this.isGuest())||(K.excludeGuest&&this.isGuest())||(K.excludeNodes&&this.nodeType())){return true}P.push($.extend(true,{},this))});if(typeof J==="function"){J(P)}}},I,N)}function p(K){if(typeof K!=="object"){K={cb:arguments[0],macAddress:arguments[1],threshold:arguments[2],cbError:arguments[3]}}var J=K.cb,L=K.macAddress,I=K.threshold,M=K.cbError;C(function(){var N=null;$.each(t,function(){for(var O=0;O<this.data.knownMACAddresses.length;O++){if(L===this.data.knownMACAddresses[O]){N=this;return false}}});J(N)},I,M)}function b(K){if(typeof K!=="object"){K={cb:arguments[0],ipAddress:arguments[1],threshold:arguments[2],cbError:arguments[3]}}var J=K.cb,L=K.ipAddress,I=K.threshold,M=K.cbError;C(function(){var N=null;$.each(t,function(){if(this.connections()){var P=this.connections();for(var O=0;O<P.length;O++){if(P[O].ipAddress===L){N=this;return false}}}});J(N)},I,M)}function o(K){if(typeof K!=="object"){K={cb:arguments[0],matchDeviceID:arguments[1],threshold:arguments[2],cbError:arguments[3]}}var J=K.cb,M=K.matchDeviceID,I=K.threshold,L=K.cbError;C(function(){var N=null;$.each(t,function(){if(this.deviceID()===M){N=this;return false}});J(N)},I,L)}function G(L){if(typeof L!=="object"){L={cb:arguments[0],deviceTypes:arguments[1],threshold:arguments[2],cbError:arguments[3]}}var J=L.cb,K=L.deviceTypes,I=L.threshold,M=L.cbError;C(function(){var N=[];$.each(t,function(){for(var O=0;O<K.length;O++){if(K[O]===this.deviceType()){N.push(this);break}}});J(N)},I,M)}function u(L){if(typeof L!=="object"){L={cb:arguments[0],cbFilter:arguments[1],threshold:arguments[2],cbError:arguments[3]}}var K=L.cb,J=L.cbFilter,I=L.threshold,M=L.cbError;C(function(){var O=[];for(var N in t){if(J(t[N])){O.push(t[N])}}K(O)},I,M)}function F(K){if(typeof K!=="object"){K={cb:arguments[0],threshold:arguments[1],cbError:arguments[2]}}var J=K.cb,I=K.threshold,L=K.cbError;C(function(){var M=null;for(var N in t){if(t[N].isAuthority()){M=t[N];break}}J(M)},I,L)}function i(I){RAINIER.jnap.send({action:"/jnap/guestnetwork/GetGuestNetworkClients",data:{},cb:function(J){if(J.result==="OK"){if(typeof I==="function"){I(J)}}else{}},disableDefaultAjaxErrHandler:true})}function e(I){return t[I]}function a(I){delete t[I];RAINIER.event.fire("devices.revisionUpdated")}function n(){if(!r){t={}}else{$.each(t,function(I){if(!t[I].isGuest()){delete t[I]}})}q=0;w=0}function D(I){r=I.isGuestNetworkEnabled;if(RAINIER.shared.util.areServicesSupported(["/jnap/guestnetwork/GuestNetwork4"])){d=I.isGuestNetworkACaptivePortal}else{d=RAINIER.network.isGuestNetworkClientUsed()}}function h(I){if(!RAINIER.shared.util.areServicesSupported(["/jnap/nodes/networkconnections/NodesNetworkConnections"])){console.warn("Node does not support NodesNetworkConnections, skipping");return}deviceManager.init().then(function(){deviceManager.nodes.startNetworkConnectionsPolling(function(J){$.each(J.changedDevices,function(L,K){$.each(t,function(){if(this.deviceID()===K.deviceID){this.data.connections=K.connections;return false}})});if(J.changedDevices.length&&typeof I==="function"){I()}})})}function g(){deviceManager.nodes.stopNetworkConnectionsPolling()}function y(){RAINIER.event.connect("guestNetwork.updated",function(I,J){D(J)});RAINIER.event.connect("RAINIER.network.deviceInfoCache:Set",function(){var I=RAINIER.jnapActions.getDevices();if(I!==E){E=I;q=0;w=0}})}y();return{getDevices:k,getDeviceByMACAddress:p,getDeviceByIPAddress:b,getDeviceByDeviceID:o,getDevicesByTypes:G,getDevicesByCallback:u,getAuthorityDevice:F,checkDeviceID:e,deleteDevice:a,clearDevices:n,updateNodeConnections:h,stopUpdateNodeConnections:g}}());