RAINIER.userRetryCount=0;RAINIER.SLEEP_AFTER_WAN_CABLE_CONNECTED=10000;RAINIER.SLEEP_AFTER_PM_CABLE_CONNECTED=10000;RAINIER.CHECK_WAN_CABLE_CONNECTED_TIMEOUT=10000;RAINIER.CHECK_WAN_CABLE_CONNECTED_INTERVAL=3000;RAINIER.PPPOE_RECONNECT_AFTER_SECS=20;RAINIER.DELAY_AFTER_SET_WAN_SETTINGS=45000;RAINIER.POLL_FOR_WAN_IP_MAX_RETRIES=18;RAINIER.POLL_FOR_WAN_IP_INTERVAL=5000;RAINIER.POLL_WAN_TYPE_MAX_RETRIES=6;RAINIER.POLL_WAN_TYPE_INTERVAL=5000;RAINIER.DELAY_AFTER_DISABLE_PM_DHCP=90000;RAINIER.MAX_PM_USER_RETRIES=4;RAINIER.RETRYING_INTERNET_CHECK=false;function goToNextPage(a){if(a){RAINIER.shared.util.setCookie("hasInternet","true",null,"/")}RAINIER.setup.goToVerifiedPage("update")}function isWanIpAddressNonZero(a){return !!a&&a!=="0.0.0.0"}function pollForWanIp(a){if(typeof a!=="number"){a=0}RAINIER.jnap.send({action:"/jnap/router/GetWANStatus",data:{},cb:function(c){if(c.result==="OK"){var b=c.output.wanConnection;if(b&&isWanIpAddressNonZero(b.ipAddress)){goToNextPage(true)}else{if(a<RAINIER.POLL_FOR_WAN_IP_MAX_RETRIES){setTimeout(function(){pollForWanIp(++a)},RAINIER.POLL_FOR_WAN_IP_INTERVAL)}else{showGeneralError(RAINIER.setup.ui.pppoeSettingsInvalid);showView("pppoeCredentials")}}}}})}function pppInputsAreValid(b,a){clearAllInputErrors();if(b.length>255){showInputValidationError("usernameInputValidation",false)}else{if(!RAINIER.shared.util.isAscii(b)){showInputValidationError("usernameInputValidation",true,RAINIER.setup.ui.inputInvalid)}else{if(a.length>255){showInputValidationError("passwordInputValidation",false)}else{if(!RAINIER.shared.util.isAscii(a)){showInputValidationError("passwordInputValidation",true,RAINIER.setup.ui.inputInvalid)}else{return true}}}}return false}function userEnteredPPPCredentials(){var b=document.getElementById("skipPppoe").checked;if(b){showView("working");goToNextPage(false)}else{var d=document.getElementById("pppoeUsername").value,a=document.getElementById("pppoePassword").value;if(!pppInputsAreValid(d,a)){showView("pppoeCredentials");return}var c=document.getElementById("pppoeStatusMessage");document.addClass(c,"hidden");showView("working");RAINIER.jnap.send({action:"/jnap/router/GetWANSettings",data:{},cb:function(g){if(g.result==="OK"){var h=g.output;var e={username:d,password:a,serviceName:h.pppoeSettings?h.pppoeSettings.serviceName:"",behavior:"KeepAlive",maxIdleMinutes:1,reconnectAfterSeconds:RAINIER.PPPOE_RECONNECT_AFTER_SECS};var f={wanType:"PPPoE",mtu:h.mtu,pppoeSettings:e};RAINIER.jnap.send({action:"/jnap/router/SetWANSettings",data:f,cb:function(i){if(i.result==="OK"){setTimeout(function(){pollForRouterConnection({cb:pollForWanIp})},RAINIER.DELAY_AFTER_SET_WAN_SETTINGS)}else{if(i.result!=="_AjaxError"){if(i.result==="ErrorInvalidUsername"){showInputValidationError("usernameInputValidation",true,RAINIER.setup.ui.inputInvalid)}else{if(i.result==="ErrorInvalidPassword"){showInputValidationError("passwordInputValidation",true,RAINIER.setup.ui.inputInvalid)}else{RAINIER.executeDefaultJnapErrorHandler(i)}}}}},disableDefaultJnapErrHandler:true})}}})}}function configurePPP(){RAINIER.jnap.send({action:"/jnap/router/GetWANStatus",data:{},cb:function(b){if(b.result==="OK"){var a=b.output.wanConnection;if(a&&isWanIpAddressNonZero(a.ipAddress)){goToNextPage(true)}else{showView("pppoeCredentials");changeBtnState(document.getElementById("nextButton"),true)}}}})}function noInternetDetectWan(a){RAINIER.jnap.send({action:"/jnap/router/GetWANStatus",data:{},cb:function(d){if(d.result==="OK"){var c=d.output.wanStatus,b=d.output.detectedWANType;if(d.output.isDetectingWANType&&a<RAINIER.POLL_WAN_TYPE_MAX_RETRIES){setTimeout(function(){noInternetDetectWan(++a)},RAINIER.POLL_WAN_TYPE_INTERVAL)}else{if((c==="Connected"||c==="Connecting")&&b!=="DHCP"){configurePPP()}else{if(c==="Connected"&&!RAINIER.RETRYING_INTERNET_CHECK){RAINIER.RETRYING_INTERNET_CHECK=true;checkInternet(internetCheckCompleted)}else{RAINIER.setup.goToPage("/ui/dynamic/setup/powercycle_modem.html")}}}}}})}function internetCheckCompleted(a){if(RAINIER.PMSettings.isPowerModemEnabled){RAINIER.setup.goToPage("/ui/dynamic/setup/pm_region.html")}else{if(a){goToNextPage(a)}else{noInternetDetectWan(0)}}}function getDSLSettingsCompleted(){if(!RAINIER.PMSettings.isPowerModemEnabled){showView("pmCableInstructions")}else{getTypeOfConnection()}}function supportsPMCompleted(a){if(!a){setTimeout(verifyWanStatus,RAINIER.setup.UI_DELAY)}else{setTimeout(function(){getDSLSettings(getDSLSettingsCompleted)},RAINIER.setup.UI_DELAY)}}function waitForWanToConnect(a){if(typeof a!=="number"){a=(new Date()).getTime()}RAINIER.jnap.send({action:"/jnap/router/GetWANStatus",data:{},cb:function(e,c){if(e.result==="OK"){var d=e.output.wanStatus,b=e.output.detectedWANType;if(d==="Connected"||(d==="Connecting"&&b==="PPPoE")||((new Date()).getTime()>a+RAINIER.CHECK_WAN_CABLE_CONNECTED_TIMEOUT)){setTimeout(verifyWanStatus,RAINIER.SLEEP_AFTER_WAN_CABLE_CONNECTED)}else{setTimeout(function(){waitForWanToConnect(a)},RAINIER.CHECK_WAN_CABLE_CONNECTED_INTERVAL)}}else{if(c.status!==200){pollForRouterConnection({cb:verifyWanStatus})}}},disableDefaultAjaxErrHandler:true})}function verifyWanStatus(){RAINIER.jnap.send({action:"/jnap/router/GetWANStatus",data:{},cb:function(b){if(b.result==="OK"){var a=b.output.wanStatus;if(a==="LimitedConnection"||a==="Connecting"||a==="Connected"){RAINIER.userRetryCount=0;checkInternet(internetCheckCompleted)}else{if(RAINIER.userRetryCount>=RAINIER.MAX_PM_USER_RETRIES){RAINIER.userRetryCount=0;RAINIER.executeDefaultJnapErrorHandler(b)}else{if(a==="Disconnected"){showView("wanCableUnplugged");RAINIER.userRetryCount++}else{if(a==="Indeterminate"){setTimeout(verifyWanStatus,RAINIER.SLEEP_AFTER_WAN_CABLE_CONNECTED);RAINIER.userRetryCount++}else{}}}}}}})}function getADSLLineStatus(){RAINIER.jnap.send({action:"/jnap/powermodem/GetADSLLineStatus",data:{},timeoutMs:15000,cb:function(b){if(b.result==="OK"){var a=b.output.status;if(a==="Up"){RAINIER.userRetryCount=0;checkInternet(internetCheckCompleted)}else{if(RAINIER.userRetryCount>=RAINIER.MAX_PM_USER_RETRIES){RAINIER.userRetryCount=0;RAINIER.executeDefaultJnapErrorHandler(b)}else{if(a==="Down"||a==="Initialized"){showView("pmCableInstructions");RAINIER.userRetryCount++}else{if(a==="Initializing"){setTimeout(getADSLLineStatus,RAINIER.SLEEP_AFTER_PM_CABLE_CONNECTED);RAINIER.userRetryCount++}else{}}}}}}})}function getTypeOfConnection(){RAINIER.jnap.send({action:"/jnap/powermodem/GetPowerModemStatus",data:{},cb:function(b){if(b.result==="OK"){var a=b.output.status;if(a==="Found"){RAINIER.userRetryCount=0;setTimeout(getADSLLineStatus,RAINIER.INTERNET_POLL_INTERVAL)}else{if(RAINIER.userRetryCount>=RAINIER.MAX_PM_USER_RETRIES){RAINIER.userRetryCount=0;RAINIER.executeDefaultJnapErrorHandler(b)}else{if(a==="NotFound"||a==="Unknown"){showView("pmCableInstructions");RAINIER.userRetryCount++}else{if(a==="Detecting"){setTimeout(getTypeOfConnection,RAINIER.SLEEP_AFTER_PM_CABLE_CONNECTED);RAINIER.userRetryCount++}else{}}}}}}})}function supportsPM(a){RAINIER.jnap.send({action:"/jnap/core/GetDeviceInfo",data:{},cb:function(c){if(c.result==="OK"){RAINIER.jnapCache.set(RAINIER.jnapActions.getDeviceInfo(),c.output);var b=RAINIER.shared.util.areServicesSupported(["/jnap/powermodem/PowerModem"]);a(b)}}})}function onNext(){var a=getCurrentView();startPleaseWaitTimer();showView("working");setTimeout(function(){if(a==="wanCableUnplugged"){waitForWanToConnect()}else{if(a==="pmCableInstructions"){if(document.getElementById("pmSetupCheckbox").checked){RAINIER.PMSettings.isPowerModemEnabled=false}else{RAINIER.PMSettings.isPowerModemEnabled=true}setDSLSettings(function(b){if(b.result==="OK"){if(!RAINIER.PMSettings.isPowerModemEnabled){RAINIER.userRetryCount=0;setTimeout(verifyWanStatus,RAINIER.DELAY_AFTER_DISABLE_PM_DHCP)}else{setTimeout(getTypeOfConnection,RAINIER.INTERNET_POLL_INTERVAL)}}else{showView("landing");RAINIER.executeDefaultJnapErrorHandler(b)}})}else{if(a==="pppoeCredentials"){userEnteredPPPCredentials()}}}},RAINIER.setup.UI_DELAY)}function checkInputs(){}window.onbeforeunload=function(){return RAINIER.shared.util.decodeHtml(RAINIER.setup.ui.confirmExit)};window.onload=function(){startPleaseWaitTimer();showView("loading");supportsPM(supportsPMCompleted)};