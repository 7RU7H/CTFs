window.RAINIER=window.RAINIER||{};RAINIER.network=RAINIER.network||{};RAINIER.radioSettings=RAINIER.radioSettings||[];RAINIER.PMSettings=RAINIER.PMSettings||{isPowerModemEnabled:false};RAINIER.setup=RAINIER.setup||{};RAINIER.setup.UI_DELAY=1000;RAINIER.INTERNET_POLL_INTERVAL=5000;RAINIER.INTERNET_POLL_MAX_COUNT=24;RAINIER.MAX_USER_RETRIES=3;RAINIER.MAX_INTERNET_RETRIES=5;RAINIER.POLL_FOR_ROUTER_CONNECTION_DEFAULT_INTERVAL=5000;RAINIER.POLL_FOR_ROUTER_CONNECTION_DEFAULT_MAX_TRIES=30;RAINIER.NONCLOUDMODELS=[];var cookiePasswordPrefix="wirelessPassword";if(window.$){$ajax=jQuery.ajax;$ajaxSetup=jQuery.ajaxSetup;$deferred=jQuery.Deferred;$extend=jQuery.extend;$isFunction=jQuery.isFunction;$=undefined;jQuery=undefined}if(typeof console==="undefined"){console={}}if(typeof console.log==="undefined"){}if(typeof console.error==="undefined"){}if(!RAINIER.network.isBehindNode){RAINIER.network.isBehindNode=function(){return false}}function clickNextOnEnter(d,c){var b=d.keyCode||d.which;if(b===13){var a=document.getElementById(c);if(!a.disabled){a.onclick()}}}RAINIER.setup.goToPage=function(a){window.onbeforeunload=null;window.location.href=a};RAINIER.setup.goToVerifiedPage=function(b,a){RAINIER.shared.ui.goToVerifiedUrl("/ui/dynamic/setup/"+b+".html",a)};RAINIER.setup.setTextForNode=function(b,a){b.innerHTML="";if(b.appendChild&&document.createTextNode){b.appendChild(document.createTextNode(a))}else{b.textContent=b.innerText=a}};function parseJSON(c){var a=null;try{a=JSON.parse(c)}catch(b){}return a}document.elementHasClass=function(b,c){var a=" "+b.className+" ";return(a.indexOf(" "+c+" ")!==-1)};document.getElementsByClass=function(d,c){if(!c){c=document.getElementById("dialog")}var e=[],a=c.getElementsByTagName("*");for(var b=0;b<a.length;b++){if(document.elementHasClass(a[b],d)){e.push(a[b])}}return e};document.addClass=function(b,c){if(b){var d=" "+c+" ";var a=" "+b.className+" ";if(a.indexOf(d)<0){if(b.className.length===0){b.className=c}else{b.className=b.className+" "+c}}}};document.addClassById=function(c,b){var a=document.getElementById(c);document.addClass(a,b)};document.removeClass=function(b,c){var d=" "+c+" ";if(b){var a=" "+b.className+" ";while(a.indexOf(d)>=0){a=a.replace(d," ")}if(a.charAt(0)===" "){a=a.slice(1,a.length)}if(a.charAt(a.length-1)===" "){a=a.slice(0,a.length-1)}b.className=a}};document.removeClassById=function(c,b){var a=document.getElementById(c);document.removeClass(a,b)};document.setElementDispaly=function(a,b){if(a&&a.style){a.style.display=b}};document.hideElement=function(a){document.setElementDispaly(a,"none")};document.showElement=function(a){document.setElementDispaly(a,"block")};document.hideElementById=function(a){document.hideElement(document.getElementById(a))};document.showElementById=function(a){document.showElement(document.getElementById(a))};function showInputValidationError(b,e,c){var d=document.getElementById(b),f=document.getElementsByClass("inputValidationBox",d)[0],a=document.getElementsByClass("inputField",d)[0];document.addClass(f,"inputError");if(e){document.removeClass(f,"showInputValidationMessage");var g=document.getElementsByClass("inputValidationErrorMessage",f);if(g.length>=1){if(c&&c.length>=1){g[0].innerHTML=c}}else{return}}else{document.addClass(f,"showInputValidationMessage")}if(a){a.focus()}}function showGeneralError(a){var c=document.getElementById("validationErrorDiv");if(a){var b=document.getElementById("validationErrorTd");b.innerHTML=a}c.style.display="block"}function showGeneralMessage(a){if(a){var b=document.getElementById("messageDiv");b.innerHTML=a;b.style.display="block"}}function clearAllInputErrors(){var b=document.getElementsByClass("inputError");for(var a=0;a<b.length;a++){document.removeClass(b[a],"inputError")}document.hideElementById("validationErrorDiv");document.hideElementById("connectionErrorDiv")}var showView=function(h){var b=false,f=document.getElementsByTagName("button"),j=document.getElementsByClass("view"),c=document.getElementsByClass(h),e=document.getElementById("content"),a=["verifyingEmail","verifyingPassword","working"],d;if(h==="loading"||h==="working"||h==="updating"){b=true}for(d=0;d<f.length;d++){if(!document.elementHasClass(f[d],"disabledButton")){f[d].disabled=b}}if(c.length>0&&(a.join(" ").indexOf(h)!==-1)&&"getComputedStyle" in window){var g=getComputedStyle(e).getPropertyValue("height");c[c.length-1].style.marginTop=(parseInt(g)/2-38)+"px";e.style.height=g}else{e.style.height=""}for(d=0;d<j.length;d++){document.hideElement(j[d])}for(d=0;d<c.length;d++){document.showElement(c[d])}};if(window.location.search&&window.location.search.indexOf("view=")>0){RAINIER.setup.goToPage=function(){};var showViewCopy=showView;showView=function(b){window.onbeforeunload=null;var a=RAINIER.shared.util.getURLParameter("view");showViewCopy(a)}}function getCurrentView(){var d=document.getElementsByClass("view");for(var c=0;c<d.length;c++){if(d[c].style.display==="block"){var b=d[c].className;b=b.split(" ");for(var a=0;a<b.length;a++){if(b[a]==="view"){return b[a+1]}}break}}return""}function checkInternet(a,b){RAINIER.shared.pingTests.start(RAINIER.shared.pingTests.allTests,function(d,c,e){if(c>1){return}a(true,b)},function(d,c,e){if(e===RAINIER.shared.pingTests.allTests.length){a(false,b)}})}function checkInternetCompleted(e,b){var f=b.cb,c=b.currentCount,d=b.maxCount,a=b.interval;if(e){f(true)}else{if(c<d){b.currentCount++;setTimeout(function(){checkInternet(checkInternetCompleted,b)},a)}else{f(false)}}}function pollForInternet(a,c,d){var b={interval:c||RAINIER.INTERNET_POLL_INTERVAL,maxCount:d||RAINIER.INTERNET_POLL_MAX_COUNT,cb:a,currentCount:0};checkInternet(checkInternetCompleted,b)}function pollForRouterConnection(a){if(typeof a.interval==="undefined"){a.interval=RAINIER.POLL_FOR_ROUTER_CONNECTION_DEFAULT_INTERVAL}if(typeof a.maxRetries==="undefined"){a.maxRetries=RAINIER.POLL_FOR_ROUTER_CONNECTION_DEFAULT_MAX_TRIES}if(typeof a.currentRetry==="undefined"){a.currentRetry=0}RAINIER.jnap.send({action:"/jnap/core/IsAdminPasswordDefault",data:{},cb:function(b,c){if(c.status===200){if(typeof a.cb==="function"){a.cb(b,c)}}else{if(a.currentRetry<a.maxRetries){a.currentRetry++;setTimeout(function(){pollForRouterConnection(a)},a.interval)}else{if(a.disableDefaultAjaxErrorHandler){if(typeof a.cb==="function"){a.cb(b,c)}}else{RAINIER.setup.executeDefaultAjaxErrorHandler()}}}},disableDefaultAjaxErrHandler:true})}function getRouterPassword(){var a=RAINIER.shared.util.getCookie("admin-auth");if(a){a=a.replace("Basic ","");a=window.atob(a);a=a.replace("admin:","")}else{a=""}return a}function getPasswordHint(){return RAINIER.shared.util.getCookie("passwordHint")}function setRouterPassword(a){RAINIER.shared.util.setCookie("admin-auth","Basic "+window.btoa("admin:"+a),null,"/")}function saveModelNumber(a){RAINIER.shared.util.setCookie("modelNumber",a,null,"/")}function setPasswordHint(a){RAINIER.shared.util.setCookie("passwordHint",a,null,"/")}function saveHardwareVersion(a){RAINIER.shared.util.setCookie("hardwareVersion",a,null,"/")}function getModelNumber(){var a=RAINIER.shared.util.getCookie("modelNumber");return a?a:""}function getHardwareVersion(){var a=RAINIER.shared.util.getCookie("hardwareVersion");return a?a:""}function reviewModelNumber(c){var b=getModelNumber();if(b===""){var a=RAINIER.jnap.Transaction({onComplete:c});getRouterInfo(a,function(d){if(d.result==="OK"){saveModelNumber(RAINIER.setup.getCurrentNetworkModelName());saveHardwareVersion(RAINIER.setup.getCurrentNetworkHardwareVersion())}});a.send()}else{c()}}function saveWirelessSsidAll(){for(var a=0;a<RAINIER.radioSettings.length;a++){saveWirelessSsid(RAINIER.radioSettings[a])}}function saveWirelessSsid(a){if(!a){return}var b="wirelessSsid";if(a.band!=="2.4GHz"){b=b+a.band}RAINIER.shared.util.setCookie(b,window.btoa(unescape(encodeURIComponent(a.settings.ssid))),null,"/")}function getWirelessSsid(c){var a="wirelessSsid";if(c&&c!=="2.4GHz"){a=a+c}var b=RAINIER.shared.util.getCookie(a);return b?decodeURIComponent(escape(window.atob(b))):""}function saveWirelessPasswordAll(){for(var a=0;a<RAINIER.radioSettings.length;a++){saveWirelessPassword(RAINIER.radioSettings[a])}}function saveWirelessPassword(a){if(!a){return}var b=cookiePasswordPrefix;if(a.band!=="2.4GHz"){b+=a.band}RAINIER.shared.util.setCookie(b,window.btoa(a.settings.wpaPersonalSettings.passphrase),null,"/")}function getWirelessPassword(c){var b=cookiePasswordPrefix;if(c&&c!=="2.4GHz"){b+=c}var a=RAINIER.shared.util.getCookie(b);return a?window.atob(a):""}function getRadioCount(){return RAINIER.radioSettings.length}function getRadioById(b){var a=getRadioCount();if(a){for(var c=0;c<a;c++){if(RAINIER.radioSettings[c].radioID===b){return RAINIER.radioSettings[c]}}}return null}function getRadioByIndex(a){if(RAINIER.radioSettings.length>a){return RAINIER.radioSettings[a]}else{return null}}RAINIER.executeDefaultJnapErrorHandler=function(b){var a={};if(b&&b.result){a.errorCode=RAINIER.shared.ui.errorCode.errorStringToErrorCode(b.result.toString())}if(b.action){a.action=b.action}RAINIER.setup.goToGenericErrorPage(a)};RAINIER.setup.goToGenericErrorPage=function(a){a=a||{};RAINIER.shared.util.setCookie("page",window.location);RAINIER.shared.util.setCookie("view",getCurrentView());if(RAINIER.setup.call){RAINIER.shared.util.setCookie("call",RAINIER.setup.call)}else{RAINIER.shared.util.deleteCookie("call")}if(a.errorCode){RAINIER.shared.util.setCookie("errCode",a.errorCode)}else{RAINIER.shared.util.deleteCookie("errCode")}if(a.errorMessage){RAINIER.shared.util.setCookie("errMessage",a.errorMessage)}else{RAINIER.shared.util.deleteCookie("errMessage")}RAINIER.setup.goToPage("/ui/dynamic/setup/generic_error.html")};function changeBtnState(b,a){b.disabled=!a}function lanBreakOnNext(){showView("working");RAINIER.jnap.send({action:"/jnap/core/IsAdminPasswordDefault",data:{},cb:function(a,b){if(b.status===200){window.onbeforeunload=null;window.location.reload()}else{showView("landing")}},disableDefaultAjaxErrHandler:true})}function getRouterInfo(c,a){var b={action:"/jnap/core/GetDeviceInfo",data:{},cb:function(f){if(f.result==="OK"){RAINIER.setup.setRouterInfo(f.output);var e=f.output.services;for(var d=0;d<e.length;d++){if(e[d].indexOf("linksys.com")>-1){RAINIER.jnap.host="linksys.com";break}}if(typeof a==="function"){a(f)}}}};if(c){c.add(b)}else{RAINIER.jnap.send(b)}}function getDSLSettings(a){RAINIER.jnap.send({action:"/jnap/powermodem/GetDSLSettings",data:{},cb:function(b){if(b.result==="OK"){RAINIER.PMSettings=b.output;if(typeof a==="function"){a(b)}}}})}function setDSLSettings(a){var b={isPowerModemEnabled:RAINIER.PMSettings.isPowerModemEnabled};if(RAINIER.PMSettings.isPowerModemEnabled){if(RAINIER.PMSettings.dslSettings){RAINIER.PMSettings.dslSettings.qosType=RAINIER.PMSettings.dslSettings.qosType||"UBR";RAINIER.PMSettings.dslSettings.modulation=RAINIER.PMSettings.dslSettings.modulation||"MultiMode";RAINIER.PMSettings.dslSettings.mtu=RAINIER.PMSettings.dslSettings.mtu||0;if(RAINIER.PMSettings.dslSettings.pppSettings){RAINIER.PMSettings.dslSettings.pppSettings.behavior=RAINIER.PMSettings.dslSettings.pppSettings.behavior||"KeepAlive";if(RAINIER.PMSettings.dslSettings.pppSettings.behavior==="KeepAlive"){RAINIER.PMSettings.dslSettings.pppSettings.reconnectAfterSeconds=RAINIER.PMSettings.dslSettings.pppSettings.reconnectAfterSeconds||30}if(RAINIER.PMSettings.dslSettings.pppSettings.behavior==="ConnectOnDemand"){RAINIER.PMSettings.dslSettings.pppSettings.maxIdleMinutes=RAINIER.PMSettings.dslSettings.pppSettings.maxIdleMinutes||15}}b.dslSettings=RAINIER.PMSettings.dslSettings;if(RAINIER.PMSettings.dslSettings.wanType==="PPPoE"||RAINIER.PMSettings.dslSettings.wanType==="PPPoA"){delete b.dslSettings.staticSettings}else{delete b.dslSettings.pppSettings}}}RAINIER.jnap.send({action:"/jnap/powermodem/SetDSLSettings",data:b,cb:function(c){if(c.result==="OK"){sideEffects=c.sideEffects;handleSideEffects(sideEffects,function(){a(c)})}else{a(c)}},disableDefaultJnapErrHandler:true})}function handleSideEffects(b,a){var d=false;if(b){for(var c=0;c<b.length;c++){if(b[c]==="DeviceRestart"||b[c]==="WANInterruption"){d=true;break}}}if(d){var e={cb:function(){a()},disableDefaultAjaxErrorHandler:true};setTimeout(function(){pollForRouterConnection(e)},RAINIER.INTERNET_POLL_INTERVAL)}else{a()}}function setPPPSettings(a){var b={};b.username=RAINIER.PMSettings.dslSettings.pppSettings.username||"";b.password=RAINIER.PMSettings.dslSettings.pppSettings.password||"";b.serviceName=RAINIER.PMSettings.dslSettings.pppSettings.serviceName||"";RAINIER.jnap.send({action:"/jnap/powermodem/SetPPPCredentials",data:b,cb:function(c){if(c.result==="OK"){sideEffects=c.sideEffects;handleSideEffects(sideEffects,function(){a(c)})}else{a(c)}},disableDefaultJnapErrHandler:true})}RAINIER.manualSettingsRetries=parseInt(RAINIER.shared.util.getCookie("manualSettingsRetries"))||1;function checkInternetStatus(){pollForInternet(function(a){if(a){RAINIER.shared.util.setCookie("hasInternet","true",null,"/");RAINIER.setup.goToPage("/ui/dynamic/setup/update.html")}else{if(RAINIER.manualSettingsRetries<RAINIER.MAX_USER_RETRIES){var b=RAINIER.manualSettingsRetries+1;RAINIER.shared.util.setCookie("manualSettingsRetries",b,null,"/");if(RAINIER.shared.util.getCookie("manualSetup")){RAINIER.setup.goToPage("/ui/dynamic/setup/pm_dsl_manual.html")}else{RAINIER.setup.goToPage("/ui/dynamic/setup/pm_dsl_settings.html")}}else{RAINIER.setup.goToPage("/ui/dynamic/setup/pm_no_internet.html")}}},RAINIER.INTERNET_POLL_INTERVAL,RAINIER.MAX_INTERNET_RETRIES)}function disableOrEnableNextButton(b,a){if(b.length>0&&a.length>0){changeBtnState(document.getElementById("nextButton"),true)}else{changeBtnState(document.getElementById("nextButton"),false)}}function getRadioSettingsInTransaction(b,a){b.add({action:RAINIER.jnapActions.getRadioInfo(),data:{},cb:function(c){if(c.result==="OK"){c.output.radios.sort(function(e,d){return e.radioID>d.radioID});RAINIER.radioSettings=c.output.radios;if(typeof a==="function"){a(c)}}}})}RAINIER.setup.getRouterDeviceID=function(b,e,c){function a(g){if(g.result==="OK"){RAINIER.devices=g.output.devices;for(var f=0;f<RAINIER.devices.length;f++){if(RAINIER.devices[f].isAuthority){d=RAINIER.devices[f].deviceID;RAINIER.shared.util.setCookie("routerDeviceId",d,null,"/");break}}if(d){b(d)}else{}}else{e(g)}}if(typeof b!=="function"){b=function(){}}if(typeof e!=="function"){e=function(){}}var d=RAINIER.shared.util.getCookie("routerDeviceId");if(!d){if(c){c.add({action:"/jnap/devicelist/GetDevices",data:{},cb:function(f){a(f)}})}else{RAINIER.jnap.send({action:"/jnap/devicelist/GetDevices",data:{},cb:function(f){a(f)}})}}else{b(d)}};function getRouterPropertyValue(a,b){RAINIER.jnap.send({action:"/jnap/devicelist/GetDevices",data:{deviceIDs:[RAINIER.shared.util.getCookie("routerDeviceId")]},cb:function(e){if(e.result==="OK"){if(e.output.devices.length>0){var d=e.output.devices[0].properties;for(var c=0;c<d.length;c++){if(d[c].name===a){b(d[c].value);return}}}b(null)}}})}RAINIER.setup.addDeviceProperties=function(d,c,a,b){if(typeof a!=="function"){a=function(){}}if(typeof b!=="function"){b=function(){}}RAINIER.jnap.send({action:"/jnap/devicelist/SetDeviceProperties",data:{deviceID:d,propertiesToModify:c},cb:function(e){if(e.result==="OK"){a()}else{b(e)}}})};RAINIER.setup.addRouterProperties=function(c,a,b){RAINIER.setup.getRouterDeviceID(function(d){RAINIER.setup.addDeviceProperties(d,c,a,b)},b)};RAINIER.setup.addDevicePropertiesInTransaction=function(b,e,d,a,c){if(typeof a!=="function"){a=function(){}}if(typeof c!=="function"){c=function(){}}b.add({action:"/jnap/devicelist/SetDeviceProperties",data:{deviceID:e,propertiesToModify:d},cb:function(f){if(f.result==="OK"){a()}else{if(f.result!=="_AjaxError"&&f.result!=="_ErrorAbortedAction"){c(f)}}}})};RAINIER.setup.addRouterPropertiesInTransaction=function(b,d,a,c){RAINIER.setup.addDevicePropertiesInTransaction(b,RAINIER.shared.util.getCookie("routerDeviceId"),d,a,c)};RAINIER.setup.removeDeviceProperties=function(d,c,a,b){if(typeof a!=="function"){a=function(){}}if(typeof b!=="function"){b=function(){}}RAINIER.jnap.send({action:"/jnap/devicelist/SetDeviceProperties",data:{deviceID:d,propertiesToRemove:c},cb:function(e){if(e.result==="OK"){a()}else{b(e)}}})};RAINIER.setup.removeRouterProperties=function(c,a,b){RAINIER.setup.getRouterDeviceID(function(d){RAINIER.setup.removeDeviceProperties(d,c,a,b)},b)};RAINIER.setup.removeDevicePropertiesInTransaction=function(b,e,d,a,c){if(typeof a!=="function"){a=function(){}}if(typeof c!=="function"){c=function(){}}b.add({action:"/jnap/devicelist/SetDeviceProperties",data:{deviceID:e,propertiesToRemove:d},cb:function(f){if(f.result==="OK"){a()}else{if(f.result!=="_AjaxError"&&f.result!=="_ErrorAbortedAction"){c(f)}}}})};RAINIER.setup.removeRouterPropertiesInTransaction=function(b,d,a,c){RAINIER.setup.removeDevicePropertiesInTransaction(b,RAINIER.shared.util.getCookie("routerDeviceId"),d,a,c)};RAINIER.setup.executeDefaultAjaxErrorHandler=function(){var a=RAINIER.setup.ui.lanBreakContentLanding;a=a.replace(/REPLACE_SSID/g,getWirelessSsid().replace(/[$]/g,"$$$"));a=a.replace(/REPLACE_PASSWORD/g,getWirelessPassword().replace(/[$]/g,"$$$"));RAINIER.shared.ui.showErrorWithinDocument("<h1>"+RAINIER.setup.ui.lanBreakHeader+"</h1>",a,'<button type="button" id="nextButton" onclick="lanBreakOnNext();">'+RAINIER.setup.ui.retry+"</button>")};var timerPleaseWait=null;function setPleaseWaitMessage(c){var b=document.getElementsByClass("pleaseWait");for(var a=0;a<b.length;a++){b[a].innerHTML=c}}function startPleaseWaitTimer(){setPleaseWaitMessage(RAINIER.setup.ui.pleaseWait);if(timerPleaseWait){clearTimeout(timerPleaseWait)}timerPleaseWait=setTimeout(function(){setPleaseWaitMessage(RAINIER.setup.ui.almostThere)},30000)}function loginLocal(a){var b=a?a:"/ui/dynamic/login.html";RAINIER.shared.util.signOutCookies();document.hideElementById("div502Message");showView("working");RAINIER.shared.util.setRemoteSetting(RAINIER.jnap,false,function(){RAINIER.setup.goToPage(b)})}function retry502(){document.hideElementById("div502Message");showView("working");setTimeout(function(){RAINIER.setup.goToPage("/")},1100)}function isNumber(a){return !isNaN(parseFloat(a))&&isFinite(a)&&a.match(/^\d+$/)}function sortByKey(b,a){return b.sort(function(e,d){var c=e[a],f=d[a];return((c<f)?-1:((c>f)?1:0))})}function onEnterKeyPress(c,a){var b=c.keyCode||c.which;if(b===13&&typeof a==="function"){a()}};