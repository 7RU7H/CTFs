(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","lodash","jnap-js/jnap","jnap-js/cloud-rest","./side-effects-manager","./http-request-cordova","./cache-manager"],b)}else{if(typeof module==="object"&&module.exports){module.exports=b(require("jquery"),require("lodash"),require("@linksys/jnap-js").JNAP,require("@linksys/jnap-js").CLOUD_REST,require("./side-effects-manager"),require("./http-request-cordova"),require("./cache-manager"))}else{a.JNAP=b(a.$,(a.lodash||a._),a.JNAP,a.CLOUD_REST,a.sideEffectsManager,a.httpRequestCordova,a.cacheManager)}}}(this,function(k,q,m,c,o,n,p){var b=[];function j(w,u,x,r,t){var v={action:w},s="You should use "+u+" in this call. Let JNAP.send() pick the best action supported by the router.";if(w===x){console.info(s,"- logData:",v)}if(w===u&&m.isServiceSupported(r,v,t)){return x}return null}function i(t,r,s){var u;s=s||m.cache.data;r=m.getOptions(r);if(r&&r.disableFeatureDetection){return t}u=q.curryRight(j)(s);return u(t,"/router/GetWANSettings","/router/GetWANSettings5","/router/Router10")||u(t,"/router/GetWANSettings","/router/GetWANSettings4","/router/Router8")||u(t,"/router/GetWANSettings","/router/GetWANSettings2","/router/Router3")||u(t,"/router/SetWANSettings","/router/SetWANSettings4","/router/Router8")||u(t,"/router/SetWANSettings","/router/SetWANSettings3","/router/Router4")||u(t,"/router/SetWANSettings","/router/SetWANSettings2","/router/Router3")||u(t,"/router/GetWANStatus","/router/GetWANStatus3","/router/Router5")||u(t,"/router/GetWANStatus","/router/GetWANStatus2","/router/Router3")||u(t,"/router/GetIPv6Settings","/router/GetIPv6Settings2","/router/Router5")||u(t,"/router/SetIPv6Settings","/router/SetIPv6Settings2","/router/Router5")||u(t,"/router/GetCTFSettings","/router/broadcom/GetCTFSettings","/router/broadcom/RouterBroadcom")||u(t,"/router/SetCTFSettings","/router/broadcom/SetCTFSettings","/router/broadcom/RouterBroadcom")||u(t,"/networkconnections/GetNetworkConnections","/networkconnections/GetNetworkConnections2","/networkconnections/NetworkConnections2")||u(t,"/wirelessap/GetRadioInfo","/wirelessap/GetRadioInfo3","/wirelessap/WirelessAP4")||u(t,"/wirelessap/GetRadioInfo","/wirelessap/GetRadioInfo2","/wirelessap/WirelessAP3")||u(t,"/wirelessap/SetRadioSettings","/wirelessap/SetRadioSettings3","/wirelessap/WirelessAP4")||u(t,"/wirelessap/SetRadioSettings","/wirelessap/SetRadioSettings2","/wirelessap/WirelessAP3")||u(t,"/ddns/GetDDNSStatus","/ddns/GetDDNSStatus2","/ddns/DDNS3")||u(t,"/routermanagement/GetManagementSettings","/routermanagement/GetManagementSettings2","/routermanagement/RouterManagement2")||u(t,"/routermanagement/SetManagementSettings","/routermanagement/SetManagementSettings2","/routermanagement/RouterManagement2")||u(t,"/vlantagging/GetVLANTaggingSettings","/vlantagging/GetVLANTaggingSettings2","/vlantagging/VLANTagging2")||u(t,"/vlantagging/SetVLANTaggingSettings","/vlantagging/SetVLANTaggingSettings2","/vlantagging/VLANTagging2")||u(t,"/core/SetAdminPassword","/core/SetAdminPassword2","/core/Core3")||u(t,"/guestnetwork/GetGuestNetworkSettings","/guestnetwork/GetGuestRadioSettings2","/guestnetwork/GuestNetwork4")||u(t,"/guestnetwork/SetGuestNetworkSettings","/guestnetwork/SetGuestRadioSettings2","/guestnetwork/GuestNetwork4")||u(t,"/guestnetwork/GetGuestNetworkSettings","/guestnetwork/GetGuestRadioSettings","/guestnetwork/GuestNetwork3")||u(t,"/guestnetwork/SetGuestNetworkSettings","/guestnetwork/SetGuestRadioSettings","/guestnetwork/GuestNetwork3")||u(t,"/storage/GetMountedPartitions","/storage/GetPartitions","/storage/Storage2")||u(t,"/devicelist/GetDevices","/devicelist/GetDevices3","/devicelist/DeviceList4")||u(t,"/nodes/healthcheck/GetHealthCheckStatus","/healthcheck/GetHealthCheckStatus","/healthcheck/HealthCheckManager")||u(t,"/nodes/healthcheck/GetHealthCheckResults","/healthcheck/GetHealthCheckResults","/healthcheck/HealthCheckManager")||u(t,"/nodes/healthcheck/RunHealthCheck","/healthcheck/RunHealthCheck","/healthcheck/HealthCheckManager")||u(t,"/nodes/healthcheck/StopHealthCheck","/healthcheck/StopHealthCheck","/healthcheck/HealthCheckManager")||u(t,"/nodes/healthcheck/GetSupportedHealthCheckModules","/healthcheck/GetSupportedHealthCheckModules","/healthcheck/HealthCheckManager")||t}m.actionSupportedByRouter=i;function l(r){return r.action.replace(m.getOptions().baseUrl,"")}function g(t,s,r){if(t==="/router/GetWANStatus"&&r&&r.result==="_ErrorUnexpected"&&r.error&&r.error.indexOf("invalid IPv6 address string")>-1){s.resolve({result:"OK",callUUID:r.callUUID,output:{supportedWANTypes:["DHCP"],isDetectingWANType:false,detectedWANType:"DHCP",wanStatus:"Connected",wanConnection:{wanType:"DHCP",ipAddress:"192.168.0.99"},macAddress:"00:00:00:99:99:99",ignoreFakeJNAPResponse:true}});return true}return false}function e(r,s){if(!q.isPlainObject(r)){r={response:r}}r.callUUID=m.getOptions(s).callUUID}function h(r){return function(v,u,t){var s=m.Deferred();if(!t){t={}}if(v==="/router/RenewDHCPWANLease"||v==="/router/RenewDHCPIPv6WANLease"){t.overrideJnapResult=function(w){w.sideEffects=w.sideEffects||["WANInterruption"];return w}}else{if(v==="/nodes/setup/StartAutoChannelSelection"){t.overrideJnapResult=function(w){w.sideEffects=w.sideEffects||["WirelessInterruption"];return w}}}r(v,u,t).success(function(w,x,y){e(w,t);s.resolve(w,x,y)}).error(function(w,x,y){e(w,t);if(!g(v,s,w)){s.reject(w,x,y)}});return s}}var a=m.resetOptions;var f=m.send;m.resetOptions=function(){a();m.setOptions({callUUID:"[none]"});m.unsubscribeAll();o.init();p.init(f);if(typeof cordova!=="undefined"){m.setOptions({httpRequest:n})}};m.send=h(function(x,w,u){var y=m.cache.data||{},r=u.noCaching?f:p.send;if(q.result(u,"cacheOverrides")){console.info("[setting JNAP caches to specified overrides]",u.cacheOverrides);u.supportedForCaching=u.supportedForCaching||{};q.keys(u.cacheOverrides).forEach(function(z){u.supportedForCaching[z]=true});y=u.cacheOverrides}var t=[];if(x==="/core/Transaction"){for(var v=0;v<w.length;v++){var s=l(w[v]);t.push({action:m.getOptions().baseUrl+s});s=i(s,u,y);w[v].action=m.getOptions().baseUrl+s}}return r(x,w,u,t).success(function(z,A,C){var B=[];if(x==="/core/Transaction"){w.forEach(function(D){B=q.union(B,q.filter(b,{call:l(D)}))})}else{B=q.filter(b,{call:x})}B.forEach(function(D){D.cb(z,A,C)})})});function d(t,s){s=s||m.cache.data;if(!s["/core/GetDeviceInfo"]||!s["/core/GetDeviceInfo"].output){var r="you need to run /core/GetDeviceInfo before you can use any other JNAP APIs (so we know what APIs are supported)";console.info(r,"- logData:",t);throw r}}m.isServiceSupported=function(r,t,s){s=s||m.cache.data;t=t||{service:r};d(t,s);return s["/core/GetDeviceInfo"].output.services.filter(function(u){u=u.replace("http://cisco.com/jnap","").replace("http://linksys.com/jnap","");return u===r}).length>0};m.isFeatureSupported=function(r,t){if(!t){d({feature:r});t=m.cache.data["/core/GetDeviceInfo"].output}if(["Node","Nodes"].indexOf(r)>-1){var s=q.find(t.services,function(u){return u.indexOf("/jnap/nodes/")!==-1});return !q.isEmpty(s)}else{if(r==="ExternalStorage"){return m.isServiceSupported("/storage/Storage")&&m.isServiceSupported("/storage/FTPServer")&&m.isServiceSupported("/storage/SMBServer")}else{if(r==="NodesExternalStorage"){return m.isServiceSupported("/nodes/storage/Storage")&&m.isServiceSupported("/nodes/storage/SMBServer")}}}throw"unknown feature "+r};m.subscribe=function(s,r){var t=i(s);if(q.find(b,{call:t,cb:r})){throw"Subscription already exists for passed in JNAP call and callback"}b.push({call:t,cb:r})};m.unsubscribe=function(s,r){var u=i(s),t=q.findIndex(b,{call:u,cb:r});if(t!==-1){b.splice(t,1)}};m.unsubscribeAll=function(){b=[]};m.target=function(t,x,s,v,w){var u,r;function y(z,D,A,C){var B=q.merge(t,A||{});C=C||[];u=null;if(x||D){u=m.getAuth();if(x){m.setAuth(x)}else{m.setAuth(D)}C.push({auth:m.getAuth()})}C.push(B);r=z.apply(null,C);if(u){m.setAuth(u)}return r}return(function(){var z=s&&v&&w?c.setAuth(s,v,w):null;t=t||{};return{transaction:function(){var B=m.transaction(),A=B.send;B.send=function(C){return y(A,z,C)};return B},send:function(C,B,A){return y(m.send,z,A,[C,B])}}}())};m.resetOptions();return m}));