(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery"],b)}else{if(typeof module==="object"&&module.exports){module.exports=b(require("jquery"))}else{a.JNAP=b(a.$)}}}(this,function(h){var s;var a=function(){var u=h.Deferred();u.success=u.done;u.error=u.fail;u["finally"]=u.always;return u};var g="Basic ";var n={send:function(w,v,u){u.success=w;u.error=v;h.ajax(u)}};var i=function(x){var w=[];var v=[];var z=false;var y=15500;function B(E,D){if(z){throw"transaction can not be modified after it was sent"}D=D||{};w.push({action:x.baseUrl+E,request:D});var C=a();v.push(C);return C}function u(C){return function(G,E,H){for(var F=0;F<v.length;F++){var D=null;if(G&&G.responses&&G.responses[F]){D=G.responses[F]}if(!C&&D&&D.result==="OK"){v[F].resolve(D,E,H,G)}else{v[F].reject(D,E,H,G)}}}}function A(C){z=true;C=h.extend(true,{},x,C);C.timeout=Math.max(y,C.timeout);return s.send("/core/Transaction",w,C).success(u(false)).error(u(true))}return{add:B,send:A}};var d,f,r=false;function q(u){f=h.extend(true,f,u)}function l(u){return h.extend(true,{},f,u)}function j(){f={httpRequest:n,baseUrl:"http://linksys.com/jnap",timeout:10000}}function p(v){try{return window.atob(v)}catch(u){}return v}function t(u){if(!u){return d}else{if(typeof u==="function"){return u}else{var v;if(u.indexOf(g)===0&&p(u.replace(g,"")).indexOf("admin:")===0){v=u}else{v=g+window.btoa("admin:"+u)}return function(w){w.headers["X-JNAP-Authorization"]=v}}}}function m(){return h.noop}function o(v){d=null;d=t(v);var u={headers:{},url:"/JNAP/"};if(d){d(u)}return d}function c(v,u){if(!r||u){v()}else{setTimeout(function(){c(v)},50)}}function k(x,y,C){y=y||{};var B=a();C=l(C);var u=C.overrideJnapResult;var w={headers:{"X-JNAP-Action":C.baseUrl+x,Expires:"Fri, 10 Oct 2015 14:19:41 GMT","Cache-Control":"no-cache"},contentType:"application/json; charset=UTF-8",type:"POST",url:"/JNAP/",data:JSON.stringify(y),timeout:C.timeout};var A=0;var v=function(I,D,H,E){var G=(E||"")+x.slice(1),F=Date.now()-A;if(u){I=u(I,D,H);u=null}if(I&&I.result==="_ErrorUnknownAction"&&C.baseUrl.indexOf("linksys.com")!==-1){C.baseUrl=C.baseUrl.replace("linksys.com","cisco.com");k(x,y,C).success(function(L,J,K){q({baseUrl:C.baseUrl});B.resolve(L,J,K)}).error(function(L,J,K){B.reject(L,J,K)})}else{B.reject(I,D,H)}};var z=function(J,E,I,F){var H=(F||"")+x.slice(1),G=Date.now()-A;if(u){J=u(J,E,I);u=null}if(!h.isPlainObject(J)){B.reject(J,E,I)}else{if(J.result!=="OK"){if(J.result==="_ErrorUnknownAction"){v(J,E,I)}else{B.reject(J,E,I)}}else{if(J.sideEffects&&C.sideEffect){var D=J.sideEffects;delete J.sideEffects;C.sideEffect(D,z,J,E,I)}else{B.resolve(J,E,I)}}}};if(r){}c(function(){if(C.auth){C.auth(w)}else{if(d){d(w)}}A=Date.now();s.sendHttpRequest(z,v,w,C)},C.disablePause);return B}j();function b(x,w,v,u){u.retry--;console.info("retrying call (url, retryCount, retry, retryDelay)",v.url,u.retryCount,u.retry,u.retryDelay);setTimeout(function(){e(x,w,v,u)},u.retryDelay)}function e(x,w,v,u){u=l(u);if(u.retry){if(!u.retryCount){u.retryCount=u.retry;u.retryDelay=u.retryDelay||0}u.httpRequest.send(function(y,z,A){if(v.url.indexOf("/JNAP/")===-1){x(y,z,A)}else{if(y&&y.result==="OK"){x(y,z,A)}else{b(x,w,v,u)}}},function(){b(x,w,v,u)},v)}else{if(u.retryCount){delete u.retryCount}u.httpRequest.send(x,w,v)}}s={setOptions:q,getOptions:l,resetOptions:j,setAuth:o,getAuth:t,getNoAuth:m,send:k,Deferred:a,sendHttpRequest:e,pause:function(){r=true},resume:function(){r=false},transaction:function(){return i(f)}};return s}));