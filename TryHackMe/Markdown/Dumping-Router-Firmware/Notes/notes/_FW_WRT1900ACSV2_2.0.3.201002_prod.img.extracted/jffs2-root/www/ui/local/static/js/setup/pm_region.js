var routerRegions=null;RAINIER.SLEEP_AFTER_PM_AUTO_CHECK=10000;RAINIER.PM_AUTO_MAX_RETRIES=2;function goToNextPage(){clearAllInputErrors();if(document.getElementById("unavailableRegion").checked){RAINIER.setup.goToPage("/ui/dynamic/setup/pm_dsl_manual.html")}else{save(function(){setTimeout(checkGetAutoDSLConfigurationStatus,1000)})}}function changeSelectState(a,b){a.selectedIndex=0;a.disabled=b}function resetDomEls(){document.getElementById("validationErrorDiv").style.display="none";changeSelectState(document.getElementById("regionsSelect"),false);changeSelectState(document.getElementById("countriesSelect"),true);changeSelectState(document.getElementById("ispsSelect"),true);document.getElementById("unavailableRegion").checked=false;changeBtnState(document.getElementById("nextButton"),false)}function displayError(){document.getElementById("validationErrorDiv").style.display="block"}function checkGetAutoDSLConfigurationStatusCompleted(a){if(a==="PPPoA"||a==="PPPoE"){RAINIER.setup.goToPage("/ui/dynamic/setup/pm_dsl_settings.html")}else{RAINIER.setup.goToPage("/ui/dynamic/setup/pm_dsl_static.html")}}function checkGetAutoDSLConfigurationStatus(){var a=getSelectedProfileCount()||1,b=RAINIER.SLEEP_AFTER_PM_AUTO_CHECK*a,d=1;function c(){RAINIER.jnap.send({action:"/jnap/powermodem/GetAutoDSLConfigurationStatus",data:{},cb:function(f){if(f.result==="OK"){var e=f.output.status;switch(e){case"Configured":checkGetAutoDSLConfigurationStatusCompleted(f.output.detectedWANType);break;case"Failed":showView("landing");displayError();break;case"Configuring":setTimeout(c,b);break;case"NotConfigured":if(d>0){d--;setTimeout(c,b)}else{showView("landing");displayError()}break;default:break}}}})}c()}function getSelectedProfileCount(){var f=document.getElementById("regionsSelect").selectedIndex,g=document.getElementById("countriesSelect").selectedIndex,c=document.getElementById("ispsSelect"),b=c.options[c.selectedIndex].text,e=routerRegions[f-1].supportedCountries[g-1].supportedISPs;for(var d=0;d<e.length;d++){var a=e[d].name;if(a===b){return e[d].profileCount}}}function save(g){var c=document.getElementById("regionsSelect"),e=document.getElementById("countriesSelect"),b=document.getElementById("ispsSelect"),f=c.options[c.selectedIndex].value,d=e.options[e.selectedIndex].text,a=b.options[b.selectedIndex].text;showView("working");if(RAINIER.shared.util.getCookie("manualSetup")){RAINIER.shared.util.deleteCookie("manualSetup")}RAINIER.jnap.send({action:"/jnap/powermodem/StartAutoDSLConfiguration",data:{region:f,country:d,isp:a},cb:function(h){if(h.result==="OK"){g()}else{if(h.result==="ErrorInvalidRegion"||h.result==="ErrorInvalidISP"||h.result==="Error"){showView("landing");displayError()}else{showView("landing");RAINIER.executeDefaultJnapErrorHandler(h)}}},disableDefaultJnapErrHandler:true})}function unavailableRegion(b){var a=b.checked;changeSelectState(document.getElementById("regionsSelect"),a);changeSelectState(document.getElementById("countriesSelect"),true);changeSelectState(document.getElementById("ispsSelect"),true);changeBtnState(document.getElementById("nextButton"),a)}function setRegion(a){var b=a.selectedIndex;if(b>0){createOptions(routerRegions[b-1].supportedCountries,"countriesSelect",RAINIER.setup.ui.selectCountry);changeSelectState(document.getElementById("countriesSelect"),false)}else{changeSelectState(document.getElementById("countriesSelect"),true)}changeBtnState(document.getElementById("nextButton"),false);changeSelectState(document.getElementById("ispsSelect"),true)}function setCountry(a){var b=a.selectedIndex,c=document.getElementById("regionsSelect").selectedIndex;if(b>0){createOptions(routerRegions[c-1].supportedCountries[b-1].supportedISPs,"ispsSelect",RAINIER.setup.ui.selectIsp);changeSelectState(document.getElementById("ispsSelect"),false)}else{changeSelectState(document.getElementById("ispsSelect"),true)}changeBtnState(document.getElementById("nextButton"),false)}function setISP(a){var b=a.selectedIndex;if(b>0){changeBtnState(document.getElementById("nextButton"),true)}else{changeBtnState(document.getElementById("nextButton"),false)}}function generateRegions(c){var a=document.getElementById("regionsSelect");function b(){var f=0,g=routerRegions.length,d,e;routerRegions=sortByKey(routerRegions,"name");a.innerHTML="";d=document.createElement("option");d.innerHTML=RAINIER.setup.ui.selectRegion;d.selected="selected";a.appendChild(d);for(f;f<g;f++){d=document.createElement("option");if(RAINIER.setup.ui.pmRegions[routerRegions[f].name]){e=RAINIER.setup.ui.pmRegions[routerRegions[f].name]}else{e=routerRegions[f].name}d.innerHTML=e;d.value=routerRegions[f].name;a.appendChild(d)}showView("landing");c()}RAINIER.jnap.send({action:"/jnap/powermodem/GetSupportedRegions",data:{},cb:function(d){if(d.result==="OK"){routerRegions=d.output.supportedRegions;b()}else{}}})}function createOptions(d,a,c){var g=document.getElementById(a),f=0,h=d.length,e,b;d=sortByKey(d,"name");g.innerHTML="";e=document.createElement("option");e.innerHTML=c;e.selected="selected";g.appendChild(e);for(f;f<h;f++){e=document.createElement("option");b=d[f].name;e.innerHTML=b;g.appendChild(e)}}function init(){showView("loading");if(RAINIER.shared.util.getCookie("manualSettingsRetries")){RAINIER.shared.util.deleteCookie("manualSettingsRetries")}if(RAINIER.shared.util.getCookie("staticSettings")){RAINIER.shared.util.deleteCookie("staticSettings")}if(RAINIER.shared.util.getCookie("pppSettings")){RAINIER.shared.util.deleteCookie("pppSettings")}generateRegions(resetDomEls)}window.onbeforeunload=function(){return RAINIER.shared.util.decodeHtml(RAINIER.setup.ui.confirmExit)};window.onload=function(){init()};