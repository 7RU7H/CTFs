window.RAINIER=window.RAINIER||{};RAINIER.applets=RAINIER.applets||{};RAINIER.applets.MediaPrioritization=RAINIER.applets.MediaPrioritization||(function(){var o="9BDB14C9-C328-40ED-89A9-A3A822B8B5D2",t="BBB6425B-D3A1-45D6-8A68-B80DC37502A6",q=["/jnap/qos/QoS"],c="urn:cisco-com:ui:qos-order",r={apps:[],devices:[]},l=1000;Mb=l*1000;var g={type:{device:"device",application:"application",onlineGame:"onlineGame"},priority:{low:"Low",normal:"Normal",medium:"Medium",high:"High"},trafficType:{background:"Background",generic:"Generic",voice:"Voice",video:"Video"},protocol:{TCP:"TCP",UDP:"UDP",Both:"Both"}};var k="device-icon online-game",s="device-icon application";var p={devices:[],QoSSettings:{applicationRules:[],deviceRules:[]},QoSSettingsSetup:{},WLANQoSSettings:{}},f={QoSSettings:{applicationRules:[],deviceRules:[]},WLANQoSSettings:{}};var e={getQoS:function a(v,u){v.add({action:"/jnap/qos/GetQoSSettings",data:{},cb:function(w){if(w.result==="OK"){RAINIER.deviceManager.getAuthorityDevice(function(x){var y=x.getCustomProperty(c);if(y){r=JSON.parse(y);console.warn("sortOrder loaded: %o",y)}});u(w.output)}else{console.warn("GetQoSSettings: o.output is empty. Terminating...error:"+w.error+" result: "+w.result)}}})},getWLANQoSSettings:function(v,u){v.add({action:"/jnap/qos/GetWLANQoSSettings",data:{},cb:function(w){if(w.result==="OK"){u(w.output)}else{console.warn("GetWLANQoSSettings: o.output is empty. Terminating...error:"+w.error+" result: "+w.result)}}})}};function h(x,y){var v=[],w={high:[]},u=0;x.forEach(function(A,z){$.each(r.devices,function(B,C){if(A.macAddress===C.macAddress){u=C.order;return}});v.push({ruleList:"dev",rule:x[z],score:u})});y.forEach(function(A,z){$.each(r.apps,function(C,B){if(A.description===B.name){u=B.order;return}});v.push({ruleList:"app",rule:y[z],score:u})});v.sort(function(A,z){return(A.score-z.score)});v.forEach(function(z){var A;A=z.ruleList;if(w.high.length<3){w.high.push({ruleType:A,rule:z.rule})}});return w}function i(w,v,x){if(typeof x.description==="undefined"||typeof x.value==="undefined"||typeof x.icon==="undefined"||typeof x.mediaType==="undefined"){console.warn("buildLi data is missing required attribute")}else{var u=$(w.formatObj(x));u.data(x);v.append(u)}}function b(y,B){var u=RAINIER.applets.MediaPrioritization,x=false,z,v,D,C,A;if(y==="dev"){$.each(p.devices,function(E,H){var G=H.knownMACAddresses();for(var F=0;F<G.length;F++){if(G[F]===B.macAddress){z=H;break}}});if(z){A=RAINIER.ui.getDeviceIcon(z);C=z.friendlyName();D=g.type.device}}else{if(y==="app"){v=u.gameStaticList[B.description];if(v){D=g.type.onlineGame;A=k}else{D=g.type.application;v=u.applicationStaticList[B.description];A=s;if(!v){v=B;x=true}}C=v.description}}var w={mediaType:D,description:C,value:escape(C),icon:A,isUserDefined:x};if(y==="dev"){w.macAddress=B.macAddress}else{if(y==="app"){w.portRanges=v.portRanges}}return w}function n(){var u=new $.Deferred();function v(w){$.each(w,function(){this.value=escape(this.description)})}$.getJSON("/ui/dynamic/applets/media_prioritization/applications.json",function(w){$.extend(RAINIER.applets.MediaPrioritization,{applicationStaticList:w.applicationStaticList,gameStaticList:w.gameStaticList});v(w.applicationStaticList);v(w.gameStaticList);u.resolve("get app data complete")});return u}function m(){var u=new $.Deferred();var v=RAINIER.jnap.Transaction({onComplete:function(){u.resolve("jnap trans complete")}});e.getQoS(v,function(w){w.downstreamBandwidthbps=Math.round(w.downstreamBandwidthbps/l)*l;p.QoSSettings=$.extend(true,{},w);f.QoSSettings=$.extend(true,{},w)});e.getWLANQoSSettings(v,function(w){p.WLANQoSSettings=$.extend(true,{},w);f.WLANQoSSettings=$.extend(true,{},w)});v.send();return u}function d(){var u=$.Deferred();RAINIER.deviceManager.getDevices(function(v){$.each(v,function(){this.mediaType=g.type.device});p.devices=v;u.resolve("load devices complete")},{excludeAuthority:true,excludeNodes:true},-1);return u}function j(u){var w=n(),x=d(),v=m();$.when(w,x,v).then(function(){u(p)})}return{requiredServices:q,appletId:o,widgetId:t,load:j,buildLi:i,getMediaData:b,sortRules:h,jnap:e,Kb:l,Mb:Mb}}());