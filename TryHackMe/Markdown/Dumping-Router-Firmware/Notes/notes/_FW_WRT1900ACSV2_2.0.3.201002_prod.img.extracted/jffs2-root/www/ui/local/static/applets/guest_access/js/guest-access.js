(function(){var h=$("#guest-access-applet"),j=RAINIER.network.isBehindNode()?h.find("#guestWPAPassphrase"):h.find("#guestPassword"),q=h.find('select[name="maxSimultaneousGuests"]'),g=h.find("#guest-access-settings"),u=false,b,d,s,f=RAINIER.ui.dialogWarning,k=5*1000,t=true,c={};var o={guestSettings:{},radio:{}},i={guestSettings:{}};var l={isGuestNetworkEnabled:"boolean",maxSimultaneousGuests:"number","radio.band24.isEnabled":"boolean","radio.band50.isEnabled":"boolean"};var e={onToggleWidget:function(){RAINIER.connect.AppletManager.toggleWidgetShowState("B24C693D-4DFF-417D-A10F-A8212051E60E","E50B6C6C-35E7-425A-91BA-4313F87AA0B7")},onClose:function(){RAINIER.ui.MainMenu.closeApplet()},onSave:function(){r()}};function a(){RAINIER.ui.tooltip.add(h.find("[tooltip]"),"top");h.find("footer .cancel").click(e.onClose);h.find("footer .submit").click(e.onSave);h.find("#cbAddWidget").click(e.onToggleWidget);RAINIER.ui.editFormClick(g,g.find("#edit-guest-access > a"))}function n(){var v={validationType:"utf8LengthTooLong",maxLen:32,whiteSpace:false,isRequired:true},w=validation.ruleSet.wpaPassphrase;if(t){w={minLen:o.guestSettings.guestPasswordRestrictions.minLength,maxLen:o.guestSettings.guestPasswordRestrictions.maxLength,isRequired:true,validCharSet:RAINIER.ui.validation.concatAllowedCharRanges(o.guestSettings.guestPasswordRestrictions.allowedCharacters)}}w.message=RAINIER.ui.validation.strings.guestAccess.passwordInvalid;c.fnPasswordValid=RAINIER.ui.buildInputValidBalloon($.extend(true,{},w,{els:j}));c.fnSsid24Valid=RAINIER.ui.buildInputValidBalloon($.extend(true,{},v,{els:h.find('input[name="radio.band24.guestSSID"]')}));c.fnSsid50Valid=RAINIER.ui.buildInputValidBalloon($.extend(true,{},v,{els:h.find('input[name="radio.band50.guestSSID"]')}))}function r(){function w(){RAINIER.connect.checkRouterConnectionForRestoration(true,false)}var y=true;if(!o.guestSettings.canEnableGuestNetwork){RAINIER.ui.MainMenu.closeApplet()}else{i.guestSettings=$.extend(true,{},o.guestSettings,RAINIER.binder.fromDom(h,l));if(!t){$.delAttr(i.guestSettings,"maxSimultaneousGuests")}if(!u){$.delAttr(i.guestSettings.radio,"band50")}if(RAINIER.applets.guestNetwork.isGuestSSIDConflict(i.guestSettings,o.radio)){b.show();y=false}else{if(u){if(!o.radio.band24){$.delAttr(i.guestSettings.radio,"band24")}if(!o.radio.band50){$.delAttr(i.guestSettings.radio,"band50")}if(o.radio.band24&&!o.radio.band24.settings.isEnabled&&i.guestSettings.radio.band24.isEnabled){d.show();y=false}else{if(o.radio.band50&&!o.radio.band50.settings.isEnabled&&i.guestSettings.radio.band50.isEnabled){s.show();y=false}}}}console.warn("doUpdate: "+y);if(y&&c.fnPasswordValid.isValid(true)&&c.fnSsid24Valid.isValid(true)&&(!o.guestSettings.radio.band50||c.fnSsid50Valid.isValid(true))){console.warn("isBand24Changing",RAINIER.applets.guestNetwork.isBand24Changing(o,i));console.warn("isBand50Changing",RAINIER.applets.guestNetwork.isBand50Changing(o,i));if(i.guestSettings.isGuestNetworkEnabled!==o.guestSettings.isGuestNetworkEnabled||i.guestSettings.maxSimultaneousGuests!==o.guestSettings.maxSimultaneousGuests||RAINIER.applets.guestNetwork.isBand24Changing(o,i)||RAINIER.applets.guestNetwork.isBand50Changing(o,i)){var x=false,v=null;if(!u&&o.guestSettings.isGuestNetworkEnabled&&i.guestSettings.isGuestNetworkEnabled&&o.guestSettings.radio.band24.guestSSID!==i.guestSettings.radio.band24.guestSSID){RAINIER.ui.showWaiting();x=true;v=function(){setTimeout(function(){RAINIER.jnap.send({action:"/jnap/core/Reboot",data:{},cb:function(z){if(z.result==="OK"){RAINIER.event.fire("router.interruptionStarted");RAINIER.ui.showWaiting();setTimeout(function(){w()},4000)}else{}},disableDefaultAjaxErrHandler:true,disableDefaultRebootErrHandler:true})},k)}}RAINIER.applets.guestNetwork.setSettings(i.guestSettings,v,null,true,x)}else{}RAINIER.ui.MainMenu.closeApplet()}}}function m(y){o.guestSettings=y||o.guestSettings;g.removeClass("edit");if(RAINIER.network.isBehindNode()){if(o.guestSettings.radio.band24.guestWPAPassphrase==="BeMyGuest"){g.find("#edit-guest-access > a").click();g.find("#guestWPAPassphrase").focus();o.guestSettings.radio.band24.guestWPAPassphrase=""}$.delAttr(o.guestSettings.radio,"band50")}i.guestSettings=$.extend(true,{},o.guestSettings);t=symmetryUtil.guestAccess.isCaptivePortal(o.guestSettings);if(o.guestSettings.radio.band50){g.addClass("guest-50")}if(q.find("option").length===0){var x=parseInt(o.guestSettings.maxSimultaneousGuestsLimit/10,10),w=RAINIER.ui.common.strings.guest;for(var v=x;v<=o.guestSettings.maxSimultaneousGuestsLimit;v+=x){if(w!==RAINIER.ui.common.strings.guests&&v>1){w=RAINIER.ui.common.strings.guests}q.append('<option value="{0}">{0} {1}</option>'.format(v,w))}}RAINIER.binder.toDom(o.guestSettings,h,{});h.find("[tooltip]").each(function(){var z=$(this);z.attr("tooltip",z.text())});if(!o.guestSettings.canEnableGuestNetwork){f({msg:h.find("#wirelessIsDisabled").html(),hideSubmit:true,cancel:RAINIER.ui.button.strings.ok});q.attr("disabled","disabled");h.find('input[name="isGuestNetworkEnabled"]').attr("disabled","disabled");h.find("#edit-guest-access > a").hide();h.find("footer .cancel").hide();h.find("#enabled-text-24").text(RAINIER.ui.common.strings.disabled);h.find("#enabled-text-50").text(RAINIER.ui.common.strings.disabled)}else{h.find('input[name="isGuestNetworkEnabled"]').removeAttr("disabled");h.find("#edit-guest-access > a").show();q.removeAttr("disabled");h.find("footer .cancel").show();if(h.find("#enabled-24").is(":checked")){h.find("#enabled-text-24").text(RAINIER.ui.common.strings.enabled)}else{h.find("#enabled-text-24").text(RAINIER.ui.common.strings.disabled)}if(h.find("#enabled-50").is(":checked")){h.find("#enabled-text-50").text(RAINIER.ui.common.strings.enabled)}else{h.find("#enabled-text-50").text(RAINIER.ui.common.strings.disabled)}j.attr("maxlength",t?o.guestSettings.guestPasswordRestrictions.maxLength:validation.ruleSet.wpaPassphrase.maxLength);n()}h.find('input[name="isGuestNetworkEnabled"]').trigger("change");RAINIER.ui.fixIeForm(g);RAINIER.event.fire("applet.loaded")}function p(){u=RAINIER.shared.util.areServicesSupported(["/jnap/guestnetwork/GuestNetwork3"]);if(RAINIER.network.isBehindNode()){h.find(".showForLinksysRouters").remove()}else{h.find(".showForNodes").remove()}RAINIER.util.trapEnter(".toggle-edit input");h.find("#cbAddWidget").attr("checked",RAINIER.connect.AppletManager.getWidgetShowState("B24C693D-4DFF-417D-A10F-A8212051E60E","E50B6C6C-35E7-425A-91BA-4313F87AA0B7"));b=RAINIER.ui.dialog($("#guest-ssid-conflict"));d=RAINIER.ui.dialog($("#band24-disabled"));s=RAINIER.ui.dialog($("#band50-disabled"));var v=RAINIER.jnap.Transaction();RAINIER.applets.guestNetwork.getSettings(o.guestSettings,m,v);v.add({action:RAINIER.jnapActions.getRadioInfo(),data:{},cb:function(w){if(w.result==="OK"){o.radio=w.output||{};$.each(o.radio.radios,function(){switch(this.band){case"2.4GHz":o.radio.band24=this;break;case"5GHz":o.radio.band50=this;break}})}}});v.send();a();if($.cookie("app-flag")==="conflict"){$.cookie("app-flag",null,{expires:null,path:"/"});b.show()}}p()}());