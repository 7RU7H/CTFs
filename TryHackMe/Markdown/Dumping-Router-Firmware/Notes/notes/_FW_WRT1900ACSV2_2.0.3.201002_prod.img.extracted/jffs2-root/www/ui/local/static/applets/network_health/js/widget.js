(function(){var d=$("#network-health.widget"),e=d.find("#main-slide"),E=d.find("#firmware-update-slide"),u=d.find("#net-slideshow"),m=d.find("#net-slideshow-controls"),s=["main"],j=(245+30),A=true,g=false,C=true,i=0,c=0,G=0,o=null,y=null,F="BDBC8297-8982-4BCF-84EC-91783FF9013C";var r={firmwareStatus:{}},l={fwLastSuccessfulCheckTime:null};function t(J,L){var H=d.find(J),I=H.hasClass("check-mark"),K=H.hasClass("error-mark");if((!I&&!K)||I!==L){H.removeClass("check-mark");H.removeClass("error-mark");H.addClass(L?"check-mark":"error-mark")}}function x(){if(A){t("#router-mark",true);if(g){t("#internet-mark",true);d.find("#network-health-router-not-found").removeClass("status-show");d.find("#no-internet-connection").removeClass("status-show");d.find("#connected").addClass("status-show")}else{t("#internet-mark",false);d.find("#connected").removeClass("status-show");d.find("#network-health-router-not-found").removeClass("status-show");d.find("#no-internet-connection").addClass("status-show")}}else{d.find("#internet-mark").removeClass("error-mark");d.find("#internet-mark").removeClass("check-mark");t("#router-mark",false);d.find("#connected").removeClass("status-show");d.find("#no-internet-connection").removeClass("status-show");d.find("#network-health-router-not-found").addClass("status-show")}}function k(H){if(RAINIER.connect.hasDoneInitialInternetCheck()){A=RAINIER.connect.isLanConnected();g=RAINIER.connect.isWanConnected();x();if(typeof H==="function"){H()}}else{setTimeout(function(){k(H)},2500)}}function h(H){var I=null;RAINIER.jnap.send({action:"/jnap/firmwareupdate/GetFirmwareUpdateStatus",data:{},cb:function(J){if(J.result==="OK"){r.firmwareStatus=J.output||{}}else{I=J.result}if(typeof H==="function"){H(I)}},disableDefaultJnapErrHandler:true,disableDefaultAjaxErrHandler:true,disableDefaultRebootErrHandler:true,timeoutMs:10000})}function D(){if($.inArray("firmware-update",s)===-1){E.show();s.push("firmware-update");B()}}function p(){console.warn("Network Status: checkForFirmware");if(RAINIER.network.isBehindNode()){RAINIER.network.checkNodesFwUpdate(function(H){if(_.find(_.result(H.output,"firmwareUpdateStatus"),"availableUpdate")){RAINIER.ui.herald.show("firmware-update")}},function(H){})}else{h(function(){l.fwLastSuccessfulCheckTime=r.firmwareStatus.lastSuccessfulCheckTime;a(function(H){if(H.result==="OK"){setTimeout(function(){h(q)},2500)}else{}})})}}function a(H){RAINIER.jnap.send({action:"/jnap/firmwareupdate/UpdateFirmwareNow",data:{onlyCheck:true},cb:function(I){H(I)},disableDefaultJnapErrHandler:true,disableDefaultAjaxErrHandler:true,disableDefaultRebootErrHandler:true})}function q(){var H=(r.firmwareStatus.lastSuccessfulCheckTime!==l.fwLastSuccessfulCheckTime),I=(!r.firmwareStatus.pendingOperation||r.firmwareStatus.pendingOperation!=="Checking");if(r.firmwareStatus.availableUpdate||(H&&I)||G>15){if(r.firmwareStatus.availableUpdate){D()}else{if($.inArray("firmware-update",s)!==-1){E.hide();s.splice($.inArray("firmware-update",s),1);B()}}}else{G++;setTimeout(function(){h(q)},2500)}}function n(I){var H=m.find("li");u.css("left",I*-j);H.removeClass("current");if(s.length>1){$(H[I]).addClass("current");clearInterval(o);b(I)}}function z(){$.each(s,function(H){m.append("<li></li>");m.find("li").last().bind("click",{slideItem:H},function(I){n(I.data.slideItem)})});m.find("li").first().addClass("current")}function f(){var H=m.find("li");if(C){c=(c<(s.length-1))?c+1:0;u.css("left",c*-j);H.removeClass("current");$(H[c]).addClass("current")}}function B(){if(o){clearInterval(o)}m.empty();if(s.length>1){z()}n(0)}function b(H){c=i=H;o=setInterval(f,8000)}function v(){e.mouseover(function(){C=false});e.mouseout(function(){C=true});E.mouseover(function(){C=false});E.mouseout(function(){C=true});E.find("#fw-update").click(function(){var H=RAINIER.connect.AppletManager.getAppletById(F);if(H){RAINIER.ui.MainMenu.launchApplet(H,"","check-firmware")}else{console.warn("Widget: cannot locate Connectivity applet")}})}function w(){v();RAINIER.event.connect("rainier.wanConnected",function(){g=true;x()});RAINIER.event.connect("rainier.wanDisconnected",function(){g=false;x()});RAINIER.event.connect("rainier.lanConnected",function(){A=true;x()});RAINIER.event.connect("rainier.lanDisconnected",function(){A=false;x()});RAINIER.event.connect(["router.interruptionStarted","rainier.firmwareCheckInitiated"],function(){if(y){clearTimeout(y);y=null}});k(function(){y=setTimeout(function(){if(g){p()}},45000)})}w()}());