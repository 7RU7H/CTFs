(function(a,b){if(typeof define==="function"&&define.amd){define(["lodash","./symmetry-jnap"],b)}else{if(typeof module==="object"&&module.exports){module.exports=b(require("lodash"),require("./symmetry-jnap"))}else{a.utilNetworkSecurity=b((a.lodash||a._),a.JNAP)}}}(this,function(r,j){var n;r.padStart=r.padStart||r.padLeft;var h={sunday:"111111111111111111111111111111111111111111111111",monday:"111111111111111111111111111111111111111111111111",tuesday:"111111111111111111111111111111111111111111111111",wednesday:"111111111111111111111111111111111111111111111111",thursday:"111111111111111111111111111111111111111111111111",friday:"111111111111111111111111111111111111111111111111",saturday:"111111111111111111111111111111111111111111111111"};var s="*.";var o=":00";var i=new RegExp(o+"$");var e=/\*\.(.+)/;function l(u,w){var v=u.engineConfigs.internetBlockScheduleExceptions.ignoreScheduleAndBlockMACAddresses;return v.indexOf(w)>-1}function g(u,v){var w=u.engineConfigs.internetBlockScheduleExceptions.ignoreScheduleAndAllowMACAddresses;return w.indexOf(v)>-1}function t(u,v){return r.result(r.find(u.supportedCategories,{categoryID:parseInt(v,10)}),"presetName")}function c(v,u){return r.result(r.find(v.engineConfigs.profiles.deviceSpecificProfiles,function(w){return w.macAddresses.indexOf(u)!==-1}),"internetBlockSchedule",null)}function m(v){var w=v.startTime.replace(i,""),u=v.endTime.replace(i,"");return{startHour:w*2,endHour:u*2}}function k(u){var v=r.clone(h);r.each(u,function(x,y){var w,z;r.each(x,function(A){w=m(A);z=r.fill(v[y].split(""),"0",w.startHour,w.endHour);v[y]=z.join("")})});return v}function p(w,v,x,u){w[v].push({startTime:x,endTime:u})}function q(w){var u=n.parentalControls.getUniqueWeekRanges(w),v={};r.each(h,function(y,x){v[x]=[]});r.each(u,function(x){x.days.forEach(function(z){var A=r.padStart(x.startHour+o,5,"0"),B=r.padStart(x.endHour+o,5,"0"),y=B;if(x.endNextDay){y="24:00";p(v,n.time.getNextDay(z),"00:00",B)}p(v,z,A,y)});x.days.forEach(function(y){v[y]=r.sortBy(v[y],function(z){return z.startTime})})});return v}function b(v){var u=[];r.each(v,function(w){u.push(w.replace(e,"$1"))});return r.uniq(u)}function a(v){var u=j.Deferred(),w=v?v.add:j.send;w("/parentalcontrol/GetParentalControlSettings").success(function(x){var y=r.cloneDeep(x.output);y.engineConfigs.profiles.deviceSpecificProfiles.forEach(function(A){var z=A.urlWhiteBlackList;r.each(A.urlWhiteBlackList,function(C,B){z[B]=b(C)})});y.maxTotalAllowedURLs=Math.floor(y.maxTotalAllowedURLs/2);u.resolve(y)}).error(function(x){u.reject(x)});return u}function d(v){var u=[];r.each(v,function(w){u.push(w);if(r.isNaN(n.ip.ipToNum(w))){u.push(s+w)}});return u}function f(v,w){var u=j.Deferred(),y=r.cloneDeep(v),x=w?w.add:j.send;y.engineConfigs.profiles.deviceSpecificProfiles.forEach(function(A){var z=A.urlWhiteBlackList;r.each(A.urlWhiteBlackList,function(C,B){z[B]=d(C)})});x("/parentalcontrol/SetParentalControlSettings",y).success(function(){u.resolve(y)}).error(function(z){u.reject(z)});return u}return function(u){n=u;return{isAlwaysBlocked:l,isAlwaysUnblocked:g,getCategoryNameByID:t,getBlockScheduleByMACAddress:c,blockScheduleToGrid:k,gridToBlockSchedule:q,scrubListForDisplay:b,modListForSave:d,getNetworkSecuritySettings:a,setNetworkSecuritySettings:f}}}));