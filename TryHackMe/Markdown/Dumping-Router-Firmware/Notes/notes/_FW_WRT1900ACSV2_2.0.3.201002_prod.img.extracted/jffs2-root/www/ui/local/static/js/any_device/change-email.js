function simpleInputValidation(){var b=document.getElementById("newEmailInput").value,a=document.getElementById("passwordInput").value;clearAllInputErrors();if(a.length===0){showInputValidationError("passwordValidation",true,RAINIER.ui.myAccountStrings.inputRequired)}else{if(b.length===0){showInputValidationError("newEmailValidation",true,RAINIER.ui.myAccountStrings.inputRequired)}else{if(b.length<7||b.length>254){showInputValidationError("newEmailValidation",true,RAINIER.ui.myAccountStrings.invalidEmail)}else{if(RAINIER.shared.util.beginsOrEndsWithSpace(b)){showInputValidationError("newEmailValidation",true,RAINIER.setup.ui.inputCannotBeginOrEndWithSpace)}else{return true}}}}return false}function showError(b,a){try{if(JSON.parse(b.responseText).errors[0].error.code==="INVALID_CURRENT_PASSWORD"){showGeneralError(RAINIER.ui.myAccountStrings.errorChangingPassword);showView("landing");return true}else{if(JSON.parse(b.responseText).errors[0].error.code==="INVALID_PARAMETER"){showGeneralError(RAINIER.ui.myAccountStrings.invalidEmailMsg);showView("landing");return true}else{if(JSON.parse(b.responseText).errors[0].error.code==="ACCOUNT_ALREADY_EXISTS"){showGeneralError(RAINIER.createAccount.strings.accountExistsMessage.replace("{username}",a));showView("landing");return true}else{if(JSON.parse(b.responseText).errors[0].error.code==="ACCOUNT_PENDING"){showGeneralError(RAINIER.ui.myAccountStrings.accountPending);showView("landing");return true}else{if(JSON.parse(b.responseText).errors[0].error.code==="INVALID_SESSION_TOKEN"){RAINIER.shared.ui.ensureSignedIn();return true}}}}}}catch(c){}showGeneralError(RAINIER.ui.myAccountStrings.couldNotSaveAccountModifications+"\n"+RAINIER.ui.myAccountStrings.couldNotSaveAccountModificationsTitle);showView("landing");return true}function changeEmail(){if(!simpleInputValidation()){return}showView("working");var b=document.getElementById("newEmailInput").value,a=document.getElementById("passwordInput").value;RAINIER.cloud.send({url:"/cloud/user-service/rest/accounts/self/usernamechanges",type:"POST",data:{passwordChange:{currentPassword:a,newUsername:b}},cb:function(d,c){if(c.status!==200){showError(c,b)}else{showView("emailVerified");document.getElementById("okButton").style.display="none";document.getElementById("cancelButton").style.display="none"}},cbError:function(c){showError(c,b)}})}function callback(){var a=RAINIER.shared.util.getURLParameter("callback");if(a){window.location.assign(a)}}function cancel(){callback()}function verifyToken(){var b={};b.verification={};b.verification.status="ACCEPTED";b.verification.parameters=[];var a=RAINIER.shared.util.getURLParameter("callback");RAINIER.cloud.send({url:"/cloud/user-service/rest/verifications/"+RAINIER.shared.util.getURLParameter("verificationToken")+"/status/",type:"PUT",data:b,cb:function(){if(a){showGeneralMessage(RAINIER.ui.myAccountStrings.successMessage.replace("{url}",a))}else{showGeneralMessage(RAINIER.ui.myAccountStrings.successMessageNoCallback)}showView("emailChanged");RAINIER.shared.util.signOutCookies()},cbError:function(c){if((c.status===409&&c.statusText==="Conflict")||(c.status===404&&c.statusText==="Not Found")){showGeneralError();showView()}else{var d={};try{d.result=JSON.parse(c.responseText).errors[0].error.message}catch(f){}RAINIER.shared.ui.showGenericError()}}})}window.onload=function(){var b=RAINIER.shared.util.getURLParameter("verificationToken"),a=RAINIER.shared.util.getURLParameter("callback");if(!a){document.getElementById("cancelButton").style.display="none"}if(b){document.getElementById("okButton").style.display="none";document.getElementById("cancelButton").style.display="none";showView("verifyingAccount");verifyToken()}else{RAINIER.shared.ui.ensureSignedIn();showView("landing")}};