var commonReservedIpAddresses=["0.0.0.0","127.0.0.0","169.254.0.0","224.0.0.0","240.0.0.0","255.255.255.255"],reservedHostIpAddresses=["192.168.1.0","192.168.1.255"];function isReservedIpAddress(b,a){function d(g){var e=0,f=g.length;for(e;e<f;e++){if(g[e]===b){return true}}return false}var c=d(commonReservedIpAddresses);return !c&&a?d(reservedHostIpAddresses):c}function dot2num(a){return((((((+a[0].value)*256)+(+a[1].value))*256)+(+a[2].value))*256)+(+a[3].value)}function ipAddressToString(a){return a[0].value+"."+a[1].value+"."+a[2].value+"."+a[3].value}function parseIPAddressToArray(a){return a.split(".")}function fromSubnetToPrefixLength(b){var c=b.toString(2),a=c.indexOf("0");if(b===0){return 0}else{if(b===4294967295){return 32}else{if(c.length!==32){return -1}else{if(/^1+0+$/.test(c)){return a}else{return -1}}}}}function fromPrefixLengthToSubnet(g){var d=parseInt(g);function h(m){return parseInt(m,2)}if(d>=0&&d<=32){var e="11111111111111111111111111111111",a="00000000000000000000000000000000",i=e.substring(0,d),j=a.substring(0,32-d),k=i.concat(j),b=k.substring(0,8),f=k.substring(8,16),l=k.substring(16,24),c=k.substring(24,32);return h(b)+"."+h(f)+"."+h(l)+"."+h(c)}return -1}function commonValidations(a,g){var d=0,f=0,c=false,e=a.length,b;for(d;d<e;d++){b=a[d].value;f=d;if(b.length===0){showInputValidationError(g,true,RAINIER.setup.ui.inputRequired);c=true;break}else{if(RAINIER.shared.util.beginsOrEndsWithSpace(b)){showInputValidationError(g,true,RAINIER.setup.ui.inputCannotBeginOrEndWithSpace);c=true;break}else{if(!isNumber(b)||b>255||b<0){showInputValidationError(g,true,RAINIER.setup.ui.inputInvalid);c=true;break}}}}if(c){a[f].focus();document.addClass(a[f],"currentError");return false}return true}function validateIpAddress(){var a=document.getElementById("ipAddressFields").getElementsByTagName("input"),b=ipAddressToString(a),c=commonValidations(a,"ipAddressValidation");if(c&&(a[0].value==="0"||isReservedIpAddress(b,true))){showInputValidationError("ipAddressValidation",true,RAINIER.setup.ui.invalidIpAddress);return false}return c}function validateSubnet(){var a=document.getElementById("subnetFields").getElementsByTagName("input"),e=parseInt(a[0].value,10),c=dot2num(a),d=c.toString(2),g=d.indexOf("0"),b=ipAddressToString(a),f=commonValidations(a,"subnetValidation");if(f){f=!isReservedIpAddress(b)&&e!==0&&d.length===32&&g>=8&&g<=30&&d.indexOf("1",g)===-1;if(!f){showInputValidationError("subnetValidation",true,RAINIER.setup.ui.invalidSubnetMask)}}return f}function validateGateway(){var c=document.getElementById("gatewayFields").getElementsByTagName("input"),b=document.getElementById("ipAddressFields").getElementsByTagName("input"),d=ipAddressToString(c),g=commonValidations(c,"gatewayValidation");if(g){var e=0,a=true,f=c.length;for(e;e<f;e++){if(c[e].value!==b[e].value){a=false;break}}if(a){showInputValidationError("gatewayValidation",true,RAINIER.setup.ui.equalGatewayIpAddress);g=false}else{if(isReservedIpAddress(d)){showInputValidationError("gatewayValidation",true,RAINIER.setup.ui.invalidIpAddress);g=false}}}return g}function validateDns(){var a=document.getElementById("dnsFields").getElementsByTagName("input"),b=ipAddressToString(a),c=commonValidations(a,"dnsValidation");if(c){if(isReservedIpAddress(b)||a[0].value==="0"){showInputValidationError("dnsValidation",true,RAINIER.setup.ui.invalidDns);c=false}}return c}function validateAll(){document.removeClass(document.getElementsByClass("currentError")[0],"currentError");clearAllInputErrors();return validateIpAddress()&&validateSubnet()&&validateGateway()&&validateDns()}function updateIpAddressEl(c,a){var b=parseIPAddressToArray(c),d=0,e=b.length;for(d;d<e;d++){a[d].value=b[d]}}function enableOrDisableInputs(c){var e=document.getElementById("staticSettingsBox"),f=e.getElementsByTagName("input"),a=0,d=f.length,b;if(c){document.addClass(e,e.className+" opacity")}else{b=new RegExp("(\\s|^)opacity(\\s|$)");document.removeClass(e,e.className+" opacity")}for(a;a<d;a++){f[a].disabled=c}}function autoDHCP(){enableOrDisableInputs(document.getElementById("autoDHCP").checked)}function saveSettings(d){var a=document.getElementById("subnetFields").getElementsByTagName("input"),b=dot2num(a);function c(){setDSLSettings(function(h){if(h.result==="OK"){d()}else{var g=document.getElementById("validationErrorDiv"),e=g.getElementsByTagName("td");showView("landing");g.style.display="block";for(var f=1;f<e.length;f++){document.addClass(e[f],"hidden")}switch(h.result){case"ErrorInvalidGateway":document.removeClass(document.getElementById("ErrorInvalidGateway"),"hidden");break;case"ErrorInvalidIPAddress":document.removeClass(document.getElementById("ErrorInvalidIPAddress"),"hidden");break;case"ErrorInvalidNetworkPrefixLength":document.removeClass(document.getElementById("ErrorInvalidNetworkPrefixLength"),"hidden");break;case"ErrorInvalidPrimaryDNSServer":document.removeClass(document.getElementById("ErrorInvalidPrimaryDNSServer"),"hidden");break;default:RAINIER.executeDefaultJnapErrorHandler(h);break}}})}RAINIER.PMSettings.dslSettings=RAINIER.PMSettings.dslSettings||{};if(!document.getElementById("autoDHCP").checked){if(validateAll()){showView("working");RAINIER.PMSettings.dslSettings.autoDHCP=false;RAINIER.PMSettings.dslSettings.staticSettings={ipAddress:ipAddressToString(document.getElementById("ipAddressFields").getElementsByTagName("input")),networkPrefixLength:fromSubnetToPrefixLength(b),gateway:ipAddressToString(document.getElementById("gatewayFields").getElementsByTagName("input")),dnsServer1:ipAddressToString(document.getElementById("dnsFields").getElementsByTagName("input"))};c()}}else{showView("working");if(RAINIER.PMSettings.dslSettings.wanType==="2684Bridged"){RAINIER.PMSettings.dslSettings.autoDHCP=true;delete RAINIER.PMSettings.dslSettings.staticSettings}c()}}function fillInputs(){updateIpAddressEl(RAINIER.PMSettings.dslSettings.staticSettings.ipAddress,document.getElementById("ipAddressFields").getElementsByTagName("input"));updateIpAddressEl(fromPrefixLengthToSubnet(RAINIER.PMSettings.dslSettings.staticSettings.networkPrefixLength),document.getElementById("subnetFields").getElementsByTagName("input"));updateIpAddressEl(RAINIER.PMSettings.dslSettings.staticSettings.gateway,document.getElementById("gatewayFields").getElementsByTagName("input"));updateIpAddressEl(RAINIER.PMSettings.dslSettings.staticSettings.dnsServer1,document.getElementById("dnsFields").getElementsByTagName("input"))}function goToNextPage(){if(!RAINIER.shared.util.getCookie("admin-auth")){setRouterPassword("admin")}clearAllInputErrors();saveSettings(function(){RAINIER.shared.util.setCookie("staticSettings",true,null,"/");checkInternetStatus()})}function init(){getDSLSettings(function(a){if(a.result==="OK"){RAINIER.PMSettings.dslSettings=RAINIER.PMSettings.dslSettings||{};if(RAINIER.shared.util.getCookie("dslSettings")){RAINIER.PMSettings.dslSettings=JSON.parse(RAINIER.shared.util.getCookie("dslSettings"))}if(RAINIER.PMSettings.dslSettings.staticSettings){fillInputs()}if(RAINIER.PMSettings.dslSettings.wanType==="2684Bridged"){document.getElementById("autoDHCPSection").style.display="block"}if(RAINIER.manualSettingsRetries>1&&RAINIER.shared.util.getCookie("staticSettings")){document.getElementById("validationErrorDiv").style.display="block";document.removeClass(document.getElementById("ErrorInvalidStaticSettings"),"hidden")}showView("landing");checkInputs()}})}window.onbeforeunload=function(){return RAINIER.shared.util.decodeHtml(RAINIER.setup.ui.confirmExit)};function checkInputs(){var c=document.getElementById("gatewayFields").getElementsByTagName("input"),b=document.getElementById("ipAddressFields").getElementsByTagName("input"),d=document.getElementById("subnetFields").getElementsByTagName("input"),e=document.getElementById("dnsFields").getElementsByTagName("input"),a=document.getElementById("autoDHCP").checked;if(a){changeBtnState(document.getElementById("nextButton"),true)}else{var f=checkEmptyInputs(c)&&checkEmptyInputs(b)&&checkEmptyInputs(d)&&checkEmptyInputs(e);changeBtnState(document.getElementById("nextButton"),f)}}function checkEmptyInputs(b){for(var a=0;a<b.length;a++){if(b[a].value.length<=0){return false}}return true}window.onload=function(){showView("loading");init()};