RAINIER=RAINIER||{};RAINIER.ajax=(function(){function b(d,k,j){function h(m,l){var n;if(m.responses&&m.result==="Error"){for(var o=0;o<m.responses.length;o++){for(n=0;n<l.length;n++){if(m.responses[o].result===l[n]){return true}}}}else{for(n=0;n<l.length;n++){if(m.result===l[n]){return true}}}return false}if(d&&h(d,["_ErrorSessionVerification"])&&RAINIER.network.uiLoadedFromCloud()){RAINIER.ui.dialogSigningOut()}else{if(!(RAINIER.routerInterruptionDialog&&RAINIER.routerInterruptionDialog.isShowing())&&!(RAINIER.routerNotFoundDialog&&RAINIER.routerNotFoundDialog.isShowing())&&!RAINIER.ui.dialog($("#router-reboot"),{}).isShowing()){if(d===null||typeof d!=="object"){d={result:d?d:"JSON parse error"}}if(k){d.action=k;if(k.indexOf("/jnap/core/Transaction")>-1){var g,f=RAINIER.jnap.transactions();console.warn(f);for(var e=0;e<d.responses.length;e++){g=d.responses[e].result;if(g!=="OK"&&g!=="_ErrorAbortedAction"){d.action=f[e].action+" : "+JSON.stringify(f[e].request);d.result=g;break}}}if(j&&j.getAllResponseHeaders().length>0){d.responseHeaders=j.getAllResponseHeaders()}}RAINIER.ui.dialogError(d)}}}var c={executeDefaultJnapErrorHandler:b};var a=function(d){var e=Object.create(d);if($.isFunction(e.initialize)){Array.prototype.shift.call(arguments);e.initialize.apply(e,arguments)}return e};return function(){return a(c)}}());function executeDefaultAjaxErrorHandler(c,e,f){function d(g){if(RAINIER.network.isAuthorityRemote()){RAINIER.network.handleRemoteConnectionProblem(f)}else{if(RAINIER.routerNotFoundDialog.isShowing()){RAINIER.routerNotFoundDialog.show(g)}}}if(RAINIER.network.isBeforeUnload()){return}var b;if(c&&(c.status===0||c.status===12007||c.status===12029)){if(!RAINIER.routerInterruptionDialog.isShowing()&&!RAINIER.routerNotFoundDialog.isShowing()&&!RAINIER.ui.dialog($("#router-reboot"),{}).isShowing()){var a=e;if(e.indexOf("/jnap/core/Transaction")>-1){a+=" -- "+RAINIER.jnap.transactions()}if(c&&c.getAllResponseHeaders().length>0){a+=" -- "+c.getAllResponseHeaders()}RAINIER.ui.hideWaiting(function(){RAINIER.ui.hideMasterWaiting(function(){d(a)})})}}else{if(c&&(c.status>=500&&c.status<600)){b={result:"Cloud 500 Error"}}else{b={result:"JSON parse error"}}if(e){b.action=e;if(e.indexOf("/jnap/core/Transaction")>-1){b.transactions=RAINIER.jnap.transactions()}if(c&&c.getAllResponseHeaders().length>0){b.responseHeaders=c.getAllResponseHeaders()}}RAINIER.ui.dialogError(b)}}RAINIER.cloud=(function(){var a=RAINIER.ajax();a.request=b;a.send=d;function c(e){$.ajax(e)}function b(g){if(typeof g!=="object"){return}var f=g.url,j=g.type||"GET",e=g.cb,k=g.cbError,l=g.headers||[],m={};m.Accept="application/json";m["X-Linksys-Network-Id"]=RAINIER.network.getCurrentNetworkID();m["X-Linksys-Client-Type-Id"]=RAINIER.shared.util.getCiscoHNClientID();m["X-Linksys-Router-FW-Version"]=RAINIER.network.getCurrentNetworkFirmwareVersion();m["X-Linksys-Router-Model-Number"]=RAINIER.network.getCurrentNetworkModelNumber();m.Expires="Fri, 10 Oct 2013 14:19:41 GMT";m["Cache-Control"]="no-cache";for(var h=0;h<l.length;h++){if(l[h].name){m[l[h].name]=l[h].value}}if($.cookie("user-auth-token")){m.Authorization='CiscoHNUserAuth session_token="'+$.cookie("user-auth-token")+'"'}return{headers:m,type:j,contentType:"application/json; charset=UTF-8",dataType:"json",url:f,data:JSON.stringify(g.data),error:function(i,o,n){if(typeof k!=="function"||k(i)===false){executeDefaultAjaxErrorHandler(i,f,o)}},success:function(n,o,i){if(typeof n!=="object"){a.executeDefaultJnapErrorHandler(n,f,i)}else{if(typeof e==="function"){e(n,i)}}}}}function d(){var e=RAINIER.cloud.request;c(e.apply(e,arguments))}return a}());RAINIER.jnap=(function(){var a=false,i,b=20,f=3000,h="";function d(v){if(typeof v!=="object"){v={action:arguments[0],data:arguments[1],cb:arguments[2],disableDefaultAjaxErrHandler:arguments[3],disableDefaultJnapErrHandler:arguments[4],disableDefaultRebootErrHandler:arguments[5],useAdminAuth:arguments[6],adminPasswordOverride:arguments[7],forceLocal:arguments[8],networkID:arguments[9],timeoutMs:arguments[10],altJNAPHost:arguments[11]}}var o=RAINIER.network.getJNAPHost(),q=v.altJNAPHost||false;if(q){o=RAINIER.network.getAltJNAPHost()}var p=v.action,m=v.cb,u=p.substr(0,7)==="http://"?p:"http://{0}".format(o)+p,k={},x=v.disableDefaultAjaxErrHandler||false,j=v.disableDefaultJnapErrHandler||false,r=v.disableDefaultRebootErrHandler||false,s=v.useAdminAuth||false,n=v.adminPasswordOverride||null,y=v.forceLocal||false,l=v.networkID||RAINIER.network.getCurrentNetworkID(),z=v.timeoutMs||null,t=0;h=v.data;if(!y&&RAINIER.network.uiLoadedFromCloud()&&RAINIER.network.getAuthorityNetworkID()!==l){a=true}else{a=false}if(!z){if(RAINIER.network.isAuthorityRemote()){z=30000}else{if(p.indexOf("/jnap/core/Transaction")>-1){z=15500}else{z=10000}}}$.ajaxSetup({timeout:z});k["X-JNAP-Action"]=u;k.Expires="Fri, 10 Oct 2013 14:19:41 GMT";k["Cache-Control"]="no-cache";if(a){k["X-Linksys-Network-Id"]=l;k["X-Linksys-Client-Type-Id"]=RAINIER.shared.util.getCiscoHNClientID();k.Authorization='CiscoHNUserAuth session_token="'+$.cookie("user-auth-token")+'"'}else{if(!s&&$.cookie("user-auth-token")){k["X-JNAP-Session"]=$.cookie("user-auth-token")}else{if(n){k["X-JNAP-Authorization"]=n}else{k["X-JNAP-Authorization"]=$.cookie("admin-auth")}}}var w={headers:k,type:"POST",url:a?"/cloud/JNAP/":"/JNAP/",data:JSON.stringify(v.data),contentType:"application/json; charset=UTF-8",error:function(A,C,B){if(!x){executeDefaultAjaxErrorHandler(A,p,C)}if(typeof m==="function"){m({result:"_AjaxError"},A)}},success:function(A,F,D){var B,E;if(typeof A!=="object"){E=RAINIER.util.parseJSON(A);B=A}else{E=A;B=JSON.stringify(A)}if(!E||E.result!=="OK"){if(E&&E.result==="_ErrorUnexpected"&&E.error==="timeout"&&RAINIER.network.isAuthorityRemote()){window.location.replace("/ui/dynamic/no-remote-router.html")}else{if((!E&&RAINIER.connect.isRouterRebooting())||(E&&(E.result==="_ErrorNotReady"||(p.indexOf("/jnap/core/Transaction")>-1&&E.responses&&$.grep(E.responses,function(G){return G.result==="_ErrorNotReady"}).length>0)))){t++}else{t=b+1}}if(t<=b){var C=$.extend({},this.xhrRetry);C.xhrRetry=$.extend({},this.xhrRetry);setTimeout(function(){$.ajax(C)},f);return}else{if(!j){i.executeDefaultJnapErrorHandler(E,p,D)}}}if(typeof m==="function"){m(E,D)}if(E&&E.result&&E.result==="OK"&&E.sideEffects&&E.sideEffects.length>0){if(!r){RAINIER.connect.handleSideEffects(E.sideEffects)}}},xhrRetry:null};w.xhrRetry=$.extend({},w);return w}function g(j){$.ajax(j)}function c(){var j=RAINIER.jnap.request;g(j.apply(j,arguments))}function e(){return h}i=RAINIER.ajax();i.request=d;i.transactions=e;i.send=c;return i}());RAINIER.jnap.Transaction=(function(){function b(e,h){var f,g;if(typeof e!=="object"){g=RAINIER.util.parseJSON(e);f=e}else{g=e;f=JSON.stringify(e)}if($.isFunction(this.onReturn)){this.onReturn()}a.call(this,g,f,h);if($.isFunction(this.onComplete)){this.onComplete(g,h)}}function a(f,e,h){for(var g=0;g<this.callbacks.length;g++){if($.isFunction(this.callbacks[g])){this.callbacks[g].call(this,(f&&f.responses)?f.responses[g]:{result:"_AjaxError"},h,f,g)}}}var d={add:function(e){if(typeof e!=="object"){e={action:arguments[0],data:arguments[1],cb:arguments[2]}}e.action="http://{0}{1}".format(RAINIER.network.getJNAPHost(),e.action);this.actions.push({action:e.action,request:e.data});this.callbacks.push(e.cb)},send:function(){RAINIER.jnap.send.call(this,this.jnapOpts)}};var c=function(f){if(typeof f!=="object"){f={};if($.isFunction(arguments[0])){f.onReturn=arguments[0]}if($.isFunction(arguments[1])){f.onComplete=arguments[1]}}var e=Object.create(d);$.extend(e,f);e.callbacks=[];e.actions=[];e.jnapOpts=$.extend(f,{action:"http://{0}/jnap/core/Transaction".format(RAINIER.network.getJNAPHost()),data:e.actions,cb:b.bind(e)});return e};return c}());$(window).bind("beforeunload",function(){RAINIER.network.setBeforeUnload(true)});