(function(){var cj=$("#connectivity-applet"),bc=cj.find("#basic"),ae=cj.find("#local-network"),ar=cj.find("#vlan-tagging"),bZ=cj.find("#vlanProfiles"),b0=cj.find("#administration"),a7=cj.find("#advanced-routing"),bm=cj.find("#fw-update-form"),aD=cj.find("#pm-fw-update-form"),ba=cj.find("#static-list"),aA=RAINIER.applets.connectivity.sharedOptions,Y=RAINIER.applets.connectivity.sharedEvents,F=ae.find('div.ip-input:[name="lanSettings.ipAddress"]'),bk=ae.find('input[name="lanSettingsSetup.dhcpSettings.maxClients"]'),b2=cj.find("#firmware-auto-nodes"),X=b2.find("#fw-details-block"),M=RAINIER.ui.dialogWarning,a0=null,aQ=null,h=null,m=null,bb=null,bT=null,b4=null,x=null,ac=null,aa=RAINIER.ui.buildInputValidBalloon,bK=null,bh=null,co=null,ab=0,a2=0,ax=false,b3=false,aL={name:"",settings:{"interface":"",destinationLAN:"",subnetMask:"",gateway:""}},u={name:"",settings:{"interface":"",destinationLAN:"0.0.0.0",subnetMask:"0.0.0.0",gateway:"0.0.0.0"}},o=/^([0-9]+)\.([0-9]+)\.([0-9]+)\.([0-9]+)$/,q=/^.*(FW_APM[0-9][0-9][0-9]_Annex_[A-Z]).+$/,A=/^.*FW_[^_]+_(\d+)\..+$/i,cs=null,aH=null,bu=null,b1=null,ca=null,ak=false,by=false,cp=null,cc=false,Q=false,d=false,bd=false,bj=window.location.hash,aS=240*1000,aR=5*1000,bM=3*1000,s=3,bg=0,t,aU,aw=[];var w=RAINIER.applets.connectivity.internetSettings;var c=[".bin",".img",".trx",".ssa"];var P=RAINIER.ui.template.createTemplate($("#templateStaticRow tr")),cg=RAINIER.ui.template.createTemplate(cj.find("#template-wireless-radios > *")),S=RAINIER.ui.template.createTemplate(cj.find("#template-nodes-fw-details > *"));var b={devices:[],wireless:{radios:[]},portlights:false,firmware:{},firmwareStatus:{},time:{},lanSettings:{},lanSettingsSetup:{},linkAggregation:{},connections:{},info:{},routing:{entries:[]},mgmt:{},upnp:{},isSIPEnabled:false,adminPwRestrictions:{},dhcpLease:{},guestSettings:{},isCTFEnabled:false,isExpressForwardingEnabled:false,vlanSettings:{},vlanSettingsSetup:{maxVLANTaggingRulesPerPort:5},openVpn:{},wan:{},DSLSettings:{},PowerModemStatus:{},passwordHint:"",isAllJoynEnabled:false};var br={adminpass:"",isPasswordCurrent:false,portlights:false,wireless:{radios:[]},setWireless:[],dhcp:{},time:{},firmware:{},routing:{entries:[]},isSIPEnabled:false,routingList:[],supportedTimeZones:[],maxDHCPReservationDescriptionLength:0,maxStaticRouteEntries:0,trans:{},fwLastSuccessfulCheckTime:null,isCTFEnabled:false,vlanSettings:{},isAllJoynEnabled:false};var b5={"linkAggregation.isEnabled":"boolean","wan.mtu":"number","wan.tpSettings.useStaticSettings":"boolean","wan.bridgeSettings.useStaticSettings":"boolean","wan.useStaticSettings":"boolean","wan.tpSettings.maxIdleMinutes":"number","wan.tpSettings.reconnectAfterSeconds":"number","wan.L2TPSettings.maxIdleMinutes":"number","wan.L2TPSettings.reconnectAfterSeconds":"number","wan.pppoeSettings.maxIdleMinutes":"number","wan.pppoeSettings.reconnectAfterSeconds":"number","lanSettings.dhcpSettings.leaseMinutes":"number","lanSettings.dhcpSettings.maxClients":"number","ipv6.ipv6rdTunnelSettings.prefixLength":"number","ipv6.ipv6rdTunnelSettings.borderRelayPrefixLength":"number","vlanSettings.isEnabled":"boolean",vlanID:"number",vlanPriority:"number","vlanSettings.profile.vlanTaggingSettings.wanSettings.vlanID":"number","vlanSettings.profile.vlanTaggingSettings.ipTVSettings.vlanID":"number","vlanSettings.profile.vlanTaggingSettings.voIPSettings.vlanID":"number","vlanSettings.profile.vlanTaggingSettings.wanSettings.vlanPriority":"number","routing.isDynamicRoutingEnabled":"boolean","labels.band":"display-only","labels.short":"display-only","labels.network":"display-only","labels.networkName":"display-only"};var bp=aA.checks;var bv={name:"Manual",vlanTaggingSettings:{wanSettings:{vlanID:0,vlanPriority:0,vlanStatus:"Tagged"},ipTVSettings:[],voIPSettings:[]}};var ck={onEditRoute:function(){var cu=this.index()-1,cv=$(this);cv.addClass("edit");cv.removeClass("hover");RAINIER.binder.toDom(br.routingList[cu],cv,{});av(cv)},onDelRoute:function(){var cu=this.index()-1;br.routingList.splice(cu,1);$(this).hide();$(this).remove()},onUpdRoute:function(){var cu=this.index()-1,cw=$(this),cv=RAINIER.binder.fromDom(cw,{});if(aK(cw)){br.routingList[cu]=cv;RAINIER.binder.toDom(cv,cw);if(cv.settings["interface"]==="LAN"){cw.find("#interface-lan").show();cw.find("#interface-internet").hide()}else{cw.find("#interface-internet").show();cw.find("#interface-lan").hide()}cw.removeClass("edit")}},onCancelRoute:function(){var cu=this.index()-1,cw=$(this),cv=br.routingList[cu];RAINIER.ui.inputBalloon.hide();RAINIER.ui.validation.removeInvalidMarks(cw);cw.removeClass("edit");if(b6(cv)){br.routingList.splice(cu,1);cw.remove()}else{RAINIER.binder.toDom(cv,cw)}},onAutoFirmwareUpdate:function(){M({msg:cj.find("#updateFwConfirm").html(),onSubmit:function(){$("#fw-installing").css("display","none");$("#fw-downloading").css("display","inline");ak=true;n()}})},onManualFirmwareUpdate:function(){console.warn("onManualFirmwareUpdate");if(a0&&a0.isShowing()){a0.close()}M({msg:cj.find("#updateFwConfirm").html(),onSubmit:function(){ak=false;N()}})},onManualPmFirmwareUpdate:function(){console.warn("onManualPmFirmwareUpdate");x=M({msg:cj.find("#updatePmFwConfirm").html(),onSubmit:function(){by=false;bR()}})},onEnableVlanChange:function(cv){var cu=$(cv.target).is(":checked");bZ.attr("disabled",!cu);RAINIER.ui.shield.toggle(ar.find(".highlighted.block-row"),!cu)},onVlanProfilesChange:function(){if(!bd){var cu=bZ.val(),cv={vlanSettings:{}};if(cu!=="Manual"){$.each(aw,function(){if(this.name===cu){cv.vlanSettings.profile=this}})}else{RAINIER.ui.shield.toggle(ar.find(".highlighted.block-row"),false)}if(!cv.vlanSettings.profile&&b.vlanSettings.profile&&b.vlanSettings.profile.name!=="Manual"){cv.vlanSettings.profile=$.extend({},b.vlanSettings.profile);cv.vlanSettings.profile.name="Manual"}bE(cv)}},onClose:Y.onClose,onApply:function(){bt(false)},onSave:function(){bt(true)},onSaveComplete:Y.onSaveComplete};var aF={advancedrouting:false,vlantagging:false,administration:false,powerModem:false};var az={cutThroughForwarding:false,expressForwarding:false,passwordHint:false,allJoyn:false,router6:false,powerTable:false};var aO={basic:cj.find("#basic-tab"),localNetwork:cj.find("#localnetwork-tab"),advancedrouting:cj.find("#advancedrouting-tab"),vlantagging:cj.find("#vlantagging-tab"),administration:cj.find("#administration-tab"),powerModem:cj.find("#powerModem-tab"),velopSimpleSetup:cj.find("#velopSimpleSetup-tab")};function bt(cv){var cu=false;aA.doClose=cv||false;aA.doSave=true;switch(b1){case"basic":if(T()){cu=true;if(bS()){au()}}break;case"internet-settings":cu=w.save();break;case"power-modem":if(w.powerModemHasChanges()){cu=true;w.pmSettingsSave()}break;case"local-network":if(ao()){cu=true;if(bW()){a3()}}break;case"advanced-routing":if(bi()){cu=true;if(aN()){bH()}}break;case"vlan-tagging":if(D()){cu=true;if(aT()){bn()}}break;case"administration":if(j()){cu=true;aM()}break}if(aA.doClose&&!cu){ck.onClose()}}function E(){var cu=false;switch(bu){case"basic":cu=T();break;case"internet-settings":cu=w.internetSettingsHasChanges();break;case"power-modem":cu=w.powerModemHasChanges();break;case"local-network":cu=ao();break;case"advanced-routing":cu=bi();break;case"vlan-tagging":cu=D();break;case"administration":cu=j();break}if(cu){b1=bu;cs.show()}return cu}function B(){bd=true;switch(b1){case"basic":aV();ah();bz();break;case"internet-settings":w.resetTabChanges();break;case"power-modem":w.resetPowerModemChanges();break;case"local-network":$.extend(true,b.lanSettingsSetup,b.lanSettings);aX();bJ();break;case"advanced-routing":ap();break;case"vlan-tagging":bE();break;case"administration":r();break}bd=false}function bB(){w.pageLoad();w.internetSettingsAddEvents()}function ch(cu){cu.add({action:RAINIER.jnapActions.getRadioInfo(),data:{},cb:function(cv){if(cv.result==="OK"){b.wireless=cv.output||{};RAINIER.applets.wireless.sortRadios(b.wireless.radios);console.warn("getRadioInfo",RAINIER.jnapActions.getRadioInfo(),b.wireless)}else{}}});cu.add({action:"/jnap/locale/GetTimeSettings",data:{},cb:function(cv){b.time=cv.output||{};if(cv.result==="OK"){b.time.supportedTimeZones.sort(function(cx,cw){if(cx.description===cw.description){return 0}else{if(cx.description>cw.description){return 1}else{return -1}}});br.supportedTimeZones=b.time.supportedTimeZones;$.delAttr(b.time,"currentTime","supportedTimeZones")}else{}}});cu.add({action:"/jnap/routerleds/GetRouterLEDSettings",data:{},cb:function(cv){if(cv.result==="OK"){b.portlights=cv.output.isSwitchportLEDEnabled}else{}}});cu.add({action:"/jnap/firmwareupdate/GetFirmwareUpdateSettings",data:{},cb:function(cv){if(cv.result==="OK"){b.firmware=cv.output||{}}else{}}});cu.add({action:"/jnap/core/GetAdminPasswordRestrictions",data:{},cb:function(cv){if(cv.result==="OK"){b.adminPwRestrictions=cv.output||{}}else{}}});cu.add({action:"/jnap/core/GetDeviceInfo",data:{},cb:function(cv){if(cv.result==="OK"){b.info=cv.output||{}}else{}}});if(aF.powerModem){cu.add({action:"/jnap/powermodem/GetDSLSettings",data:{},cb:function(cv){if(cv.result==="OK"){b.DSLSettings=cv.output||{}}}});cu.add({action:"/jnap/powermodem/GetPowerModemStatus",data:{},cb:function(cv){if(cv.result==="OK"){b.PowerModemStatus=cv.output||{};if(b.PowerModemStatus.status==="Found"){ad()}else{bc.find("#pm-fw-version").hide()}}}})}cu.add({action:RAINIER.jnapActions.getWANStatus(),data:{},cb:function(cv){if(cv.result==="OK"){if(cv.output){b.wan=cv.output}else{}}else{}}});RAINIER.applets.guestNetwork.getSettings(b.guestSettings,function(cv){b.guestSettings=$.extend({},cv)},cu);if(az.passwordHint){cu.add({action:"/jnap/core/GetAdminPasswordHint",data:{},cb:function(cv){if(cv.result==="OK"){b.passwordHint=cv.output||{}}else{}}})}if(RAINIER.shared.util.areServicesSupported(["/jnap/powertable/PowerTable"])){cu.add({action:"/jnap/powertable/GetPowerTableSettings",data:{},cb:function(cv){if(cv.result==="OK"){b.powerTable=cv.output||{};az.powerTable=cv.output.isPowerTableSelectable}else{}}})}}function cr(){var cu=null,cv=null;bc.find("#basic-wireless-radios").empty();$.each(b.wireless.radios,function(cx,cw){if(RAINIER.applets.wireless.shouldFilterRadio(cw,b.wireless)){cv=RAINIER.shared.util.getLabeledRadio(b.wireless,cw.radioID);RAINIER.applets.wireless.setDisplayWepKey(cv);cu=RAINIER.ui.template.createBlock(cg,cv,b5);cu.prop("id",cw.radioID);if(RAINIER.network.isRadioLocked(cw.band)){cu.find(".row").hide();cu.find("#bridge-message").text(RAINIER.ui.strings.bridge.radioLocked);cu.find("#wireless-bridge").show()}else{ai(cu,cw)}cu.find("[tooltip]").each(function(){$(this).attr("tooltip",$(this).text())});bc.find("#basic-wireless-radios").append(cu);bA(bc.find("#"+RAINIER.ui.escapeId(cw.radioID)),cw)}});if(b.wireless.bandSteeringMode==="TriBand"){bc.find("#basic-wireless-enabled").addClass("triBandSteeringMode")}else{bc.find("#basic-wireless-enabled").removeClass("triBandSteeringMode")}bc.find("#basic-wireless-enabled").show();RAINIER.ui.tooltip.add("#basic-wireless-enabled [tooltip]")}function bN(){if(!az.passwordHint){return}if(b.passwordHint.passwordHint!==""){bc.find("#passwordHintLabel").text(b.passwordHint.passwordHint).show();bc.find("#noPasswordHintLabel").hide()}else{bc.find("#passwordHintLabel").hide();bc.find("#noPasswordHintLabel").show()}}function aV(){var cu=null;bc.find("#time-zone").empty();$.each(br.supportedTimeZones,function(){cu={timeZoneID:this.timeZoneID,description:RAINIER.ui.common.strings.timeZones[this.timeZoneID]||this.description};bc.find("#time-zone").append('<option value="{timeZoneID}">{description}</option>'.formatObj(cu))});bc.find("#auto-adj-dst").attr("disabled",b.time.timeZoneID.indexOf("NO-DST")>-1);RAINIER.binder.toDom(b,bc,b5);cr();bN();cj.find(".firmware-auto-update").attr("checked",(b.firmware.updatePolicy.indexOf("Automatically")===0));if($.cookie("user-auth-token")){cj.find("#firmware-manual #fw-update-user-auth-token, #pm-firmware-manual #pm-fw-update-user-auth-token").attr("value",$.cookie("user-auth-token"));cj.find("#firmware-manual #fw-update-admin-auth, #pm-firmware-manual #pm-fw-update-admin-auth").detach()}else{cj.find("#firmware-manual #fw-update-admin-auth, #pm-firmware-manual #pm-fw-update-admin-auth").attr("value",$.cookie("admin-auth"));cj.find("#firmware-manual #fw-update-user-auth-token, #pm-firmware-manual #pm-fw-update-user-auth-token").detach()}RAINIER.ui.fixIeForm("#basic-wireless-radios")}function p(){RAINIER.applets.connectivity.initializeDefaultMacAddressInputValues(bc);RAINIER.applets.connectivity.initializeGeneralInputValues(bc)}function C(){var cw=cj.find("#firmware-file").val().toLowerCase(),cv=RAINIER.network.getCurrentNetworkModelNumber().toLowerCase(),cu=RAINIER.network.getBaseNetworkModelNumber().toLowerCase(),cx=lodash.words(RAINIER.network.getCurrentNetworkHardwareVersion())[0];if($.grep(c,function(cy){return cw.indexOf(cy)===cw.length-4}).length===0){a0=M({msg:cj.find("#invalidFwExtension").html(),onSubmit:function(){ck.onManualFirmwareUpdate()}})}else{if((cw.indexOf(cv)===-1&&cw.indexOf(cu)===-1)||cx!==cw.replace(A,"$1")){a0=M({msg:cj.find("#invalidFwName").html(),onSubmit:function(){ck.onManualFirmwareUpdate()}})}else{if(cw!==""){ck.onManualFirmwareUpdate()}}}}function ah(){cj.find("#basic-wireless-enabled").removeClass("edit");cj.find("#edit-basic-wireless").show();cj.find("#edit-basic-wireless > a").removeClass("disabled").removeProp("disabled");aV()}function bz(){cj.find("#edit-router-password > a").removeClass("disabled").removeProp("disabled");cj.find("#edit-router-password").show();bc.find("#password-section .readOnly").show();bc.find("#update-password").hide();cj.find("#current-router-password").val("");cj.find("#router-password").val("");cj.find("#confirm-router-password").val("");cj.find("#router-password-hint input").val("").trigger("keyup").hide();cj.find('#router-password-hint input[type="password"]').show();RAINIER.ui.inputBalloon.hide();RAINIER.ui.validation.removeInvalidMarks("#update-password")}function cq(){RAINIER.util.trapEnter($("#basic-wireless-enabled, #password-section, #local-network, #internet-settings").find("input[type=text]"));if(!RAINIER.network.isAuthorityRemote()||RAINIER.shared.util.areServicesSupported(["/jnap/core/Core2"])){bc.find("#edit-router-password > a").click(function(){bc.find("#password-section .readOnly").hide();if(az.passwordHint){bc.find("#update-password .passwordHintSection").removeClass("hidden");bc.find("#update-password .noPasswordHintSection").hide()}bc.find("#update-password").css("display","block");cj.find("#edit-router-password > a").addClass("disabled").prop("disabled");RAINIER.ui.fixIeForm("#password-section")})}else{bc.find("#password-section").hide()}bc.find("#update-password .close-button").click(function(){bz()});RAINIER.ui.viewPassword(bc.find(".password-eye-box"));RAINIER.ui.tooltip.add(bc.find(".filename"),"top");RAINIER.ui.editFormClick($("#basic-wireless-enabled"),$("#edit-basic-wireless > a"));cj.find("#time-zone").change(function(){var cv=$(this).val();$.each(br.supportedTimeZones,function(){if(this.timeZoneID===cv){cj.find("#auto-adj-dst").attr("disabled",!this.observesDST);cj.find("#auto-adj-dst").attr("checked",this.observesDST);return}})});cj.find("#firmware-update .check-update").click(I);if(RAINIER.network.isBehindNode()){cj.find("#firmware-auto-nodes #start-updates button").click(ck.onAutoFirmwareUpdate);b2.find("#fw-details").click(function(){b2.removeClass("show-details");if(b2.hasClass("details")){b2.removeClass("details")}else{if(b2.hasClass("updating")){b2.removeClass("updating")}else{b2.addClass("show-details");if(t){b2.addClass("details")}else{b2.addClass("updating")}}}})}cj.find(".choose-file").click(function(cx){if(!$.browser.msie){var cw=$(cx.target),cv=cw.attr("id")==="pm-choose-file"?cj.find("#pm-firmware-file"):cj.find("#firmware-file");cv.click()}return false});if($.browser.msie){var cu=bc.find("#firmware-file, #pm-firmware-file");RAINIER.ui.tooltip.add(cu,"top");cu.hover(function(cv){$(cv.target).siblings(".choose-file").addClass("hover")},function(cv){$(cv.target).siblings(".choose-file").removeClass("hover")});cu.mousedown(function(cv){$(cv.target).siblings(".choose-file").addClass("active")});cu.mouseup(function(cv){$(cv.target).siblings(".choose-file").removeClass("active")});cu.mouseout(function(cv){$(cv.target).siblings(".choose-file").removeClass("active")})}else{cj.find("#filename, #pm-filename").click(function(cv){$(cv.target).siblings(".choose-file").click()})}cj.find("#firmware-file, #pm-firmware-file").change(function(cy){var cw=$(this).val(),cv=$(cy.target),cz=cv.siblings("label"),cx=cv.attr("id")==="pm-firmware-file"?cj.find("#pm-start-update"):cj.find("#start-update");var cA=cw.replace(/^.*[\\\/]/,"");cz.text(cA).attr("tooltip",cA);cv.attr("tooltip",cA);if(cw!==""){cx.removeAttr("disabled")}else{cx.attr("disabled",true)}});cj.find("#start-update").click(C);cj.find("#pm-start-update").click(bO);bm.submit(function(){if(cc){cc=false;return true}return false});aD.submit(function(){if(d){d=false;return true}return false})}function aW(){var cw={minLen:b.adminPwRestrictions.minLength,maxLen:b.adminPwRestrictions.maxLength,whiteSpace:false,isRequired:false,isBlankOnBlur:false,errors:[{test:new RegExp("^$|^["+RAINIER.ui.validation.concatAllowedCharRanges(b.adminPwRestrictions.allowedCharacters)+"]+$"),when:false,message:RAINIER.ui.validation.strings.invalidCharacters}]},cx={isBlankOnBlur:true,errors:[{test:RAINIER.ui.validation.tests.matchAnotherInput.curry($("#router-password")),when:false,message:RAINIER.ui.validation.strings.passwordDoesNotMatch}]},cu={validationType:"utf8LengthTooLong",maxLen:512},cv=bp.basic;cv.routerPW=aa($.extend(true,{},cw,{els:cj.find("#current-router-password")}));cv.newRouterPW=aa($.extend(true,{},cw,{els:cj.find("#router-password")}));cv.confirmRouterPW=aa($.extend(true,{},cw,cx,{els:cj.find("#confirm-router-password")}));if(az.passwordHint){cv.newRouterPWHidden=aa($.extend(true,{},cw,{els:cj.find('#router-password-hint input[type="password"]')}));cv.newRouterPWVisible=aa($.extend(true,{},cw,{els:cj.find('#router-password-hint input[type="text"]')}));cv.pwHint=aa($.extend(true,{},cu,{els:cj.find("#password-hint")}))}RAINIER.util.trapEnter("#router-password")}function bA(cw,cv){var cz=RAINIER.util.getObjVal(cv,"settings.wepSettings.encryption"),cu=bp.basic,cy={validCharSet:"ascii",maxLen:64,isRequired:true},cx={maxLen:26,validCharSet:"hex",whiteSpace:false,isRequired:true};cu[cv.radioID+"ssid"]=aa($.extend(true,{},aA.rules.ssid,{els:cw.find('input:[name="settings.ssid"]')}));cu[cv.radioID+"passPhrase"]=aa($.extend(true,{},aA.rules.password,{els:cw.find('input:[name="settings.wpaPersonalSettings.passphrase"]'),errors:[{test:RAINIER.ui.validation.tests.isWpaPassword,when:false,message:RAINIER.ui.validation.strings.invalidWpaPassword}]}));cu[cv.radioID+"wepKey"]=aa($.extend(true,{},cx,{els:cw.find('input:[name="settings.wepSettings.key"]'),errors:[{test:RAINIER.ui.validation.tests.isWepKey.curry($('<input value="{0}"></input>'.format(cz)),1,$('<input value="1"></input>')),when:false,message:RAINIER.ui.validation.strings.invalidWepKey}]}));cu[cv.radioID+"sharedKey"]=aa($.extend(true,{},cy,{els:cw.find('input:[name="settings.wpaEnterpriseSettings.sharedKey"]')}))}function bS(){var cu=bp.basic,cw=true;if(bc.find("#basic-wireless-enabled").is(":visible")){var cv=null;$.each(b.wireless.radios,function(cy,cx){cv=bc.find("#"+RAINIER.ui.escapeId(cx.radioID));if(cw&&cv.find('input:[name="settings.ssid"]').is(":visible")){cw=cu[cx.radioID+"ssid"].isValid(true)}if(cw&&cv.find('input:[name="settings.wpaPersonalSettings.passphrase"]').is(":visible")){cw=cu[cx.radioID+"passPhrase"].isValid(true)}if(cw&&cv.find('input:[name="settings.wepSettings.key"]').is(":visible")){cw=cu[cx.radioID+"wepKey"].isValid(true)}if(cw&&cv.find('input:[name="settings.wpaEnterpriseSettings.sharedKey"]').is(":visible")){cw=cu[cx.radioID+"sharedKey"].isValid(true)}});if(cw&&RAINIER.applets.guestNetwork.isGuestSSIDConflict(b.guestSettings,br.wireless.radios)){ac.show();cw=false}}if(bc.find("#update-password").is(":visible")){if(az.passwordHint){if(cw){if(bc.find('#router-password-hint input[type="password"]').is(":visible")){cw=cu.newRouterPWHidden.isValid(true)}else{cw=cu.newRouterPWVisible.isValid(true)}if(!cw){bc.find(".password-eye-box").addClass("invalid")}else{bc.find(".password-eye-box").removeClass("invalid")}if(cw){cw=cu.pwHint.isValid(true)}}}else{if(cw){cw=cu.routerPW.isValid(true)}if(cw){cw=cu.newRouterPW.isValid(true)}if(cw){cw=cu.confirmRouterPW.isValid(true)}}}return cw}function bf(){if(az.powerTable){RAINIER.shared.ui.populateRegions(b.powerTable.supportedCountries,bc.find("#region-select")[0]);bc.find("#power-table").removeClass("hidden")}aV();cq();aW();if(aF.powerModem){aE()}else{bc.find("#pm-firmware-update").remove()}if(az.passwordHint){bc.find(".passwordHintSection").removeClass("hidden")}if(bj==="#casupport"){bc.find("#firmware-manual").removeClass("showForLinksysRouters")}}function ai(cu,cv){if(cv.settings.security==="None"){cu.find("#basic-wep-password").hide();cu.find("#basic-wpa-password").hide();cu.find("#basic-no-security").show();cu.find("#basic-wpa-enterprise-key").hide()}else{if(cv.settings.security==="WEP"){cu.find("#basic-wep-password").show();cu.find("#basic-wpa-password").hide();cu.find("#basic-no-security").hide();cu.find("#basic-wpa-enterprise-key").hide()}else{if(cv.settings.security==="WPA-Enterprise"||cv.settings.security==="WPA2-Enterprise"||cv.settings.security==="WPA-Mixed-Enterprise"){cu.find("#basic-wep-password").hide();cu.find("#basic-wpa-password").hide();cu.find("#basic-no-security").hide();cu.find("#basic-wpa-enterprise-key").show()}else{cu.find("#basic-wep-password").hide();cu.find("#basic-wpa-password").show();cu.find("#basic-no-security").hide();cu.find("#basic-wpa-enterprise-key").hide()}}}}function aZ(cu){var cw=cu.settings.security;if(!RAINIER.util.isSecurityTypeWep(cw)){delete cu.settings.wepSettings}else{delete cu.settings.wepSettings.passphrase;var cv=cu.settings.wepSettings.txKey;cu.settings.wepSettings["key"+cv]=cu.settings.wepSettings.key;delete cu.settings.wepSettings.key}if(!RAINIER.util.isSecurityTypeWpaPersonal(cw)){delete cu.settings.wpaPersonalSettings}if(!RAINIER.util.isSecurityTypeWpaEnterprise(cw)){delete cu.settings.wpaEnterpriseSettings}return cu}function ad(){RAINIER.jnap.send({action:"/jnap/powermodem/GetPowerModemFirmwareVersion",data:{},cb:function(cu){if(cu.result==="OK"){bc.find('[name="pmFirmwareVersion.firmwareVersion"]').html(cu.output.firmwareVersion)}},disableDefaultJnapErrHandler:true})}function L(){var cu=$.Deferred();function cw(cx){if(cx.result==="OK"){br.isPasswordCurrent=true}else{br.isPasswordCurrent=false}cu.resolve("CheckAdminPassword complete")}if(RAINIER.shared.util.areServicesSupported(["/jnap/core/Core2"])){var cv={adminPassword:br.currentAdminpass};RAINIER.jnap.send({action:"/jnap/core/CheckAdminPassword2",data:cv,cb:cw,disableDefaultJnapErrHandler:true})}else{RAINIER.jnap.send({action:"/jnap/core/CheckAdminPassword",data:{},cb:cw,disableDefaultJnapErrHandler:true,useAdminAuth:true,adminPasswordOverride:"Basic "+window.btoa("admin:"+br.currentAdminpass)})}return cu}function W(){cj.find("#firmware-update #check-progress").removeClass("show");cj.find("#firmware-update #no-update").removeClass("show");cj.find("#firmware-update #server-unavailable").removeClass("show");cj.find("#firmware-update #firmware-download").removeClass("show")}function v(){cj.find("#firmware-auto-nodes-header").removeClass("alert");cj.find("#firmware-auto-nodes-header").removeClass("check");cj.find("#firmware-auto-nodes-header #time-to-update").removeClass("show");cj.find("#firmware-auto-nodes-header #up-to-date").removeClass("show");cj.find("#firmware-auto-nodes-header #no-internet-detected").removeClass("show");cj.find("#firmware-auto-nodes-header #cannot-reach-server").removeClass("show")}function b9(cu,cv){console.warn("updateNodesFwVersions",cv);t=cv;bo()}function J(){if(t){X.find(".node-details").each(function(cw,cx){var cv=$(cx),cz=cv.data("id"),cy=_.result(_.find(aU.output.firmwareUpdateStatus,{deviceUUID:cz}),"availableUpdate");console.warn("updateNodesFwDetails",cy);cv.find(".checking-fw, .available-fw, .up-to-date-fw").removeClass("show");if(cy){var cu=RAINIER.ui.common.strings.firmwareUpdate.AvailableVersion.format(cy.firmwareVersion);cv.find(".info-badge").attr("tooltip",cu);cv.find(".device-icon").addClass("update-available");cv.find(".available-fw").addClass("show")}else{cv.find(".device-icon").addClass("up-to-date");cv.find(".up-to-date-fw").addClass("show")}})}}function bo(){console.warn("populateNodesFwDetails",t);X.find(".node-details").remove();_.each(t,function(cu){var cw=RAINIER.ui.template.createBlock(S,cu),cv=cu.deviceID;cw.data("id",cv);cw.find(".device-icon").addClass(cu.deviceIcon);cw.find(".checking-fw").addClass("show");cw.find('span[name="deviceName"]').attr("tooltip",cu.deviceName);X.append(cw)});RAINIER.ui.tooltip.add(X.find("[tooltip]"),"top");if(b2.hasClass("updating")){b2.removeClass("updating");b2.addClass("details")}if(aU){J();if(t.length>aU.output.firmwareUpdateStatus.length){I()}}}function ay(){cj.find("#firmware-auto-nodes-header").addClass("check");RAINIER.ui.spinner.build("#spinner-section-nodes",18).spin("#spinner-section-nodes")}function I(){console.warn("[chkFwUpdate]");RAINIER.event.fire("rainier.firmwareCheckInitiated");cj.find("#firmware-update .check-update").attr("disabled","true");if(RAINIER.network.isBehindNode()){v();ay();RAINIER.network.checkNodesFwUpdate(aB,function(cu){aB({output:{firmwareUpdateStatus:[{lastOperationFailure:{error:"Error"}}]}})})}else{W();cj.find("#firmware-update #check-progress").addClass("show");RAINIER.ui.spinner.build("#spinner-section",18).spin("#spinner-section");a2=0;bU(function(){br.fwLastSuccessfulCheckTime=b.firmwareStatus.lastSuccessfulCheckTime;RAINIER.jnap.send({action:"/jnap/firmwareupdate/UpdateFirmwareNow",data:{onlyCheck:true},cb:function(cu){if(cu&&cu.result==="OK"){setTimeout(function(){bU(cd)},2500)}else{if(cu&&cu.result==="_ErrorTargetUnreachable"){cj.find("#firmware-update #server-unavailable").addClass("show")}else{}}}})})}}function cd(){var cu=(b.firmwareStatus.lastSuccessfulCheckTime!==br.fwLastSuccessfulCheckTime),cv=(!b.firmwareStatus.pendingOperation||b.firmwareStatus.pendingOperation.operation!=="Checking");if(b.firmwareStatus.availableUpdate||(cu&&cv)||a2>15){ct()}else{a2++;setTimeout(function(){bU(cd)},2500)}}function aC(cv){if(cv>100){clearInterval(bh)}else{var cu=$("#firmware-progress");if(Q){cu=$("#pm-firmware-progress")}RAINIER.ui.progressBar.update({element:cu.find("div.progress-bar"),percent:cv})}}function bQ(){RAINIER.ui.showMasterWaiting();RAINIER.event.disconnect("dialog.routerRebootClosed",bQ)}function cm(){ax=false;b3=false;cp=(new Date()).getTime();console.warn("Firmware Update starting - "+cp);aC(0);if(Q){bb.show()}else{m.show()}RAINIER.event.connect("dialog.routerRebootClosed",bQ)}function bR(){Q=true;d=true;aJ("manualPmFwUpdate",aD)}function N(){cc=true;aJ("manualFwUpdate",bm)}function aJ(cw,cv){var cz=0;function cx(){if(!bh){bh=setInterval(function(){aC(++cz)},665)}}function cu(cA){if(cA.lengthComputable){cz=((cA.loaded/cA.total)/2)*100;console.warn("FW Upload progress - {0} of {1} [{2}%]".format(cA.loaded,cA.total,cz));if(cz>=49.5||cA.loaded===cA.total){cx()}else{aC(cz)}}else{aC(++cz)}}RAINIER.event.fire("router.interruptionStarted");console.warn("["+cw+" - Submitting Image]");cm();if(window.FormData){var cy=new FormData(cv[0]);$.ajax({url:cv.attr("action"),type:"POST",data:cy,cache:false,contentType:false,processData:false,timeout:aS,xhr:function(){var cA=$.ajaxSettings.xhr();if(cA.upload){cA.upload.addEventListener("progress",cu,false);cA.upload.addEventListener("load",cx,false)}else{cx()}return cA},success:function(cD){var cB=cD?cD:"[no response]",cC=RAINIER.util.parseJSON(cB),cA="2123";if(cC){cA=cC.result}console.warn(["JCGI call complete - ms elapsed: ",((new Date()).getTime()-cp)]);console.warn("Response: "+cB);if(cA==="OK"){b3=true;bK=setTimeout(function(){y(bD)},4000);cx()}else{bX("Done - JCGI return: "+cB)}},error:function(cA,cC,cB){bX("Fail - JCGI return: {0} - {1}".format(cC,cB))}})}else{$("#form-target").load(function(){try{var cC=this.contentWindow?this.contentWindow.document.body.innerHTML:null,cB=$(cC),cE=cB?cB.text():"[no response]",cF=RAINIER.util.parseJSON(cE),cA="2123";if(cF){cA=cF.result}console.warn(["JCGI call complete - ms elapsed: ",((new Date()).getTime()-cp)]);console.warn("Response: "+cE);if(cA==="OK"){b3=true;bK=setTimeout(function(){y(bD)},4000)}else{bX("JCGI submit failed (response): "+cE)}}catch(cD){bX("JCGI submit failed (exception): "+cD)}});cv.submit();cx()}co=setTimeout(bX,60*7*1000)}function n(){console.warn("[getFwUpdate - Retrieving Firmware update]");RAINIER.event.fire("router.interruptionStarted");cm();if(RAINIER.network.isBehindNode()){console.info("Starting Nodes FW update via lib");symmetryUtil.firmwareUpdate.update({success:function(cu){if(sessionStorage){sessionStorage.setItem("nodesFWUpdateStatus",JSON.stringify(cu))}K(true)},error:function(cu){var cw=lodash.result(cu,"output.firmwareUpdateStatus"),cv=lodash.result(_.find(cw,"lastOperationFailure"),"lastOperationFailure","UpdateFailed");m.close();K(false,cv)},progress:V,progressOffset:2,pollingTimeout:1500})}else{RAINIER.jnap.send({action:"/jnap/firmwareupdate/UpdateFirmwareNow",data:{onlyCheck:false},cb:function(cu){if(cu.result==="OK"){cj.find("#firmware-update #firmware-download").removeClass("show");bK=setTimeout(function(){y(bD)},aR)}else{m.close();I(false)}}})}return true}function aB(cu){console.warn("[updateNodesFwInfo]",cu);v();b.firmwareStatus=_.find(cu.output.firmwareUpdateStatus,"availableUpdate");aU=RAINIER.network.getNodesAvailableUpdates();if(!b.firmwareStatus){b.firmwareStatus=_.find(cu.output.firmwareUpdateStatus,"lastOperationFailure")}else{cj.find("#firmware-auto-nodes-header").addClass("alert");cj.find("#firmware-auto-nodes-header #time-to-update").addClass("show");b2.addClass("install");J()}if(!b.firmwareStatus){cj.find("#firmware-auto-nodes-header #up-to-date").addClass("show");b.firmwareStatus=cu.output.firmwareUpdateStatus[0];J()}ct()}function ct(){console.warn("[updateFwInfo]");var cu=b.firmwareStatus.availableUpdate;RAINIER.ui.spinner.stop("#spinner-section");W();if(cu){var cv=RAINIER.ui.common.strings.firmwareUpdate.UpdateAvailable.format(cu.firmwareVersion);cj.find("#firmware-auto #firmware-download").html(cv);cj.find("#firmware-auto #firmware-download a").click(ck.onAutoFirmwareUpdate);cj.find("#firmware-auto #firmware-download").addClass("show")}else{if(b.firmwareStatus.lastOperationFailure){if(RAINIER.network.isBehindNode()){v();cj.find("#firmware-auto-nodes-header #cannot-reach-server").addClass("show")}else{cj.find("#firmware-update #server-unavailable").addClass("show")}}else{cj.find("#firmware-update #no-update").addClass("show")}}cj.find("#firmware-update .check-update").removeAttr("disabled")}function aI(){if(bh){clearInterval(bh);bh=null}if(bK){clearTimeout(bK);bK=null}if(co){clearTimeout(co);co=null}}function bX(cu){if(Q){console.warn("[PowerModem - chkCancelManualUpdate]")}else{console.warn("[chkCancelManualUpdate]")}console.warn(["[isFirmwareDownloaded, ms elapsed]",b3,((new Date()).getTime()-cp)]);aI();if(!b3){if(Q){bb.close();a8(false,cu)}else{m.close();K(false,cu)}console.warn('FW Update: 7 min Timer expired or JCGI did not respond "OK" - Update cancelled')}}function bU(cu){var cv=null;RAINIER.jnap.send({action:"/jnap/firmwareupdate/GetFirmwareUpdateStatus",data:{},cb:function(cw){if(cw&&cw.result){if(cw.result==="OK"){b.firmwareStatus=cw.output||{}}else{cv=cw.result}}else{cv="_ErrorNotReady"}if(typeof cu==="function"){cu(cv)}},disableDefaultJnapErrHandler:true,disableDefaultAjaxErrHandler:true,disableDefaultRebootErrHandler:true,timeoutMs:10000})}function a1(){if(!ax){console.warn(["router rebooting - ms elapsed:",((new Date()).getTime()-cp)]);ax=true;aC(100);setTimeout(function(){m.close();if(RAINIER.network.isBehindNode()){RAINIER.connect.routerRebootDialog.show()}else{RAINIER.connect.handleSideEffects(["DeviceRestart"])}},250)}b.firmwareStatus="_Rebooting"}function V(cv,cu){cv=cv.toFixed(2);if(cu==="Rebooting"){a1()}else{if(cu==="Installing"){$("#fw-installing").css("display","inline");$("#fw-downloading").css("display","none")}aC(cv*1.5)}}function y(cu){console.warn(["[chkFwUpdateStatus - ms elapsed]",((new Date()).getTime()-cp)]);bU(function(cx){var cv=b.firmwareStatus.lastOperationFailure,cw=b.firmwareStatus.pendingOperation;if(ak&&cv){console.warn("cache.firmwareStatus.lastOperationFailure is present: "+cv);m.close();K(false);return}else{if((ak&&cw&&cw.operation==="Rebooting")||cx==="_AjaxError"||cx==="_ErrorNotReady"||cx==="_ErrorUnknownSession"){a1()}}if(typeof cu==="function"){cu()}})}function k(cu){setTimeout(function(){RAINIER.network.handleFirmwareUpdate(function(cv){K(cv,null,true)})},cu)}function bG(){RAINIER.network.checkInternetConnection(function(cu){if(!cu){setTimeout(bG,4000)}else{k(aR)}},true)}function bD(){console.warn(["updateFwDlStatus",b.firmwareStatus]);console.warn(JSON.stringify(b.firmwareStatus));if(ax&&b.firmwareStatus!=="_Rebooting"){console.warn("[Fw update complete]");ax=false;if(RAINIER.connect.isOrWasWanConnected()){bG()}else{k(aR)}return}else{if(b.firmwareStatus.pendingOperation){var cu=b.firmwareStatus.pendingOperation;if(cu.operation==="Downloading"){ab=cu.progressPercent/2}else{if(cu.operation==="Installing"){$("#fw-installing").css("display","inline");$("#fw-downloading").css("display","none");ab=50+(cu.progressPercent/2)}else{if(cu.operation==="Rebooting"){ab=100}}}aC(ab)}else{console.warn("[no pendingOperation]")}}bK=setTimeout(function(){y(bD)},aR)}function K(cv,cu,cw){console.warn("checkFwUpdate",cv,cu,cw);aI();RAINIER.event.disconnect("dialog.routerRebootClosed",bQ);aC(0);if(RAINIER.network.isBehindNode()){if(RAINIER.connect.routerRebootDialog.isShowing()){RAINIER.connect.routerRebootDialog.close()}RAINIER.ui.showMasterWaiting()}if(cv){if(Q){Q=false;b4.show()}else{setTimeout(aj,10000)}}else{if(cw&&bg<s){bg++;k(bM)}else{if(cu&&cu.indexOf("ErrorSignatureCheckFailed")>-1){M({msg:cj.find("#invalidFwFile").html(),cancel:RAINIER.ui.button.strings.close,hideSubmit:true})}else{if(!cu||cu!=="ConnectivityFailure"){RAINIER.ui.dialogError({result:RAINIER.ui.validation.strings.errors.FirmwareUpdateFailed,action:cu})}else{RAINIER.ui.hideMasterWaiting()}}RAINIER.event.fire("router.interruptionCompleted")}}}function a8(cv,cu){console.warn("checkPmFwUpdate",cv,cu);aI();RAINIER.ui.showWaiting();bb.close();aC(0);if(cv){if(RAINIER.connect.isOrWasWanConnected()){bG()}else{Q=false;setTimeout(function(){b4.show()},10000)}}else{Q=false;aQ=RAINIER.ui.dialog("#pmFirmwareUpgradeError",{onSubmit:function(){if(aQ&&aQ.isShowing()){aQ.close()}RAINIER.event.fire("router.interruptionCompleted");RAINIER.event.fire("connection.enableCheck")}});setTimeout(function(){aQ.show()},1000)}}function aj(){W();bT.show()}function G(){RAINIER.ui.tooltip.add(bc.find("#pm-firmware-manual .shield"),"top");RAINIER.ui.tooltip.add(bc.find("#pm-filename"),"top")}function bO(){var cu=cj.find("#pm-firmware-file").val();if(cu.match(q)){$("#pm-firmware-version").val(cu.replace(/^.*[\\\/]/,""));ck.onManualPmFirmwareUpdate()}else{if(cu!==""){h=RAINIER.ui.dialog("#invalidPmFwFile",{onSubmit:function(){h.close()}});h.show()}}}function aE(){bc.find("#pm-firmware-update").show();if(!b.DSLSettings.isPowerModemEnabled){bc.find("#pm-firmware-manual .shield").show()}else{bc.find("#pm-firmware-manual .shield").hide()}G();bO();$(".generic-error-technical-support").unbind("click");$(".generic-error-technical-support").click(function(){window.open("http://support.linksys.com/en-us/support")})}function i(){var cv=RAINIER.binder.fromDom(bc,b5),cu=null;$.extend(true,br,cv);br.firmware=$.extend(true,{},b.firmware);if(RAINIER.network.isBehindNode()){br.firmware.updatePolicy=cj.find("#auto-update-nodes").is(":checked")?"AutomaticallyCheckAndInstall":"Manual"}else{br.firmware.updatePolicy=cj.find("#auto-update").is(":checked")?"AutomaticallyCheckAndInstall":"Manual"}br.wireless=$.extend(true,{},b.wireless);br.wireless.radios=[];$.each(b.wireless.radios,function(cx,cw){cu=$.extend(true,{},cw,RAINIER.binder.fromDom(bc.find("#"+RAINIER.ui.escapeId(cw.radioID)),b5));cu=aZ(cu);br.wireless.radios.push(cu)});$.delAttr(br.wireless,"supportedBandSteeringModes");br.currentAdminpass=cj.find("#current-router-password").val();if(az.passwordHint){br.adminpass=bc.find("#router-password-hint input:visible").val()}else{br.adminpass=cj.find("#router-password").val()}console.warn(["basicFromDom (store.wireless, cache.wireless)",br.wireless,b.wireless])}function T(){var cu=false;i();var cv=$.extend(true,{},b.wireless);$.delAttr(cv,"supportedBandSteeringModes");if(az.powerTable){}if(!$.compare(br.wireless,cv)||!$.compare(br.firmware,b.firmware)||!$.compare(br.time,b.time)||br.portlights!==b.portlights||(az.powerTable&&!$.compare(br.powerTable.country,b.powerTable.country))||bc.find("#update-password").is(":visible")){cu=true}return cu}function au(){br.trans=RAINIER.jnap.Transaction({onComplete:ck.onSaveComplete});if(br.adminpass&&(br.currentAdminpass||az.passwordHint)){var cu=L();RAINIER.ui.showWaiting();$.when(cu).then(function(){if(br.isPasswordCurrent||az.passwordHint){var cx=RAINIER.jnapActions.setAdminPassword(),cw={adminPassword:br.adminpass};if(az.passwordHint){cw.passwordHint=br.passwordHint.passwordHint}M({msg:cj.find("#password-warning-dialog").html(),onSubmit:function(){br.trans.add({action:cx,data:cw,cb:function(cy){if(cy.result==="OK"){$.cookie("admin-auth","Basic "+window.btoa("admin:"+br.adminpass),{expires:null,path:"/"});if(RAINIER.network.isBehindNode()){JNAP.setAuth($.cookie("admin-auth"))}$.extend(true,b.passwordHint,br.passwordHint);bN();bz()}else{aA.doSave=false}}});bl()},onCancel:function(){bz();if(T()){bt(aA.doClose)}else{if(aA.doTabChange){aA.destinationTab.click()}}}})}else{var cv=RAINIER.ui.build;RAINIER.ui.wait(false);RAINIER.ui.inputBalloon.add({els:$("#current-router-password"),balloonContent:cv.DIV({"class":"flow"},[cv.SPAN({"class":"icon warning"}),cv.SPAN({"class":"msg"},RAINIER.ui.validation.strings.mustMatchCurrentPassword)])},true);return false}})}else{bl()}}function Z(cu){if(cu.result==="OK"){$.each(br.wireless.radios,function(cw,cv){$.each(b.wireless.radios,function(cx,cy){if(cv.radioID===cy.radioID){cy=$.extend(true,cy,cv)}})});ah();RAINIER.event.fire("wireless.updated",b.wireless)}else{aA.doSave=false}}function bl(){var cu=false,cv=false,cw=RAINIER.ui.dialog("#powerTableRestartWarning",{onSubmit:cx});function cx(){RAINIER.ui.showWaiting();br.trans.send()}if(br.firmware.updatePolicy!==b.firmware.updatePolicy){br.trans.add({action:"/jnap/firmwareupdate/SetFirmwareUpdateSettings",data:br.firmware,cb:function(cy){if(cy.result==="OK"){$.extend(true,b.firmware,br.firmware)}else{aA.doSave=false}}})}else{}if(!$.compare(b.time,br.time)){br.trans.add({action:"/jnap/locale/SetTimeSettings",data:br.time,cb:function(cy){if(cy.result==="OK"){$.extend(true,b.time,br.time)}else{aA.doSave=false}}})}else{}if(br.portlights!==b.portlights){br.trans.add({action:"/jnap/routerleds/SetRouterLEDSettings",data:{isSwitchportLEDEnabled:br.portlights},cb:function(cy){if(cy.result==="OK"){b.portlights=br.portlights}else{aA.doSave=false}}})}else{}if(az.powerTable&&!$.compare(b.powerTable.country,br.powerTable.country)){if(!b.wireless.isBandSteeringEnabled){cu=b.wireless.radios.some(function(cy){return cy.settings.channel!==0||cy.settings.channelWidth!=="Auto"})}if(RAINIER.network.isBehindNode()){cv=true}br.trans.add({action:"/jnap/powertable/SetPowerTableSettings",data:{country:br.powerTable.country},cb:function(cy){if(cy.result==="OK"){$.extend(true,b.powerTable,br.powerTable)}else{aA.doSave=false}}})}else{}if(cu){RAINIER.ui.dialog("#powerTableConfirm",{onSubmit:function(){if(cv){cw.show()}else{cx()}}}).show()}else{if(cv){cw.show()}else{if(RAINIER.applets.wireless.radiosHaveChanges(br.wireless,b.wireless)){RAINIER.applets.wireless.commitSettings(br.trans,br.wireless,b.wireless,b5,cx,Z)}else{console.warn("[Basic: No change in radios]");cx()}}}}function bF(){RAINIER.applets.dhcpReservations.openDHCPReservations()}function ci(){if(ae.find('input[type="checkbox"]').is(":checked")){if(bW()){if(ao()){var cu=RAINIER.ui.dialog($("#promptsavedhcpreservation"),{onSubmit:function(){var cv="/jnap/router/SetLANSettings";RAINIER.ui.showWaiting();RAINIER.applets.dhcpReservations.stripDefaultIPValues(br);RAINIER.applets.dhcpReservations.scrubInvalidDHCPReservations(br.lanSettings.dhcpSettings.reservations);RAINIER.jnap.send({action:cv,data:br.lanSettings,cb:function(cw){if(cw.result==="OK"){$.extend(true,b.lanSettings,br.lanSettings);$.extend(true,b.lanSettingsSetup,b.lanSettings);aX();bJ();bF()}else{if(cw.result!=="_AjaxError"){if(RAINIER.ui.validation.strings.errors[cw.result]){RAINIER.ui.alert("",RAINIER.ui.validation.strings.errors[cw.result])}else{RAINIER.ajax().executeDefaultJnapErrorHandler(cw,cv)}}}}})}});cu.show()}else{bF()}}}}function cl(cu){cu.add({action:"/jnap/router/GetLANSettings",data:{},cb:function(cv){if(cv.result==="OK"){b.lanSettings=cv.output||{};b.lanSettingsSetup=$.extend(true,{},b.lanSettings);$.delAttr(b.lanSettings,["minNetworkPrefixLength","maxNetworkPrefixLength","maxDHCPReservationDescriptionLength","minAllowedDHCPLeaseMinutes","maxAllowedDHCPLeaseMinutes"])}else{}}});if(RAINIER.network.isOpenVPNSupported()){cu.add({action:"/jnap/openvpn/GetOpenVPNSettings",data:{},cb:function(cv){if(cv.result==="OK"){b.openVpn=$.extend(true,{},cv.output||{});if(!cv.output){}}else{}}})}if(RAINIER.shared.util.areServicesSupported(["/jnap/linkaggregation/LinkAggregation"])){cu.add({action:"/jnap/linkaggregation/GetLinkAggregationSettings",data:{},cb:function(cw){var cv=ae.find("#link-aggregation-ports");if(cw.result==="OK"){b.linkAggregation=$.extend(true,{},cw.output||{});cv.text(cv.text().replace("{firstPortNumber}",b.linkAggregation.aggregatedPorts[0]+1).replace("{secondPortNumber}",b.linkAggregation.aggregatedPorts[1]+1));$.delAttr(b.linkAggregation,"aggregatedPorts");if(!cw.output){}}else{}}});ae.find("#link-aggregation-form").css("display","block")}}function aP(){var cu=RAINIER.util.dot2num(F),cw=RAINIER.util.dot2num(ae.find('div.edit:[name="lanSettingsSetup.dhcpSettings.firstClientIPAddress"]')),cv=cw+parseInt(bk.val(),10)-1;return cu>=cw&&cu<=cv}function bY(){var cu=RAINIER.util.dot2num(b.lanSettings.ipAddress),cw=RAINIER.util.dot2num(b.lanSettingsSetup.dhcpSettings.firstClientIPAddress),cv=RAINIER.util.dot2num(b.lanSettingsSetup.dhcpSettings.lastClientIPAddress);if(cu<cw||cu>cv){return cv-cw+1}else{return cv-cw}}function a6(cx,cA){var cz=RAINIER.util.fromSubnetToPrefixLength(cx),cw=Math.pow(2,32-cz),cv=RAINIER.util.dot2num(cx),cA=RAINIER.util.dot2num(cA),cu=cA.toString(2),cy=parseInt(cv.toString(2).substring(0,cz)+cu.substring(cu.length-(32-cz),cu.length),2)-cv;if(aP()){cw--}return cw-cy-1}function bC(){b.lanSettingsSetup.dhcpSettings.maxClients=bY();b.lanSettingsSetup.dhcpSettings.maxUsers=a6(b.lanSettingsSetup.subnetMask,b.lanSettingsSetup.dhcpSettings.firstClientIPAddress)}function aX(){b.lanSettingsSetup.ipAddress=b.lanSettings.ipAddress;b.lanSettingsSetup.subnetMask=RAINIER.util.fromPrefixLengthToSubnet(b.lanSettings.networkPrefixLength);var cw=ae.find('div.ip-input[name="lanSettingsSetup.subnetMask"]').children(":not(span)"),cv=ae.find('div.ip-input.edit[name="lanSettingsSetup.dhcpSettings.firstClientIPAddress"]').children(":not(span)");for(var cu=0;cu<b.lanSettingsSetup.minNetworkPrefixLength/8;cu++){if($(cw[cu]).is("input")){$(cw[cu]).replaceWith('<label style="padding-right:5px;"></label>')}if($(cv[cu]).is("input")){$(cv[cu]).replaceWith("<label/>")}}am();if(b.lanSettings.isDHCPEnabled){bC()}RAINIER.binder.toDom(b,ae,b5);e();RAINIER.applets.connectivity.bridge.redirectUrlToDom({hostName:b.lanSettings.hostName,domain:"local"});RAINIER.applets.dhcpReservations.init()}function bP(){RAINIER.applets.connectivity.initializeDefaultMacAddressInputValues(ae);RAINIER.applets.connectivity.initializeGeneralInputValues(ae)}function bJ(){var cu=cj.find("#local-network-fieldset");cu.removeClass("edit");ae.find("#edit-local-network > a").removeClass("disabled");ae.find("#edit-local-network > a").removeProp("disabled");ae.find("#edit-local-network").show();RAINIER.binder.toDom(b,cu,b5)}function e(){var cx=ae.find("#dhcp-form"),cy=ae.find("#dhcp-enabled").is(":checked");if(!cy){var cv={lanSettingsSetup:null,lanSettings:null};cv.lanSettingsSetup=$.extend(true,{},b.lanSettingsSetup);cv.lanSettings=$.extend(true,{},b.lanSettings);cv.lanSettings.isDHCPEnabled=false;RAINIER.binder.toDom(cv,cx,b5);RAINIER.ui.validation.removeInvalidMarks(cx)}else{if(ae.find('[name="lanSettingsSetup.dhcpSettings.maxClients"]').val()===""){var cw=50,cu=a6(b.lanSettingsSetup.subnetMask,b.lanSettingsSetup.dhcpSettings.firstClientIPAddress);if(cu<cw){cw=cu}b.lanSettings.dhcpSettings={leaseMinutes:1440};b.lanSettingsSetup.dhcpSettings.maxClients=cw;b.lanSettingsSetup.dhcpSettings.maxUsers=cu;RAINIER.binder.toDom(b,ae,{});ae.find("#dhcp-enabled").attr("checked","checked")}}cx.find('input:not(input[type="checkbox"])').prop("disabled",!cy);ae.find("#dhcp-reservation > button").prop("disabled",!cy)}function a5(){RAINIER.ui.editFormClick(cj.find("#local-network-fieldset"),cj.find("#edit-local-network > a"),null,true);function cv(){if(bp.localNetwork.routerIPAddress.isValid()&&bp.localNetwork.startIpAddress.isValid()){var cB=RAINIER.binder.fromDom(ae,b5);$.extend(true,b.lanSettingsSetup,cB.lanSettingsSetup);b.lanSettingsSetup.dhcpSettings.maxUsers=a6(cB.lanSettingsSetup.subnetMask,cB.lanSettingsSetup.dhcpSettings.firstClientIPAddress);RAINIER.binder.toDom(b,ae.find('span[name="lanSettingsSetup.dhcpSettings.maxUsers"]').parent(),b5);if(bp.localNetwork.maxUsers.isValid()){var cz=ae.find('div.edit[name="lanSettingsSetup.dhcpSettings.firstClientIPAddress"]'),cw=RAINIER.util.dot2num(b.lanSettings.ipAddress);b.lanSettingsSetup.dhcpSettings.firstClientIPAddress=RAINIER.util.getObjVal(RAINIER.binder.fromDom(cz.parent()),cz.attr("name"));var cy=RAINIER.util.dot2num(b.lanSettingsSetup.dhcpSettings.firstClientIPAddress),cx=cy+parseInt(bk.val(),10)-1;b.lanSettingsSetup.dhcpSettings.lastClientIPAddress=RAINIER.util.num2dot(cx);if(cw>=cy&&cw<=cx){b.lanSettingsSetup.dhcpSettings.lastClientIPAddress=RAINIER.util.num2dot(cx+1)}b.lanSettingsSetup.dhcpSettings.maxClients=bk.val()}var cA={lanSettingsSetup:b.lanSettingsSetup};RAINIER.binder.toDom(cA,ae,b5)}}function cu(){if(bp.localNetwork.routerIPAddress.isValid()){var cz=RAINIER.binder.fromDom(ae,b5),cw=b.lanSettingsSetup.minNetworkPrefixLength/8,cx=cz.lanSettings.ipAddress.split(".");$.extend(true,b.lanSettingsSetup,cz.lanSettingsSetup);if(cw===1){b.lanSettingsSetup.dhcpSettings.firstClientIPAddress=b.lanSettingsSetup.dhcpSettings.firstClientIPAddress.replace(o,cx[0]+".$2.$3.$4");b.lanSettingsSetup.dhcpSettings.lastClientIPAddress=b.lanSettingsSetup.dhcpSettings.lastClientIPAddress.replace(o,cx[0]+".$2.$3.$4")}else{if(cw===2){b.lanSettingsSetup.dhcpSettings.firstClientIPAddress=b.lanSettingsSetup.dhcpSettings.firstClientIPAddress.replace(o,cx[0]+"."+cx[1]+".$3.$4");b.lanSettingsSetup.dhcpSettings.lastClientIPAddress=b.lanSettingsSetup.dhcpSettings.lastClientIPAddress.replace(o,cx[0]+"."+cx[1]+".$3.$4")}else{b.lanSettingsSetup.dhcpSettings.firstClientIPAddress=b.lanSettingsSetup.dhcpSettings.firstClientIPAddress.replace(o,cx[0]+"."+cx[1]+"."+cx[2]+".$4");b.lanSettingsSetup.dhcpSettings.lastClientIPAddress=b.lanSettingsSetup.dhcpSettings.lastClientIPAddress.replace(o,cx[0]+"."+cx[1]+"."+cx[2]+".$4")}}var cy={lanSettingsSetup:b.lanSettingsSetup};RAINIER.binder.toDom(cy,ae,b5)}}ae.find('div[name="lanSettings.ipAddress"]').change(function(){cu();cv()});ae.find('div.edit[name="lanSettingsSetup.dhcpSettings.firstClientIPAddress"] > input:text, input[name="lanSettingsSetup.dhcpSettings.maxClients"], div[name="lanSettingsSetup.subnetMask"]').change(function(){cv()});ae.find("#dhcp-reservation > button").click(function(){ci()});ae.find("#dhcp-enabled").click(function(){e()});ae.find("#enable-link-aggregation").trigger("change")}function g(){function cy(cK){return(cK>0)&&(cK<=parseInt($('[name="lanSettingsSetup.dhcpSettings.maxUsers"]').text(),10))}function cD(){var cN=RAINIER.util.dot2num(F),cL=RAINIER.util.dot2num(cI),cP=(cN&cL)>>>0,cM=(~cL|cP)>>>0,cO=RAINIER.util.num2dot(cP+1),cK=RAINIER.util.num2dot(cM-1);return RAINIER.ui.validation.strings.invalidIPAddressSubnet+" ["+cO+"-"+cK+"]"}function cC(){var cK=RAINIER.util.dot2num(F),cL=RAINIER.util.dot2num(ae.find('div.edit:[name="lanSettingsSetup.dhcpSettings.firstClientIPAddress"]'));return cK===cL}function cH(){var cL=RAINIER.util.dot2num(F),cK=RAINIER.util.dot2num(b.openVpn.clientIPStartAddress),cM=cK+b.openVpn.maxConcurrentConnections-1;return cL>=cK&&cL<=cM}function cA(){var cM=RAINIER.util.dot2num(ae.find('div.edit:[name="lanSettingsSetup.dhcpSettings.firstClientIPAddress"]')),cK=RAINIER.util.dot2num(b.openVpn.clientIPStartAddress),cL=cK+b.openVpn.maxConcurrentConnections-1;return cM>=cK&&cM<=cL}var cv={minLen:1,maxLen:15,validationType:"hostName",whiteSpace:false,isRequired:true},cu={validCharSet:"numeric",minLen:1,maxLen:Math.pow(2,32-b.lanSettingsSetup.minNetworkPrefixLength).toString().length,whiteSpace:false,isRequired:true,isBlankOnBlur:false},cG={validCharSet:"numeric",minLen:1,maxLen:b.lanSettingsSetup.maxAllowedDHCPLeaseMinutes.toString().length,minVal:b.lanSettingsSetup.minAllowedDHCPLeaseMinutes,maxVal:b.lanSettingsSetup.maxAllowedDHCPLeaseMinutes,whiteSpace:false,isRequired:true},cF={maxLen:3,validationType:"ipAddress",validCharSet:"numeric",isComposite:true,isBlankOnBlur:false},cB={validCharSet:"numeric",maxLen:3,validationType:"routerIPAddress",isComposite:true,isBlankOkOnBlur:false},cz={validationType:"subnetMask",maxLen:3,isComposite:true,isBlankOkOnBlur:false},cw={},cI=ae.find('div.ip-input[name="lanSettingsSetup.subnetMask"]');var cJ=$.extend(true,{},cB,{elContainer:F,elInputSubnetMask:cI}),cx=$.extend(true,{},{validCharSet:"numeric",isComposite:true,isBlankOnBlur:false},{elContainer:ae.find('div.edit:[name="lanSettingsSetup.dhcpSettings.firstClientIPAddress"]'),elInputSubnetMask:cI,elInputRouterIPAddress:F,errors:[{test:RAINIER.ui.validation.tests.isIPAddress.curry(ae.find('div.edit:[name="lanSettingsSetup.dhcpSettings.firstClientIPAddress"]'),false),when:false,message:RAINIER.ui.validation.strings.invalidIPAddress},{test:RAINIER.ui.validation.tests.isHostValidForGivenRouterIPAddressAndSubnetMask.curry(ae.find('div.edit:[name="lanSettingsSetup.dhcpSettings.firstClientIPAddress"]'),F,cI),when:false,message:function(){return cD()}},{test:cC,when:true,message:RAINIER.ui.validation.strings.invalidIPAddress}]});if(b.openVpn.isOpenVPNEnabled){cJ.errors=[{test:cH,when:true,message:RAINIER.ui.validation.strings.invalidIPAddress}];cx.errors.push({test:cA,when:true,message:RAINIER.ui.validation.strings.invalidIPAddress})}cw.routerIPAddress=aa(cJ);cw.startIpAddress=aa(cx);cw.hostName=aa($.extend(true,{},cv,{els:ae.find('input:[name="lanSettings.hostName"]')}));cw.subnetMask=aa($.extend(true,{},cz,{elContainer:ae.find('div.ip-input:[name="lanSettingsSetup.subnetMask"]'),minNetworkPrefixLength:b.lanSettingsSetup.minNetworkPrefixLength,maxNetworkPrefixLength:b.lanSettingsSetup.maxNetworkPrefixLength}));cw.maxUsers=aa($.extend(true,{},cu,{els:ae.find('input:[name="lanSettingsSetup.dhcpSettings.maxClients"]'),errors:[{test:cy,when:false,message:RAINIER.ui.validation.strings.connectivity.invalidNumberOfUsers}]}));cw.clientLeaseTime=aa($.extend(true,{},cG,{els:ae.find('input:[name="lanSettings.dhcpSettings.leaseMinutes"]')}));function cE(cK,cL){return aa($.extend(true,{},cF,{elContainer:ae.find(cK),allowZeroes:!!cL.allowZeroes}))}cw.dnsServer1=cE('div:[name="lanSettings.dhcpSettings.dnsServer1"]',{allowZeroes:true});cw.dnsServer2=cE('div:[name="lanSettings.dhcpSettings.dnsServer2"]',{allowZeroes:true});cw.dnsServer3=cE('div:[name="lanSettings.dhcpSettings.dnsServer3"]',{allowZeroes:true});cw.winsServer=cE('div:[name="lanSettings.dhcpSettings.winsServer"]',{allowZeroes:true});ae.find('input[name="lanSettingsSetup.dhcpSettings.maxClients"]').focus(function(){bp.localNetwork.maxUsers.isValid(true)});bp.localNetwork=cw}function bW(){var cu=true;cu=bp.localNetwork.hostName.isValid(true)&&bp.localNetwork.routerIPAddress.isValid(true)&&bp.localNetwork.subnetMask.isValid(true);if(cu&&ae.find('input[type="checkbox"]').is(":checked")){cu=bp.localNetwork.startIpAddress.isValid(true)&&bp.localNetwork.maxUsers.isValid(true)&&bp.localNetwork.clientLeaseTime.isValid(true)&&bp.localNetwork.dnsServer1.isValid(true)&&bp.localNetwork.dnsServer2.isValid(true)&&bp.localNetwork.dnsServer3.isValid(true)&&bp.localNetwork.winsServer.isValid(true)}return cu}function bL(){aX();a5();g()}function l(){var cu=RAINIER.binder.fromDom(ae,b5);$.extend(true,br,cu);br.lanSettings.dhcpSettings.firstClientIPAddress=b.lanSettingsSetup.dhcpSettings.firstClientIPAddress;br.lanSettings.dhcpSettings.lastClientIPAddress=b.lanSettingsSetup.dhcpSettings.lastClientIPAddress;if(br.lanSettings.ipAddress!==b.lanSettings.ipAddress){br.lanSettings.dhcpSettings.reservations=[]}else{br.lanSettings.dhcpSettings.reservations=RAINIER.applets.dhcpReservations.dhcpReservationsFromDom()}if(RAINIER.applets.dhcpReservations.isDHCPEnabled()){b.lanSettings.dhcpSettings.reservations=br.lanSettings.dhcpSettings.reservations}br.lanSettings.networkPrefixLength=RAINIER.util.fromSubnetToPrefixLength(br.lanSettingsSetup.subnetMask)}function ao(){var cu=false;l();if(!$.compare(br.lanSettings,b.lanSettings)||(br.lanSettings.isDHCPEnabled&&!bp.localNetwork.maxUsers.isValid(true))||(br.lanSettings.isDHCPEnabled&&!bp.localNetwork.startIpAddress.isValid(true))||(RAINIER.shared.util.areServicesSupported(["/jnap/linkaggregation/LinkAggregation"])&&!$.compare(br.linkAggregation,b.linkAggregation))){cu=true}return cu}function am(){["dnsServer1","dnsServer2","dnsServer3","winsServer"].forEach(function(cu){if(!b.lanSettings.dhcpSettings[cu]){b.lanSettings.dhcpSettings[cu]="0.0.0.0"}})}function a3(){var cw="/jnap/router/SetLANSettings",cu=RAINIER.jnap.Transaction();function cv(cx){var cz=[{err:"ErrorInvalidPrimaryDNSServer",msg:RAINIER.ui.validation.strings.invalidIPAddress,els:bp.localNetwork.dnsServer1},{err:"ErrorInvalidSecondaryDNSServer",msg:RAINIER.ui.validation.strings.invalidIPAddress,els:bp.localNetwork.dnsServer2},{err:"ErrorInvalidTertiaryDNSServer",msg:RAINIER.ui.validation.strings.invalidIPAddress,els:bp.localNetwork.dnsServer3},{err:"ErrorInvalidWINSServer",msg:RAINIER.ui.validation.strings.invalidIPAddress,els:bp.localNetwork.winsServer}];for(var cy=0;cy<cz.length;cy++){if(cx===cz[cy].err){return cz[cy]}}}RAINIER.ui.showWaiting();RAINIER.applets.dhcpReservations.stripDefaultIPValues(br);if(RAINIER.shared.util.areServicesSupported(["/jnap/linkaggregation/LinkAggregation"])){cu.add({action:"/jnap/linkaggregation/SetLinkAggregationSettings",data:br.linkAggregation,cb:function(cx){if(cx.result==="OK"){b.linkAggregation=$.extend(true,{},br.linkAggregation);$.delAttr(b.linkAggregation,"aggregatedPorts");console.warn(["Updated cache.linkAggregation:",b.linkAggregation])}else{}}})}cu.add({action:cw,data:br.lanSettings,cb:function(cy){if(cy.result==="OK"){b.lanSettings.dhcpSettings=$.extend(true,{},br.lanSettings.dhcpSettings);$.extend(true,b.lanSettings,br.lanSettings);$.extend(true,b.lanSettingsSetup,b.lanSettings);aX();bJ();ck.onSaveComplete()}else{if(cy.result!=="_AjaxError"){var cx=cv(cy.result);if(cx){RAINIER.ui.wait(false);RAINIER.ui.inputBalloon.message({els:cx.els.elContainer,message:cx.msg,hasErrors:true})}else{if(RAINIER.ui.validation.strings.errors[cy.result]){RAINIER.ui.alert("",RAINIER.ui.validation.strings.errors[cy.result])}else{RAINIER.ajax().executeDefaultJnapErrorHandler(cy,cw)}}}}},disableDefaultJnapErrHandler:true});cu.send()}function a4(cu){cu.add({action:RAINIER.jnapActions.getRoutingSettings(),data:{},cb:function(cv){if(cv.result==="OK"){b.routing=$.extend(true,{},cv.output||{});br.maxStaticRouteEntries=b.routing.maxStaticRouteEntries;br.routing.isDynamicRoutingEnabled=b.routing.isDynamicRoutingEnabled;$.delAttr(b.routing,"maxStaticRouteEntries");br.routing=$.extend(true,{},b.routing);if(!cv.output){}}else{}}})}function aq(cv,cu){var cw=RAINIER.ui.template.createBlock(P,cv);if(cu){cw.addClass("edit")}RAINIER.binder.toDom(cv,cw);if(cv.settings["interface"]==="LAN"){cw.find("#interface-lan").show()}else{cw.find("#interface-internet").show()}av(cw);RAINIER.util.trapEnter(cw);cw.find("td").hover(function(){var cx=$(this).parent();if(!cx.hasClass("edit")){cx.addClass("hover")}},function(){$(this).parent().removeClass("hover")});cw.find("#edit-route").click(ck.onEditRoute.bind(cw));cw.find("#cancel").click(ck.onCancelRoute.bind(cw));cw.find("#delete-route").click(ck.onDelRoute.bind(cw));cw.find("#save-route").click(ck.onUpdRoute.bind(cw));if($.compare(cv,aL)){ba.find("tr:first-child").after(cw)}else{ba.append(cw)}RAINIER.util.trapEnter(cw.find("input[type=text]"))}function ap(){RAINIER.ui.clearTbl(ba);RAINIER.binder.toDom(b,a7);br.routingList.length=0;$.each(b.routing.entries,function(){if(this.settings.networkPrefixLength){this.settings.subnetMask=RAINIER.util.fromPrefixLengthToSubnet(this.settings.networkPrefixLength);delete this.settings.networkPrefixLength}br.routingList.push(this);aq(this)})}function ag(){cj.find("#add-route").click(function(){var cu=$.extend({},aL);br.routingList.unshift(cu);aq(cu,true)})}function aN(){var cu=cj.find("#advanced-routing .edit");for(var cv=0;cv<cu.length;cv++){var cw=$(cu[cv]);if(!aK(cw)){return false}else{cw.find("#save-route").click()}}return true}function av(cy){var cw={minLen:1,maxLen:25,validCharSet:"ascii",whiteSpace:false,isRequired:true},cx={maxLen:3,validationType:"ipAddress",validCharSet:"numeric",isComposite:true,isBlankOnBlur:false},cu={maxLen:3,validationType:"subnetMask",isRequired:true,isComposite:true},cv={};cv.name=aa($.extend(true,{},cw,{els:cy.find('input:[name="name"]')}));cv.destinationLAN=aa($.extend(true,{},cx,{elContainer:cy.find('div:[name="settings.destinationLAN"]'),allowZeroes:false}));cv.subnetMask=aa($.extend(true,{},cu,{elContainer:cy.find('div:[name="settings.subnetMask"]'),minNetworkPrefixLength:b.lanSettingsSetup.minNetworkPrefixLength,maxNetworkPrefixLength:b.lanSettingsSetup.maxNetworkPrefixLength}));cv.gateway=aa($.extend(true,{},cx,{elContainer:cy.find('.spEdit > div[name="settings.gateway"]'),allowZeroes:true,errors:[{test:RAINIER.applets.connectivity.isStaticRouteGatewayValid.curry(cy.find('.spEdit > select:[name="settings.interface"]'),cy.find('.spEdit > div:[name="settings.gateway"]'),b.lanSettings.ipAddress,b.lanSettingsSetup.subnetMask),when:false,message:RAINIER.ui.validation.strings.errors.ErrorInvalidGateway}]}));cy.data(cv)}function aK(cv){var cu=cv.data();return cu.name.isValid(true)&&cu.destinationLAN.isValid(true)&&cu.subnetMask.isValid(true)&&cu.gateway.isValid(true)}function b6(cu){var cv=false;if(cu.name===""&&((cu.settings.destinationLAN==="0.0.0.0"&&cu.settings.gateway==="0.0.0.0"&&cu.settings.subnetMask==="0.0.0.0")||(cu.settings.destinationLAN===""&&cu.settings.gateway===""&&cu.settings.subnetMask===""))){cv=true}return cv}function f(){ap();ag()}function bs(){var cu=RAINIER.binder.fromDom(a7,b5);cu.routing.isNATEnabled=!cu.routing.isDynamicRoutingEnabled;$.extend(true,br,cu);br.routing.entries=br.routingList.filter(function(cv){return(!$.compare(cv,aL)&&!$.compare(cv,u))});console.warn(["advancedroutingFromDom",br,b])}function bi(){var cu=false;if(aN()){bs()}if(a7.find("#save-route:visible").length>0||!$.compare(b.routing,br.routing)){cu=true}return cu}function af(){var cu=$.extend(true,{},br.routing);cu.entries.forEach(function(cv){cv.settings.networkPrefixLength=RAINIER.util.fromSubnetToPrefixLength(cv.settings.subnetMask);delete cv.settings.subnetMask});return cu}function bH(){if(!$.compare(b.routing,br.routing)){RAINIER.ui.showWaiting();var cu=af();RAINIER.jnap.send({action:RAINIER.jnapActions.setRoutingSettings(),data:cu,cb:function(cv){if(cv.result==="OK"){$.extend(b.routing,br.routing);b.routing.entries=br.routing.entries.clone()}else{aA.doSave=false}ck.onSaveComplete()}})}return true}function bn(){var cu=RAINIER.jnap.Transaction({onComplete:ck.onSaveComplete});cu.add({action:RAINIER.jnapActions.setVLANTaggingSettings(),data:br.vlanSettings,cb:function(cv){if(cv.result==="OK"){b.vlanSettings=$.extend(true,{},br.vlanSettings);bE()}else{aA.doSave=false}}});RAINIER.ui.showWaiting();cu.send()}function a9(cu){cu.add({action:RAINIER.jnapActions.getVLANTaggingSettings(),data:{},cb:function(cv){if(cv.result==="OK"){b.vlanSettings=cv.output;b.vlanSettingsSetup=$.extend(true,{},b.vlanSettings);$.delAttr(b.vlanSettings,["maxVLANTaggingRulesPerPort","isVLANPrioritySupported","vlanPortNumbers"])}else{}}});cu.add({action:"/jnap/vlantagging/GetProfiles",data:{},cb:function(cv){if(cv.result==="OK"){aw=cv.output.profiles}else{}}})}function z(){var cu=b.vlanSettingsSetup.vlanPortNumbers;if(cu){ar.find(".vlanPort1").removeClass("port3").addClass("port"+cu[0]);ar.find(".vlanPort2").removeClass("port4").addClass("port"+cu[1])}}function cf(){var cu=false;aG();bE();an();RAINIER.util.trapEnter(ar.find("input"));if(RAINIER.shared.util.areServicesSupported(["/jnap/vlantagging/VLANTagging2"])||RAINIER.shared.util.areServicesSupported(["/jnap/vlantagging/VLANTagging3"])){cu=true;if(RAINIER.shared.util.areServicesSupported(["/jnap/vlantagging/VLANTagging3"])){z()}}if(cu&&!b.vlanSettingsSetup.isVLANPrioritySupported){cj.find(".vlan-priority").remove()}}function aT(){if(!ar.find("#enableVlan").is(":checked")){return true}return bp.vlanTagging.vlanWanSettingsRules.isValid(true)&&bp.vlanTagging.vlanLANSettingsRules.isValid(true)}function U(){function cz(cA){return parseInt(cw.val(),10)===parseInt(cA,10)}var cw=ar.find('#vlanWanSettings input[type="text"]:enabled'),cx=ar.find('#ethernetPorts input[type="text"]:enabled'),cy=cx.filter(function(){return parseInt(this.value)!==0&&this.value!==""}),cv={validCharSet:"numeric",whiteSpace:false,minLen:1,maxLen:4,minVal:3,maxVal:4094,isRequired:true},cu={};cu.vlanWanSettingsRules=aa($.extend(true,{},cv,{els:ar.find('#vlanWanSettings input[type="text"]:enabled')}));cu.vlanLANSettingsRules=aa($.extend(true,{},cv,{els:cy,errors:[{test:cz,when:true,message:RAINIER.ui.validation.strings.connectivity.vlanIdDuplicated}]}));bp.vlanTagging=cu;cx.unbind("keyup focus blur").keyup(O).blur(b8)}function D(){bw();var cu=$.compare(br.vlanSettings,b.vlanSettings);return !cu}function cb(cu){if(cu){ar.find(".vlanTaggingSettings").addClass("readOnly");ar.find(".vlanTaggingSettings .toggle-edit label").each(function(){$(this).attr("tooltip",$(this).text())})}else{ar.find(".vlanTaggingSettings").removeClass("readOnly")}}function aG(){var cu={Manual:RAINIER.ui.common.strings.vlanProfiles.Manual,"Unifi (@ Home)":RAINIER.ui.common.strings.vlanProfiles["Unifi-Home"],"Unifi (@ Business)":RAINIER.ui.common.strings.vlanProfiles["Unifi-Business"],"Singtel (mio TV)":RAINIER.ui.common.strings.vlanProfiles["Singtel-MIO"],"Singtel (other)":RAINIER.ui.common.strings.vlanProfiles["Singtel-Other"],"M1 (Fibre)":RAINIER.ui.common.strings.vlanProfiles["M1-Fibre"],"Maxis (Fibre)":RAINIER.ui.common.strings.vlanProfiles["Maxis-Fibre"],"Maxis (Fibre special)":RAINIER.ui.common.strings.vlanProfiles["Maxis-Fibre-Special"],StarHub:RAINIER.ui.common.strings.vlanProfiles["Star-Hub"]},cw='<option value="{profileId}">{profileName}</option>',cv;if(RAINIER.ui.getDirection()==="rtl"){cw='<option value="{profileId}">{profileName}&#x200E;</option>'}bZ.empty();bZ.append(cw.formatObj({profileId:"Manual",profileName:cu.Manual}));aw.sort(function(cy,cx){return(cy.name>cx.name)?1:((cy.name<cx.name)?-1:0)});$.each(aw,function(){if(cu[this.name]){cv={profileId:this.name,profileName:cu[this.name]};bZ.append(cw.formatObj(cv))}})}function al(cw,cu,cv){cw.find('option[value="Tagged"]').text(RAINIER.ui.common.strings.vlanStatus.Tagged);cw.find('option[value="Untagged"]').text(RAINIER.ui.common.strings.vlanStatus.Untagged);cu.text(RAINIER.ui.common.strings.vlanStatus[cv.vlanStatus])}function bE(cv){function cA(cC,cB){$.each(cC,function(cD,cE){at(cB,cE,cD===cC.length-1&&cC.length===b.vlanSettingsSetup.maxVLANTaggingRulesPerPort,false)})}function cu(cB,cC){if(cB.length){cA(cB,cC.find("table"));cC.show()}else{if(cz.vlanSettings.profile.name!=="Manual"){cC.hide()}else{if(cz.vlanSettings.profile.name==="Manual"){cC.find("tbody tr").remove();at(cC.find("table"),{vlanID:0},false,false)}}}}var cz=cv||$.extend(true,{},b);if(!cz.vlanSettings.profile){cz.vlanSettings.profile=$.extend({},bv)}var cy=cz.vlanSettings.profile.vlanTaggingSettings.ipTVSettings,cx=cz.vlanSettings.profile.vlanTaggingSettings.voIPSettings,cw=cz.vlanSettings.profile.vlanTaggingSettings.wanSettings;if(cz.vlanSettings.profile.name==="Manual"){ar.find(".showForManual").show();ar.find(".hideForManual").hide()}else{ar.find(".showForManual").hide();ar.find(".hideForManual").show()}ar.find("#ipTVSettings tbody tr, #voIPSettings tbody tr").remove();RAINIER.binder.toDom(cz,ar,b5);al(ar.find("#vlanWanSettings select.vlanTag"),ar.find('#vlanWanSettings label[name="vlanSettings.profile.vlanTaggingSettings.wanSettings.vlanStatus"]'),cw);if(cz.vlanSettings.profile.name!=="Manual"&&!cy.length&&!cx.length){ar.find("#ethernetPorts").hide()}else{ar.find("#ethernetPorts").show();ar.find("#ipTVSettings").show();ar.find("#voIPSettings").show()}cu(cy,ar.find("#ipTVSettings"));cu(cx,ar.find("#voIPSettings"));cb(cz.vlanSettings.profile.name!=="Manual")}function bw(){var cw=RAINIER.binder.fromDom(ar,b5),cu=ar.find("#ipTVSettings tbody tr"),cv=ar.find("#voIPSettings tbody tr");function cx(cA,cz){var cy=0;$.each(cz,function(cB,cF){var cD=$(cF),cE=cD.find("input").val();if(!cD.hasClass("disabled")&&parseInt(cE)!==0&&cE!==""){var cC=RAINIER.binder.fromDom(cD,b5);cA[cy]=cC;cy++}})}$.extend(true,br,cw);br.vlanSettings.profile.vlanTaggingSettings.ipTVSettings=[];br.vlanSettings.profile.vlanTaggingSettings.voIPSettings=[];if(ar.find("#ipTVSettings").is(":visible")){cx(br.vlanSettings.profile.vlanTaggingSettings.ipTVSettings,cu)}if(ar.find("#voIPSettings").is(":visible")){cx(br.vlanSettings.profile.vlanTaggingSettings.voIPSettings,cv)}if(!br.vlanSettings.isEnabled&&br.vlanSettings.profile.name==="Manual"){if(!bp.vlanTagging.vlanWanSettingsRules.isValid()||!bp.vlanTagging.vlanLANSettingsRules.isValid()){br.vlanSettings=$.extend({},b.vlanSettings);br.vlanSettings.isEnabled=false;if(br.vlanSettings.profile){br.vlanSettings.profile.name="Manual"}}}}function be(cv,cu){cv.find("input, select").attr("disabled",!cu);if(cu){cv.removeClass("disabled")}else{cv.addClass("disabled")}}function at(cx,cy,cB,cv){var cA=ar.find("#vlanRowTemplate tr"),cw=RAINIER.ui.template.createBlock(cA,cy),cu=cw.find("label"),cz=cw.find('select[name="vlanStatus"]');al(cz,cw.find('label[name="vlanStatus"]'),cy);cu.attr("tooltip",cu.text());RAINIER.util.trapEnter(cw.find("input"));if(cv){cw.insertBefore(cx.find("tbody tr:last-child"))}else{cx.append(cw)}if(cx.find("tbody tr").length===b.vlanSettingsSetup.maxVLANTaggingRulesPerPort){be(cw,true)}cw.find("input").keyup(O).trigger("keyup").blur(b8).trigger("blur");cw.find('select[name="vlanPriority"]').change(b8)}function b8(){function cv(cx){var cw=$(cx[0]),cy=cw.parents("tr").find('select[name="vlanPriority"]');$.each(cx,function(){var cz=$(this),cA=cz.parents("tr").find('select[name="vlanPriority"]');if(cz.attr("disabled")!=="disabled"){cA.attr("disabled",false)}if(parseInt(cz.val())===parseInt(cw.val())){cA.val(cy.val()).attr("disabled",true)}});cy.attr("disabled",false)}var cu=ar.find("#ethernetPorts input:not(:disabled)");$.each(cu,function(){var cw=$(this),cy=parseInt(cw.val()),cx=$("#ethernetPorts input").filter(function(){return parseInt(this.value)===cy});if(cy>2&&cy<4095){cw.parents("tr").find('select[name="vlanPriority"]').attr("disabled",false);if(cx.length>1){cv(cx)}}})}function O(cw){var cu=$(cw.target),cv=cu.parents("tr").find("select");cv.attr("disabled",parseInt(cu.val())===0);U();RAINIER.ui.inputBalloon.hide();RAINIER.ui.inputBalloon.reset()}function an(){ar.find("#enableVlan").change(ck.onEnableVlanChange);bZ.change(ck.onVlanProfilesChange);ar.find("#enableVlan").trigger("change")}function bq(cu){cu.add({action:RAINIER.jnapActions.getManagementSettings(),data:{},cb:function(cv){if(cv.result==="OK"){b.mgmt=cv.output}else{}}});cu.add({action:"/jnap/routerupnp/GetUPnPSettings",data:{},cb:function(cv){if(cv.result==="OK"){b.upnp=cv.output||{}}else{}}});cu.add({action:"/jnap/firewall/GetALGSettings",data:{},cb:function(cv){if(cv.result==="OK"){b.isSIPEnabled=cv.output.isSIPEnabled}else{}}});if(az.cutThroughForwarding){cu.add({action:RAINIER.jnapActions.getCTFSettings(),data:{},cb:function(cv){if(cv.result==="OK"){b.isCTFEnabled=cv.output.isCTFEnabled}else{}}})}if(az.router6){cu.add({action:RAINIER.jnapActions.getExpressForwardingSettings(),data:{},cb:function(cv){if(cv.result==="OK"){az.expressForwarding=cv.output.isExpressForwardingSupported;if(az.expressForwarding){b.isExpressForwardingEnabled=cv.output.isExpressForwardingEnabled}}else{}}})}if(az.allJoyn){cu.add({action:"/jnap/alljoyn/GetAllJoynSettings",data:{},cb:function(cv){if(cv.result==="OK"){b.isAllJoynEnabled=cv.output.isEnabled}else{}}})}}function r(){if(az.cutThroughForwarding){b0.find("#administration-ctf").show()}if(az.router6&&az.expressForwarding){b0.find("#administration-expressforwarding").show()}RAINIER.binder.toDom(b,b0)}function H(){}function bx(){if(!RAINIER.network.uiLoadedFromCloud()){$("#allow-remote-access").hide()}if(az.allJoyn){b0.find("#alljoyn").removeClass("hidden")}if(RAINIER.shared.util.areServicesSupported(["/jnap/routermanagement/RouterManagement2"])&&!b.mgmt.isManageWirelesslySupported){b0.find("#wireless-access-block").remove()}$.delAttr(b.mgmt,"isManageWirelesslySupported");r();H()}function bI(){var cu=RAINIER.binder.fromDom(b0,b5);$.extend(br,cu);br.mgmt=$.extend({},b.mgmt,br.mgmt)}function j(){var cu=false;bI();if(az.cutThroughForwarding){}if(az.allJoyn){}if(!$.compare(br.mgmt,b.mgmt)||!$.compare(br.upnp,b.upnp)||br.isSIPEnabled!==b.isSIPEnabled||(az.cutThroughForwarding&&br.isCTFEnabled!==b.isCTFEnabled)||(az.router6&&az.expressForwarding&&br.isExpressForwardingEnabled!==b.isExpressForwardingEnabled)||(az.allJoyn&&br.isAllJoynEnabled!==b.isAllJoynEnabled)){cu=true}return cu}function aM(){var cu=RAINIER.jnap.Transaction({onComplete:ck.onSaveComplete});if(!$.compare(b.mgmt,br.mgmt)){cu.add({action:RAINIER.jnapActions.setManagementSettings(),data:br.mgmt,cb:function(cv){if(cv.result==="OK"){$.extend(true,b.mgmt,br.mgmt)}else{aA.doSave=false}}})}if(!$.compare(b.upnp,br.upnp)){cu.add({action:"/jnap/routerupnp/SetUPnPSettings",data:br.upnp,cb:function(cv){if(cv.result==="OK"){$.extend(true,b.upnp,br.upnp)}else{aA.doSave=false}}})}if(b.isSIPEnabled!==br.isSIPEnabled){cu.add({action:"/jnap/firewall/SetALGSettings",data:{isSIPEnabled:br.isSIPEnabled},cb:function(cv){if(cv.result==="OK"){b.isSIPEnabled=br.isSIPEnabled}else{aA.doSave=false}}})}if(az.cutThroughForwarding&&b.isCTFEnabled!==br.isCTFEnabled){cu.add({action:RAINIER.jnapActions.setCTFSettings(),data:{isCTFEnabled:br.isCTFEnabled},cb:function(cv){if(cv.result==="OK"){b.isCTFEnabled=br.isCTFEnabled}else{aA.doSave=false}}})}if(az.router6&&az.expressForwarding&&b.isExpressForwardingEnabled!==br.isExpressForwardingEnabled){cu.add({action:RAINIER.jnapActions.setExpressForwardingSettings(),data:{isExpressForwardingEnabled:br.isExpressForwardingEnabled},cb:function(cv){if(cv.result==="OK"){b.isExpressForwardingEnabled=br.isExpressForwardingEnabled}else{aA.doSave=false}}})}if(az.allJoyn&&b.isAllJoynEnabled!==br.isAllJoynEnabled){cu.add({action:"/jnap/alljoyn/SetAllJoynSettings",data:{isEnabled:br.isAllJoynEnabled},cb:function(cv){if(cv.result==="OK"){b.isAllJoynEnabled=br.isAllJoynEnabled}else{aA.doSave=false}}})}RAINIER.ui.showWaiting();cu.send()}function b7(){var cz=cj.find("#velop-simpleSetup"),cD="admin",cy="Node1",cC=["2.4GHz","5GHz"],cA=["userDeviceName","userDeviceLocation"],cx,cw,cG,cu="/jnap/nodes/smartconnect/SetWiredAutoOnboardingSettings";if(RAINIER.shared.util.areServicesSupported(["/jnap/nodes/autoonboarding/AutoOnboarding"])){cu="/jnap/nodes/autoonboarding/SetWiredAutoOnboardingSettings"}else{cz.find("#startBTOnboarding").hide();cz.find("#autoonboarding-notavailable").show()}function cH(cN){if(cN.result==="OK"){console.warn("Setup complete");setTimeout(function(){cz.find(".unconfigured-block").hide();cz.find("#ssidTxt").text(cz.find("#ssid").val());cz.find("#pwTxt").text(cz.find("#password").val());cz.find(".ssid-block").show();cz.find(".configured-block").show()},20*1000)}else{}}function cB(cO,cN){var cP={action:cu,data:{isAutoOnboardingEnabled:true},cb:function(cQ){if(cQ.result==="OK"){if(typeof cN==="function"){cN()}}else{}},disableDefaultAjaxErrHandler:true};if(cO){cO.add(cP)}else{RAINIER.jnap.send(cP)}}function cv(cO,cN){var cP={action:cu,data:{isAutoOnboardingEnabled:false},cb:function(cQ){if(cQ.result==="OK"){if(typeof cN==="function"){cN()}}else{}},disableDefaultAjaxErrHandler:true};if(cO){cO.add(cP)}else{RAINIER.jnap.send(cP)}}function cL(){var cO={action:"/jnap/nodes/autoonboarding/SetBluetoothAutoOnboardingSettings",data:{isAutoOnboardingEnabled:true},cb:function(cP){if(cP.result==="OK"){setTimeout(cN,500)}else{}},disableDefaultAjaxErrHandler:true};function cN(){RAINIER.jnap.send({action:"/jnap/nodes/autoonboarding/StartBluetoothAutoOnboarding",data:{},cb:function(cP){if(cP.result==="OK"){setTimeout(function(){cz.find("#startBTOnboarding").removeProp("disabled");cz.find("#stopOnboarding").removeProp("disabled")},10000)}else{}},disableDefaultAjaxErrHandler:true})}RAINIER.jnap.send(cO)}function cJ(){var cN={action:"/jnap/nodes/autoonboarding/SetBluetoothAutoOnboardingSettings",data:{isAutoOnboardingEnabled:false},cb:function(cO){if(cO.result==="OK"){console.warn("BTOnboarding stopped")}else{}},disableDefaultAjaxErrHandler:true};RAINIER.jnap.send(cN)}function cE(){if(cw&&cG){var cN=_.find(cw,{isAuthority:true});if(cN){cx=cN.deviceID;console.warn("Found Authority",cx)}cG.updatePolicy="AutomaticallyCheckAndInstall";cz.find("#setupNode").click(function(){var cR=[],cO=[],cS=cz.find("#ssid").val(),cQ=cz.find("#password").val();cz.find("#setupNode").prop("disabled","disabled");_.map(cC,function(cT){cR.push({band:cT,ssid:cS,security:"WPA2-Personal",passphrase:cQ})});_.map(cA,function(cT){cO.push({name:cT,value:cy})});var cP=RAINIER.jnap.Transaction({onComplete:cH,timeoutMs:45*1000,disableDefaultJnapErrHandler:true,disableDefaultAjaxErrHandler:true});cP.add("/jnap/nodes/smartmode/SetDeviceMode",{mode:"Master"});cP.add({action:"/jnap/nodes/setup/SetSimpleWiFiSettings",data:{simpleWiFiSettings:cR},cb:function(cT){if(cT.result!=="OK"){cz.find("#setupNode").removeProp("disabled");console.warn("err",cT.result);if(cT.result==="ErrorInvalidSSID"){cI("ssidInputValidation",true,RAINIER.ui.validation.strings.connectivity.inputInvalid)}else{cF("ssidInputValidation")}if(cT.result==="ErrorInvalidPassphrase"){cI("passwordInputValidation",true,RAINIER.ui.validation.strings.connectivity.inputInvalid)}else{cF("passwordInputValidation")}}else{cF("ssidInputValidation");cF("passwordInputValidation")}}});cP.add("/jnap/core/SetAdminPassword2",{adminPassword:"admin"});cP.add("/jnap/devicelist/SetDeviceProperties",{deviceID:cx,propertiesToModify:cO});cP.add("/jnap/firmwareupdate/SetFirmwareUpdateSettings",cG);cP.send()});cz.find("#setupNode").removeProp("disabled")}else{}cz.find(".unconfigured-block").show()}function cK(){var cN=RAINIER.jnap.Transaction({onComplete:cE,timeoutMs:30*1000,disableDefaultJnapErrHandler:true});cN.add({action:"/jnap/devicelist/GetDevices",data:{},cb:function(cO){if(cO.result==="OK"){cw=cO.output.devices}else{}}});cN.add({action:"/jnap/firmwareupdate/GetFirmwareUpdateSettings",data:{},cb:function(cO){if(cO.result==="OK"){cG=cO.output}else{}}});cN.send();$(".unconfigured-block").show()}function cM(){var cN="/jnap/nodes/smartconnect/GetWiredAutoOnboardingSettings";if(RAINIER.shared.util.areServicesSupported(["/jnap/nodes/autoonboarding/AutoOnboarding"])){cN="/jnap/nodes/autoonboarding/GetWiredAutoOnboardingSettings"}RAINIER.jnap.send({action:cN,data:{},cb:function(cO){if(cO.result==="OK"){var cP=cO.output;if(cP.isAutoOnboardingEnabled){cz.find("#startOnboarding").prop("disabled","disabled");cz.find("#stopOnboarding").removeProp("disabled")}cz.find(".configured-block").show()}else{}}})}function cI(cO,cR,cP){var cQ=cz.find("#"+cO),cS=cQ.find(".inputValidationBox"),cN=cQ.find("inputField");cS.addClass("inputError");if(cR){cS.removeClass("showInputValidationMessage");var cT=cS.find(".inputValidationErrorMessage");if(cT.length>0){console.warn(cT);if(cP&&cP.length>0){cT.html(cP)}}else{return}}else{cS.addClass("showInputValidationMessage")}if(cN){cN.focus()}}function cF(cN){var cO=cz.find("#"+cN),cP=cO.find(".inputValidationBox");cP.removeClass("inputError")}cz.find("#startOnboarding").click(function(){$(this).prop("disabled","disabled");cB(null,function(){cz.find("#stopOnboarding").removeProp("disabled")})});cz.find("#stopOnboarding").click(function(){$(this).prop("disabled","disabled");cv(null,function(){cz.find("#startOnboarding").removeProp("disabled")});cJ()});cz.find("#startBTOnboarding").click(function(){$(this).prop("disabled","disabled");cL()});RAINIER.jnap.send({action:"/jnap/nodes/smartmode/GetDeviceMode",data:{},cb:function(cN){console.warn("GetDeviceMode",cN);if(cN.result==="OK"){switch(cN.output.mode){case"Unconfigured":cK();break;case"Master":cM();break}}else{}},disableDefaultAjaxErrHandler:true})}function R(cu){ch(cu);w.internetSettingsPreInit(cu);cl(cu);if(aF.advancedrouting){a4(cu)}if(aF.vlantagging){a9(cu)}if(aF.administration){bq(cu)}}function a(){bf();w.internetSettingsInit();bL();if(aF.advancedrouting){f()}if(aF.vlantagging){cf()}if(aF.administration){bx()}if(bj==="#casupport"&&aF.velopSimpleSetup){b7()}RAINIER.ui.textAreaPlaceholder.init();RAINIER.event.fire("applet.loaded");if(RAINIER.network.isBehindNode()){t=RAINIER.network.getNodesCurrentFirmwareVersions();console.warn("nodesCurent",t);if(!t){RAINIER.event.connect("nodes-current-fw-versions",b9)}else{bo()}aU=RAINIER.network.getNodesAvailableUpdates();if(!aU){I()}else{aB(aU)}if($.cookie("app-flag")==="update-firmware"){setTimeout(function(){ck.onAutoFirmwareUpdate()},500)}}else{if($.cookie("app-flag")==="check-firmware"){setTimeout(function(){cj.find(".check-update").click()},500)}}}function ce(){cj.find(".tabs").prepend(aO.basic);if(bj==="#casupport"&&aF.velopSimpleSetup){cj.find("#internetSettingsTab").after(aO.velopSimpleSetup)}if(aF.administration){cj.find("#internetSettingsTab").after(aO.administration)}if(aF.vlantagging){cj.find("#internetSettingsTab").after(aO.vlantagging)}else{ar.remove()}if(aF.advancedrouting){cj.find("#internetSettingsTab").after(aO.advancedrouting)}cj.find("#internetSettingsTab").after(aO.localNetwork);if(aF.powerModem){cj.find("#internetSettingsTab").after(aO.powerModem)}else{cj.find("#power-modem").remove()}}function bV(cu){aF.advancedrouting=true;aF.administration=RAINIER.shared.util.areServicesSupported(["/jnap/firewall/Firewall","/jnap/routerupnp/RouterUPnP","/jnap/routermanagement/RouterManagement"]);aF.powerModem=RAINIER.network.isPowerModemSupported();aF.vlantagging=(RAINIER.shared.util.areServicesSupported(["/jnap/vlantagging/VLANTagging"])||RAINIER.shared.util.areServicesSupported(["/jnap/vlantagging/VLANTagging2"]))&&!RAINIER.network.isBridgeMode();az.cutThroughForwarding=RAINIER.shared.util.areServicesSupported(["/jnap/router/Router2"])||RAINIER.shared.util.areServicesSupported(["/jnap/router/broadcom/RouterBroadcom"]);az.passwordHint=RAINIER.shared.util.areServicesSupported(["/jnap/core/Core3"]);az.allJoyn=RAINIER.shared.util.areServicesSupported(["/jnap/alljoyn/AllJoyn"]);az.router6=RAINIER.shared.util.areServicesSupported(["/jnap/router/Router6"]);aF.velopSimpleSetup=RAINIER.network.isBehindNode()&&cu;ce()}function aY(){p();w.initializeInternetSettingsDefaultInputValues();bP()}function cn(cu){RAINIER.applets.connectivity.resetSharedOptions();RAINIER.deviceManager.getDevices(function(cw){b.devices=cw});RAINIER.ui.progressBar.build("updateFwProgress div.progress-bar");RAINIER.ui.progressBar.build("updatePmFwProgress div.progress-bar");cs=RAINIER.ui.dialog($("#dialog-tabchange"),{onSubmit:function(){aA.doTabChange=true;bt(false)}});$("#dialog-tabchange #no-save").unbind("click");$("#dialog-tabchange #no-save").click(function(){cs.close();B();aA.destinationTab.click()});m=RAINIER.ui.dialog("#updateFwProgress",{});bb=RAINIER.ui.dialog("#updatePmFwProgress",{});bT=RAINIER.ui.dialog("#updateFwComplete",{cancelClose:true,onSubmit:function(){window.location.replace("/ui/dynamic/home.html")}});b4=RAINIER.ui.dialog("#updatePmFwComplete",{cancelClose:true,onSubmit:function(){window.location.replace("/ui/dynamic/home.html")}});ac=RAINIER.ui.dialog("#guest-ssid-conflict");bB();aY();bV(typeof cu==="boolean"?!cu:true);aH=RAINIER.ui.tabs.init({fireEvents:true,initialTab:$.cookie("initial-tab")});aH.connect(function(cx,cw){if(cw.type==="tab"){bu=cw.srcTabId;b1=cw.destTabId;if(cw.srcIdx>-1){aA.destinationTab=cw.destTab;if(E()){cx.cancelEvent=true}}else{bu=b1}}else{ca=cw.destTabId;if(!RAINIER.network.isBridgeMode()&&(ca==="ip-v4"||ca==="ip-v6")){cj.find("div#ipv4-ipv6-common").toggleClass("ipv6",ca==="ip-v6")}else{cx.cancelEvent=true}}});aH.fireInit();var cv=RAINIER.jnap.Transaction({onComplete:a});R(cv);cv.send();cj.find("footer .cancel").click(ck.onClose);cj.find("footer .submit").click(ck.onSave);cj.find("footer .apply").click(ck.onApply);RAINIER.event.connect("tab.changed",function(cw,cx){switch(cx.destTabId){case"internet-settings":case"ip-v6":case"local-network":RAINIER.ui.fixIeForm("#"+cx.destTabId);break}})}if(RAINIER.network.isBehindNode()){symmetryUtil.nodes.canOnlyBeSlave().always(cn)}else{cn()}}());