(function(){var l={},j={},i=RAINIER.shared.util.getCookie("user-auth-token"),b=RAINIER.shared.util.getURLParameter("networkId"),k=RAINIER.shared.util.getURLParameter("email"),e=RAINIER.shared.util.getURLParameter("deviceId"),d=RAINIER.shared.util.getURLParameter("locale");function f(p){for(var o=0;o<l.deviceRules.length;o++){if(p===l.deviceRules[o].macAddress){return true}}return false}function h(o){var p=document.getElementById("notLoading");if(p){p.style.display=(o==="loading"?"none":"block")}showView(o)}function n(){RAINIER.shared.util.setCurrentNetworkID(b);var p="login-simple.html"+window.location.search;var o=RAINIER.shared.util.getURLParameter("app");if(!o){p+="&app=mediapri"}window.location=p}function c(){RAINIER.shared.util.signOutCookies();n()}function a(q){for(var o=0;o<j.length;o++){var p=j[o];if(q===p.deviceID){return p}}return null}function g(s){if(s.result!=="OK"){h("error");return}var q=a(e);if(!q){h("deviceNotFound");return}var r=(l.applicationRules.length+l.deviceRules.length);var p=true;if(f(q.knownMACAddresses[0])){if(l.isQoSEnabled){h("success");return}p=false}else{if(r>=3){h("queueFull");return}}if(p){l.deviceRules.push({macAddress:q.knownMACAddresses[0],description:q.friendlyName||"Network Device",trafficType:"Video",priority:"High"})}l.isQoSEnabled=true;delete l.maxDescriptionLength;delete l.maxApplicationRules;delete l.maxPortRanges;delete l.maxDeviceRules;RAINIER.jnap.send({action:"/jnap/qos/SetQoSSettings",data:l,remote:true,cb:function(t){if(t.result==="OK"){h("success")}else{h("error")}},disableDefaultAjaxErrHandler:true,disableDefaultJnapErrHandler:true})}function m(){RAINIER.jnap.send({action:"/jnap/core/IsAdminPasswordDefault",data:{},remote:true,disableDefaultAjaxErrHandler:true,disableDefaultJnapErrHandler:true,cb:function(q){if(q.result!=="OK"){h("networkNotFound");return}var p=RAINIER.jnap.Transaction({onComplete:g,remote:true,disableDefaultJnapErrHandler:true,disableDefaultAjaxErrHandler:true});p.add({action:"/jnap/qos/GetQoSSettings",data:{},cb:function(r){if(r.result==="OK"){l=r.output}}});p.add({action:"/jnap/devicelist/GetDevices",data:{},cb:function(r){if(r.result==="OK"){j=r.output.devices}}});p.send()}})}window.onload=function(){if(!k||!e||!b||!d){h("error");return}if(typeof i==="undefined"){c();return}if(typeof RAINIER.shared.util.getCurrentNetworkID()==="undefined"){RAINIER.shared.util.setCurrentNetworkID(b)}else{if(RAINIER.shared.util.getCurrentNetworkID()!==b){c();return}}h("loading");m()}}());