RAINIER.applets.connectivity.internetSettings=RAINIER.applets.connectivity.internetSettings||(function(){var J=$("#connectivity-applet"),u=J.find("#internet-settings"),ag=J.find("#power-modem"),D=J.find("#wanType"),aw=u.find("#pmWanType"),ah=ag.find("#dsl-settings"),z=RAINIER.applets.connectivity.sharedOptions,av=RAINIER.applets.connectivity.sharedEvents,m=RAINIER.ui.buildInputValidBalloon,aB=RAINIER.ui.dialogWarning,G=z.checks,P=null,i=null,N=false,n=5*1000,ay=13,a=null,p=false,L=false;var E={wan:{},wireless:{},wanStatus:{},macAddressCloneSettings:{},ipv6:{},ipv6Setup:{},currentDeviceMAC:null,deviceMode:{},wanTagging:{},homeKitSettings:{}},ar={macAddressCloneSettings:{},ipv6:{},powerModem:{}},aG={"wan.mtu":"number","wan.tpSettings.useStaticSettings":"boolean","wan.bridgeSettings.useStaticSettings":"boolean","wan.useStaticSettings":"boolean","wan.tpSettings.maxIdleMinutes":"number","wan.tpSettings.reconnectAfterSeconds":"number","wan.L2TPSettings.maxIdleMinutes":"number","wan.L2TPSettings.reconnectAfterSeconds":"number","wan.pppoeSettings.maxIdleMinutes":"number","wan.pppoeSettings.reconnectAfterSeconds":"number","wan.wanTaggingSettings.vlanTaggingSettings.vlanID":"number","lanSettings.dhcpSettings.leaseMinutes":"number","lanSettings.dhcpSettings.maxClients":"number","ipv6.ipv6rdTunnelSettings.prefixLength":"number","ipv6.ipv6rdTunnelSettings.borderRelayPrefixLength":"number"},M={basic:J.find("#basic-tab"),basicDiv:J.find("#basic"),localNetwork:J.find("#localnetwork-tab"),advancedrouting:J.find("#advancedrouting-tab"),administration:J.find("#administration-tab"),powerModem:J.find("#powerModem-tab")},x={onConnTypeChange:function(){RAINIER.ui.inputBalloon.hide();var aH=D.val();["DHCP","PPPoE","PPTP","L2TP","Static","Bridge","WirelessRepeater","WirelessBridge"].forEach(function(aI){$("#"+aI).toggle(aI===aH)});u.find(".connectionError").hide();if(RAINIER.network.isBridgeMode(aH)){$("#bridgeModeHint").show();RAINIER.binder.toDom(E,u,aG);if(Q.router5){aa()}else{az()}Z()}else{$("#bridgeModeHint").hide()}ab();ao(RAINIER.network.isBridgeMode(aH));RAINIER.ui.fixIeForm("#ip-v4-fieldset")},onClose:av.onClose,onSaveComplete:av.onSaveComplete},Q={powerModem:false,router3:false,router5:false,router8:false,router10:false};var H={powerModem:{},wan:{}},aC={"powerModem.isPowerModemEnabled":"boolean","powerModem.dslSettings.pcr":"number","powerModem.dslSettings.scr":"number","powerModem.dslSettings.vci":"number","powerModem.dslSettings.vpi":"number"},k={onHidePmSections:function(){u.find("#pm-wan-type-label").hide();aw.hide();if(!u.find("#ip-v4-fieldset").hasClass("edit")){u.find("#ipv4-wan-type").show()}D.show().trigger("change")},onShowPmSections:function(){u.find("#ipv4-wan-type").hide();D.hide();u.find("#DHCP").hide();if(!u.find("#ip-v4-fieldset").hasClass("edit")){u.find("#pm-wan-type-label").css("display","table-cell")}aw.show().trigger("change")},onPmEnableChange:function(aI){var aH=$(aI.target).is(":checked");b(ah,aH)},onPmConnTypeChange:function(){var aH=u.find("#pmWanType option:selected"),aI=aH.attr("data-location");["Bridge","Static","PPPoE"].forEach(function(aJ){$("#"+aJ).toggle(aJ===aI)});switch(aH.val()){case"2684Bridged":if(u.find("#ip-v4-fieldset").hasClass("edit")){A(u.find("#bridge-auto").is(":checked"))}break;default:A(true);break}u.find("#pm-wan-type-label").html(aH.text());RAINIER.ui.fixIeForm("#ip-v4-fieldset")},onQoSTypeChange:function(aH){var aI=$(aH.target);if(RAINIER.network.isAuthorityRemote()){return}switch(aI.val()){case"UBR":ah.find("#pcr, #scr").attr("disabled","disabled");break;case"CBR":ah.find("#scr").attr("disabled","disabled");ah.find("#pcr").removeAttr("disabled");break;default:ah.find("#pcr, #scr").removeAttr("disabled");break}RAINIER.ui.inputBalloon.hide();RAINIER.ui.validation.removeInvalidMarks(ah)}};function b(aI,aH){if(aH){aI.find(".shield").hide()}else{aI.find(".shield").show()}}function e(){return(Q.powerModem&&H.powerModem.isPowerModemEnabled)?aw.val():D.val()}function ao(aH){if(aH){u.find("ul.sub-tabs li:nth-child(2)").addClass("disabled");u.find('select[name="wan.mtu-type"]').val("auto");u.find('input[name="wan.mtu"]').attr("disabled","true");u.find('select[name="wan.mtu-type"]').attr("disabled","true");u.find("#macaddress-enabled").attr("disabled","true");u.find("#macaddress-enabled").removeAttr("checked").change();ai(false)}else{u.find("ul.sub-tabs li:nth-child(2)").removeClass("disabled");u.find('select[name="wan.mtu-type"]').removeAttr("disabled");u.find('select[name="wan.mtu-type"]').trigger("change");u.find("#macaddress-enabled").removeAttr("disabled");ai(u.find("#macaddress-enabled").is(":checked"))}g("bridge")}function T(aH){if(Q.powerModem){Y()}J.find("#ip-v4 span.ui-radio").hide();aH.add({action:RAINIER.jnapActions.getWANSettings(),data:{},cb:function(aI){if(aI.result==="OK"){E.wan=aI.output||{};E.wan.toJSON=j;if(Q.router8){if(!E.wan.wanTaggingSettings){J.find("#wanTaggingSettings").remove()}else{E.wanTagging=$.extend({},E.wan.wanTaggingSettings)}}}else{}}});if(Q.router3||Q.router5){aH.add({action:RAINIER.jnapActions.getWANStatus(),data:{},cb:function(aI){if(aI.result==="OK"){E.wanStatus=aI.output||{};if(Q.router3){RAINIER.applets.connectivity.bridge.sanitizeWirelessModeSecurity(E.wanStatus)}}else{}}})}aH.add({action:"/jnap/router/GetMACAddressCloneSettings",data:{},cb:function(aI){if(aI.result==="OK"){E.macAddressCloneSettings=aI.output||{}}else{}}});aH.add({action:RAINIER.jnapActions.getIPv6Settings(),data:{},cb:function(aI){if(aI.result==="OK"){E.ipv6=aI.output||{};if(Q.router5&&E.ipv6.wanType==="Automatic"){E.ipv6=$.extend(true,E.ipv6,E.ipv6.ipv6AutomaticSettings);delete E.ipv6.ipv6AutomaticSettings}$.extend(true,E.ipv6Setup,E.ipv6);delete E.ipv6.duid}else{}}});aH.add({action:RAINIER.jnapActions.getRadioInfo(),data:{},cb:function(aI){if(aI.result==="OK"){E.wireless=aI.output||{}}else{}}});if(!RAINIER.network.isAuthorityRemote()){RAINIER.jnap.send({action:"/jnap/devicelist/GetLocalDevice",data:{},cb:function(aI){if(aI.result==="OK"){J.find("#cloneMAC").show();RAINIER.deviceManager.getDeviceByDeviceID(f,aI.output.deviceID)}else{J.find("#cloneMAC").hide()}},disableDefaultJnapErrHandler:true})}if(RAINIER.network.isBehindNode()){aH.add({action:"/jnap/nodes/smartmode/GetDeviceMode",data:{},cb:function(aI){if(aI.result==="OK"){E.deviceMode=aI.output||{}}else{}}})}if(RAINIER.shared.util.areServicesSupported(["/jnap/homekit/HomeKit"])){aH.add({action:"/jnap/homekit/GetHomeKitSettings",data:{},cb:function(aI){if(aI.result==="OK"){E.homeKitSettings=aI.output||{}}else{}}})}}function v(aI,aH){if(aH.contains(aI)){["-keep-alive","-connect-on-demand"].forEach(function(aJ){var aL="#"+aI+aJ,aK=$(aL).is(":checked");$(aL+"-value").toggle(aK)});w(J.find("#"+aI+"-conn-mode").parent(),"#"+aI+"-conn-mode-label")}}function R(){if(E.wan.staticSettings){E.wan.staticSettings.subnetMask=RAINIER.util.fromPrefixLengthToSubnet(E.wan.staticSettings.networkPrefixLength)}else{if(E.wan.bridgeSettings&&E.wan.bridgeSettings.staticSettings){E.wan.bridgeSettings.staticSettings.subnetMask=RAINIER.util.fromPrefixLengthToSubnet(E.wan.bridgeSettings.staticSettings.networkPrefixLength)}else{if(E.wan.tpSettings&&E.wan.tpSettings.staticSettings){E.wan.tpSettings.staticSettings.subnetMask=RAINIER.util.fromPrefixLengthToSubnet(E.wan.tpSettings.staticSettings.networkPrefixLength)}}}D.val(E.wan.wanType);D.trigger("change");u.find('#domainName-label > label[name="wan.domainName"]').text(E.wan.domainName);u.find('input[name="domainName"]').val(E.wan.domainName);A(true);if(RAINIER.network.isBridgeMode()){ao(true);M.administration.remove();M.advancedrouting.remove();M.localNetwork.remove();M.vlantagging.remove()}Z();u.find("#macaddress-enabled").attr("checked",E.macAddressCloneSettings.isMACAddressCloneEnabled);ai(E.macAddressCloneSettings.isMACAddressCloneEnabled);RAINIER.binder.toDom(E,u.find("#internet-connection"),aG);RAINIER.binder.toDom(E,u.find("#ip-v6"),aG);RAINIER.applets.connectivity.bridge.wanToDom(E);if(Q.router5){aa()}else{u.find("#ipv6-connection-type").css("display","none");u.find("#automaticSettings").css("display","block");az()}v(E.wan.wanType.toLowerCase(),["l2tp","pppoe","pptp"]);["pptp","bridge"].forEach(function(aH){var aI=u.find("#"+aH+"-mode");g(aH,aI);aI.find("input[type=radio]").change(function(){g(aH,aI);if(aH==="bridge"&&u.find("#ip-v4-fieldset").hasClass("edit")){A(!$(this).attr("id").contains("manual"))}RAINIER.ui.fixIeForm(u)})});u.find("[tooltip]").each(function(){var aH=$(this);aH.attr("tooltip",aH.text())})}function w(aK,aJ){var aI=$(aK),aH={id:aI.find("input[type=radio]:checked").attr("id")};aH.label=aI.find('label[for="'+aH.id+'"]').html();aI.find(aJ).html(aH.label);return aH}function g(aH,aI){if(!aI){aI=u.find("#"+aH+"-mode")}u.find("._"+aH+"-manual").toggle(w(aI,"#"+aH+"-ip-address-mode").id.contains("manual"))}function Z(){if(E.wan.mtu!==0){u.find('select[name="wan.mtu-type"]').val("manual")}else{u.find('select[name="wan.mtu-type"]').val("auto")}u.find('select[name="wan.mtu-type"]').trigger("change")}function af(){V();RAINIER.applets.connectivity.initializeDefaultMacAddressInputValues(u);RAINIER.applets.connectivity.initializeGeneralInputValues(u);u.find("#ipv6-tunnel-mode").val("Disabled");u.find("#ipv6-tunnel-settings-prefix").val("");u.find("#ipv6-tunnel-settings-prefix-length").val(0);u.find("#ipv6-tunnel-settings-mask-length").val(0)}function W(){u.find("#ip-v4-fieldset").removeClass("edit");V();D.val(E.wan.wanType);D.trigger("change");A(true);D.attr("disabled",true);u.find("#edit-ipv4").toggle(!RAINIER.network.isAuthorityRemote());u.find("#edit-ipv4 > a").removeClass("disabled");u.find("#edit-ipv4 > a").removeProp("disabled");$("#ipv4-wan-type").show();D.parent().hide();u.find("#ip-v4 span.ui-radio").hide()}function r(){u.find("#ip-v6-fieldset").removeClass("edit");RAINIER.binder.toDom(E,u.find("#ip-v6"),aG);i=null;P=null;if(Q.router5){aA();ad();aa()}else{az()}u.find("#edit-ipv6").toggle(!RAINIER.network.isAuthorityRemote());u.find("#edit-ipv6 > a").removeClass("disabled");u.find("#edit-ipv6 > a").removeProp("disabled")}function aD(){if(Q.powerModem){o()}D.change(x.onConnTypeChange);RAINIER.ui.editFormClick(u.find("#ip-v4-fieldset"),u.find("#edit-ipv4 > a"),function(){u.find("#ip-v4-fieldset").addClass("edit");u.find("#ipv4-wan-type").hide();D.removeAttr("disabled");D.parent().show();S(D.val());u.find("#ip-v4 span.ui-radio").show()},true);if(Q.router5){RAINIER.ui.editFormClick(u.find("#ip-v6-fieldset"),u.find("#edit-ipv6 > a"),aa,true)}else{RAINIER.ui.editFormClick(u.find("#ip-v6-fieldset"),u.find("#edit-ipv6 > a"),az,true)}u.find('#PPTP input[name="wan.tpSettings.useStaticSettings"]:radio').click(function(){var aH=$(this).val();var aI=u.find('#PPTP div.ip-input[name="wan.tpSettings.staticSettings.ipAddress"] > *, div.ip-input[name="wan.tpSettings.staticSettings.subnetMask"] > *,div.ip-input[name="wan.tpSettings.staticSettings.gateway"] > *,div.ip-input[name="wan.tpSettings.staticSettings.dnsServer1"] > *,div.ip-input[name="wan.tpSettings.staticSettings.dnsServer2"] > *, div.ip-input[name="wan.tpSettings.staticSettings.dnsServer3"] > *');aI.attr("disabled",aH==="false");A(aH==="false")});u.find('#PPTP input[name="wan.tpSettings.behavior"]:radio').click(function(){var aH=$(this).val();u.find('#PPTP input[name="wan.tpSettings.maxIdleMinutes"]').attr("disabled",aH!=="ConnectOnDemand");u.find('#PPTP input[name="wan.tpSettings.reconnectAfterSeconds"]').attr("disabled",aH==="ConnectOnDemand")});u.find('#L2TP input[name="wan.L2TPSettings.behavior"]:radio').click(function(){var aH=$(this).val();u.find('#L2TP input[name="wan.L2TPSettings.maxIdleMinutes"]').attr("disabled",aH!=="ConnectOnDemand");u.find('#L2TP input[name="wan.L2TPSettings.reconnectAfterSeconds"]').attr("disabled",aH==="ConnectOnDemand")});u.find('#PPPoE [name="wan.pppoeSettings.behavior"]').click(function(){var aH=$(this).val();u.find('#PPPoE input[name="wan.pppoeSettings.maxIdleMinutes"]').attr("disabled",aH!=="ConnectOnDemand");u.find('#PPPoE input[name="wan.pppoeSettings.reconnectAfterSeconds"]').attr("disabled",aH==="ConnectOnDemand")});u.find('input[value="ConnectOnDemand"]').click(function(aH){if(!$(aH.target).hasClass("ui-radio-active")&&N){RAINIER.ui.alert(J.find("#connect-on-demand-warning").html())}u.find('input[value="KeepAlive"]').removeClass("ui-radio-active");$(aH.target).addClass("ui-radio-active")});u.find('input[value="KeepAlive"]').click(function(aH){$(aH.target).addClass("ui-radio-active");u.find('input[value="ConnectOnDemand"]').removeClass("ui-radio-active")});$('select[name="wan.mtu-type"]').change(function(){var aH=$(this).val();u.find('input[name="wan.mtu"]').attr("disabled",aH==="auto");u.find('input[name="wan.mtu"]').val(aH==="manual"?E.wan.mtu!==0?E.wan.mtu:RAINIER.applets.connectivity.getMaxMTUValue(e()).toString():"0")});u.find("#macaddress-enabled").click(function(){var aH=u.find("#macaddress-enabled").is(":checked");if(aH){G.internetSettings.macClone.enable()}else{G.internetSettings.macClone.disable()}ai(aH)});if(!RAINIER.network.isAuthorityRemote()){u.find("#internet-connection #clone-macaddress").click(B)}else{u.find("#cloneMACBlock").css("display","none")}u.find("#ipv6-automatic-enabled").click(function(){az()});u.find("#ipv6WanType").change(aa);u.find("#ipv6-tunnel-mode").change(function(){if(!u.find("#ipv6-automatic-enabled").is(":checked")&&u.find("#ipv6-tunnel-mode").val()==="Manual"){u.find('.tunnel-mode-manual input[type="text"]').removeAttr("disabled");if(P){var aH={ipv6:{}};aH.ipv6.ipv6rdTunnelSettings=P;RAINIER.binder.toDom(aH,u.find("#ip-v6",aG))}}else{u.find('.tunnel-mode-manual input[type="text"]').attr("disabled",true);var aI=RAINIER.binder.fromDom(u,aG);P=aI.ipv6.ipv6rdTunnelSettings;u.find("#ipv6-tunnel-settings-prefix").val("");u.find("#ipv6-tunnel-settings-prefix-length").val(0);u.find("#ipv6-tunnel-settings-mask-length").val(0);u.find("#ipv6-tunnel-settings-border-relay > input").val(0)}if(!u.find("#ip-v6-fieldset").hasClass("edit")){u.find("#ipv6-tunnel-mode-text").text(u.find("#ipv6-tunnel-mode option:selected").text())}})}function V(){u.find("#pppoe-username").val("");u.find("#pppoe-password").val("");u.find("#pppoe-service-name").val("");u.find("#pppoe-keep-alive").click();u.find("#pppoe-max-idle-time").val(15);u.find("#pppoe-redial-period").val(30);u.find("#pptp-username").val("");u.find("#pptp-password").val("");u.find("#pptp-auto").click();u.find("#pptp-keep-alive").click();u.find("#pptp-max-idle-time").val(15);u.find("#pptp-redial-period").val(30);u.find("#l2tp-username").val("");u.find("#l2tp-password").val("");u.find("#l2tp-max-idle-time").val(15);u.find("#l2tp-redial-period").val(30);u.find("#l2tp-keep-alive").click();u.find("#Bridge #bridge-auto").click();u.find("#ip-v4 div.ip-input > input").val(0);if(!RAINIER.network.isAuthorityRemote()){u.find("#edit-ipv4").show()}}function az(){if(u.find("#ipv6-automatic-enabled").is(":checked")){u.find("#ipv6-tunnel-mode").attr("disabled",true);var aI=RAINIER.binder.fromDom(u,aG);i=aI.ipv6.ipv6rdTunnelMode;u.find("#ipv6-tunnel-mode").val("Disabled");if(!u.find("#ip-v6-fieldset").hasClass("edit")){u.find("#ipv6-automatic-text").text(RAINIER.ui.common.strings.enabled)}}else{u.find("#ipv6-tunnel-mode").removeAttr("disabled");if(i){var aH={ipv6:{}};aH.ipv6.ipv6rdTunnelMode=i;RAINIER.binder.toDom(aH,u.find("#ip-v6",aG))}if(!u.find("#ip-v6-fieldset").hasClass("edit")){u.find("#ipv6-automatic-text").text(RAINIER.ui.common.strings.disabled)}}u.find("#ipv6-tunnel-mode").trigger("change")}function aa(){var aH=u.find("#ipv6WanType").val();if(!aH){aH=E.ipv6.wanType}switch(aH){case"PPPoE":u.find("#automaticSettings").css("display","none");u.find("#pppoeSettings").css("display","block");break;case"Pass-through":u.find("#automaticSettings").css("display","none");u.find("#pppoeSettings").css("display","none");break;default:u.find("#pppoeSettings").css("display","none");u.find("#automaticSettings").css("display","block");az();break}u.find("#ipv6-wan-type").text(RAINIER.ui.common.strings.wanIpv6Type[aH])}function ax(){var a3={minLen:4,maxLen:39,validCharSet:"ascii",whiteSpace:false},aV={validCharSet:"numeric",whiteSpace:false,isRequired:true},aS={minLen:2,maxLen:2,validationType:"macAddress",validCharSet:"hex",isRequired:true},a7={validCharSet:"ascii",whiteSpace:false,maxLen:255,isRequired:false},aO={validCharSet:"ascii",maxLen:255,isRequired:false},aQ=validation.ruleSet.vlanID,aN=validation.rule.vlanIDValid,a0={validCharSet:"ascii",maxLen:255,whiteSpace:false},aK={maxLen:3,validationType:"ipAddress",validCharSet:"numeric",isComposite:true,blankIsOkOnblur:false},aR={maxLen:3,validationType:"subnetMask",isRequired:true},a4={maxLen:63,validationType:"ipv6Address",isRequired:true},a5={pppoe:{},staticIp:{},pptp:{},l2tp:{},bridgemode:{},ipv6:{}};function aH(a8){if($.isNumeric(a8)){var a9=parseInt(a8,10);return a9>=576&&a9<=RAINIER.applets.connectivity.getMaxMTUValue(e())}return false}function aI(a8){if(!a8){return true}else{if($.isNumeric(a8)){var a9=parseInt(a8,10);return a9>=E.wanTagging.vlanLowerLimit&&a9<=E.wanTagging.vlanUpperLimit}}return false}function aT(a8){return a8>=1&&a8<=9999}function a2(a8){return a8>=20&&a8<=180}function aM(a8){return a8>=0&&a8<=64}function aZ(a8){return a8>=0&&a8<=32}function aJ(bc,ba){var a9=u.find(bc),bb=u.find(ba);for(var a8=0;a8<4;a8++){if($(a9.children()[a8]).val()!==$(bb.children()[a8]).val()){return false}}return true}function aP(a8,a9){if(!a9){a9={}}return m($.extend(true,{},!!a9.asSubnet?aR:aK,{elContainer:u.find(a8),allowZeroes:!!a9.allowZeroes}))}function aL(a9,a8){a9.ipAddress=m($.extend(true,{},aK,{elContainer:u.find('div:[name="'+a8+'.ipAddress"]'),allowZeroes:false,errors:[{test:aJ.curry('div:[name="'+a8+'.ipAddress"]','div:[name="'+a8+'.gateway"]'),when:true,message:RAINIER.ui.validation.strings.connectivity.ipAddressIsEqualGateway}]}));a9.subnetMask=aP('div:[name="'+a8+'.subnetMask"]',{asSubnet:true});a9.gateway=aP('div:[name="'+a8+'.gateway"]',{allowZeroes:false});a9.dnsServer1=aP('div:[name="'+a8+'.dnsServer1"]',{allowZeroes:false});a9.dnsServer2=aP('div:[name="'+a8+'.dnsServer2"]',{allowZeroes:true});a9.dnsServer3=aP('div:[name="'+a8+'.dnsServer3"]',{allowZeroes:true})}function aW(){aL(a5.staticIp,"wan.staticSettings");a5.staticIp.domainName=m($.extend(true,{},$.extend({},a3,{isRequired:false}),{els:u.find('input:[name="domainName"]')}))}function a1(){a5.pppoe.username=m($.extend(true,{},a7,{els:u.find('input:[name="wan.pppoeSettings.username"]')}));a5.pppoe.password=m($.extend(true,{},aO,{els:u.find('input:[name="wan.pppoeSettings.password"]')}));if(Q.router10){a5.pppoe.vlanID=m($.extend(true,{},aQ,{els:u.find("#pppoe-vlan-id"),errors:[{test:aI,when:false,message:function(){return RAINIER.util.outOfRangeMessage(E.wanTagging.vlanLowerLimit,E.wanTagging.vlanUpperLimit)}}]}))}else{a5.pppoe.vlanID=m($.extend(true,{},aQ,{els:u.find("#pppoe-vlan-id"),errors:[{test:aN.fn,when:false,message:RAINIER.ui.validation.strings.connectivity.pppoeVlanIdOutOfRange}]}))}a5.pppoe.serviceName=m($.extend(true,{},a0,{els:u.find('input:[name="wan.pppoeSettings.serviceName"]')}));a5.pppoe.maxIdleMinutes=m($.extend(true,{},{validCharSet:"numeric",whiteSpace:false},{els:u.find('input:[name="wan.pppoeSettings.maxIdleMinutes"]'),errors:[{test:aT,when:false,message:RAINIER.ui.validation.strings.connectivity.maxIdleTimeOutOfRange}]}));a5.pppoe.redialPeriod=m($.extend(true,{},{validCharSet:"numeric",whiteSpace:false},{els:u.find('input:[name="wan.pppoeSettings.reconnectAfterSeconds"]'),errors:[{test:a2,when:false,message:RAINIER.ui.validation.strings.connectivity.redialPeriodOutOfRange}]}))}function aU(){aL(a5.pptp,"wan.tpSettings.staticSettings");a5.pptp.domainName=m($.extend(true,{},$.extend({},a3,{isRequired:false}),{els:u.find('input:[name="domainName"]')}));a5.pptp.server=aP('div:[name="wan.tpSettings.server"]',{allowZeroes:false});a5.pptp.username=m($.extend(true,{},a7,{els:u.find('input:[name="wan.tpSettings.username"]')}));a5.pptp.password=m($.extend(true,{},aO,{els:u.find('input:[name="wan.tpSettings.password"]')}));a5.pptp.maxIdleMinutes=m($.extend(true,{},{validCharSet:"numeric",whiteSpace:false},{els:u.find('input:[name="wan.tpSettings.maxIdleMinutes"]'),errors:[{test:aT,when:false,message:RAINIER.ui.validation.strings.connectivity.maxIdleTimeOutOfRange}]}));a5.pptp.redialPeriod=m($.extend(true,{},{validCharSet:"numeric",whiteSpace:false},{els:u.find('input:[name="wan.tpSettings.reconnectAfterSeconds"]'),errors:[{test:a2,when:false,message:RAINIER.ui.validation.strings.connectivity.redialPeriodOutOfRange}]}))}function aY(){a5.l2tp.ipAddress=aP('div:[name="wan.L2TPSettings.server"]',{allowZeroes:false});a5.l2tp.username=m($.extend(true,{},a7,{els:u.find('input:[name="wan.L2TPSettings.username"]')}));a5.l2tp.password=m($.extend(true,{},aO,{els:u.find('input:[name="wan.L2TPSettings.password"]')}));a5.l2tp.maxIdleMinutes=m($.extend(true,{},{validCharSet:"numeric",whiteSpace:false},{els:u.find('input:[name="wan.L2TPSettings.maxIdleMinutes"]'),errors:[{test:aT,when:false,message:RAINIER.ui.validation.strings.connectivity.maxIdleTimeOutOfRange}]}));a5.l2tp.redialPeriod=m($.extend(true,{},{validCharSet:"numeric",whiteSpace:false},{els:u.find('input:[name="wan.L2TPSettings.reconnectAfterSeconds"]'),errors:[{test:a2,when:false,message:RAINIER.ui.validation.strings.connectivity.redialPeriodOutOfRange}]}))}function aX(){aL(a5.bridgemode,"wan.bridgeSettings.staticSettings");a5.bridgemode.domainName=m($.extend(true,{},$.extend({},a3,{isRequired:false}),{els:u.find('input:[name="domainName"]')}))}function a6(){a5.ipv6.prefix=m($.extend(true,{},a4,{els:u.find('input:[name="ipv6.ipv6rdTunnelSettings.prefix"]')}));a5.ipv6.prefixLength=m($.extend(true,{},{validCharSet:"numeric",isRequired:true,whiteSpace:false},{els:u.find('input:[name="ipv6.ipv6rdTunnelSettings.prefixLength"]'),errors:[{test:aM,when:false,message:RAINIER.ui.validation.strings.connectivity.ipv6PrefixLengthOutOfRange}]}));a5.ipv6.borderRelay=aP('div:[name="ipv6.ipv6rdTunnelSettings.borderRelay"]',{allowZeroes:false});a5.ipv6.borderRelayPrefixLength=m($.extend(true,{},{validCharSet:"numeric",isRequired:true,whiteSpace:false},{els:u.find('input:[name="ipv6.ipv6rdTunnelSettings.borderRelayPrefixLength"]'),errors:[{test:aZ,when:false,message:RAINIER.ui.validation.strings.connectivity.ipv6BorderRelayPrefixLengthOutOfRange}]}))}aW();a1();aU();aY();aX();a6();a5.mtu=m($.extend(true,{},aV,{els:u.find('input:[name="wan.mtu"]'),errors:[{test:aH,when:false,message:function(){return RAINIER.util.outOfRangeMessage(576,RAINIER.applets.connectivity.getMaxMTUValue(e()))}}]}));a5.macClone=m($.extend(true,{},aS,{els:u.find('.mac-input input[type="text"]'),elContainer:u.find('div:[name="macAddressCloneSettings.macAddress"]'),isComposite:true,isBlankOkOnBlur:false}));RAINIER.applets.connectivity.bridge.addValidation();G.internetSettings=a5}function X(){function aK(){var aR=true;if(G.internetSettings.staticIp.ipAddress.isValid(true)&&G.internetSettings.staticIp.subnetMask.isValid(true)&&G.internetSettings.staticIp.gateway.isValid(true)&&G.internetSettings.staticIp.dnsServer1.isValid(true)&&G.internetSettings.staticIp.dnsServer2.isValid(true)&&G.internetSettings.staticIp.dnsServer3.isValid(true)){aR=true}else{aR=false}if(aR&&u.find('input[name="domainName"]').is(":visible")&&u.find('input[name="domainName"]').val().length>0){if(G.internetSettings.staticIp.domainName.isValid(true)){aR=true}else{aR=false}}return aR}function aI(){var aR=true;if(G.internetSettings.pppoe.username.isValid(true)&&G.internetSettings.pppoe.password.isValid(true)&&G.internetSettings.pppoe.vlanID.isValid(true)&&G.internetSettings.pppoe.serviceName.isValid(true)){if(u.find('#PPPoE input[name="wan.pppoeSettings.behavior"]:radio:checked').val()==="KeepAlive"){aR=G.internetSettings.pppoe.redialPeriod.isValid(true)}else{aR=G.internetSettings.pppoe.maxIdleMinutes.isValid(true)}}else{aR=false}return aR}function aH(){var aR=true;if(u.find('#PPTP input[name="wan.tpSettings.useStaticSettings"]:radio:checked').val()==="true"){if(G.internetSettings.pptp.ipAddress.isValid(true)&&G.internetSettings.pptp.subnetMask.isValid(true)&&G.internetSettings.pptp.gateway.isValid(true)&&G.internetSettings.pptp.dnsServer1.isValid(true)&&G.internetSettings.pptp.dnsServer2.isValid(true)&&G.internetSettings.pptp.dnsServer3.isValid(true)){aR=true}else{aR=false}if(aR&&u.find('input[name="domainName"]').is(":visible")&&u.find('input[name="domainName"]').val().length>0){if(G.internetSettings.pptp.domainName.isValid(true)){aR=true}else{aR=false}}}if(aR){if(G.internetSettings.pptp.server.isValid(true)&&G.internetSettings.pptp.username.isValid(true)&&G.internetSettings.pptp.password.isValid(true)){if(u.find('#PPTP input[name="wan.tpSettings.behavior"]:radio:checked').val()==="KeepAlive"){aR=G.internetSettings.pptp.redialPeriod.isValid(true)}else{aR=G.internetSettings.pptp.maxIdleMinutes.isValid(true)}}else{aR=false}}return aR}function aL(){if(G.internetSettings.l2tp.ipAddress.isValid(true)&&G.internetSettings.l2tp.username.isValid(true)&&G.internetSettings.l2tp.password.isValid(true)){if(u.find('#L2TP input[name="wan.L2TPSettings.behavior"]:radio:checked').val()==="KeepAlive"){return G.internetSettings.l2tp.redialPeriod.isValid(true)}else{return G.internetSettings.l2tp.maxIdleMinutes.isValid(true)}}else{return false}}function aQ(){var aR=true;if(u.find("#bridge-manual").is(":checked")){if(G.internetSettings.bridgemode.ipAddress.isValid(true)&&G.internetSettings.bridgemode.subnetMask.isValid(true)&&G.internetSettings.bridgemode.gateway.isValid(true)&&G.internetSettings.bridgemode.dnsServer1.isValid(true)&&G.internetSettings.bridgemode.dnsServer2.isValid(true)&&G.internetSettings.bridgemode.dnsServer3.isValid(true)){aR=true}else{aR=false}if(aR&&u.find('input[name="domainName"]').is(":visible")&&u.find('input[name="domainName"]').val().length>0){if(G.internetSettings.bridgemode.domainName.isValid(true)){aR=true}else{aR=false}}}return aR}function aJ(){var aT=true;if(!u.find("#ipv6-automatic-enabled").is(":checked")&&u.find("#ipv6-tunnel-mode").val()==="Manual"){aT=(G.internetSettings.ipv6.prefix.isValid(true)&&G.internetSettings.ipv6.prefixLength.isValid(true)&&G.internetSettings.ipv6.borderRelay.isValid(true)&&G.internetSettings.ipv6.borderRelayPrefixLength.isValid(true));if(aT){var aS=parseInt(u.find("#ipv6-tunnel-settings-prefix-length").val(),10);var aR=parseInt(u.find("#ipv6-tunnel-settings-mask-length").val(),10);aT=aS-aR<=32;if(!aT){RAINIER.ui.alert("",J.find("#border-prefix-invalid-value").text())}}else{if(!u.find('ul[class="sub-tabs"] > li:nth-child(2)').hasClass("selected")){u.find('ul[class="sub-tabs"] > li:nth-child(2)').click();aJ()}}}return aT}function aN(aS){var aT=false,aR=u.find("#ipv6WanType").val();$.each(E.wanStatus.supportedWANCombinations,function(aU,aV){if(aV.wanType===aS&&aV.wanIPv6Type===aR){aT=true}});return aT}var aP=true;var aM=e();switch(aM){case"Static":case"2684Routed":case"IPoA":aP=aK();break;case"PPPoE":case"PPPoA":aP=aI();break;case"PPTP":aP=aH();break;case"L2TP":aP=aL();break;case"Bridge":case"2684Bridged":aP=aQ();break;default:aP=true;break}aP=aP&&RAINIER.applets.connectivity.bridge.isValid();if(aP&&u.find("#macaddress-enabled").is(":checked")){aP=G.internetSettings.macClone.isValid(true)}if(!RAINIER.network.isBridgeMode(aM)){if(aP&&u.find('select[name="wan.mtu-type"]').val()==="manual"){aP=G.internetSettings.mtu.isValid(true)}aP=aP&&aJ()}if(Q.router5&&!aN(aM)){var aO=RAINIER.ui.dialog("#ipv6-ipv4-not-valid",{onSubmit:function(){aO.close()}});aO.show();aP=aP&&false}return aP}function at(){if(!z.doClose){R();W();r();ax();if(Q.powerModem){aj()}RAINIER.applets.connectivity.bridge.init(E)}}function ai(aH){u.find("#macaddress-enabled").change();if(aH){u.find(".mac-input :input").removeAttr("disabled");u.find("#clone-macaddress").removeAttr("disabled")}else{u.find(".mac-input :input").attr("disabled","disabled");u.find("#clone-macaddress").attr("disabled","disabled")}}function f(aH){E.currentDeviceMAC=aH.data.connections[0].macAddress}function B(){var aH={macAddressCloneSettings:{macAddress:E.currentDeviceMAC}};RAINIER.binder.toDom(aH,J.find(".macAddressClone"),aG)}function A(aH){u.find("#domainName-label").hide();u.find("#domainName-input").hide();if(aH){u.find("#domainName-label").show()}else{u.find("#domainName-input").show()}}function S(aH){switch(aH){case"PPPoE":case"L2TP":case"DHCP":A(true);break;case"Static":A(!u.find("#ip-v4-fieldset").hasClass("edit"));break;case"PPTP":A(!u.find("#ip-v4-fieldset").hasClass("edit")||!u.find('#PPTP input[name="wan.tpSettings.useStaticSettings"][value="true"]').is(":checked"));break;case"Bridge":A(!u.find("#ip-v4-fieldset").hasClass("edit")||!u.find('#Bridge input[name="wan.bridgeSettings.useStaticSettings"][value="true"]').is(":checked"));break;case"WirelessRepeater":case"WirelessBridge":A(true);break}$("#ipv4-wan-type").html(D.find(":selected").text())}function ab(){var aH=D.val();N=false;if(E.wan.wanTaggingSettings&&!E.wan.wanTaggingSettings.isEnabled){$.delAttr(E.wan.wanTaggingSettings,"vlanTaggingSettings")}switch(aH){case"PPPoE":if(E.wan.wanType==="PPPoE"){RAINIER.binder.toDom(E,$("#PPPoE"),aG,null,true);if(E.wan.pppoeSettings){u.find("#PPPoE input[value="+E.wan.pppoeSettings.behavior+"]").click()}}break;case"PPTP":if(E.wan.wanType==="PPTP"){RAINIER.binder.toDom(E,$("#PPTP"),aG,null,true);if(E.wan.tpSettings){u.find("#PPTP input[value="+E.wan.tpSettings.behavior+"]").click();if(E.wan.tpSettings.useStaticSettings){u.find('#PPTP input[name="wan.tpSettings.useStaticSettings"][value="true"]').click()}}}break;case"L2TP":if(E.wan.wanType==="L2TP"){E.wan.L2TPSettings=E.wan.tpSettings;RAINIER.binder.toDom(E,$("#L2TP"),aG);if(E.wan.L2TPSettings){u.find("#L2TP input[value="+E.wan.L2TPSettings.behavior+"]").click()}delete E.wan.L2TPSettings}break;case"Static":if(E.wan.wanType==="Static"){RAINIER.binder.toDom(E,$("#Static"),aG,null,true)}break;case"Bridge":if(E.wan.wanType==="Bridge"){RAINIER.binder.toDom(E,$("#Bridge"),aG,null,true);if(E.wan.bridgeSettings&&E.wan.bridgeSettings.useStaticSettings){u.find('#Bridge input[name="wan.bridgeSettings.useStaticSettings"][value="true"]').click()}}break;case"DHCP":RAINIER.binder.toDom(E,$("#DHCP"),aG);break;case"WirelessRepeater":case"WirelessBridge":RAINIER.applets.connectivity.bridge.wanToDom(E);break;default:break}N=true;S(aH)}function F(aH){function aI(aJ){if(aJ.behavior==="ConnectOnDemand"){delete aJ.reconnectAfterSeconds}else{delete aJ.maxIdleMinutes}}if(aH.L2TPSettings){aI(aH.L2TPSettings)}else{if(aH.tpSettings){aI(aH.tpSettings)}else{if(aH.pppoeSettings){aI(aH.pppoeSettings)}}}}function q(){function aN(aP){var aO=u.find('#domainName-input > input[name="domainName"]').val();if(aO!==""){aP.domainName=aO}}function aI(aO){if(aO.dnsServer2==="0.0.0.0"){delete aO.dnsServer2}if(aO.dnsServer3==="0.0.0.0"){delete aO.dnsServer3}}var aH=D.val();var aL={},aK={wan:{}};switch(aH){case"PPPoE":aL=RAINIER.binder.fromDom($("#PPPoE"),aG);if(aL.wan.wanTaggingSettings){aL.wan.wanTaggingSettings=$.extend(true,{},E.wan.wanTaggingSettings,aL.wan.wanTaggingSettings);var aM=aL.wan.wanTaggingSettings.vlanTaggingSettings.vlanID;aL.wan.wanTaggingSettings.isEnabled=!!aM;if(aM){aL.wan.wanTaggingSettings.vlanTaggingSettings.vlanStatus="Tagged"}else{$.delAttr(aL.wan.wanTaggingSettings,"vlanTaggingSettings")}}break;case"PPTP":aL=RAINIER.binder.fromDom($("#PPTP"),aG);if(u.find('#PPTP input[name="wan.tpSettings.useStaticSettings"]:radio').val()==="false"){aN(aL.wan.tpSettings.staticSettings)}if(!aL.wan.tpSettings.useStaticSettings){delete aL.wan.tpSettings.staticSettings}else{aL.wan.tpSettings.staticSettings.networkPrefixLength=RAINIER.util.fromSubnetToPrefixLength(aL.wan.tpSettings.staticSettings.subnetMask);delete aL.wan.tpSettings.staticSettings.subnetMask;aI(aL.wan.tpSettings.staticSettings)}break;case"L2TP":aL=RAINIER.binder.fromDom($("#L2TP"),aG);aL.wan.tpSettings=aL.wan.L2TPSettings;delete aL.wan.L2TPSettings;aL.wan.tpSettings.useStaticSettings=false;break;case"Static":aL=RAINIER.binder.fromDom($("#Static"),aG);aN(aL.wan.staticSettings);aI(aL.wan.staticSettings);aL.wan.staticSettings.networkPrefixLength=RAINIER.util.fromSubnetToPrefixLength(aL.wan.staticSettings.subnetMask);delete aL.wan.staticSettings.subnetMask;break;case"Bridge":aL=RAINIER.binder.fromDom($("#Bridge"),aG);if(u.find('#Bridge input[name="wan.bridgeSettings.useStaticSettings"]:radio').val()==="false"){aN(aL.wan.bridgeSettings.staticSettings)}if(!aL.wan.bridgeSettings.useStaticSettings){delete aL.wan.bridgeSettings.staticSettings}else{aL.wan.bridgeSettings.staticSettings.networkPrefixLength=RAINIER.util.fromSubnetToPrefixLength(aL.wan.bridgeSettings.staticSettings.subnetMask);delete aL.wan.bridgeSettings.staticSettings.subnetMask;aI(aL.wan.bridgeSettings.staticSettings)}break;case"DHCP":aL={wan:{}};break;case"WirelessRepeater":aL=RAINIER.applets.connectivity.bridge.wanFromDom("WirelessRepeater");break;case"WirelessBridge":aL=RAINIER.applets.connectivity.bridge.wanFromDom("WirelessBridge");break}F(aL.wan);aK.wan=aL.wan;delete aK.wan["mtu-type"];var aJ=RAINIER.binder.fromDom($("#internet-connection"),aG);aK.wan.wanType=aH;if($('select[name="wan.mtu-type"]').val()==="auto"){aK.wan.mtu=0}else{aK.wan.mtu=aJ.wan.mtu}aK.wan.toJSON=j;return aK.wan}function an(){var aH=RAINIER.binder.fromDom(u,aG);ar.macAddressCloneSettings=aH.macAddressCloneSettings;ar.ipv6=aH.ipv6;if(ar.ipv6.isIPv6AutomaticEnabled){delete ar.ipv6.ipv6rdTunnelMode}if(ar.ipv6.isIPv6AutomaticEnabled||ar.ipv6.ipv6rdTunnelMode!=="Manual"){delete ar.ipv6.ipv6rdTunnelSettings}ar.wan=q();if(!ar.macAddressCloneSettings.isMACAddressCloneEnabled){delete ar.macAddressCloneSettings.macAddress}}function am(){function aJ(){if(E.wan.mtu===0&&u.find('select[name="wan.mtu-type"]').val()==="manual"){return true}else{return false}}var aH=false;an();F(E.wan);if(!ar.wan.domainName){delete E.wan.domainName}if(E.wan.wanType!=="PPPoE"){$.delAttr(E.wan,"wanTaggingSettings")}if(E.wan.wanType==="PPPoE"&&ar.wan.wanType!=="PPPoE"&&Q.router8&&E.wan.wanTaggingSettings){ar.wan.wanTaggingSettings={isEnabled:false}}if(Q.router5&&ar.ipv6.wanType!=="Automatic"){ar.ipv6={wanType:ar.ipv6.wanType}}if(!Q.router5){$.delAttr(ar.ipv6,"wanType")}var aI=(Q.powerModem&&H.powerModem.isPowerModemEnabled)?ak():!$.compare(ar.wan.toJSON(),E.wan.toJSON());if(aI||!$.compare(ar.macAddressCloneSettings,E.macAddressCloneSettings)||!$.compare(ar.ipv6,E.ipv6)||aJ()){aH=true}return aH}function I(){var aH=RAINIER.jnap.Transaction({onComplete:function(){if(!z.doClose){R();W();ae();var aJ="#ip-v6 ",aI=[aJ+'label[name="ipv6.ipv6rdTunnelSettings.prefix"]',aJ+'label[name="ipv6.ipv6rdTunnelSettings.prefixLength"]',aJ+'label[name="ipv6.ipv6rdTunnelSettings.borderRelay"]',aJ+'label[name="ipv6.ipv6rdTunnelSettings.borderRelayPrefixLength"]'];u.find(aI.join(",")).text("");r()}if(z.doSave){if(p){RAINIER.applets.connectivity.bridge.redirectToLSWF(L)}if(a){RAINIER.applets.connectivity.bridge.redirectToBridgeDomain(e(),a)}else{x.onSaveComplete()}}},disableDefaultJnapErrHandler:true,disableDefaultRebootErrHandler:Q.powerModem?false:RAINIER.network.isBridgeMode(e())||L});return aH}function O(){var aJ=false,aH=false,aK="";L=RAINIER.network.isBehindNode()&&E.wan.wanType!==ar.wan.wanType&&(RAINIER.network.isBridgeMode(E.wan.wanType)||RAINIER.network.isBridgeMode(ar.wan.wanType));var aR=I();function aL(aS){z.doSave=false;if(aS.result==="repeater-bridge-error"){RAINIER.ui.hideWaiting();u.find(".connectionError").show()}else{if(aS.result!=="_AjaxError"){if(RAINIER.ui.validation.strings.errors[aS.result]){RAINIER.ui.alert("",RAINIER.ui.validation.strings.errors[aS.result])}else{RAINIER.ajax().executeDefaultJnapErrorHandler(aS,aK)}}}}function aN(aS){aK="/jnap/router/GetWirelessConnectionStatus";RAINIER.jnap.send({action:aK,data:{},cb:function(aU){if(aU.result==="OK"){switch(aU.output.wirelessConnectionState){case"Success":aR.send();return;case"Idle":case"Connecting":if(aS<ay){setTimeout(function(){aN(++aS)},n);return}break;case"Failed":aU.result="repeater-bridge-error";aL(aU);return}var aT=RAINIER.ui.dialog("#wireless-bridge-not-connected");aT.show()}else{if(aU.result==="_AjaxError"){aU.result="repeater-bridge-error"}aL(aU)}}})}if((!Q.powerModem||!H.powerModem.isPowerModemEnabled)&&$.compare(E.wan,ar.wan)===false){aJ=["WirelessBridge","WirelessRepeater"].indexOf(ar.wan.wanType)!==-1;aH=RAINIER.network.isBehindNode()&&["PPPoE","Static"].indexOf(ar.wan.wanType)!==-1&&(RAINIER.shared.util.areServicesSupported(["/jnap/nodes/setup/Setup5"])?RAINIER.shared.util.areServicesSupported(["/jnap/nodes/setup/SelectableWAN"]):true);a=null;aK=RAINIER.jnapActions.setWANSettings();aR.add({action:aK,data:ar.wan,cb:function(aS){if(aS.result==="OK"){E.wan=$.extend(true,{},ar.wan);RAINIER.network.setCurrentWanSettings(E.wan);a=(aS.output)?aS.output.redirection:null;if(u.find("#domainName-input").is(":visible")){E.wan.domainName=u.find('#domainName-input > input[name="domainName"]').val();u.find('#domainName-label > label[name="wan.domainName"]').text(E.wan.domainName)}}else{aL(aS)}}});var aP=$.extend(true,{},E.wireless);if(ar.wan.wanType==="WirelessBridge"&&aP.bandSteeringMode==="TriBand"){aK=RAINIER.jnapActions.setRadioSettings();RAINIER.applets.wireless.scrubForSave(aP);aP.bandSteeringMode="Basic";aR.add({action:aK,data:aP,cb:function(aS){if(aS.result!=="OK"){aL(aS)}}})}if(RAINIER.network.isBridgeMode(ar.wan.wanType)&&RAINIER.network.isRemoteSettingSupported()){aK="/jnap/ui/SetRemoteSetting";aR.add({action:aK,data:{isEnabled:false},cb:function(aS){if(aS.result!=="OK"){aL(aS)}}})}}if(!$.compare(E.macAddressCloneSettings,ar.macAddressCloneSettings)){aK="/jnap/router/SetMACAddressCloneSettings";aR.add({action:aK,data:ar.macAddressCloneSettings,cb:function(aS){if(aS.result==="OK"){E.macAddressCloneSettings=$.extend(true,{},ar.macAddressCloneSettings)}else{aL(aS)}}})}else{}if(!$.compare(E.ipv6,ar.ipv6)){var aO=$.extend(true,{},ar.ipv6);if(Q.router5){if(aO.wanType==="Automatic"){aO={wanType:aO.wanType,ipv6AutomaticSettings:_.omit(aO,"wanType")}}else{aO={wanType:aO.wanType}}}else{delete aO.wanType}aK=RAINIER.jnapActions.setIPv6Settings();aR.add({action:aK,data:aO,cb:function(aS){if(aS.result==="OK"){E.ipv6=$.extend(true,{},ar.ipv6)}else{aL(aS)}}})}if(Q.powerModem&&H.powerModem.isPowerModemEnabled&&$.compare(ar.powerModem,H.powerModem)===false){aR.add(aq(ar.powerModem))}RAINIER.ui.showWaiting();function aI(){aK="/jnap/router/InitiateWirelessConnection";RAINIER.jnap.send({action:aK,data:{wirelessModeSettings:ar.wan.wirelessModeSettings},cb:function(aS){if(aS.result==="OK"){setTimeout(function(){aN(0)},n)}else{aL(aS)}}})}if(aH){function aQ(aS){aK="/jnap/nodes/setup/SetWANPort";RAINIER.ui.showWaiting();RAINIER.jnap.send({action:aK,data:aS,cb:function(aT){if(aT.result==="OK"){if(aJ){aI()}else{aR.send()}}else{aL(aT)}}})}function aM(){aK="/jnap/nodes/setup/GetPortConnectionStatus";RAINIER.jnap.send({action:aK,data:{},cb:function(aX){if(aX.result==="OK"){var aS=lodash.filter(aX.output.portConnectionStatus,{connectionState:"Connected"});if(!aS.length){aB({msg:J.find("#noEthernetPorts").html(),cancel:RAINIER.ui.button.strings.ok,hideSubmit:true})}else{if(aS.length===1){aQ({portId:aS[0].portId})}else{var aW=$("#twoEthernetPorts"),aV=RAINIER.ui.dialog(aW,{width:685}),aU=RAINIER.network.getBaseNetworkModelNumber(),aT;if(aU){aT=aW.find("#port-left").attr("src").replace("WHW03",aU);aW.find("#port-left").attr("src",aT);aT=aW.find("#port-right").attr("src").replace("WHW03",aU);aW.find("#port-right").attr("src",aT);if(["WHW01","WHW01B","MX5300","MX5400"].indexOf(aU)>-1){aW.find(".velop-senior").hide();aW.find(".velop-junior").show()}}aV.show();aW.find("table").unbind("click").click(function(){var aY=$(this).attr("id")==="portPowerSwitch"?0:1;aV.close();aQ({portId:aY})})}}}else{aL(aX)}}})}aM()}else{if(aJ){aI()}else{aR.send()}}return true}function y(){var aK=false,aJ=RAINIER.network.isBridgeMode(D.val()),aI=RAINIER.network.isBridgeMode(E.wan.wanType);p=aI&&!aJ;function aH(){u.find(".connectionError").hide();if(RAINIER.network.isBehindNode()&&D.val()==="Bridge"){if(E.homeKitSettings.isPaired){RAINIER.ui.dialog("#nodes-homekit-bridgemode-warning-dialog",{width:685}).show()}else{RAINIER.ui.dialog("#nodes-bridgemode-warning-dialog",{onSubmit:O,width:685}).show()}}else{var aL={msg:RAINIER.applets.connectivity.bridge.dialogWarning(ar.wan),onSubmit:O,cancel:RAINIER.ui.button.strings.cancel,css:{width:565}};if(D.val()==="WirelessBridge"){aL.submit=RAINIER.ui.button.strings.wirelessBridge}else{if(D.val()==="WirelessRepeater"){aL.submit=RAINIER.ui.button.strings.wirelessRepeater}}aB(aL)}}if(am()){aK=true;if(X()){if(RAINIER.network.isAuthorityRemote()&&aJ){aB({msg:$("#internet-settings-warning-dialog").html(),onSubmit:aH})}else{if(RAINIER.network.isBehindNode()&&E.wan.wanType==="Bridge"){RAINIER.ui.dialog("#disable-bridgemode-warning-dialog",{onSubmit:O,width:685}).show()}else{if(RAINIER.network.isAuthorityRemote()){aB({msg:$("#internet-settings-warning-dialog").html(),onSubmit:O})}else{if(aJ){aH()}else{O()}}}}}}return aK}function l(){R();W();r();ae()}function s(){Q.powerModem=RAINIER.network.isPowerModemSupported();Q.router3=RAINIER.shared.util.areServicesSupported(["/jnap/router/Router3"]);Q.router5=RAINIER.shared.util.areServicesSupported(["/jnap/router/Router5"]);Q.router8=RAINIER.shared.util.areServicesSupported(["/jnap/router/Router8"]);Q.router10=RAINIER.shared.util.areServicesSupported(["/jnap/router/Router10"]);J=$("#connectivity-applet");u=J.find("#internet-settings");D=J.find("#wanType");if(Q.powerModem){U()}M={basic:J.find("#basic-tab"),basicDiv:J.find("#basic"),localNetwork:J.find("#localnetwork-tab"),advancedrouting:J.find("#advancedrouting-tab"),administration:J.find("#administration-tab"),vlantagging:J.find("#vlantagging-tab"),powerModem:J.find("#powerModem-tab")};c($("#Static .ipv4-form"),"wan.staticSettings");c($("#PPTP .ipv4-form"),"wan.tpSettings.staticSettings","_pptp-manual");c($("#Bridge .ipv4-form"),"wan.bridgeSettings.staticSettings","_bridge-manual");if(!Q.router8){J.find("#wanTaggingSettings").remove()}RAINIER.ui.tooltip.add(u.find("[tooltip]"))}function c(aL,aK,aI,aH){var aJ=J.find("#ipv4-form-template > div").clone();aJ.find("[name]").each(function(){var aM=$(this);aM.attr("name",aK+"."+aM.attr("name"))});if(aI){aJ.addClass(aI)}if(aH){aJ.css(aH)}aJ.insertAfter(aL);aL.remove()}function j(){var aH=$.extend(true,{},this);if(aH.staticSettings&&aH.staticSettings.subnetMask){delete aH.staticSettings.subnetMask}if(aH.bridgeSettings&&aH.bridgeSettings.staticSettings&&aH.bridgeSettings.staticSettings.subnetMask){delete aH.bridgeSettings.staticSettings.subnetMask}if(aH.tpSettings&&aH.tpSettings.staticSettings&&aH.tpSettings.staticSettings.subnetMask){delete aH.tpSettings.staticSettings.subnetMask}if(aH.domainName){delete aH.domainName}if(Q.router10&&aH.wanTaggingSettings){delete aH.wanTaggingSettings.vlanLowerLimit;delete aH.wanTaggingSettings.vlanUpperLimit}return aH}function aA(){var aH=u.find("#ipv6WanType");aH.find("option").remove();$.each(E.wanStatus.supportedIPv6WANTypes,function(aI,aK){var aJ="<option></option>";if(aK===E.ipv6.wanType){aJ='<option selected="selected"></option>'}aH.append($(aJ).attr("value",aK).text(RAINIER.ui.common.strings.wanIpv6Type[aK]))})}function ad(){var aH=$("#ipv4-ipv6-combinations");aH.find(".wanTypeCombination").remove();$.each(E.wanStatus.supportedWANCombinations,function(aJ,aK){var aI=aK.wanType;if(aI==="DHCP"){aI+="-Short"}aH.append($('<tr class="wanTypeCombination"><td>'+RAINIER.ui.common.strings.wanType[aI]+"</td><td>"+RAINIER.ui.common.strings.wanIpv6Type[aK.wanIPv6Type]+"</td></tr>"))})}function U(){ag=J.find("#power-modem");aw=u.find("#pmWanType");ah=ag.find("#dsl-settings");RAINIER.jnap.send({action:"/jnap/powermodem/GetDSLSettings",data:{},cb:function(aH){if(aH.result==="OK"){H.powerModem=aH.output}}})}function aq(aH){var aI="/jnap/powermodem/SetDSLSettings";return{action:aI,data:aH,cb:function(aJ){if(aJ.result==="OK"){H.powerModem=$.extend(true,{},ar.powerModem);ae()}else{z.doSave=false;if(aJ.result!=="_AjaxError"){if(RAINIER.ui.validation.strings.errors[aJ.result]){RAINIER.ui.alert("",RAINIER.ui.validation.strings.errors[aJ.result])}else{RAINIER.ajax().executeDefaultJnapErrorHandler(aJ,aI)}}}}}}function t(){function aH(){RAINIER.network.checkInternetConnection(function(aK){var aJ=(new Date()).getTime()-aI;if(aK||aJ>105000){RAINIER.routerInterruptionDialog.close();RAINIER.event.fire("connection.enableCheck");av.onSaveComplete()}else{setTimeout(aH,5000)}},true)}RAINIER.routerInterruptionDialog.show();RAINIER.event.fire("connection.disableCheck");var aI=(new Date()).getTime();setTimeout(aH,5000)}function C(){RAINIER.event.disconnect("router.interruptionCompleted",C);if(!z.doClose){var aH=RAINIER.jnap.Transaction({onComplete:at});s();aD();T(aH);aH.send()}av.onSaveComplete()}function au(){if(K()){var aJ=ar.powerModem,aI="/jnap/powermodem/SetDSLSettings",aH=aJ.isPowerModemEnabled!==H.powerModem.isPowerModemEnabled;if(!aJ.isPowerModemEnabled){delete aJ.dslSettings}console.warn("pmSettingsSave: isPowerModemEnabledChanging, isPowerModemEnabled",aH,aJ.isPowerModemEnabled);RAINIER.ui.showWaiting();RAINIER.jnap.send({action:aI,data:aJ,cb:function(aK){if(aK.result==="OK"){H.powerModem=$.extend(true,{},ar.powerModem);ae();if(aH){RAINIER.event.connect("router.interruptionCompleted",C)}else{t()}}else{z.doSave=false;if(aK.result!=="_AjaxError"){if(RAINIER.ui.validation.strings.errors[aK.result]){RAINIER.ui.alert("",RAINIER.ui.validation.strings.errors[aK.result])}else{RAINIER.ajax().executeDefaultJnapErrorHandler(aK,aI)}}}}})}return true}function d(){var aH={validCharSet:"numeric",minLen:1,maxLen:5,minVal:0,maxVal:65534,isRequired:true},aK={validCharSet:"numeric",minLen:1,maxLen:5,minVal:0,maxVal:255,isRequired:true},aJ={validCharSet:"numeric",minLen:1,maxLen:5,minVal:0,maxVal:65535,isRequired:true},aI={};aI.pcr=m($.extend(true,{},aH,{els:ah.find("#pcr")}));aI.scr=m($.extend(true,{},aH,{els:ah.find("#scr")}));aI.vpi=m($.extend(true,{},aK,{els:ah.find("#vpi")}));aI.vci=m($.extend(true,{},aJ,{els:ah.find("#vci")}));G.powerModem=aI}function ac(aH){switch(aH){case"pcr":return G.powerModem.pcr.isValid(true);case"scr":return G.powerModem.scr.isValid(true);case"vpi":return G.powerModem.vpi.isValid(true);case"vci":return G.powerModem.vci.isValid(true)}}function K(){if(!ag.find("#isPmEnabled").is(":checked")){return true}var aH=ah.find("#qos-type"),aI=true;switch(aH.val()){case"CBR":aI=ac("pcr");break;case"VBR":aI=ac("pcr")&&ac("scr");break}aI=aI&&ac("vpi")&&ac("vci");return aI}function o(){aw.change(k.onPmConnTypeChange);u.find("#edit-ipv4 a").click(function(){u.find("#pm-wan-type-label").hide()});u.find("#displayPmTab a").click(function(){J.find("#powerModem-tab span").trigger("click")});ag.find("#isPmEnabled").change(k.onPmEnableChange).trigger("change");ah.find("#qos-type").change(k.onQoSTypeChange)}function Y(){u.find("#displayPmTab").css("display","block");aF()}function aj(){d();ah.find("input").keyup(function(aH){ac($(aH.target).attr("id"))});ap();al();ah.find("#qos-type").trigger("change")}function aF(){if(RAINIER.network.isAuthorityRemote()){ag.find("input, select").attr("disabled","true")}}function al(){if(H.powerModem.isPowerModemEnabled){var aI=$.extend(true,{},H.powerModem.dslSettings),aH={},aJ={};if(aI){if(aI.staticSettings){aH=aI.staticSettings}if(aI.pppSettings){aJ=aI.pppSettings}switch(aI.wanType){case"2684Bridged":H.wan.bridgeSettings={};H.wan.bridgeSettings.useStaticSettings=!aI.autoDHCP;u.find("#bridge-auto").attr("value",aI.autoDHCP);u.find("#bridge-manual").attr("value",!aI.autoDHCP);if(H.wan.bridgeSettings.useStaticSettings){H.wan.bridgeSettings.staticSettings=aH;H.wan.bridgeSettings.staticSettings.subnetMask=RAINIER.util.fromPrefixLengthToSubnet(aH.networkPrefixLength);RAINIER.binder.toDom(H,$("#Bridge"),aG,null,true);RAINIER.binder.toDom(H.powerModem.dslSettings.staticSettings,$("#domainName-input"));u.find('input[name="wan.bridgeSettings.useStaticSettings"][value="true"]').click()}break;case"2684Routed":case"IPoA":H.wan.staticSettings=aH;H.wan.staticSettings={subnetMask:RAINIER.util.fromPrefixLengthToSubnet(aH.networkPrefixLength)};RAINIER.binder.toDom(H,$("#Static"),aG,null,true);break;case"PPPoA":case"PPPoE":H.wan.pppoeSettings=aJ;RAINIER.binder.toDom(H,$("#PPPoE"),aG,null,true);if(H.wan.pppoeSettings){if(H.wan.pppoeSettings.behavior==="KeepAlive"){delete H.powerModem.dslSettings.pppSettings.maxIdleMinutes}else{delete H.powerModem.dslSettings.pppSettings.reconnectAfterSeconds}u.find("#PPPoE input[value="+H.wan.pppoeSettings.behavior+"]").click()}v("pppoe",["pppoe"]);break}aw.val(aI.wanType).trigger("change");E.wan.mtu=aI.mtu;Z();RAINIER.binder.toDom(H,u.find("#internet-connection fieldset:first"),aG)}}}function ap(){RAINIER.binder.toDom(H,ag.find("#pmTools"),aC);RAINIER.binder.toDom(H,ah,aC);if(H.powerModem.isPowerModemEnabled){var aH=H.powerModem.dslSettings;k.onShowPmSections();if(aH){ah.find("#qos-type").val(aH.qosType).trigger("change");ah.find("#dsl_modulation").val(aH.modulation);if(aH.qosType==="UBR"){delete H.powerModem.dslSettings.pcr;delete H.powerModem.dslSettings.scr}else{if(aH.qosType==="CBR"){delete H.powerModem.dslSettings.scr}}}}else{k.onHidePmSections();ah.find('input[type="text"]').val("")}}function h(){function aM(aO){var aN=u.find('#domainName-input > input[name="domainName"]').val();if(aN!==""){aO.domainName=aN}}function aI(aN){if(aN.dnsServer2==="0.0.0.0"){delete aN.dnsServer2}if(aN.dnsServer3==="0.0.0.0"){delete aN.dnsServer3}}var aH=aw.val();var aL={},aK={wan:{}};switch(aH){case"2684Bridged":aL=RAINIER.binder.fromDom($("#Bridge"),aG);aL.wan.bridgeSettings.useStaticSettings=u.find('#Bridge input[name="wan.bridgeSettings.useStaticSettings"]:checked').attr("id").contains("manual");if(aL.wan.bridgeSettings.useStaticSettings){aM(aL.wan.bridgeSettings.staticSettings)}if(!aL.wan.bridgeSettings.useStaticSettings){delete aL.wan.bridgeSettings.staticSettings}else{aL.wan.bridgeSettings.staticSettings.networkPrefixLength=RAINIER.util.fromSubnetToPrefixLength(aL.wan.bridgeSettings.staticSettings.subnetMask);aI(aL.wan.bridgeSettings.staticSettings);delete aL.wan.bridgeSettings.staticSettings.subnetMask}break;case"2684Routed":case"IPoA":aL=RAINIER.binder.fromDom($("#Static"),aG);aM(aL.wan.staticSettings);aI(aL.wan.staticSettings);aL.wan.staticSettings.networkPrefixLength=RAINIER.util.fromSubnetToPrefixLength(aL.wan.staticSettings.subnetMask);delete aL.wan.staticSettings.subnetMask;break;case"PPPoA":case"PPPoE":aL=RAINIER.binder.fromDom($("#PPPoE"),aG);break}F(aL.wan);aK.wan=aL.wan;delete aK.wan["mtu-type"];var aJ=RAINIER.binder.fromDom($("#internet-connection"),aG);aK.wan.wanType=aH;aK.wan.mtu=$('select[name="wan.mtu-type"]').val()==="auto"?0:aJ.wan.mtu;return aK.wan}function aE(){var aI=RAINIER.binder.fromDom(J.find("#pmTools, #dsl-settings"),aC),aH=h();ar.powerModem=aI.powerModem;ar.powerModem.dslSettings.qosType=ah.find("#qos-type").val();if(ar.powerModem.dslSettings.qosType==="UBR"){delete ar.powerModem.dslSettings.pcr;delete ar.powerModem.dslSettings.scr}else{if(ar.powerModem.dslSettings.qosType==="CBR"){delete ar.powerModem.dslSettings.scr}}ar.powerModem.dslSettings.modulation=ah.find("#dsl_modulation").val();ar.powerModem.dslSettings.wanType=aH.wanType;ar.powerModem.dslSettings.mtu=aH.mtu;if(!ar.powerModem.isPowerModemEnabled){delete ar.powerModem.dslSettings}else{if(!H.powerModem.isPowerModemEnabled){if("PPPoE"===E.wan.wanType){ar.powerModem.dslSettings.wanType=E.wan.wanType;ar.powerModem.dslSettings.pppSettings=E.wan.pppoeSettings}else{if("Bridge"===E.wan.wanType){ar.powerModem.dslSettings.wanType="2684Bridged";ar.powerModem.dslSettings.autoDHCP=!E.wan.bridgeSettings.useStaticSettings;if(ar.powerModem.dslSettings.autoDHCP){ar.powerModem.dslSettings.staticSettings=E.wan.bridgeSettings.staticSettings}}else{ar.powerModem.dslSettings.wanType="2684Bridged";ar.powerModem.dslSettings.autoDHCP=true}}}else{switch(aH.wanType){case"2684Bridged":ar.powerModem.dslSettings.autoDHCP=!aH.bridgeSettings.useStaticSettings;if(aH.bridgeSettings.useStaticSettings){ar.powerModem.dslSettings.staticSettings=aH.bridgeSettings.staticSettings}break;case"2684Routed":case"IPoA":ar.powerModem.dslSettings.staticSettings=aH.staticSettings;break;case"PPPoA":case"PPPoE":ar.powerModem.dslSettings.pppSettings=aH.pppoeSettings;break}}}}function ak(){var aH=false;aE();F(H.wan);if($.compare(ar.powerModem,H.powerModem)!==true){aH=true}return aH}function ae(){if(Q.powerModem){ap();al()}}return{events:x,pageLoad:s,internetSettingsPreInit:T,internetSettingsInit:at,initializeInternetSettingsDefaultInputValues:af,internetSettingsAddEvents:aD,internetSettingsHasChanges:am,powerModemHasChanges:ak,resetTabChanges:l,resetPowerModemChanges:ae,save:y,pmSettingsSave:au}}());