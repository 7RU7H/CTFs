(function(){var au=$("#wireless-applet"),d=au.find("#wireless"),bp=au.find("#filter-list"),Q=au.find("#wps"),w=au.find("#scheduler"),aI=w.find(".currentTime span"),C=au.find("#ssid-broadcast-warning"),bo=au.find("#no-ssid-broadcast-warning"),W=au.find("#wps-popup"),aD=au.find("#advanced"),q=null,bi=null,aa=false,bd={macAddress:""},t=32,ae=5*1000,br=null,a5=null,bg=null,L=null,K=null,ay=null,k=null,ax=null,l=false,g=true,u=true,p=null,aX=500,ag=null,a8=null,aN=false,ar=false,m=false,at=false,D=true,B=RAINIER.ui.buildInputValidBalloon,Z=RAINIER.network.isBehindNode()&&window.location.hash!=="#casupport";var aA={serverAvailable:true};var ad=RAINIER.ui.template.createTemplate(au.find("#templateFilterRow tr")),N=RAINIER.ui.template.createTemplate(au.find("#template-radio-config-box > div")),ba="div.radio-config-box";var af={firewall:{},wireless:{radios:[]},wps:{},clientPIN:"",serverPIN:"",filters:[],guestSettings:{},simpletap:{},wan:{},scheduler:{},atf:{},topologyOptimization:{},homeKitSettings:{}};var a9={firewall:{},wireless:{radios:[]},setWireless:[],filters:[],filterList:[],simpletap:{},scheduler:{},atf:{},topologyOptimization:{}};var c=["Auto","Standard","Wide","Wide80"];var bs={"wan.tpSettings.useStaticSettings":"boolean","wan.bridgeSettings.useStaticSettings":"boolean","wan.useStaticSettings":"boolean","wan.tpSettings.maxIdleMinutes":"number","wan.tpSettings.reconnectAfterSeconds":"number","wan.L2TPSettings.maxIdleMinutes":"number","wan.L2TPSettings.reconnectAfterSeconds":"number","wan.pppoeSettings.maxIdleMinutes":"number","wan.pppoeSettings.reconnectAfterSeconds":"number","settings.broadcastSSID":"boolean","settings.channel":"number","settings.wpaEnterpriseSettings.radiusPort":"number","settings.wepSettings.txKey":"number","wps.enabled":"boolean","simpletap.isSetupVAPEnabled":"boolean","labels.short":"display-only","labels.band":"display-only","labels.network":"display-only","labels.networkName":"display-only","labels.wirelessSettings":"display-only","wireless.combineNetworks":"boolean","topologyOptimization.isClientSteeringEnabled":"boolean","topologyOptimization.isNodeSteeringEnabled":"boolean"};var al={};var O={onToggleWidget:function(){RAINIER.connect.AppletManager.toggleWidgetShowState("7B1F462B-1A78-4AF6-8FBB-0C221703BEA4","7C8E2909-A0EF-48E7-A7BD-F615059F510C")},onEditFilter:function(bt){var bu=$(bt);$(this).parents("tr").addClass("edit");$(this).parents("tr").removeClass("hover");bu.find(".text-mac").val(bu.find(".mac").text());a1(bu)},onDelFilter:function(bu){var bt=bu.index()-1;a9.filterList.splice(bt,1);$(bu).hide();$(bu).remove();bm()},onUpdFilter:function(bu){var bt=bu.index()-1,bv=$(bu),bw=$.trim(bv.find(".text-mac").val());if(i(bu)){if(bw){a9.filterList[bt]=bw;bv.find(".mac").text(bw);bv.removeClass("edit")}else{a9.filterList.splice(bt,1);bv.remove()}}},onCancelFilter:function(bu){var bt=bu.index()-1,bv=a9.filterList[bt];$(bu).removeClass("edit");if(bv===""){a9.filterList.splice(bt,1);$(bu).hide();$(bu).remove()}else{$(bu).find(".mac").text(bv)}RAINIER.ui.inputBalloon.hide()},onClose:function(){RAINIER.ui.MainMenu.closeApplet()},onApply:function(){S(false)},onSave:function(){S(true)},onSaveComplete:function(bt){if(bt===undefined){bt=true}if(bt){RAINIER.ui.hideWaiting()}if(u){if(g){O.onClose()}else{if(l){ax.click()}}}}};var v={macfiltering:false,simpletap:false,scheduler:false};var aB={macfiltering:au.find("#wireless-disabled-features #mac-filtering-tab"),simpletap:au.find("#wireless-disabled-features #simpletap-tab"),scheduler:au.find("#wireless-disabled-features #scheduler-tab"),advanced:au.find("#wireless-disabled-features #advanced-tab")};var aG={macfiltering:au.find("#wireless-disabled-features #mac-filtering"),simpletap:au.find("#wireless-disabled-features #simpletap"),scheduler:au.find("#wireless-disabled-features #scheduler"),advanced:au.find("#wireless-disabled-features #advanced")};function S(bu){var bt=false;g=bu||false;u=true;switch(ay){case"wireless":if(a3()){bt=true;if(aw()){return aT()}}break;case"mac-filtering":if(ak()){bt=true;if(aL()){bc()}}break;case"wps":if(M()){bt=true;e()}break;case"simpletap":if(G()){bt=true;if(aP()){az()}}break;case"scheduler":if(ah()){bt=true;RAINIER.network.getRouterCurrentTime(function(bv){var bw=RAINIER.blockScheduler.getCurrentTimeCell(bv);if(bw.className==="checked"){RAINIER.ui.dialogWarning({msg:au.find("#confirm-wireless-scheduler-disabled").text(),onSubmit:aV})}else{aV()}})}break;case"advanced":if(j()){bt=true;if(bb()){aH()}}break}if(g&&!bt){O.onClose()}return true}function aF(){var bt=false;switch(K){case"wireless":bt=a3();break;case"mac-filtering":bt=ak();break;case"wps":bt=M();break;case"simpletap":bt=G();break;case"scheduler":bt=ah();break;case"advanced":bt=j();break}if(bt){ay=K;bg.show()}return bt}function z(){switch(ay){case"wireless":U();break;case"mac-filtering":aZ();break;case"wps":a7();break;case"simpletap":ap();break;case"scheduler":aK();break;case"advanced":aJ();break}}function X(bt){var bu=false;$.each(bt.supportedModes,function(bv,bw){if(bw.indexOf("ac")!==-1){bu=true;return false}});return bu}function aj(bv,bt){var bu={"802.11a":"#wireless-mode-a","802.11an":"#wireless-mode-an","802.11anac":"#wireless-mode-anac","802.11anacax":"#wireless-mode-anacax","802.11b":"#wireless-mode-b","802.11bg":"#wireless-mode-bg","802.11bgn":"#wireless-mode-bgn","802.11bgnax":"#wireless-mode-bgnax","802.11g":"#wireless-mode-g","802.11n":"#wireless-mode-n","802.11ac":"#wireless-mode-ac","802.11mixed":"#wireless-mode-mixed"};if(symmetryUtil.wireless.isMixedMode(bv,bt)){return'<option value="'+bv+'">'+au.find("#wireless-mode-mixed").text()+"</option>"}if(!bu[bv]){return'<option value="'+bv+'">'+bv+"</option>"}return'<option value="'+bv+'">'+au.find(bu[bv]).text()+"</option>"}function Y(bu,bt){$.each(bt.supportedModes.reverse(),function(bv,bw){bu.append(aj(bw,bt))})}function be(bu,bt){$.each(bt.supportedSecurityTypes,function(bv,bw){bu.append('<option value="'+bw+'">'+RAINIER.ui.common.strings.wirelessSecurity[bw]+"</option>")})}function R(bt,bu){function bv(bx){var bw=null;switch(bx){case"Auto":bw=au.find("#channel-width-auto").text();break;case"Standard":bw=au.find("#channel-width-standard").text();break;case"Wide":bw=au.find("#channel-width-wide").text();break;case"Wide80":bw=au.find("#channel-width-wide80").text();break;case"Wide160c":bw=au.find("#channel-width-wide160c").text();break;case"Wide160nc":bw=au.find("#channel-width-wide160nc").text();break;default:bw="Not Found";break}return bw}if(RAINIER.shared.util.areServicesSupported(["/jnap/wirelessap/WirelessAP4"])){$.each(bu.supportedChannelsForChannelWidths,function(){bt.append('<option value="'+this.channelWidth+'">'+bv(this.channelWidth)+"</option>")})}else{$.each(c,function(bw,bx){if(bu.band==="2.4GHz"&&bx.indexOf("Wide")!==-1){return}if(bu.band==="5GHz"&&!X(bu)&&bx==="Wide80"){return}bt.append('<option value="'+bx+'">'+bv(bx)+"</option>")})}}function aq(bt){bt.add({action:RAINIER.jnapActions.getRadioInfo(),data:{},cb:function(bv){var bu=d.find("#radio-list");af.radio=bv.output||{};if(bv.result==="OK"){af.wireless=af.radio;a9.wireless=$.extend(true,{},af.wireless);RAINIER.applets.wireless.sortRadios(af.wireless.radios);$.each(af.wireless.radios,function(){var bw=RAINIER.shared.util.getLabeledRadio(af.wireless,this.radioID),bx;bw.supportedSecurityTypes=symmetryUtil.wireless.getSecurityTypeOrder(bw.supportedSecurityTypes);bx=RAINIER.ui.template.createBlock(N,bw,bs);bx.attr("id",bw.radioID);bx.addClass(bw.band);bx.data("jnap",bw);Y(bx.find(".w-network-mode"),bw);be(bx.find(".w-security"),bw);aE(bx.find(".w-channel"),bw);R(bx.find(".w-channel-width"),bw);if(bw.band==="5GHz"&&af.wireless.isBandSteeringEnabled){bx.find(".w-channel-label, .w-channel-width-label, .w-network-mode-label").text(RAINIER.ui.common.strings.auto)}aU(bx);bu.append(bx)});if(af.wireless.supportedBandSteeringModes&&af.wireless.radios.length>1){au.find("#band-steering-selection").show();au.find("#band-steering-selection .w-steering-basic span").html(RAINIER.ui.shared.strings.bandSteering.Basic["short"]);au.find(".w-band-steer-only, .w-no-band-steer-only").hide()}else{au.find(".w-band-steer-only").hide()}if(RAINIER.applets.wireless.isTriBandSteeringSupported()){au.find("#band-steering-selection").addClass("triBandSteeringSupported");au.find("#band-steering-selection .w-steering-triBand span").html(RAINIER.ui.shared.strings.bandSteering.TriBand["short"]);au.find(".triBandSteering").show()}if(Z){af.wireless.combineNetworks=RAINIER.applets.wireless.areAllRadioSettingsIdentical(af.wireless.radios);bu.find("#RADIO_5GHz_2").hide()}if(window.location.hash==="#casupport"){d.find(".showForLinksysRouters").removeClass("showForLinksysRouters");d.find(".showForNodes").hide()}}}});bt.add({action:RAINIER.jnapActions.getWANStatus(),data:{},cb:function(bu){if(bu.result==="OK"){if(bu.output){af.wan=bu.output}else{}}else{}}});bt.add({action:RAINIER.jnapActions.getWANSettings(),data:{},cb:function(bu){if(bu.result==="OK"){af.wanSettings=bu.output}else{}}});RAINIER.applets.guestNetwork.getSettings(af.guestSettings,function(bu){af.guestSettings=$.extend({},bu)},bt);if(RAINIER.shared.util.areServicesSupported(["/jnap/homekit/HomeKit"])){bt.add({action:"/jnap/homekit/GetHomeKitSettings",data:{},cb:function(bu){if(bu.result==="OK"){af.homeKitSettings=bu.output||{}}else{}}})}}function E(bt){if(bt.combineNetworks){d.find('h2[name="labels.band"]').hide();d.find("h2.tri-band").show();d.find("#RADIO_5GHz").hide();if(af.homeKitSettings.isPaired){d.find("#homekit-combine-radios-note").show()}else{d.find("#show-more").show()}}else{d.find('h2[name="labels.band"]').show();d.find("h2.tri-band").hide();d.find("#RADIO_5GHz, #make-all-the-same").show()}}function U(){var bu=null,bt=$.extend(true,{},af.wireless);if(Z){var bv=d.find("#velop-content");d.find(".radio-link").hide();E(bt);RAINIER.binder.toDom({wireless:bt},bv,bs)}if(RAINIER.network.getCurrentWanType()==="WirelessBridge"){if(af.wanSettings.wirelessModeSettings.band==="5GHz"){d.find("#band-steering-selection").hide()}else{d.find(".triBandSteering").hide()}}$.each(af.wireless.radios,function(){var bw=this;bu=d.find("#"+RAINIER.ui.escapeId(bw.radioID));bw=RAINIER.shared.util.getLabeledRadio(bt,bw.radioID);bu.data("jnap",bw);RAINIER.binder.toDom(bw,bu,bs);if(RAINIER.network.isRadioLocked(bw.band)){bu.find(".radio-blocked").show();bu.find(".radio-settings").hide()}F(bu,true);r.call(bu);if(af.homeKitSettings.isPaired){bu.find(".w-security, .w-network-mode").prop("disabled",true)}});if(af.wireless.supportedBandSteeringModes&&!af.wireless.isBandSteeringEnabled){af.wireless.bandSteeringMode="Off"}RAINIER.binder.toDom(af,d,bs);D=false}function bj(){var bu=null;RAINIER.util.trapEnter(d.find("input[type=text]"));d.find(".w-wep-generate-keys").click(y);if(af.wireless.supportedBandSteeringModes){au.find("#band-steering-selection input").change(function(){if($(this).is(":checked")){var bv=$.extend(true,{},af.wireless);bv.bandSteeringMode=$(this).val();au.find(".w-network-mode.val-el").each(function(){r.call(this)});aw();bv.isBandSteeringEnabled=af.wireless.supportedBandSteeringModes.indexOf(bv.bandSteeringMode)>-1;if(!bv.isBandSteeringEnabled){$.delAttr(bv,"bandSteeringMode")}function bw(by,bA){var bz=RAINIER.shared.util.getLabeledRadio(bv,bA),bx={labels:bz.labels};if(bv.isBandSteeringEnabled&&symmetryUtil.wireless.isPrimaryBandSteeredRadio(bv,bz)){by.find(".w-band-steer-only").show();by.find(".w-no-band-steer-only").hide();by.find(".w-channel-label, .w-channel-width-label, .w-network-mode-label").text(RAINIER.ui.common.strings.auto);bx.settings=RAINIER.applets.wireless.getBandSteeringDefaults(bz).settings}else{by.find(".w-band-steer-only").hide();by.find(".w-no-band-steer-only").show()}RAINIER.binder.toDom(bx,by,bs);if(bv.bandSteeringMode==="TriBand"){by.find('h2[name="labels.band"]').hide();by.find("h2.tri-band").show();by.find('.radio-label[name="labels.band"]').hide();by.find(".radio-label.tri-band").show()}else{by.find('h2[name="labels.band"]').show();by.find("h2.tri-band").hide();by.find('.radio-label[name="labels.band"]').show();by.find(".radio-label.tri-band").hide()}}$.each(af.wireless.radios,function(){var bx=d.find("#"+RAINIER.ui.escapeId(this.radioID));if(RAINIER.applets.wireless.shouldFilterRadio(this,bv)){bw(bx,this.radioID);bx.show()}else{bx.hide()}})}})}if(Z){function bt(bw){var bv=$.extend(true,{},af.wireless),bx=d.find("#velop-content");bv.combineNetworks=bw;RAINIER.binder.toDom({wireless:bv},bx,bs);E(bv);if(bw){d.find("#RADIO_5GHz, .radio-link").hide();d.find("#show-more").show()}else{d.find(".radio-link").hide();d.find("#RADIO_5GHz, #show-less").show()}$.each(af.wireless.radios,function(){var bz=d.find("#"+RAINIER.ui.escapeId(this.radioID)),bA=RAINIER.shared.util.getLabeledRadio(bv,this.radioID),by={labels:bA.labels};RAINIER.binder.toDom(by,bz,bs)})}au.find("#show-less, #make-all-the-same").click(function(){bt(true)});au.find("#show-more").click(function(){bt(false)})}au.find("#band-steering-selection input").change();$.each(af.wireless.radios,function(){var bv=d.find("#"+RAINIER.ui.escapeId(this.radioID));bv.find(".w-security").change(function(bw){if(bw.originalEvent){F(bv)}})})}function r(){var bt={"settings.security":["settings.mode","settings.channelWidth","settings.channel"],"settings.mode":["settings.security","settings.channelWidth","settings.channel"],"settings.channelWidth":["settings.channel","settings.security","settings.mode"],"settings.channel":["settings.security","settings.mode","settings.channelWidth"]},bv={"settings.security":function(){var bE=$(this),bz=bE.parents(ba),bC=bz.find(".w-network-mode"),bF=bC.val(),bA=bz.find(".w-channel-width"),bD=bA.val(),bB=RAINIER.shared.util.getLabeledRadio(af.wireless,bz.attr("id")),by=d.find('input[name="wireless.bandSteeringMode"]:checked').val()||af.wireless.bandSteeringMode;$.each(bE.find("option"),function(){var bG=$(this);bG.removeClass();bG.removeData("why-invalid");bG.removeData("why-invalid-el");if((bF.indexOf("n")>-1||bF.indexOf("ac")>-1)&&$.inArray(bG.attr("value"),["WEP","WPA-Mixed-Personal","WPA-Mixed-Enterprise"])>-1){if(!symmetryUtil.wireless.isMixedMode(bF,RAINIER.applets.wireless.getRadioFromSet(af.wireless,bz.attr("id")))){bG.addClass("invalid-option");bG.data("why-invalid",bC.find(":selected").text());bG.data("why-invalid-el",bC)}}if(bG.attr("value")==="WEP"&&bD.indexOf("Wide")!==-1){bG.addClass("invalid-option");bG.data("why-invalid",bA.find(":selected").text());bG.data("why-invalid-el",bA)}if(bG.attr("value")==="WEP"&&symmetryUtil.wireless.isPrimaryBandSteeredRadio({bandSteeringMode:by},bB)){bG.addClass("invalid-option");if(by==="TriBand"){bG.data("why-invalid",RAINIER.ui.shared.strings.bandSteering.TriBand["short"]);bG.data("why-invalid-el",au.find("#triBandSteeringEnabled"))}else{bG.data("why-invalid",RAINIER.ui.shared.strings.bandSteering.Basic["short"]);bG.data("why-invalid-el",au.find("#basicBandSteeringEnabled"))}}bw(bG)})},"settings.mode":function(){var bC=$(this),by=bC.parents(ba),bA=by.find(".w-security"),bD=bA.val(),bz=by.find(".w-channel-width"),bB=bz.val();$.each(bC.find("option"),function(){var bE=$(this);bE.removeClass();bE.removeData("why-invalid");bE.removeData("why-invalid-el");if(symmetryUtil.wireless.isMixedMode(bE.attr("value"),RAINIER.applets.wireless.getRadioFromSet(af.wireless,by.attr("id")))){return}if((bE.attr("value").indexOf("n")>-1||bE.attr("value").indexOf("ac")>-1)&&$.inArray(bD,["WEP","WPA-Mixed-Personal","WPA-Mixed-Enterprise"])>-1){bE.addClass("invalid-option");bE.data("why-invalid",bA.find(":selected").text());bE.data("why-invalid-el",bA)}if(bE.attr("value").indexOf("ac")===-1&&(bB==="Wide80"||bB.indexOf("Wide160")!==-1)){bE.addClass("invalid-option");bE.data("why-invalid",bz.find(":selected").text());bE.data("why-invalid-el",bz)}if(bE.attr("value")==="802.11a"&&bB.indexOf("Wide")!==-1){bE.addClass("invalid-option");bE.data("why-invalid",bz.find(":selected").text());bE.data("why-invalid-el",bz)}bw(bE)})},"settings.channelWidth":function(){var bC=$(this),by=bC.parents(ba),bE=by.find(".w-security"),bA=bE.val(),bG=by.find(".w-network-mode"),bB=bG.val(),bD=by.find(".w-channel"),bF=+bD.val(),bz=RAINIER.applets.wireless.getRadioFromSet(af.wireless,by.attr("id"));$.each(bC.find("option"),function(){var bI=$(this),bH;bI.removeClass();bI.removeData("why-invalid");bI.removeData("why-invalid-el");if(bI.attr("value").indexOf("Wide")!==-1&&(bB==="802.11a"||bA==="WEP")){bI.addClass("invalid-option");if(bB==="802.11a"){bI.data("why-invalid",bG.find(":selected").text());bI.data("why-invalid-el",bG)}else{bI.data("why-invalid",bE.find(":selected").text());bI.data("why-invalid-el",bE)}}if((bI.attr("value")==="Wide80"||bI.attr("value").indexOf("Wide160")!==-1)&&bB.indexOf("ac")===-1){bI.addClass("invalid-option");bI.data("why-invalid",bG.find(":selected").text());bI.data("why-invalid-el",bG)}if(RAINIER.shared.util.areServicesSupported(["/jnap/wirelessap/WirelessAP4"])){bH=$.inArray(bF,$.grep(bz.supportedChannelsForChannelWidths,function(bJ){return bJ.channelWidth===bI.attr("value")})[0].channels);if(bH===-1){bI.addClass("invalid-option");bI.data("why-invalid",bD.find(":selected").text());bI.data("why-invalid-el",bD)}}else{if(bI.attr("value")==="Auto"&&$.inArray(bF,RAINIER.applets.wireless.getCommonChannels(bz.supportedChannels,bz.supportedWideChannels))===-1){bI.addClass("invalid-option");bI.data("why-invalid",bD.find(":selected").text());bI.data("why-invalid-el",bD)}else{if(bI.attr("value")==="Standard"&&$.inArray(bF,bz.supportedChannels)===-1){bI.addClass("invalid-option");bI.data("why-invalid",bD.find(":selected").text());bI.data("why-invalid-el",bD)}else{if(bI.attr("value").indexOf("Wide")>-1&&$.inArray(bF,bz.supportedWideChannels)===-1){bI.addClass("invalid-option");bI.data("why-invalid",bD.find(":selected").text());bI.data("why-invalid-el",bD)}}}}bw(bI)})},"settings.channel":function(){var bC=$(this),by=bC.parents(ba),bz=by.find(".w-channel-width"),bB=bz.val(),bA=RAINIER.applets.wireless.getRadioFromSet(af.wireless,by.attr("id"));$.each(bC.find("option"),function(){var bE=$(this),bF=Number(bE.attr("value")),bD;bE.removeClass();bE.removeData("why-invalid");bE.removeData("why-invalid-el");if(RAINIER.shared.util.areServicesSupported(["/jnap/wirelessap/WirelessAP4"])){bD=$.inArray(bF,$.grep(bA.supportedChannelsForChannelWidths,function(bG){return bG.channelWidth===bB})[0].channels);if(bD===-1){bE.addClass("invalid-option");bE.data("why-invalid",bz.find(":selected").text());bE.data("why-invalid-el",bz)}}else{if(bB==="Auto"&&$.inArray(bF,RAINIER.applets.wireless.getCommonChannels(bA.supportedChannels,bA.supportedWideChannels))===-1){bE.addClass("invalid-option");bE.data("why-invalid",bz.find(":selected").text());bE.data("why-invalid-el",bz)}else{if(bB==="Standard"&&$.inArray(bF,bA.supportedChannels)===-1){bE.addClass("invalid-option");bE.data("why-invalid",bz.find(":selected").text());bE.data("why-invalid-el",bz)}else{if(bB.indexOf("Wide")>-1&&$.inArray(bF,bA.supportedWideChannels)===-1){bE.addClass("invalid-option");bE.data("why-invalid",bz.find(":selected").text());bE.data("why-invalid-el",bz)}}}}bw(bE)})}},bx=$(this),bu=bx.attr("name");function bw(by){var bz=RAINIER.browser.ieVersion>0&&RAINIER.browser.ieVersion<=9;if(bz){by.prop("label",by.text())}by.text(by.text().replace(/[\[\]]/g,""));if(bz){by.prop("label",by.prop("label").replace(/[\[\]]/g,""))}if(by.hasClass("invalid-option")){by.text("["+by.text()+"]");if(bz){by.prop("label","["+by.prop("label")+"]")}}}if(bu){$.each(bt[bu],function(bz,by){bv[by].call(bx.parents(ba).find('[name="'+by+'"]'))})}else{$.each(bt,function(by){bv[by].call(bx.find('[name="'+by+'"]'))})}}function aU(bD){var bC=bD.data("jnap").radioID;var bA={validationType:"utf8LengthTooLong",maxLen:32,whiteSpace:false,isRequired:true},bx={minLen:8,maxLen:64,validCharSet:"ascii",whiteSpace:false,isRequired:true},by={validCharSet:"numeric",maxLen:3,validationType:"ipAddress",isComposite:true,isRequired:true},bw={validCharSet:"numeric",maxLen:5,isRequired:true,whiteSpace:false},bv={validCharSet:"ascii",maxLen:64,isRequired:true},bz={maxLen:16,isRequired:false},bu={maxLen:26,validCharSet:"hex",whiteSpace:false};al.wireless=al.wireless||{};al.wireless[bC]={};al.wireless[bC].ssid=B($.extend(true,{},bA,{els:bD.find(".w-ssid")}));al.wireless[bC].wepPassphrase=B($.extend(true,{},bz,{els:bD.find(".w-wep-pass")}));al.wireless[bC].wepkey1=B($.extend(true,{},bu,{els:bD.find(".w-wep-k1"),errors:[{test:RAINIER.ui.validation.tests.isWepKey.curry(bD.find(".w-wep-encrypt"),1,bD.find(".w-wep-tx-k")),when:false,message:RAINIER.ui.validation.strings.invalidWepKey}]}));al.wireless[bC].wepkey2=B($.extend(true,{},bu,{els:bD.find(".w-wep-k2"),errors:[{test:RAINIER.ui.validation.tests.isWepKey.curry(bD.find(".w-wep-encrypt"),2,bD.find(".w-wep-tx-k")),when:false,message:RAINIER.ui.validation.strings.invalidWepKey}]}));al.wireless[bC].wepkey3=B($.extend(true,{},bu,{els:bD.find(".w-wep-k3"),errors:[{test:RAINIER.ui.validation.tests.isWepKey.curry(bD.find(".w-wep-encrypt"),3,bD.find(".w-wep-tx-k")),when:false,message:RAINIER.ui.validation.strings.invalidWepKey}]}));al.wireless[bC].wepkey4=B($.extend(true,{},bu,{els:bD.find(".w-wep-k4"),errors:[{test:RAINIER.ui.validation.tests.isWepKey.curry(bD.find(".w-wep-encrypt"),4,bD.find(".w-wep-tx-k")),when:false,message:RAINIER.ui.validation.strings.invalidWepKey}]}));al.wireless[bC].wpaPassword=B($.extend(true,{},bx,{els:bD.find(".w-personal-pass"),errors:[{test:RAINIER.ui.validation.tests.isWpaPassword,when:false,message:RAINIER.ui.validation.strings.invalidWpaPassword}]}));al.wireless[bC].sharedKey=B($.extend(true,{},bv,{els:bD.find(".w-wpa-enterpr-key")}));al.wireless[bC].radiusServer=B($.extend(true,{},by,{elContainer:bD.find('span:[name="settings.wpaEnterpriseSettings.radiusServer"]')}));al.wireless[bC].radiusPort=B($.extend(true,{},bw,{els:bD.find(".w-wpa-enterpr-port"),errors:[{test:function(bE){return RAINIER.ui.validation.tests.isInRange(1,65536,true,bE)},when:false,message:RAINIER.ui.validation.strings.invalidPort}]}));var bB=false,bt=[{test:function(bF,bE){function bG(bJ){var bK=bE.find(":selected").text(),bI=bE.find(":selected").data("why-invalid-el").data("fieldname"),bH=bE.find(":selected").data("why-invalid");return bJ.replace("<option>",bK).replace("<other_option_name>",bI).replace("<other_option_value>",bH)}r.call(bE);if(!bB){bB=true;bD.find("select.invalid").not(bE).each(function(){$(this).change()});bB=false}if(bE.find(":selected").data("why-invalid")&&bE.is(":visible")){this.message=bG(RAINIER.ui.validation.strings.invalidWirelessOption);bD.find("select.invalid").not(bE).removeClass("invalid");return false}return true},when:false,immediateError:true}];al.wireless[bC].securityType=B({els:bD.find(".w-security"),errors:bt});al.wireless[bC].networkMode=B({els:bD.find(".w-network-mode"),errors:bt});al.wireless[bC].channelWidth=B({els:bD.find(".w-channel-width"),errors:bt});al.wireless[bC].channel=B({els:bD.find(".w-channel"),errors:bt})}function aw(){var bt=true;$.each(af.wireless.radios,function(){var bu=d.find("#"+RAINIER.ui.escapeId(this.radioID)),bv=bu.data("jnap").radioID;if(bt&&RAINIER.applets.wireless.shouldFilterRadio(this,a9.wireless)){bt=al.wireless[bv].ssid.isValid(true);bt=bt&&al.wireless[bv].securityType.isValid(true);bt=bt&&al.wireless[bv].networkMode.isValid(true);bt=bt&&al.wireless[bv].channelWidth.isValid(true);bt=bt&&al.wireless[bv].channel.isValid(true);if(bt){var bw=bu.find(".w-security").val();if(RAINIER.util.isSecurityTypeWep(bw)){bt=al.wireless[bv].wepkey1.isValid(true);if(bt){bt=al.wireless[bv].wepkey2.isValid(true)}if(bt){bt=al.wireless[bv].wepkey3.isValid(true)}if(bt){bt=al.wireless[bv].wepkey4.isValid(true)}}else{if(RAINIER.util.isSecurityTypeWpaPersonal(bw)){bt=al.wireless[bv].wpaPassword.isValid(true)}else{if(RAINIER.util.isSecurityTypeWpaEnterprise(bw)){bt=al.wireless[bv].radiusServer.isValid(true);if(bt){bt=al.wireless[bv].radiusPort.isValid(true)}if(bt){bt=al.wireless[bv].sharedKey.isValid(true)}}}}}}});if(bt&&RAINIER.applets.guestNetwork.isGuestSSIDConflict(af.guestSettings,a9.wireless.radios)){q.show();bt=false}return bt}function f(){U();bj();RAINIER.ui.fixIeForm(d);d.find("select").on("change",function(){RAINIER.ui.fixIeForm(d)});d.find("#band-steering-selection .steering-help a").click(function(){RAINIER.ui.helpMenu.show();return false})}function F(bu,bt){var bw=bu.find(".w-network-mode"),bv=bu.find(".w-security"),bx=bv.val();if(bx==="WEP"||bx==="WPA-Personal"||bx==="WPA-Enterprise"){if(!bt){RAINIER.ui.dialogWarning({msg:au.find("#confirm-wep-or-wpa").text(),onSubmit:function(){F(bu,true);bv.change()},onCancel:function(){bv.val(bv.data("current-value"));bv.change()}});return false}}if(RAINIER.util.isSecurityTypeWep(bx)){bu.removeClass("w-personal w-wpa-enterpr w-no-sec").addClass("w-wep")}else{if(RAINIER.util.isSecurityTypeWpaPersonal(bx)){bu.removeClass("w-wep w-wpa-enterpr w-no-sec").addClass("w-personal")}else{if(RAINIER.util.isSecurityTypeWpaEnterprise(bx)){bu.removeClass("w-wep w-personal w-no-sec").addClass("w-wpa-enterpr")}else{if(["None","Enhanced-Open","Enhanced-Open-Only","Enhanced-Open+None"].indexOf(bx)>-1){bu.removeClass("w-wep w-personal w-wpa-enterpr").addClass("w-no-sec")}}}}RAINIER.ui.inputBalloon.hide();bv.data("current-value",bv.val())}function y(){var bu=$(this).parent(),bw=bu.find(".w-wep-pass").val(),bt=bu.find(".w-wep-encrypt").val(),bv=RAINIER.applets.wireless.generateWepKeys(bw,bt);bu.find(".w-wep-k1").val(bv[0].toUpperCase()).change();bu.find(".w-wep-k2").val(bv[1].toUpperCase()).change();bu.find(".w-wep-k3").val(bv[2].toUpperCase()).change();bu.find(".w-wep-k4").val(bv[3].toUpperCase()).change()}function aE(bw,bv){function bu(bA){if(bA=="0"){return au.find("#wireless-channel-auto").text()}else{var by=symmetryUtil.wireless.lookupChannelDataByChannel(bA);if(by){var bz=by.channel+" - "+by.frequency+" GHz";if(by.dfs){bz+=" (DFS)"}return bz}else{return""}}}function bx(){var by=[];$.each(bv.supportedChannelsForChannelWidths,function(){by=_.union(by,this.channels)});by.sort(function(bA,bz){return bA-bz});return by}function bt(by,bz){bw.append('<option value="'+bz+'">'+bu(bz)+"</option>")}if(RAINIER.shared.util.areServicesSupported(["/jnap/wirelessap/WirelessAP4"])){$.each(bx(),bt)}else{$.each([].concat(bv.supportedChannels).concat(bv.supportedWideChannels).filter(function(bz,by,bA){return by===bA.indexOf(bz)}),bt)}}function H(bt,bu){var bv=bt.find(".w-security").val();if(!RAINIER.util.isSecurityTypeWep(bv)){delete bu.settings.wepSettings}else{delete bu.settings.wepSettings.passphrase}if(!RAINIER.util.isSecurityTypeWpaPersonal(bv)){delete bu.settings.wpaPersonalSettings}if(!RAINIER.util.isSecurityTypeWpaEnterprise(bv)){delete bu.settings.wpaEnterpriseSettings}}function aR(){var bu=RAINIER.binder.fromDom(d,bs),bt;a9.wireless=$.extend(true,{},af.wireless);a9.wireless.radios=[];if(af.wireless.supportedBandSteeringModes){a9.wireless.isBandSteeringEnabled=af.wireless.supportedBandSteeringModes.indexOf(bu.wireless.bandSteeringMode)>-1;a9.wireless.bandSteeringMode=bu.wireless.bandSteeringMode}$.each(af.wireless.radios,function(by,bx){var bw=d.find("#"+RAINIER.ui.escapeId(bx.radioID)),bv=$.extend(true,{},bx,RAINIER.binder.fromDom(bw,bs));if(bv.band==="2.4GHz"){bt=bv}if(bt&&bv.band==="5GHz"&&a9.wireless.bandSteeringMode==="TriBand"){bv.settings.isEnabled=bt.settings.isEnabled}H(bw,bv);a9.wireless.radios.push(bv)});if(_.isBoolean(bu.wireless.combineNetworks)){a9.wireless.combineNetworks=bu.wireless.combineNetworks}}function a3(){var bu=false;aR();if(a9.wireless.bandSteeringMode!==af.wireless.bandSteeringMode){bu=true}var bt=$.extend(true,{},a9.wireless);bt.radios=_.filter(bt.radios,function(bv){return RAINIER.applets.wireless.shouldFilterRadio(bv,bt)});if(RAINIER.applets.wireless.radiosHaveChanges(bt,af.wireless)){bu=true}if(!bu&&Z&&a9.wireless.combineNetworks&&af.wireless.combineNetworks!==a9.wireless.combineNetworks){bu=true}return bu}function aT(bu){var bw=false,bt=false,bv=RAINIER.applets.wireless.getRadioFromSet(a9.wireless,"RADIO_2.4GHz");bu=bu||[];$.each(a9.wireless.radios,function(){if(Z&&(this.radioID==="RADIO_5GHz_2"||(a9.wireless.combineNetworks&&this.band==="5GHz"))){return true}if(this.settings.isEnabled&&["None","Enhanced-Open","Enhanced-Open-Only","Enhanced-Open+None"].indexOf(this.settings.security)!==-1&&RAINIER.applets.wireless.shouldFilterRadio(this,a9.wireless)){bw=RAINIER.applets.wireless.hasAttributeChanged(a9.wireless,af.wireless,"security",this.radioID)}if(this.band==="5GHz"&&bv.settings.ssid!==this.settings.ssid){bt=RAINIER.applets.wireless.hasAttributeChanged(a9.wireless,af.wireless,"ssid",this.radioID)}});if(bw&&bu.indexOf("SecurityTypeDisabled")===-1){RAINIER.ui.dialogWarning({msg:au.find("#confirm-security-mode-disabled").text(),onSubmit:function(){bu.push("SecurityTypeDisabled");aT(bu)}});return false}if(bu.indexOf("wiFiNames")===-1&&Z&&bt){RAINIER.ui.dialogWarning({msg:au.find("#confirm-different-wifi-names").html(),submit:RAINIER.ui.strings.wireless.differentWiFiNames,cancel:RAINIER.ui.strings.wireless.keepOneName,onSubmit:function(){bu.push("wiFiNames");aT(bu)},onCancel:function(){var by=lodash.remove(_.clone(a9.wireless.radios),function(bz){return bz.radioID==="RADIO_2.4GHz"||bz.radioID==="RADIO_5GHz"}),bx;if(RAINIER.applets.wireless.areRadioSettingsIdentical(by,["ssid","isEnabled","mode","broadcastSSID","channelWidth","channel"])){bx=RAINIER.applets.wireless.getRadioFromSet(af.wireless,"RADIO_5GHz");a9.wireless.combineNetworks=true;d.find("#make-all-the-same").click()}else{bx=RAINIER.applets.wireless.getRadioFromSet(a9.wireless,"RADIO_5GHz");bx.settings.ssid=bv.settings.ssid}RAINIER.binder.toDom(bx,d.find("#RADIO_5GHz"),bs);bu.push("wiFiNames");aT(bu)}});return false}T();return true}function aW(bt){bt.add({action:"/jnap/macfilter/GetMACFilterSettings",data:{},cb:function(bu){if(bu.result==="OK"){af.filtering=$.extend(true,{},bu.output||{});if(af.filtering.maxMACAddresses){t=af.filtering.maxMACAddresses}a9.filtering=$.extend(true,{},af.filtering)}}})}function aZ(){var bt=af.filtering.macFilterMode;if(bt!=="Disabled"){au.find("#filter-enabled").attr("checked","checked");if(bt==="Allow"){au.find("#allow-filters").attr("checked","checked")}else{au.find("#deny-filters").attr("checked","checked")}}else{au.find("#filter-enabled").removeAttr("checked")}au.find("#filter-enabled").change();a9.filterList=[];RAINIER.ui.clearTbl(bp);$.each(af.filtering.macAddresses,function(){var bu={macAddress:this.toString()};a9.filterList.push(bu.macAddress);aS(bu,false)})}function bm(){var bt=au.find("#add-address");if(bp.find("tr").length>=t){bt.attr("disabled","disabled")}else{bt.removeAttr("disabled")}}function bl(){au.find("#add-address").click(function(){a9.filterList.unshift(bd.macAddress);aS(bd,true);if(bp.find("tr").length===t){RAINIER.ui.alert(au.find("#max-mac-addresses-reached").text())}});au.find("#filter-enabled").change(function(){V()})}function V(){var bt=au.find("#filter-enabled");if(bt.is(":checked")&&(af.filtering.macFilterMode==="Disabled")){RAINIER.ui.dialogWarning({msg:au.find("#confirm-mac-filter-enabled").text(),onCancel:function(){bt.removeAttr("checked");bt.change()}})}}function aL(){var bu=true;var bt=bp.find('tr[class="edit"]');for(var bv=0;bv<bt.length;bv++){if(!i($(bt[bv]))){bu=false;break}else{$(bt[bv]).find("#save-filter").click()}}return bu}function J(){aZ();bl()}function a1(bt){bt.find(".text-mac").change(function(){var bu=$.trim(bt.find(".text-mac").val());bu=bu.replace(/-/g,":");bt.find(".text-mac").val(bu)});I(bt)}function I(bw){var bu;function bv(bz){bu=bp.find('span[class="spStatic mac"]');for(var by=0;by<bu.length;by++){if($(bu[by]).is(":visible")&&bz===$(bu[by]).text()){return false}}return true}var bt={},bx={minLen:17,maxLen:17,validationType:"macAddress",blankIsOkOnblur:false,isRequired:true};bt.macAddress=B($.extend(true,{},bx,{els:bw.find('input[class="text-mac"]:text'),elContainer:bw.find('input[class="text-mac"]:text'),errors:[{test:bv,when:false,message:RAINIER.ui.validation.strings.connectivity.duplicatedMacAddress}]}));bw.data(bt)}function i(bu){var bt=bu.data();return bt.macAddress.isValid(true)}function aS(bu,bt){var bv=RAINIER.ui.template.createBlock(ad,bu);if(bt){bv.addClass("edit");a1(bv)}bv.find("td").hover(function(){var bw=$(this).parent();if(!bw.hasClass("edit")){bw.addClass("hover")}},function(){$(this).parent().removeClass("hover")});bv.find("#edit-filter").click(O.onEditFilter.curry(bv));bv.find("#delete-filter").click(O.onDelFilter.curry(bv));bv.find("#save-filter").click(O.onUpdFilter.curry(bv));bv.find("#cancel-filter").click(O.onCancelFilter.curry(bv));if($.compare(bu,bd)){bp.find("tr:first-child").after(bv)}else{bp.append(bv)}bm();RAINIER.util.trapEnter(bv.find("input[type=text]"))}function bf(){var bt=RAINIER.binder.fromDom(au.find("#filter-options"),bs);$.extend(true,a9,bt);a9.filtering=$.extend(true,{},af.filtering);a9.filtering.macAddresses=a9.filterList.filter(function(bu){return($.trim(bu)!=="")});if(au.find("#filter-enabled").is(":checked")){a9.filtering.macFilterMode=bt["filter-addresses"]}else{a9.filtering.macFilterMode="Disabled"}}function ak(){var bt=false;if(aL()){bf()}if(au.find("#filter-list").find("#save-filter:visible").length>0||!$.compare(a9.filtering,af.filtering)){bt=true}return bt}function bq(bt){if(RAINIER.shared.util.areServicesSupported(["/jnap/wirelessap/WPSServer3"])){RAINIER.jnap.send({action:"/jnap/wirelessap/IsWPSServerAvailable",data:{},cb:function(bu){if(bu.result==="OK"){aA.serverAvailable=bu.output.available;ai()}if(typeof bt==="function"){bt()}}});return true}return false}function bc(){if(!$.compare(af.filtering,a9.filtering)){RAINIER.ui.showWaiting();delete a9.filtering.maxMACAddresses;RAINIER.jnap.send({action:"/jnap/macfilter/SetMACFilterSettings",data:a9.filtering,cb:function(bt){if(bt.result==="OK"){$.extend(true,af.filtering,a9.filtering);af.filtering.macAddresses=a9.filtering.macAddresses.clone();if(!bq(function(){O.onSaveComplete()})){O.onSaveComplete()}}else{u=false;O.onSaveComplete()}}})}return true}function an(bt){bt.add({action:"/jnap/wirelessap/GetWPSServerSessionStatus",data:{},cb:function(bu){if(bu.result==="OK"){af.serverPIN=bu.output.serverPIN}}});if(aa){bt.add({action:"/jnap/wirelessap/GetWPSServerSettings",data:{},cb:function(bu){if(bu.result==="OK"){af.wps.enabled=bu.output.enabled}}})}if(RAINIER.shared.util.areServicesSupported(["/jnap/wirelessap/WPSServer3"])){bt.add({action:"/jnap/wirelessap/IsWPSServerAvailable",data:{},cb:function(bu){if(bu.result==="OK"){aA.serverAvailable=bu.output.available}}})}}function a7(){if(!aA.serverAvailable||(!af.wps.enabled&&aa)){Q.addClass("disabled")}else{Q.removeClass("disabled")}if(!RAINIER.applets.wireless.isWPSAvailable(af.wireless,a9.wireless,true)){Q.addClass("cannotEnable");Q.addClass("disabled")}else{if(aA.serverAvailable){Q.removeClass("serverNotAvailable")}else{Q.addClass("serverNotAvailable")}}if(Q.hasClass("disabled")){if(Q.hasClass("serverNotAvailable")||Q.hasClass("cannotEnable")){Q.find("#wps-enabled").attr("disabled","disabled")}else{Q.find("#wps-enabled").removeAttr("disabled")}au.find("#wps #wps-router-pin").text("");Q.find("#wps-button").addClass("focus");Q.find("#wps-device-pin").attr("disabled","disabled");Q.find("#wps-register").attr("disabled","disabled")}else{au.find("#wps #wps-router-pin").text(af.serverPIN);Q.find("#wps-button").removeClass("focus");Q.find("#wps-enabled").removeAttr("disabled");Q.find("#wps-device-pin").removeAttr("disabled");Q.find("#wps-register").removeAttr("disabled")}RAINIER.binder.toDom(af,au.find("#wps"),bs)}function aO(){var bt=RAINIER.binder.fromDom(au.find("#wps"),bs);$.extend(true,a9,bt)}function s(){W.find(".close-button").unbind("click");W.find(".close-button").click(function(){RAINIER.ui.spinner.stop("#spinner-section");bi.close()});W.find("#cancel-button").unbind("click");W.find("#cancel-button").click(function(){W.find("#cancel-button").attr("disabled","disabled");clearInterval(br);b();o(false)});var bu=au.find("#wps #wps-button");bu.unbind();if(!au.find("#wps").hasClass("disabled")){bu.bind({click:function(){P(false)},keypress:function(bv){if(bv.keyCode===13){P(false)}},mousedown:function(){bu.addClass("active")},mouseup:function(){bu.removeClass("active")},mouseenter:function(){bu.addClass("hover");bu.removeClass("active")},mouseleave:function(){bu.removeClass("hover");bu.removeClass("active")}})}function bt(){if(al.wps.pin.isValid(true)){P(true)}}au.find("#wps #wps-register").unbind();au.find("#wps #wps-register").click(bt);RAINIER.util.trapEnter("#wps-device-pin",bt)}function ao(){var bt={minLen:4,maxLen:9,whiteSpace:false,isRequired:false};al.wps={};al.wps.pin=B($.extend(true,{},bt,{els:au.find("#wps-device-pin"),errors:[{test:RAINIER.ui.validation.tests.isWpsPin,when:false,message:RAINIER.ui.validation.strings.invalidWpsPin}]}))}function ai(){a7();s();ao()}function o(bt){if(bt){W.find("#success").show();W.find("#close-button").show();W.find("#searching").hide();W.find("#failure").hide();W.find("#cancel-button").hide()}else{W.find("#failure").show();W.find("#close-button").show();W.find("#searching").hide();W.find("#success").hide();W.find("#cancel-button").hide()}}function b(){RAINIER.jnap.send({action:"/jnap/wirelessap/GetWPSServerSessionStatus",data:{},cb:function(bt){if(bt.output.isWPSSessionInProgress){RAINIER.jnap.send({action:"/jnap/wirelessap/StopWPSServerSession",data:{},cb:function(bu){}})}}})}function P(bw){au.find("#wps #wps-register").attr("disabled","disabled");var bv={};if(bw){bv.clientPIN=RAINIER.binder.fromDom("#wps #wps-device-pin").clientPIN;if(bv.clientPIN.length===9){bv.clientPIN=bv.clientPIN.substring(0,4)+bv.clientPIN.substring(5,9)}}var bu="/jnap/wirelessap/StartWPSServerSession";RAINIER.jnap.send({action:bu,data:bv,cb:function(bx){if(bx&&bx.result&&(bx.result==="OK"||bx.result==="ErrorWPSSessionAlreadyInProgress")){W.find("#searching").show();W.find("#cancel-button").removeAttr("disabled");W.find("#cancel-button").show();W.find("#failure").hide();W.find("#success").hide();W.find("#close-button").hide();au.find("#wps #wps-register").removeAttr("disabled");RAINIER.ui.spinner.build("#spinner-section").spin("#spinner-section");bi.show();br=setInterval(bt,5000)}else{if(bx&&bx.result&&bx.result==="ErrorInvalidClientPIN"){RAINIER.ui.alert(au.find("#wps-pin-invalid-text").html())}else{RAINIER.ajax().executeDefaultJnapErrorHandler(bx,bu)}}au.find("#wps #wps-register").removeAttr("disabled")},disableDefaultJnapErrHandler:true});function bt(){RAINIER.jnap.send({action:"/jnap/wirelessap/GetWPSServerSessionStatus",data:{},cb:function(bx){if(!bx.output.isWPSSessionInProgress){clearInterval(br);o(bx.output.lastResult==="Succeeded"?true:false)}}})}}function M(){aO();if(!aa){delete a9.wps.enabled}var bt=$.compare(a9.wps,af.wps);return !bt}function e(bv){var bx={action:"/jnap/wirelessap/SetWPSServerSettings",data:a9.wps,cb:function(by){if(by.result==="OK"){$.extend(true,af.wps,a9.wps);ai()}else{u=false}O.onSaveComplete()}},bw=function(by){if(by.result==="OK"){$.extend(true,af.wps,a9.wps);ai();O.onSaveComplete(false)}};if(bv){bx.cb=bw;bv.add(bx)}else{var bt=RAINIER.applets.wireless.ssidBroadcastWPSWarning(af.wireless,a9,bo,C);if(bt){var bu=RAINIER.ui.dialog(bt,{onSubmit:function(){RAINIER.ui.showWaiting();if(bt===bo){bx.cb=bw;am(bx)}else{RAINIER.jnap.send(bx)}},onCancel:function(){u=false;O.onSaveComplete()}});bu.show()}else{RAINIER.ui.showWaiting();RAINIER.jnap.send(bx)}}}function am(bu){var bt;if(!RAINIER.applets.wireless.isWirelessAP2Supported()){bt=RAINIER.jnap.Transaction({disableDefaultAjaxErrHandler:true,disableDefaultRebootErrHandler:true})}else{bt=RAINIER.jnap.Transaction()}RAINIER.applets.wireless.scrubForSave(a9.wireless);$.each(a9.wireless.radios,function(bw,bv){bv.settings.broadcastSSID=true});bt.add({action:RAINIER.jnapActions.setRadioSettings(),data:a9.wireless,cb:function(bv){if(bv.result==="OK"){ab();U();RAINIER.event.fire("wireless.updated")}}});bt.add(bu);bt.send()}function ap(){RAINIER.binder.toDom(af,au.find("#simpletap"),bs)}function G(){var bt=RAINIER.binder.fromDom(au.find("#simpletap"),bs);$.extend(true,a9.simpletap,bt.simpletap);return a9.simpletap.isSetupVAPEnabled!==af.simpletap.isSetupVAPEnabled}function aP(){return true}function az(){RAINIER.ui.showWaiting();RAINIER.jnap.send({action:"/jnap/wirelesssetup/SetStaticNFCSettings",data:{isSetupVAPEnabled:a9.simpletap.isSetupVAPEnabled},cb:function(bt){if(bt.result==="OK"){$.extend(true,af.simpletap,a9.simpletap)}else{u=false}O.onSaveComplete()}})}function aM(bt){bt.add({action:"/jnap/wirelesssetup/GetStaticNFCSettings",data:{},cb:function(bu){if(bu.result==="OK"){af.simpletap.isSetupVAPEnabled=bu.output.isSetupVAPEnabled}}})}function a6(){ap()}function a0(){w.find(".editRouterTime").click(function(){var bt=RAINIER.connect.AppletManager.getAppletById("BDBC8297-8982-4BCF-84EC-91783FF9013C");if(bt){RAINIER.ui.MainMenu.launchApplet(bt,"")}else{console.warn("Wireless Scheduler: cannot locate Connectivity applet")}});w.find(".help-icon").click(function(){$("#help-menu").click()})}function h(){a0();RAINIER.blockScheduler.populateBlockAccessTable(function(){if(a5==="scheduler"){au.find("#scheduler-tab > span").click()}})}function aK(){RAINIER.binder.toDom(af,au.find("#scheduler"),bs);RAINIER.blockScheduler.setCheckedCellsPol(af.scheduler.wirelessSchedule)}function av(){if(ag){var bt=new Date(Date.now()-a8);aI.html(RAINIER.util.getTimeFromRouterDateString(bt));p=setTimeout(av,aX)}}function aC(){RAINIER.blockScheduler.init();RAINIER.network.getRouterCurrentTime(function(bt){ag=RAINIER.util.routerTimeToDate(bt);a8=Date.now()-ag;av()});aK()}function a(){a9.scheduler.isWirelessSchedulerEnabled=RAINIER.blockScheduler.hasSelectedCells()?true:false;a9.scheduler.wirelessSchedule=RAINIER.blockScheduler.getAccessSchedule();if(a9.scheduler.isWirelessSchedulerEnabled){a9.scheduler.configuredRadios=af.scheduler.configurableRadios}else{a9.scheduler.configuredRadios=af.scheduler.configuredRadios}}function ah(){var bt=false;a();if(!$.compare(a9.scheduler,af.scheduler)){bt=true}return bt}function aV(){RAINIER.ui.showWaiting();var bt=$.extend(true,{},a9.scheduler);delete bt.configurableRadios;RAINIER.jnap.send({action:"/jnap/wirelessscheduler/SetWirelessSchedulerSettings",data:bt,cb:function(bu){if(bu.result==="OK"){$.extend(true,af.scheduler,a9.scheduler);RAINIER.network.setWirelessSchedulerSettings(a9.scheduler);RAINIER.event.fire("wireless.updated",af.wireless)}else{u=false}O.onSaveComplete()}})}function a4(){RAINIER.network.updateWirelessSchedulerSettings(function(){af.scheduler=$.extend(true,{},RAINIER.network.getWirelessSchedulerSettings());a9.scheduler=$.extend(true,{},af.scheduler);RAINIER.event.fire("wireless.updated")})}function aJ(){RAINIER.binder.toDom(af,aD,bs)}function A(){if(aN){a9.atf={isAirtimeFairnessEnabled:aD.find("#atf-enabled").is(":checked")}}if(at){a9.dfs={isDFSEnabled:aD.find("#dfs-enabled").is(":checked")}}if(ar){a9.topologyOptimization.isClientSteeringEnabled=aD.find("#clientSteering-enabled").is(":checked")}if(m){a9.topologyOptimization.isNodeSteeringEnabled=aD.find("#nodeSteering-enabled").is(":checked")}}function j(){var bt=false;A();if(aN&&a9.atf.isAirtimeFairnessEnabled!==af.atf.isAirtimeFairnessEnabled){bt=true}if(ar&&a9.topologyOptimization.isClientSteeringEnabled!==af.topologyOptimization.isClientSteeringEnabled){bt=true}if(m&&a9.topologyOptimization.isNodeSteeringEnabled!==af.topologyOptimization.isNodeSteeringEnabled){bt=true}return bt}function bb(){return true}function aH(){var bt=RAINIER.jnap.Transaction({onComplete:function(){O.onSaveComplete()}});RAINIER.ui.showWaiting();if(aN){bt.add({action:"/jnap/wirelessap/SetAirtimeFairnessSettings",data:{isAirtimeFairnessEnabled:a9.atf.isAirtimeFairnessEnabled},cb:function(bv){if(bv.result==="OK"){$.extend(true,af.atf,a9.atf)}else{u=false}}})}if(RAINIER.network.isTopologyOptimizationPresent()){var bu={isClientSteeringEnabled:a9.topologyOptimization.isClientSteeringEnabled};if(m){bu.isNodeSteeringEnabled=a9.topologyOptimization.isNodeSteeringEnabled}bt.add({action:RAINIER.jnapActions.setTopologyOptimizationSettings(),data:bu,cb:function(bv){if(bv.result==="OK"){$.extend(true,af.topologyOptimization,a9.topologyOptimization)}else{u=false}}})}bt.send()}function bn(bt){if(RAINIER.network.isAirtimeFairnessPresent()){bt.add({action:"/jnap/wirelessap/GetAirtimeFairnessSettings",data:{},cb:function(bu){if(bu.result==="OK"){aN=bu.output.isAirtimeFairnessSupported;if(aN){af.atf.isAirtimeFairnessEnabled=bu.output.isAirtimeFairnessEnabled}}}})}if(RAINIER.network.isTopologyOptimizationPresent()){ar=true;bt.add({action:RAINIER.jnapActions.getTopologyOptimizationSettings(),data:{},cb:function(bu){if(bu.result==="OK"){af.topologyOptimization.isClientSteeringEnabled=bu.output.isClientSteeringEnabled;if(RAINIER.shared.util.areServicesSupported(["/jnap/nodes/topologyoptimization/TopologyOptimization2"])){m=true;af.topologyOptimization.isNodeSteeringEnabled=bu.output.isNodeSteeringEnabled}}}})}}function bh(){if(!aN&&!ar){au.find("#advanced-tab").remove();aD.remove()}else{if(!at){au.find("#dfs-wrapper").hide()}if(!aN){au.find("#atf-wrapper").hide()}if(!ar){au.find("#clientSteering-wrapper").hide()}if(!m){au.find("#nodeSteering-wrapper").hide()}aJ()}}function n(bt){aq(bt);if(v.macfiltering){aW(bt)}an(bt);if(v.simpletap){aM(bt)}if(v.scheduler){a4(bt)}if(v.advanced){bn(bt)}}function a2(){f();if(v.macfiltering){J()}ai();if(v.simpletap){a6()}if(v.scheduler){h()}if(v.advanced){bh()}RAINIER.event.fire("applet.loaded")}function ac(){if(v.macfiltering){aB.macfiltering.insertAfter(au.find("#wireless-tab"));aG.macfiltering.insertAfter(d)}if(v.advanced){au.find("#wps-tab").after(aB.advanced);au.find("#wps").after(aG.advanced)}if(v.scheduler){au.find("#wps-tab").after(aB.scheduler);au.find("#wps").after(aG.scheduler)}if(v.simpletap){au.find("#wps-tab").after(aB.simpletap);au.find("#wps").after(aG.simpletap)}}function bk(){v.macfiltering=RAINIER.shared.util.areServicesSupported(["/jnap/macfilter/MACFilter"]);v.simpletap=RAINIER.shared.util.areServicesSupported(["/jnap/wirelesssetup/StaticNFCSetup"]);v.scheduler=RAINIER.network.isWirelessSchedulerSupported();v.advanced=RAINIER.network.isAirtimeFairnessPresent()||RAINIER.network.isTopologyOptimizationPresent();ac()}function aY(bu){var bt=$.extend({},af.guestSettings),bw=false,bv=$.grep(af.wireless.radios,function(by){return by.radioID==="RADIO_2.4GHz"})[0],bx=$.grep(af.wireless.radios,function(by){return by.radioID==="RADIO_5GHz"})[0];if(RAINIER.shared.util.areServicesSupported(["/jnap/guestnetwork/GuestNetwork3"])){$.each(a9.wireless.radios,function(){if(this.radioID==="RADIO_2.4GHz"){if(this.settings.isEnabled!==bv.settings.isEnabled){bw=true;if(this.settings.isEnabled===false){bt.radio.band24.isEnabled=false;bt.radio.band24.canEnableRadio=false}else{bt.radio.band24.canEnableRadio=true}}}else{if(this.radioID==="RADIO_5GHz"){if(this.settings.isEnabled!==bx.settings.isEnabled){bw=true;if(this.settings.isEnabled===false){bt.radio.band50.isEnabled=false;bt.radio.band50.canEnableRadio=false}else{bt.radio.band50.canEnableRadio=true}}}}});if(!bt.radio.band24.canEnableRadio&&!bt.radio.band50.canEnableRadio){bt.canEnableGuestNetwork=false}else{bt.canEnableGuestNetwork=true}}else{$.each(a9.wireless.radios,function(){if(this.radioID==="RADIO_2.4GHz"){if(this.settings.isEnabled!==bv.settings.isEnabled){bw=true;if(this.settings.isEnabled===false){bt.isGuestNetworkEnabled=false;bt.canEnableGuestNetwork=false}else{bt.canEnableGuestNetwork=true}}}})}if(bw){console.warn(["Updating Guest Network:",bt]);RAINIER.applets.guestNetwork.setSettings(bt,function(){af.guestSettings=bt},bu,true)}}function ab(){$.each(a9.wireless.radios,function(bu,bw){var bt=d.find("#"+RAINIER.ui.escapeId(bw.radioID)),bv=RAINIER.applets.wireless.getRadioFromSet(af.wireless,bw.radioID);bv=$.extend(true,bv,bw);H(bt,bv)})}function T(){var bw,bv=true;function bx(){aY(bw);bw.send()}if(RAINIER.applets.wireless.isSSIDBroadcastChanging(af.wireless,a9.wireless)&&!RAINIER.applets.wireless.isWirelessAP2Supported()){bw=RAINIER.jnap.Transaction({disableDefaultAjaxErrHandler:true,disableDefaultRebootErrHandler:true});bv=false}else{bw=RAINIER.jnap.Transaction()}RAINIER.ui.showWaiting();var bu=RAINIER.applets.wireless.isSSIDBroadcastChanging(af.wireless,a9.wireless)&&!RAINIER.applets.wireless.isWirelessAP2Supported();if(!RAINIER.applets.wireless.isWPSAvailable(af.wireless,a9.wireless)&&af.wps.enabled){a9.wps=a9.wps||{};a9.wps.enabled=false;e(bw)}RAINIER.applets.wireless.commitSettings(bw,a9.wireless,af.wireless,bs,bx,bt);function bt(bA,by){function bz(){RAINIER.connect.checkRouterConnectionForRestoration(true,false)}if(bA.result==="OK"){$.each(a9.wireless.radios,function(){var bB=_.find(by.radios,{radioID:this.radioID});_.extend(this,bB)});af.wireless=$.extend(true,{},af.wireless,a9.wireless);U();ab();RAINIER.event.fire("wireless.updated",af.wireless);if(Q.hasClass("cannotEnable")&&RAINIER.applets.wireless.isWPSAvailable(af.wireless,a9.wireless)){Q.removeClass("cannotEnable");a7()}if(bu){setTimeout(function(){RAINIER.jnap.send({action:"/jnap/core/Reboot",data:{},cb:function(bB){if(bB.result==="OK"){RAINIER.event.fire("router.interruptionStarted");RAINIER.ui.showWaiting();setTimeout(function(){bz()},4000)}else{}},disableDefaultAjaxErrHandler:true,disableDefaultRebootErrHandler:true})},ae)}if(!bq(function(){O.onSaveComplete(bv)})){O.onSaveComplete(bv)}}else{u=false;O.onSaveComplete(true)}}}function x(){ag=null;RAINIER.event.disconnect("applet.unloaded",x);if(RAINIER.network.isWirelessSchedulerSupported()){clearTimeout(p);p=null}}function aQ(){a5=$.cookie("initial-tab");aa=RAINIER.shared.util.areServicesSupported(["/jnap/wirelessap/WPSServer2"]);if(!aa){au.find("div#wps-enabled-switch").hide()}au.find("#cbAddWidget").attr("checked",RAINIER.connect.AppletManager.getWidgetShowState("7B1F462B-1A78-4AF6-8FBB-0C221703BEA4","7C8E2909-A0EF-48E7-A7BD-F615059F510C"));au.find("#cbAddWidget").click(O.onToggleWidget);q=RAINIER.ui.dialog("#guest-ssid-conflict");bg=RAINIER.ui.dialog($("#dialog-tabchange"),{onSubmit:function(){l=true;S(false)}});$("#dialog-tabchange #no-save").unbind("click");$("#dialog-tabchange #no-save").click(function(){bg.close();z();ax.click()});bi=RAINIER.ui.dialog(W);bk();var bt=RAINIER.jnap.Transaction({onComplete:a2});n(bt);bt.send();if(a5!=="scheduler"){L=RAINIER.ui.tabs.init({fireEvents:true,initialTab:a5})}else{L=RAINIER.ui.tabs.init({fireEvents:true})}L.connect(function(bv,bu){if(bu.type==="tab"){K=bu.srcTabId;ay=bu.destTabId;if(bu.srcIdx>-1){ax=bu.destTab;if(aF()){bv.cancelEvent=true}else{if(Z&&K==="wireless"){U()}}}else{K=ay}}else{k=bu.srcTabId}});L.fireInit();RAINIER.event.connect("tab.changed",function(bv,bu){var bw=bu.destTabId;if(bw==="scheduler"){clearTimeout(p);aC()}});RAINIER.event.connect("applet.unloaded",x);au.find("footer .cancel").click(O.onClose);au.find("footer .submit").click(O.onSave);au.find("footer .apply").click(O.onApply);if(RAINIER.network.isBridgeMode()){au.find("#simpletap-tab").remove();au.find("#wps-tab").remove();au.find("#mac-filtering-tab").remove();au.find("#scheduler-tab").remove();if(!RAINIER.network.isBehindNode()){au.find("#advanced-tab").remove()}}else{au.find(".widget-config").css("display","")}}aQ()}());