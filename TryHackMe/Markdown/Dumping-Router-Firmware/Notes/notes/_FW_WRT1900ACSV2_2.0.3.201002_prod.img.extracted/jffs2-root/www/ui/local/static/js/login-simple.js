function simpleInputValidation(){var b=document.getElementById("emailInput").value,a=document.getElementById("passwordInput").value;if(b.length===0){showInputValidationError("emailValidation",true,RAINIER.setup.ui.inputRequired)}else{if(a.length===0){showInputValidationError("passwordValidation",true,RAINIER.setup.ui.inputRequired)}else{return true}}return false}function recheckOwnedNetwork(){RAINIER.jnap.send({action:"/jnap/ownednetwork/GetOwnedNetworkID",data:{},cb:function(a){if(a.result==="OK"){if(a.output.ownedNetworkID&&a.output.ownedNetworkID.length>0){RAINIER.shared.ui.authenticatedGoToIndex(RAINIER.shared.util.getCookie("user-auth-token"))}else{window.location.replace("/ui/dynamic/associate-router-simple.html")}}}})}function setNetworkOwner(a){RAINIER.jnap.send({action:"/jnap/ownednetwork/SetNetworkOwner",data:{ownerSessionToken:RAINIER.shared.util.getCookie("user-auth-token"),friendlyName:a},cb:function(b){if(b.result==="OK"){recheckOwnedNetwork()}else{window.location.replace("/ui/dynamic/associate-router-simple.html")}},disableDefaultJnapErrHandler:true,useAdminAuth:true})}function autoAssociateRouter(){RAINIER.jnap.send({action:"/jnap/devicelist/GetDevices",data:{},cb:function(c){if(c.result==="OK"){var a=c.output.devices;for(var b=0;b<a.length;b++){if(a[b].isAuthority===true){setNetworkOwner(a[b].friendlyName);break}}}},useAdminAuth:true})}function discoverOwnedNetwork(){RAINIER.jnap.send({action:RAINIER.jnapActions.getDeviceInfo(),data:{},cb:function(b){if(b.result==="OK"){RAINIER.jnapCache.set(RAINIER.jnapActions.getDeviceInfo(),b.output);var a="/jnap/ownednetwork/GetOwnedNetworkID";if(RAINIER.shared.util.areServicesSupported(["/jnap/ownednetwork/OwnedNetwork2"])){a="/jnap/ownednetwork/IsOwnedNetwork"}RAINIER.jnap.send({action:a,data:{},cb:function(c){if(c.result==="OK"){if(c.output.isOwnedNetwork||(c.output.ownedNetworkID&&c.output.ownedNetworkID.length>0)){RAINIER.shared.ui.authenticatedGoToIndex(RAINIER.shared.util.getCookie("user-auth-token"))}else{var d=getRouterPassword();if(d&&d.length>0){autoAssociateRouter()}else{window.location.replace("/ui/dynamic/associate-router-simple.html")}}}else{RAINIER.shared.ui.authenticatedGoToIndex(RAINIER.shared.util.getCookie("user-auth-token"))}},disableDefaultAjaxErrHandler:true})}}})}function signInFailed(a){switch(a){case RAINIER.simple.account.errorCode.INVALID_USERNAME:case RAINIER.simple.account.errorCode.INVALID_PARAMETER:showGeneralError(RAINIER.login.strings.invalidCloudLogin);showView("landing");break;case RAINIER.simple.account.errorCode.ACCOUNT_DISABLED:showGeneralError(RAINIER.login.strings.accountDisabled);showView("landing");break;case RAINIER.simple.account.errorCode.ACCOUNT_PENDING:showGeneralError(RAINIER.setup.ui.accountPending);showView("landing");break;case RAINIER.simple.account.errorCode.INVALID_ACCOUNT_CREDENTIALS:showGeneralError(RAINIER.login.strings.invalidCloudLogin);showView("landing");break;case RAINIER.simple.account.errorCode.ACCOUNT_LOCKED_OUT:window.location.href="/ui/dynamic/account-lockout-simple.html";break;case RAINIER.simple.account.errorCode.ACCOUNT_SECURITY_LOCK:window.location.href="/ui/dynamic/account-security-lock-simple.html";break;case RAINIER.simple.account.errorCode.ACCOUNT_NOT_FOUND:showGeneralError(RAINIER.login.strings.accountNotFound);showView("landing");break;default:showGeneralError(RAINIER.login.strings.unexpectedCloudError);showView("landing");break}}function signIn(){if(!simpleInputValidation()){return}showView("working");clearAllInputErrors();var b=document.getElementById("emailInput").value,a=document.getElementById("passwordInput").value;RAINIER.cloud.send({url:"/cloud/user-service/rest/v2/sessions",type:"POST",data:{session:{account:{username:b,password:a}}},cb:function(d){RAINIER.shared.util.setCookie("user-auth-token",d.session.token,null,"/");var c=RAINIER.shared.util.getURLParameter("callback");if(c){window.location.assign(c)}else{discoverOwnedNetwork()}},cbError:function(c){RAINIER.simple.account.getErrorCode(c,signInFailed)}})}function checkRedirect(a){if(RAINIER.shared.util.getURLParameter("redirectedFromLogin")==="invalidMobileBrowser"){RAINIER.setup.goToPage("/ui/dynamic/mobile-browser-unsupported.html")}else{if(RAINIER.shared.util.getURLParameter("redirectedFromLogin")==="invalidBrowser"){RAINIER.setup.goToPage("/ui/dynamic/browser-unsupported.html")}else{if(typeof a==="function"){a()}}}}function verifyRouterSetupCompleted(a){RAINIER.shared.util.getCurrentAuthorityDevice(function(c){var b=c.properties;for(i=0;i<b.length;i++){if(b[i].name==="setupState"){if(b[i].value==="start"){RAINIER.setup.goToPage("/ui/dynamic/setup/generic_error.html")}else{if(b[i].value==="wifiReconnect"){RAINIER.setup.goToPage("/ui/dynamic/setup/change_router_password.html")}else{}}return}}checkRedirect();initUi()},a)}function autoFillPassword(){var a=document.getElementById("emailInput");var b=RAINIER.shared.util.getURLParameter("email");if(b){a.value=b;a=document.getElementById("passwordInput")}a.focus()}function initUi(){autoFillPassword();showView("landing")}window.onload=function(){showView("loading");RAINIER.shared.util.setCookie("visited-index",true,null,"/");document.getElementById("signinButton").onclick=signIn;var a=RAINIER.shared.util.getURLParameter("callback");if(a){document.getElementById("forgotPassword").href=document.getElementById("forgotPassword").href+"?callback="+a}if(RAINIER.shared.util.getURLParameter("app")==="mediapri"){var c=document.getElementsByClass("noMediaPri");for(var b=0;b<c.length;b++){c[b].style.display="none"}}RAINIER.shared.util.checkIsBehindNode(function(d){if(!d){RAINIER.jnap.send({action:"/jnap/core/IsAdminPasswordDefault",data:{},cb:function(e){if(lodash.result(e,"output.isAdminPasswordDefault")){verifyRouterSetupCompleted("admin")}else{checkRedirect(initUi)}},forceLocal:true,disableDefaultJnapErrHandler:true,disableDefaultAjaxErrHandler:true})}else{initUi()}})};