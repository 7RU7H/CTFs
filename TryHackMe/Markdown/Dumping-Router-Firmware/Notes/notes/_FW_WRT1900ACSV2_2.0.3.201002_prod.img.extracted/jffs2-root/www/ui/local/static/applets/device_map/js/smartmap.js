window.RAINIER=window.RAINIER||{};RAINIER.applets=RAINIER.applets||{};RAINIER.applets.networkmap=RAINIER.applets.networkmap||{};RAINIER.applets.networkmap.Loader=(function(){var d,f,v="6B749D0D-1E3B-4C2A-B0CE-D19EDA0225AC",z="7C23A10B-3C02-4F64-B954-44A148144423",q=RAINIER.ui.dialogWarning,h=true;var p={wireless:{radios:[]}};function b(){if(d.find("#filter-menu-dropdown").is(":visible")){n()}}function c(){if(h){RAINIER.event.fire("applet.loaded");d.find("#filter-map-button").click(function(A){$.cancelEvents(A);n()});$(window.document).off("click",b);$(window.document).on("click",b);RAINIER.ui.hideWaiting();RAINIER.applets.devicelist.checkAppFlag();h=false;RAINIER.applets.networkmap.App.deviceCollection.initting=false}}function u(){RAINIER.applets.networkmap.App.smartmapView.render()}function l(B,A){}function y(){RAINIER.event.disconnect("applet.closed",y);$(window.document).off("click",b);try{RAINIER.applets.networkmap.App.smartmapView.resetState()}catch(A){}try{RAINIER.applets.networkmap.App.smartmapView.remove()}catch(A){}try{delete RAINIER.applets.networkmap.App}catch(A){}h=true}function e(A){var C=A.attr("id"),B=RAINIER.applets.networkmap.App.deviceCollection.getModelByID(C);return B}function o(A){var B=e(A),C=B.attributes.deviceID();d.find("header .close-button").click();RAINIER.ui.showWaiting();setTimeout(function(){RAINIER.ui.hideWaiting();var D=RAINIER.connect.AppletManager.getAppletById(v);if(D){RAINIER.ui.MainMenu.launchApplet(D,"",C)}else{console.warn("smartmap.js: cannot locate Parental Controls applet")}},500)}function r(A){function C(){RAINIER.event.disconnect("connection.enableCheck",C);setTimeout(function(){A=RAINIER.ui.popmenu.checkState();console.warn("reserveDhcpAddressCb",A);if(A){RAINIER.ui.popmenu.hideLnk("#dhcp-set-spinner");RAINIER.ui.popmenu.showLnk("#dhcp-edit-reservation-lnk",A);RAINIER.ui.popmenu.hideLnk("#dhcp-set-reservation-lnk",A);RAINIER.ui.popmenu.unlockMenu()}RAINIER.ui.unblockUI();RAINIER.applets.networkmap.App.smartmapView.setLockState(false)},4000)}var B=e(A);if(RAINIER.applets.dhcpReservations.reserveDevice(B.attributes)){RAINIER.applets.networkmap.App.smartmapView.setLockState(true);if(RAINIER.network.isAuthorityRemote()){RAINIER.event.fire("router.interruptionStarted");setTimeout(function(){RAINIER.event.fire("connection.enableCheck");RAINIER.event.fire("router.interruptionCompleted")},5000)}else{RAINIER.connect.handleRouterInterruption(false)}RAINIER.event.connect("connection.enableCheck",C);RAINIER.ui.popmenu.lockMenu();RAINIER.ui.popmenu.hideLnk("#dhcp-set-reservation-lnk",A);RAINIER.ui.popmenu.showLnk("#dhcp-set-spinner")}}function t(A){var B=e(A);RAINIER.applets.dhcpReservations.openDHCPReservations(B.attributes)}function k(A){var B=e(A);RAINIER.applets.dhcpReservations.openDHCPReservations(B.attributes,true)}function g(){d.find("header .close-button").click();RAINIER.ui.showWaiting();setTimeout(function(){RAINIER.ui.hideWaiting();var A=RAINIER.connect.AppletManager.getAppletById(z);if(A){RAINIER.ui.MainMenu.launchApplet(A)}else{console.warn("smartmap.js: cannot locate Speed Check applet")}},500)}function j(){RAINIER.applets.networkmap.App.deviceCollection.beginStatsTracking()}function i(){var A=true;RAINIER.ui.showWaiting();RAINIER.jnap.send({action:RAINIER.jnapActions.setCTFSettings(),data:{isCTFEnabled:false},cb:function(B){if(B.result==="OK"){RAINIER.applets.devicelist.ctfDisabled();RAINIER.event.connect("connection.enableCheck",function(){if(A){A=false;setTimeout(j,18000)}})}else{}}})}function n(){if(d.find("#filter-menu").hasClass("collapsed")){d.find("#filter-menu").removeClass("collapsed")}else{d.find("#filter-menu").addClass("collapsed")}}function x(){if(RAINIER.applets.networkmap.App&&RAINIER.applets.networkmap.App.deviceCollection){RAINIER.applets.networkmap.App.deviceCollection.fetch()}}function w(){var C=false,B=false;d=$("#networkmap-applet");f=d.find("#bandwidth-report");RAINIER.applets.networkmap.App={deviceCollection:new RAINIER.applets.networkmap.Models.deviceCollection()};RAINIER.applets.networkmap.App.smartmapView=new RAINIER.applets.networkmap.Views.smartmapView({collection:RAINIER.applets.networkmap.App.deviceCollection,el:"#networkmap-applet"});RAINIER.applets.networkmap.App.bandwidthView=new RAINIER.applets.networkmap.Views.bandwidthView({collection:RAINIER.applets.networkmap.App.deviceCollection,el:f});RAINIER.applets.networkmap.App.deviceCollection.once("sync",c);RAINIER.applets.networkmap.App.deviceCollection.once("error",l);RAINIER.applets.networkmap.App.deviceCollection.on("refresh",u);d.find("#show-bandwidth-report").click(function(){if(RAINIER.applets.devicelist.isCTFEnabled()){q({msg:$("#ctf-warning-dialog").html(),onSubmit:i})}else{j()}});d.find("#rerun-report").click(function(){j()});d.find("#closeBwReport").click(function(){d.find("#bandwidth-report .refresh").attr("disabled","disabled");if(RAINIER.applets.networkmap.App.deviceCollection.bandwidthReportRunning){RAINIER.applets.networkmap.App.deviceCollection.endStatsTracking()}RAINIER.applets.devicelist.foldSection(f)});d.find("#launch-speedtest").click(g);RAINIER.event.connect("New Device Connected",function(){RAINIER.applets.networkmap.App.deviceCollection.fetch()});RAINIER.event.connect(["devices.revisionUpdated","devices.deviceDeleted"],function(){x()});RAINIER.event.connect("devices.guestNetworkUpdated",function(){x();setTimeout(function(){RAINIER.applets.networkmap.App.smartmapView.updateTabs()},1000)});RAINIER.event.connect("applet.closed",y);RAINIER.applets.networkmap.App.smartmapView.resetState();RAINIER.applets.networkmap.App.deviceCollection.fetch();RAINIER.ui.tooltip.add(".refresh, .clear-btn");if(p.wireless.supportedBandSteeringModes&&p.wireless.radios.length>1){var D=".filter-type-wirelessFive",E=null,A=$.extend(true,{},p.wireless);A.isBandSteeringEnabled=false;$.each(p.wireless.radios,function(G,F){if(F.band==="5GHz"){if(F.radioID==="RADIO_5GHz_2"){D+="-2"}E=RAINIER.shared.util.getLabeledRadio(A,F.radioID);d.find(D+" > div").html(E.labels["short"])}d.addClass("wirelessFive-2");d.find(".filter-type-wirelessFive-2").show()})}$.each(p.wireless.radios,function(G,F){if(F.band==="2.4GHz"){C=true}else{if(F.band==="5GHz"){B=true}}});if(!C){d.find(".filter-type-wirelessTwo").hide()}if(!B){d.find(".filter-type-wirelessFive").hide()}}function a(){return !!p.wireless.supportedBandSteeringModes}function m(A){RAINIER.jnap.send({action:RAINIER.jnapActions.getRadioInfo(),data:{},cb:function(B){p.wireless=B.output||{};if(B.result==="OK"){RAINIER.applets.wireless.sortRadios(p.wireless.radios);RAINIER.applets.dhcpReservations.init(A)}}})}function s(){console.warn("NM - init()");m(w)}s();return{getDeviceFromElem:e,openParentalControls:o,openDHCPReservations:t,openDHCPReservationsEditMode:k,reserveDhcpAddress:r,hasSecondarySteeredBand:a}}());