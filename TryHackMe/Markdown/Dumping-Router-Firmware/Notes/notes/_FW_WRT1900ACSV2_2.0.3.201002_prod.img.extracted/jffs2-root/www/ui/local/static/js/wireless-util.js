window.RAINIER=window.RAINIER||{};RAINIER.applets=RAINIER.applets||{};RAINIER.applets.wireless=RAINIER.applets.wireless||(function(){var b=["supportedBandSteeringModes","isBandSteeringSupported","combineNetworks"],A=["band","bssid","maxRADIUSSharedKeyLength","physicalRadioID","supportedChannels","supportedModes","supportedSecurityTypes","supportedWideChannels","supportedChannelsForChannelWidths","steeredModes","bandSteeringSettings","isSetToMixedMode"],v=["isEnabled","mode","broadcastSSID","channelWidth","channel"],k=null,i=null;function o(D,E){var F=null;$.each(D.radios,function(H,G){if(G.radioID===E){F=G;return false}});return F}function l(G,E){var D=false,F=null;$.each(G.radios,function(I,H){F=o(E,H.radioID);if(F&&!$.compare(H,F)){D=true;return false}});return D}function u(I,G,E,F){var H=o(G,F),D=o(I,F);return !$.compare(H.settings[E],D.settings[E])}function w(){return RAINIER.shared.util.areServicesSupported(["/jnap/wirelessap/WirelessAP2"])}function g(D,F){var G=false,E=null;$.each(F.radios,function(I,H){E=o(D,H.radioID);if(E){G=H.settings.isEnabled&&E.settings.broadcastSSID!==H.settings.broadcastSSID;return false}});return G}function z(E,G,H){var D=false,F=null;$.each(G.radios,function(J,I){if(RAINIER.applets.wireless.shouldFilterRadio(I,G)){F=o(E,I.radioID);if(F&&I.settings.isEnabled&&(H||I.settings.broadcastSSID)){D=true;return false}}});return D}function x(H,F,E,G){var I=true,D=false;$.each(H.radios,function(){if(this.settings.isEnabled&&this.settings.broadcastSSID){I=false}if(!this.settings.broadcastSSID){D=true}});if(F.wps&&F.wps.enabled){if(I){if(!RAINIER.applets.wireless.isWirelessAP2Supported()){E.find("#reboot-needed").show();E.find("#no-reboot-needed").hide()}else{E.find("#no-reboot-needed").show();E.find("#reboot-needed").hide()}return E}else{if(D){return G}}}return null}function y(D,E){var F=D.concat(E),G=[];F=F.filter(function(I,H,J){return H===J.indexOf(I)});$.each(F,function(H,I){if(D.indexOf(I)>-1&&E.indexOf(I)>-1){G.push(I)}});return G}function d(D){if(D.settings.wepSettings){var E=D.settings.wepSettings.txKey;D.settings.wepSettings.key=D.settings.wepSettings["key"+E]}}function f(H,F,D,G){var E=null,I=RAINIER.shared.util.getLabeledRadio(H,D);if(RAINIER.applets.wireless.shouldFilterRadio(I,H)){I.securityText=RAINIER.ui.common.strings.wirelessSecurity[I.settings.security];d(I,G,k);E=RAINIER.ui.template.createBlock(k,I,G);E.find(".warning-text, .wireless-hide-text").hide();if(I.settings.isEnabled){E.find("#disconnect-warning-wireless").show()}else{E.find("#disconnect-warning-wireless").hide()}if(I.settings.security==="WEP"){E.find("#disconnect-warning-key-row").show()}else{if(I.settings.security==="WPA-Enterprise"||I.settings.security==="WPA2-Enterprise"||I.settings.security==="WPA-Mixed-Enterprise"){E.find("#disconnect-warning-shared-key-row").show()}else{if(["None","Enhanced-Open","Enhanced-Open-Only","Enhanced-Open+None"].indexOf(I.settings.security)===-1){E.find("#disconnect-warning-password-row").show()}}}if(!I.settings.broadcastSSID){E.find("#disablingghz-broadcastSSID-text").show()}RAINIER.connect.elDisconnectWarning().find("#disconnect-warning-wireless").append(E)}}function e(E,D,F){RAINIER.ui.showWaiting();$.delAttr(D,b);E.add({action:RAINIER.jnapActions.setRadioSettings(),data:D,cb:function(G){if(typeof F==="function"){F(G,D)}}})}function s(R,G,I,J,N,H,M){var O=false,E=false,Q=false,P=false,F=false,L=false,D=false;var K=null;k=RAINIER.ui.template.createTemplate($("#radio-disconnect-warning-template > *"));RAINIER.connect.elDisconnectWarning().find("#disconnect-warning-wireless").empty();RAINIER.connect.elDisconnectWarning().find(".warning-text, .wireless-hide-text").hide();$.each(G.radios,function(T,S){if(RAINIER.network.isBehindNode()&&window.location.hash!=="#casupport"&&(S.radioID==="RADIO_5GHz_2"||(G.combineNetworks&&S.radioID==="RADIO_5GHz"))){return true}f(G,J,S.radioID,N);K=o(J,S.radioID);if(K){if(!S.settings.isEnabled){if(S.radioID==="RADIO_2.4GHz"){O=true}else{if(S.radioID==="RADIO_5GHz"){E=true}else{if(S.radioID==="RADIO_5GHz_2"){Q=true}}}}if(!S.settings.isEnabled&&K.settings.isEnabled){console.warn("radio being disabled",S.radioID);if(S.radioID==="RADIO_2.4GHz"){P=true}else{if(S.radioID==="RADIO_5GHz"){F=true}else{if(S.radioID==="RADIO_5GHz_2"){L=true}}}}}});if(G.isBandSteeringEnabled&&E){Q=true}if((P||F||L)&&(O&&E&&(!J.supportedBandSteeringModes||Q))){D=true}console.warn("confirmSetRadioSettings (radio24Disabled, radio50Disabled, allRadiosBeingDisabled)",O,E,D);RAINIER.connect.elDisconnectWarning().find(".submit").unbind("click");RAINIER.connect.elDisconnectWarning().find(".submit").click(function(){RAINIER.connect.disconnectWarningDialog.close();e(R,I,M);if(typeof H==="function"){H()}});RAINIER.network.areRadiosDisabledByWFS(function(S){if(S){RAINIER.connect.elDisconnectWarning().find("#disabling-24-50ghz-wireless-scheduler-enabled-text").show()}});if(D){RAINIER.connect.elDisconnectWarning().find("#disconnect-warning-wireless-networks-disabled-text").show()}else{RAINIER.connect.elDisconnectWarning().find("#disconnect-warning-default-text").show()}if(RAINIER.shared.util.areServicesSupported(["/jnap/guestnetwork/GuestNetwork3"])){if(P&&F){if(J.supportedBandSteeringModes){RAINIER.connect.elDisconnectWarning().find("#disabling-24-50_1ghz-disables-guest-access-text").show()}else{RAINIER.connect.elDisconnectWarning().find("#disabling-24-50ghz-disables-guest-access-text").show()}}else{if(P){RAINIER.connect.elDisconnectWarning().find("#disabling-24ghz-disables-24guest-access-text").show()}if(F){if(J.supportedBandSteeringModes){RAINIER.connect.elDisconnectWarning().find("#disabling-50_1ghz-disables-50guest-access-text").show()}else{RAINIER.connect.elDisconnectWarning().find("#disabling-50ghz-disables-50guest-access-text").show()}}}}else{if(O){RAINIER.connect.elDisconnectWarning().find("#disabling-24ghz-disables-guest-access-text").show()}}RAINIER.connect.disconnectWarningDialog.show()}function q(Q,F,K,O,G,N){var J=$.extend(true,{},F),D=J.bandSteeringMode!==K.bandSteeringMode,H=false,I=null,L=null,M=null,E=null,P=RAINIER.network.isBehindNode()&&window.location.hash!=="#casupport";J.radios=[];if(!J.isBandSteeringEnabled){$.delAttr(J,"bandSteeringMode")}if(P){if(J.combineNetworks){E=o(F,"RADIO_2.4GHz")}else{E=o(F,"RADIO_5GHz")}}$.each(F.radios,function(S,R){L=o(K,R.radioID);if(L){I=$.extend(true,{},R);H=!$.compare(R,L);$.delAttr(I,A);if(P){if(R.band==="5GHz"){I=$.extend(true,{},R,{settings:r(E.settings)});if(!$.compare(I,L)){$.delAttr(I,A);J.radios.push(I)}}else{if(H){J.radios.push(I)}}}else{if(H&&RAINIER.applets.wireless.shouldFilterRadio(R,J)){J.radios.push(I)}if(symmetryUtil.wireless.isPrimaryBandSteeredRadio(J,R)&&(H||D)){M=$.extend(true,{},I)}}}});if(J.radios.length>0||D){if(M){$.each(F.radios,function(S,R){if(RAINIER.applets.wireless.isSecondarySteeredBand(R,F)){M=$.extend(true,{},M,RAINIER.applets.wireless.getBandSteeringDefaults(R));$.delAttr(M,A);J.radios.push(M)}})}s(Q,F,J,K,O,G,N)}else{RAINIER.ui.hideWaiting()}}function h(E,D){if(D&&D.bandSteeringMode==="TriBand"){return E.band==="5GHz"}return symmetryUtil.wireless.isSecondaryBandRadio(E)}function t(E,D){if(D){return !D.isBandSteeringEnabled||symmetryUtil.wireless.isPrimaryBandSteeredRadio(D,E)||(D.bandSteeringMode==="Basic"&&E.radioID!=="RADIO_5GHz_2")}return false}function n(D){return _.find(symmetryUtil.wireless.getBandSteeringSettings().radioDefaults,{radioID:D.radioID})||{}}function C(J,E){var H=[],D,G,F;if(E==="WEP-64"){D=0;H=[];for(G=0;G<J.length;G++){D^=((J.charCodeAt(G))<<((G%4)*8))}for(G=0;G<4;G++){H[G]="";for(F=0;F<5;F++){D*=214013;D+=2531011;D&=4294967295;H[G]+=("0"+((D>>16)&255).toString(16)).slice(-2)}}}else{if(E==="WEP-128"){D="";for(G=0;G<64;G++){D+=J.charAt(G%J.length)}var I=calcMD5(D).slice(0,26);H.push(I);H.push(I);H.push(I);H.push(I)}}return H}function j(D){D.sort(function(F,E){return(F.radioID>E.radioID)?1:((F.radioID<E.radioID)?-1:0)})}function p(D){$.each(D.radios,function(F,E){$.delAttr(E,A)});$.delAttr(D,b)}function m(E){var D=r(E[0].settings);return E.every(function(G,F){return F===0||$.compare(D,r(G.settings))})}function c(F,E){var D=r(F[0].settings,E);return F.every(function(H,G){return G===0||$.compare(D,r(H.settings,E))})}function r(E,D){D=D||v;return _.omit(E,D)}function B(){return i}function a(){symmetryUtil.wireless.getWirelessSettings().success(function(D){i=D.supportedBandSteeringModes&&D.supportedBandSteeringModes.indexOf("TriBand")>-1})}return{initialize:a,getRadioFromSet:o,radiosHaveChanges:l,hasAttributeChanged:u,isWirelessAP2Supported:w,isSSIDBroadcastChanging:g,isWPSAvailable:z,ssidBroadcastWPSWarning:x,getCommonChannels:y,shouldFilterRadio:t,isTriBandSteeringSupported:B,isSecondarySteeredBand:h,getBandSteeringDefaults:n,commitSettings:q,scrubForSave:p,setDisplayWepKey:d,generateWepKeys:C,sortRadios:j,areAllRadioSettingsIdentical:m,areRadioSettingsIdentical:c,prepareRadioSettings:r}}());