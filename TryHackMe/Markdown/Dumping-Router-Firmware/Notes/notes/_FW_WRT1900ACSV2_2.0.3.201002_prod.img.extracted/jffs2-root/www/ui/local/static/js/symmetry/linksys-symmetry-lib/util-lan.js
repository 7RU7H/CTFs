(function(a,b){if(typeof define==="function"&&define.amd){define(["lodash","./symmetry-jnap"],b)}else{if(typeof module==="object"&&module.exports){module.exports=b(require("lodash"),require("./symmetry-jnap"))}else{a.utilLAN=b((a.lodash||a._),a.JNAP)}}}(this,function(k,i){var e;var d=["subnetMask","minNetworkPrefixLength","maxNetworkPrefixLength","minAllowedDHCPLeaseMinutes","maxAllowedDHCPLeaseMinutes","maxDHCPReservationDescriptionLength"];var j=["maxUsers","maxUsersLimit"];function b(q,s,r,n){var m=e.ip.ipToNum(q),p=e.ip.ipToNum(s),o=r?e.ip.ipToNum(r):p+n-1;return m>=p&&m<=o}function a(p){var q=p.dhcpSettings,o=e.ip.ipToNum(q.firstClientIPAddress),n=e.ip.ipToNum(q.lastClientIPAddress),m=n-o;if(!b(p.ipAddress,q.firstClientIPAddress,q.lastClientIPAddress)){m++}return m}function h(p,m){var o=e.ip.ipToNum(p),n=o+m-1;return e.ip.numToIP(n)}function f(q,s,p,t){var u=e.ip.subnetMaskToPrefixLength(p),r=Math.pow(2,32-u),v=e.ip.ipToNum(p),o=e.ip.ipToNum(s),n=o.toString(2),m=parseInt(v.toString(2).substring(0,u)+n.substring(n.length-(32-u),n.length),2)-v;if(b(q,s,null,t)){r--}return r-m-1}function g(){var m=i.Deferred(),n;i.send("/router/GetLANSettings",{}).success(function(o){n=o.output;n.subnetMask=e.ip.prefixLengthToSubnetMask(n.networkPrefixLength);if(n.isDHCPEnabled){n.dhcpSettings.maxUsers=a(n);n.dhcpSettings.maxUsersLimit=f(n.ipAddress,n.dhcpSettings.firstClientIPAddress,n.subnetMask,n.dhcpSettings.maxUsers)}m.resolve(n)}).error(function(o){m.reject(o)});return m}function l(o,n){var m=i.Deferred(),p=k.cloneDeep(n);p.networkPrefixLength=e.ip.subnetMaskToPrefixLength(p.subnetMask);p=k.omit(p,d);p.dhcpSettings=k.omit(p.dhcpSettings,j);if(p.isDHCPEnabled&&o.ipAddress!==p.ipAddress){p.dhcpSettings.reservations=[]}i.send("/router/SetLANSettings",p).success(function(){m.resolve(p)}).error(function(q){var r=q;switch(q.result){case"ErrorInvalidPrimaryDNSServer":case"ErrorInvalidSecondaryDNSServer":case"ErrorInvalidTertiaryDNSServer":case"ErrorInvalidWINSServer":r=q.result.replace("ErrorInvalid","invalid").replace("Server","")}m.reject(r)});return m}function c(o){var m=i.Deferred();var n=k.cloneDeep(o);n=k.omit(n,"aggregatedPorts");i.send("/linkaggregation/SetLinkAggregationSettings",n).success(function(){m.resolve(n)}).error(function(p){m.reject(p)});return m}return function(m){e=m;return{isRouterIPInDHCPRange:b,getMaxUsersForDHCPRange:a,getEndDHCPRangeForMaxUsers:h,getMaxUsersLimit:f,getLANSettings:g,setLANSettings:l,setLinkAggregationSettings:c}}}));