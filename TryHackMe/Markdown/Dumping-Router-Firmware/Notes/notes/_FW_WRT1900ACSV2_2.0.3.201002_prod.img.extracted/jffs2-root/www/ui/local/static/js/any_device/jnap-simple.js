window.RAINIER=window.RAINIER||{};RAINIER.setup=RAINIER.setup||{};RAINIER.setup.routerInfo=null;RAINIER.setup.call=null;RAINIER.setup.isRebooting=false;RAINIER.setup.setRouterInfo=function(a){RAINIER.setup.routerInfo=a};RAINIER.setup.getCurrentNetworkFirmwareVersion=function(){return RAINIER.setup.routerInfo?RAINIER.setup.routerInfo.firmwareVersion:null};RAINIER.setup.getCurrentNetworkModelName=function(){return RAINIER.setup.routerInfo?RAINIER.setup.routerInfo.modelNumber:null};RAINIER.setup.getCurrentNetworkHardwareVersion=function(){return RAINIER.setup.routerInfo?RAINIER.setup.routerInfo.hardwareVersion:null};RAINIER.cloud=(function(){var a={};a.request=b;a.send=d;function c(e){$ajax(e)}function b(g){if(typeof g!=="object"){return}var f=g.url,j=g.type||"GET",e=g.cb,k=g.cbError,l=g.headers||[],m={};RAINIER.setup.call=f;m.Accept="application/json";m.Expires="Fri, 10 Oct 2013 14:19:41 GMT";m["Cache-Control"]="no-cache";m["X-Linksys-Network-Id"]=RAINIER.shared.util.getCurrentNetworkID();m["X-Linksys-Client-Type-Id"]=RAINIER.shared.util.getCiscoHNClientID();m["X-Linksys-Router-FW-Version"]=RAINIER.setup.getCurrentNetworkFirmwareVersion();m["X-Linksys-Router-Model-Number"]=RAINIER.setup.getCurrentNetworkModelName();for(var h=0;h<l.length;h++){if(l[h].name){m[l[h].name]=l[h].value}}if(RAINIER.shared.util.getCookie("user-auth-token")){m.Authorization='CiscoHNUserAuth session_token="'+RAINIER.shared.util.getCookie("user-auth-token")+'"'}return{headers:m,type:j,contentType:"application/json; charset=UTF-8",dataType:"json",url:f,data:JSON.stringify(g.data),error:function(i,o,n){if(typeof k!=="function"||k(i)===false){RAINIER.setup.executeDefaultAjaxErrorHandler(i)}},success:function(n,o,i){if(typeof e==="function"){e(n,i)}}}}function d(){var e=RAINIER.cloud.request;c(e.apply(e,arguments))}return a}());RAINIER.jnap=(function(){function a(j){for(var h=0;h<j.length;h++){if(j[h].result==="_ErrorNotReady"){return true}}return false}var b={},c=20,f=3000;function d(q){var l=q.action,k=q.cb,p=l.substr(0,7)==="http://"?l:"http://"+RAINIER.jnap.host+l,s=q.disableDefaultAjaxErrHandler||false,h=q.disableDefaultJnapErrHandler||false,n=q.useAdminAuth||false,m=q.adminPasswordOverride||null,t=q.timeoutMs||null,j=q.remote||false,o=0,i={};if(t){$ajaxSetup({timeout:t})}else{$ajaxSetup({timeout:10000})}RAINIER.setup.call=l;i["X-JNAP-Action"]=p;i.Expires="Fri, 10 Oct 2013 14:19:41 GMT";i["Cache-Control"]="no-cache";if(!n&&RAINIER.shared.util.getCookie("user-auth-token")){i["X-JNAP-Session"]=RAINIER.shared.util.getCookie("user-auth-token")}else{if(m){i["X-JNAP-Authorization"]=m}else{i["X-JNAP-Authorization"]=RAINIER.shared.util.getCookie("admin-auth")}}if(j){i.Accept="application/json";i["X-Linksys-Network-Id"]=RAINIER.shared.util.getCurrentNetworkID();i["X-Linksys-Client-Type-Id"]=RAINIER.shared.util.getCiscoHNClientID();if(RAINIER.shared.util.getCookie("user-auth-token")){i.Authorization='CiscoHNUserAuth session_token="'+RAINIER.shared.util.getCookie("user-auth-token")+'"'}}var r={headers:i,type:"POST",url:j?"/cloud/JNAP/":"/JNAP/",data:JSON.stringify(q.data),contentType:"application/json; charset=UTF-8",error:function(v,x,w){if(v.status===404){o++;if(o<=c){var u=$extend({},this.xhrRetry);u.xhrRetry=$extend({},this.xhrRetry);setTimeout(function(){$ajax(u)},f);return}}if(!s){RAINIER.setup.executeDefaultAjaxErrorHandler(v)}if(typeof k==="function"){k({result:"_AjaxError"},v)}},success:function(u,z,x){var v,y;if(typeof u!=="object"){y=parseJSON(u);v=u}else{y=u;v=JSON.stringify(u)}if(!y||y.result!=="OK"){if((!y&&RAINIER.setup.isRebooting)||(y&&(y.result==="_ErrorNotReady"||(l.indexOf("/jnap/core/Transaction")>-1&&y.responses&&a(y.responses))))){o++}else{o=c+1}if(o<=c){var w=$extend({},this.xhrRetry);w.xhrRetry=$extend({},this.xhrRetry);setTimeout(function(){$ajax(w)},f);return}else{if(!h){if(typeof RAINIER.executeDefaultJnapErrorHandler==="function"){RAINIER.executeDefaultJnapErrorHandler(y,l)}}}}if(typeof k==="function"){k(y,x)}},xhrRetry:null};r.xhrRetry=$extend({},r);return r}function e(h){$ajax(h)}function g(){var h=RAINIER.jnap.request;e(h.apply(h,arguments))}b.request=d;b.send=g;b.host="cisco.com";return b}());RAINIER.jnap.Transaction=(function(){function b(g,e,i){var f,h;if(typeof e!=="object"){h=parseJSON(e);f=e}else{h=e;f=JSON.stringify(e)}if($isFunction(g.onReturn)){g.onReturn()}a.call(g,h,f,i);if($isFunction(g.onComplete)){g.onComplete(h,i)}}function a(f,e,h){for(var g=0;g<d.callbacks.length;g++){if($isFunction(d.callbacks[g])){d.callbacks[g].call(d,f.responses?f.responses[g]:{result:"_AjaxError"},h,f,g)}}}var d={add:function(e){if(typeof e!=="object"){e={action:arguments[0],data:arguments[1],cb:arguments[2]}}e.action="http://"+RAINIER.jnap.host+e.action;this.actions.push({action:e.action,request:e.data});this.callbacks.push(e.cb)},send:function(){RAINIER.jnap.send.call(this,this.jnapOpts)}};var c=function(f){var g=0;if(typeof f!=="object"){f={};if($isFunction(arguments[0])){f.onReturn=arguments[0];g++}if($isFunction(arguments[1])){f.onComplete=arguments[1];g++}}var e=d;$extend(e,f);e.callbacks=[];e.actions=[];e.jnapOpts=$extend(f,{action:"/jnap/core/Transaction",data:e.actions,cb:function(h,i){b(d,h,i)}});return e};return c}());