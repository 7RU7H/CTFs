var isPasswordHintSupported=false;var maxHintBytes=512;function goToNextPage(){RAINIER.setup.goToPage("/ui/dynamic/setup/congratulations.html")}function saveRouterPasswordInTransaction(b,e,a){var d=isPasswordHintSupported?"/jnap/core/SetAdminPassword2":"/jnap/core/SetAdminPassword",c={adminPassword:e};if(isPasswordHintSupported){c.passwordHint=a}b.add({action:d,data:c,cb:function(f){if(f.result==="OK"){setRouterPassword(e);setPasswordHint(c.passwordHint)}else{if(f.result==="ErrorInvalidAdminPassword"||f.result==="Error"){showView("landing");showInputValidationError("routerPasswordInputValidation",false)}else{if(f.result!=="_AjaxError"&&f.result!=="_ErrorAbortedAction"){RAINIER.executeDefaultJnapErrorHandler(f)}}}}})}function applySettings(){var a=document.getElementById("routerPasswordInput").value,b=document.getElementById("passwordHintInput");passwordHint=b.value;if(RAINIER.shared.util.beginsOrEndsWithSpace(a)){showInputValidationError("routerPasswordInputValidation",false);return}else{if(isPasswordHintSupported&&RAINIER.shared.util.lengthInBytes(passwordHint)>maxHintBytes){document.getElementById("passwordHintValidation").style.display="block";showInputValidationError("passwordHintValidation",true,RAINIER.setup.ui.tooManyCharacters);return}}startPleaseWaitTimer();showView("working");setTimeout(function(){var c=RAINIER.jnap.Transaction({onComplete:function(d){if(d.result==="OK"){goToNextPage()}},disableDefaultJnapErrHandler:true});saveRouterPasswordInTransaction(c,a,passwordHint);RAINIER.setup.removeRouterPropertiesInTransaction(c,["setupState","hasInternet"]);c.send()},RAINIER.setup.UI_DELAY)}function generateRouterPassword(){var b="abcdefghjkmnopqrstuvwxyzABCDEFGHJKLMNPQRTUVWXYZ2346789",d="";for(var a=0;a<10;a++){var c=Math.floor(Math.random()*b.length);d+=b.charAt(c)}return d}function saveHasInternetCookie(a){getRouterPropertyValue("hasInternet",function(b){if(b&&b==="true"){RAINIER.shared.util.setCookie("hasInternet","true",null,"/")}if(typeof a==="function"){a()}})}function ensureRouterSettingsAreCookiedAfterReconnect(b){if(getRouterPassword()===""){setRouterPassword("admin")}var c=RAINIER.jnap.Transaction({onComplete:function(){saveHasInternetCookie(b)}});var a=false;if(getModelNumber()===""||!RAINIER.jnapCache.get(RAINIER.jnapActions.getDeviceInfo())){a=true;getRouterInfo(c,function(d){if(d.result==="OK"){RAINIER.jnapCache.set(RAINIER.jnapActions.getDeviceInfo(),d.output);saveModelNumber(RAINIER.setup.getCurrentNetworkModelName())}})}if(getWirelessSsid()===""||getWirelessPassword()===""){a=true;getRadioSettingsInTransaction(c,function(d){if(d.result==="OK"&&getRadioByIndex(0)){saveWirelessSsidAll();saveWirelessPasswordAll()}})}if(!RAINIER.shared.util.getCookie("routerDeviceId")){a=true;RAINIER.setup.getRouterDeviceID(null,null,c)}if(a){c.send()}else{if(typeof b==="function"){b()}}}function checkInputs(){var a=document.getElementById("routerPasswordInput").value;changeBtnState(document.getElementById("nextButton"),a.length>0)}function hideAndShowPasswordHintText(b){var a=document.getElementById("moreText");passwordHintText=document.getElementById("passwordHintMoreText");if(b){a.style.display="none";passwordHintText.style.display="block"}else{passwordHintText.style.display="none";a.style.display="inline"}}window.onbeforeunload=function(){return RAINIER.shared.util.decodeHtml(RAINIER.setup.ui.confirmExit)};window.onload=function(){showView("working");ensureRouterSettingsAreCookiedAfterReconnect(function(){var a=document.getElementById("routerPasswordInput");isPasswordHintSupported=RAINIER.shared.util.areServicesSupported(["/jnap/core/Core3"]);var b=document.getElementById("routerImage"),c=RAINIER.shared.ui.getModelDataFromIcon(getModelNumber(),getHardwareVersion());b.src=b.src.replace("Default",c);showView("landing");if(!isPasswordHintSupported){document.getElementById("passwordHintSection").style.display="none";a.value=generateRouterPassword()}else{document.getElementById("noPasswordHintSection").style.display="none";changeBtnState(document.getElementById("nextButton"),false);RAINIER.shared.util.limitUTF8Field(document.getElementById("passwordHintInput"),maxHintBytes)}})};