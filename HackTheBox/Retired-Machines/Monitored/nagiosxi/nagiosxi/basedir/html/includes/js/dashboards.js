
var currentdashboardid="0";var currentdashboardtitle="";$(document).ready(function(){$("#mydashboardsinit").each(function(){show_new_dashboard(0);});$("#mydashboards-page #leftnav a:not(a.mydashboardlink)").each(function(){$(this).click(function(){clear_dashboard_controls();update_dashboards_menu();unhighlight_dashboards_menu_items();});});$("a.mydashboardlink").click(function(){handle_dashboard_menu_click(this);return;});$("a.addnewdashboardlink").click(function(){show_throbber();var backgroundcolor="ffffff";if(theme=='xi5dark'){backgroundcolor="111111";}
var theurl="";var content="<div id='popup_header' style='margin-bottom: 5px;'><b>"+_('Add Dashboard')+"</b></div><div id='popup_data'><p>"+_('Use this to add a new dashboard to your Dashboards page.')+"</p></div><form id='adddashboard_form' method='get' action='"+ajax_helper_url+"'><input type='hidden' name='cmd' value='adddashboard'><input type='hidden' name='opts' value=''><div class='popup-form-box'><div><label for='adddashboardTitleBox'>"+_('Dashboard Title')+"</label></div><input type='text' size='30' name='title' id='adddashboardTitleBox' value='' class='form-control'></div><div class='popup-form-box'><label for='backgroundcolor'>"+_('Background Color')+"</label><input type='hidden' name='background' value='"+backgroundcolor+"' id='backgroundcolor'><div id='colorpickerHolder2'><div id='colorSelector2' style='float: left;'><div style='background-color: #"+backgroundcolor+";'></div></div><span class='checkbox' style='float: left; margin: 6px 0 0 10px;'><label><input type='checkbox' name='transparent' value='1'> "+_('Transparent')+"</label></span></div></div><div id='adddashboardFormButtons'><button type='submit' class='btn btn-sm btn-primary' name='submitButton' id='submitAddDashboardButton'>"+_('Submit')+"</button></div></form>";hide_throbber();set_popup_content(content);display_popup();$('#adddashboardTitleBox').focus();$("#colorSelector2").ColorPicker({onSubmit:function(hsb,hex,rgb,el){var x=1;$("#backgroundcolor").val(hex);$(el).val(hex);$(el).ColorPickerHide();$('#colorSelector2 div').css('backgroundColor','#'+hex);},onBeforeShow:function(){var y=1;$(this).ColorPickerSetColor($("#backgroundcolor").val());},onShow:function(colpkr){$(colpkr).fadeIn(500);return false;},onHide:function(colpkr){$(colpkr).fadeOut(500);return false;},onChange:function(hsb,hex,rgb){$("#backgroundcolor").val(hex);$('#colorSelector2 div').css('backgroundColor','#'+hex);}});$("#adddashboard_form").submit(function(){hide_throbber();var params={};$(this).find(":input, :password, :checkbox, :radio, :submit, :reset").each(function(){params[this.name||this.id||this.parentNode.name||this.parentNode.id]=this.value;});params["nsp"]=nsp_str;$.ajax({type:"POST",url:this.getAttribute("action"),data:params,beforeSend:function(XMLHttpRequest){$("#popup_container").each(function(){this.origHTML=this.innerHTML;this.innerHTML="<div id='popup_header' style='margin-bottom: 5px;'><b>"+_('Please Wait')+"</b></div><div id='popup_data'><p>"+_('Processing')+"...</p><i class='fa fa-spinner fa-pulse'></i></div>";resize_popup();});},success:function(msg){$("#popup_container").each(function(){this.innerHTML="<div id='popup_header' style='margin-bottom: 5px;'><b>"+_('Dashboard Added')+"</b></div><div id='popup_data'><p>"+_('Success! Your new dashboard has been added.')+"</p></div>";resize_popup();update_dashboards_menu();fade_popup("green");if(currentdashboardid=="nodashboardid"){show_new_dashboard(0);}});},error:function(msg){$("#popup_container").each(function(){this.innerHTML="<div id='popup_header' style='margin-bottom: 5px;'><b>"+_('Error')+"</b></div><div id='popup_data'><p>"+_('An error occurred processing your request.')+"</p></div>";resize_popup();});}});return false;});});$(".edit-dashboard").click(function(){var id=$(this).parent().data('id');var title=$(this).parent().data('title');whiteout();show_throbber();var viewdata=get_ajax_data("getdashboardbyid",id);eval('var viewobj='+viewdata);var backgroundcolor=viewobj.background;var checked="";if(viewobj.transparent){checked=" checked='checked'";}
var content="<div id='popup_header'><b>"+_('Edit Dashboard')+"</b></div><div id='popup_data'></div><form id='editdashboard_form' method='get' action='"+ajax_helper_url+"'><input type='hidden' name='cmd' value='updatedashboard'><input type='hidden' id='editdashboardId' name='id' value=''><input type='hidden' name='opts' value=''><div class='popup-form-box'><div><label for='editdashboardTitleBox'>"+_('Dashboard Title')+"</label></div><input type='text' size='30' name='title' id='editdashboardTitleBox' value='' class='form-control'></div><div class='popup-form-box'><label for='backgroundcolor'>"+_('Background Color')+"</label><input type='hidden' name='background' value='"+backgroundcolor+"' id='backgroundcolor'><div id='colorpickerHolder2'><div id='colorSelector2' style='float: left;'><div style='background-color: #"+backgroundcolor+";'></div></div><span class='checkbox' style='float: left; margin: 6px 0 0 10px;'><label><input type='checkbox' name='transparent' value='1'"+checked+"> "+_('Transparent')+"</label></span></div></div><div id='editdashboardFormButtons'><input type='submit' class='btn btn-sm btn-primary' name='submitButton' value='"+_('Submit')+"' id='submitEditDashboardButton'></div></form>";hide_throbber();set_child_popup_content(content);$('#editdashboardId').val(id);$('#editdashboardTitleBox').val(title);resize_child_popup();display_child_popup();$("#colorSelector2").ColorPicker({onSubmit:function(hsb,hex,rgb,el){var x=1;$("#backgroundcolor").val(hex);$(el).val(hex);$(el).ColorPickerHide();$('#colorSelector2 div').css('backgroundColor','#'+hex);},onBeforeShow:function(){var y=1;$(this).ColorPickerSetColor($("#backgroundcolor").val());},onShow:function(colpkr){$(colpkr).fadeIn(500);return false;},onHide:function(colpkr){$(colpkr).fadeOut(500);return false;},onChange:function(hsb,hex,rgb){$("#backgroundcolor").val(hex);$('#colorSelector2 div').css('backgroundColor','#'+hex);}});$("#editdashboard_form").submit(function(){hide_throbber();var params={};$(this).find(":input, :password, :radio, :submit, :reset").each(function(){var val=this.value;if($(this).is(":checkbox")&&!$(this).is(":checked")){val=0;}
params[this.name||this.id||this.parentNode.name||this.parentNode.id]=val;});params["nsp"]=nsp_str;$.ajax({type:"POST",url:this.getAttribute("action"),data:params,beforeSend:function(XMLHttpRequest){$("#child_popup_container").each(function(){this.origHTML=this.innerHTML;this.innerHTML="<div id='popup_header' style='margin-bottom: 5px;'><b>"+_('Please Wait')+"</b></div><div id='popup_data'><p>"+_('Processing')+"...</p><i class='fa fa-spinner fa-pulse'></i></div>";resize_child_popup();});},success:function(msg){$("#child_popup_container").each(function(){this.innerHTML="<div id='popup_header' style='margin-bottom: 5px;'><b>"+_('Dashboard Changes Saved')+"</b></div><div id='popup_data'><p>"+_('Success! Your dashboard was updated successfully.')+"</p></div>";resize_child_popup();clear_whiteout();fade_child_popup("green");update_dashboards_menu();location.reload();});},error:function(msg){$("#child_popup_container").each(function(){this.innerHTML="<div id='popup_header' style='margin-bottom: 5px;'><b>"+_('Error')+"</b></div><div id='popup_data'><p>"+_('An error occurred processing your request.')+"</p></div>";resize_child_popup();});}});return false;});});$(".remove-dashboard").click(function(){var id=$(this).parent().data('id');whiteout();show_throbber();if(currentdashboardid=="home"){var content="<div id='popup_header'><b>"+_('Error')+"</b></div><div id='popup_data'><p>"+_('You cannot delete your home page dashboard.')+"</p></div>";hide_throbber();set_popup_content(content);display_popup();fade_popup("red",2000);return;}
var content="<div id='popup_header' style='padding-bottom: 10px;'><b>"+_('Confirm Dashboard Deletion')+"</b></div><div id='popup_data'><p style='padding-bottom: 15px;'>"+_('Are you sure you want to delete this dashboard and all dashlets it contains?')+"</p></div><form id='deletedashboard_form' method='get' action='"+ajax_helper_url+"'><input type='hidden' name='cmd' value='deletedashboardbyid'><input type='hidden' name='opts' value='"+id+"'><div id='editdashboardFormButtons'><input type='submit' class='btn btn-sm btn-primary' name='submitButton' value='"+_('Delete')+"' id='submitDeleteDashboardButton'> <input type='button' class='btn btn-sm btn-default close_child_popup_btn' name='cancelButton' value='"+_('Cancel')+"' style='margin-left: 5px;'></div></form>";hide_throbber();set_child_popup_content(content);display_child_popup();$("#deletedashboard_form").submit(function(){hide_throbber();var params={};$(this).find(":input, :password, :checkbox, :radio, :submit, :reset").each(function(){params[this.name||this.id||this.parentNode.name||this.parentNode.id]=this.value;});params["nsp"]=nsp_str;$.ajax({type:"POST",url:this.getAttribute("action"),data:params,beforeSend:function(XMLHttpRequest){set_child_popup_content("<div id='popup_header' style='margin-bottom: 5px;'><b>"+_('Please Wait')+"</b></div><div id='popup_data'><p>"+_('Processing')+"...</p><i class='fa fa-spinner fa-pulse'></i></div>");},success:function(msg){set_child_popup_content("<div id='popup_header' style='margin-bottom: 5px;'><b>"+_('Dashboard Deleted')+"</b></div><div id='popup_data'><p>"+_('The requested dashboard has been deleted.')+"</p></div>");clear_whiteout();fade_popup("red");update_dashboards_menu();location.reload();},error:function(msg){set_child_popup_content("<div id='popup_header' style='margin-bottom: 5px;'><b>"+_('Error')+"</b></div><div id='popup_data'><p>"+_('An error occurred processing your request.')+"</p></div>");}});return false;});});$(".clone-dashboard").click(function(){var id=$(this).parent().data('id');var title=$(this).parent().data('title')+' ('+_('Clone')+')';whiteout();show_throbber();var content="<div id='popup_header' style='padding-bottom: 5px;'><b>"+_('Clone Dashboard')+"</b></div><div id='popup_data'><p>"+_("Use this to make an exact clone of the current dashboard and all its wonderful dashlets.")+"</p></div><form id='clonedashboard_form' method='get' action='"+ajax_helper_url+"'><input type='hidden' name='cmd' value='clonedashboardbyid'><input type='hidden' name='opts' value='"+id+"'><div class='popup-form-box'><div><label for='clonedashboardTitleBox'>"+_('New Title')+"</label></div><input type='text' size='30' name='title' id='clonedashboardTitleBox' value=\""+title+"\" class='form-control'></div><div id='clonedashboardFormButtons'><input type='submit' class='btn btn-sm btn-primary' name='submitButton' value='"+_('Clone')+"' id='submitCloneDashboardButton'><!--<input type='submit' class='submitbutton' name='cancelButton' value='"+_('Cancel')+"' id='cancelCloneDashboardButton'>--></div></form>";hide_throbber();set_child_popup_content(content);display_child_popup();$("#clonedashboard_form").submit(function(){hide_throbber();var params={};$(this).find(":input, :password, :checkbox, :radio, :submit, :reset").each(function(){params[this.name||this.id||this.parentNode.name||this.parentNode.id]=this.value;});params["nsp"]=nsp_str;$.ajax({type:"POST",url:this.getAttribute("action"),data:params,beforeSend:function(XMLHttpRequest){set_child_popup_content("<div id='popup_header'><b>"+_('Please Wait')+"</b></div><div id='popup_data'><p>"+_('Processing')+"...</p><i class='fa fa-spinner fa-pulse'></i></div>");},success:function(msg){set_child_popup_content("<div id='popup_header'><b>"+_('Dashboard Cloned')+"</b></div><div id='popup_data'><p>"+_('Dashboard successfully cloned.')+"</p></div>");fade_child_popup("green");update_dashboards_menu();location.reload();},error:function(msg){set_child_popup_content("<div id='popup_header'><b>"+_('Error')+"</b></div><div id='popup_data'><p>"+_('An error occurred processing your request.')+"</p></div>");}});return false;});});$(".export-dashboard").click(function(){var id=$(this).parent().data('id');var title=$(this).parent().data('title')+' dashboard';whiteout();show_throbber();var content="<div id='popup_header' style='padding-bottom: 5px;'><b>"+_('Export Dashboard')+"</b></div><div id='popup_data'><p>"+_("Use this to export an exact clone of the current dashboard and all its wonderful dashlets.")+"</p></div><form id='exportdashboard_form' method='get' action='"+ajax_helper_url+"'><input type='hidden' name='cmd' value='getrawdashboardbyid'><input type='hidden' name='opts' value='"+id+"'><div class='popup-form-box'><div><label for='exportdashboardTitleBox'>"+_('New Title')+"</label></div><input type='text' size='30' name='title' id='exportdashboardTitleBox' value=\""+title+"\" class='form-control'></div><div id='exportdashboardFormButtons'><input type='submit' class='btn btn-sm btn-primary' name='submitButton' value='"+_('Export')+"' id='submitExportDashboardButton'><!--<input type='submit' class='submitbutton' name='cancelButton' value='"+_('Cancel')+"' id='cancelExportDashboardButton'>--></div></form>";hide_throbber();set_child_popup_content(content);display_child_popup();$("#exportdashboard_form").submit(function(){hide_throbber();var params={};$(this).find(":input, :password, :checkbox, :radio, :submit, :reset").each(function(){params[this.name||this.id||this.parentNode.name||this.parentNode.id]=this.value;});params["nsp"]=nsp_str;$.ajax({type:"POST",url:this.getAttribute("action"),data:params,beforeSend:function(XMLHttpRequest){set_child_popup_content("<div id='popup_header'><b>"+_('Please Wait')+"</b></div><div id='popup_data'><p>"+_('Processing')+"...</p><i class='fa fa-spinner fa-pulse'></i></div>");},success:function(msg){set_child_popup_content("<div id='popup_header'><b>"+_('Dashboard Exported')+"</b></div><div id='popup_data'><p>"+_('Dashboard successfully Exported.')+"</p></div>");fade_child_popup("green");update_dashboards_menu();const link=document.createElement("a");const file=new Blob([msg],{type:'text/plain'});link.href=URL.createObjectURL(file);link.download=params['title']+".txt";link.click();URL.revokeObjectURL(link.href);$("#whiteout").remove();},error:function(msg){set_child_popup_content("<div id='popup_header'><b>"+_('Error')+"</b></div><div id='popup_data'><p>"+_('An error occurred processing your request.')+"</p></div>");}});return false;});});var dashboard_file_text='';var isValidDashFile=false;$("#importfile").change(function(){var file=$('#importfile').prop('files')[0]
if(file.name.split('.').pop()!='txt'){isValidDashFile=false;}
else{if(file.type!='text/plain'){isValidDashFile=false;}
else{isValidDashFile=true;}}
var fr=new FileReader();fr.onload=function(e){dashboard_file_text=e.target.result;};fr.readAsText(file);});$("#importdashboard_form").submit(function(){if(isValidDashFile){var params={};params['cmd']='importdashboard';params['importstring']=dashboard_file_text;params['nsp']=nsp_str;var content="<div id='popup_header'><b>"+_('Dashboard Imported')+"</b></div><div id='popup_data'><p>"+_('Dashboard successfully Imported.')+"</p></div>";set_child_popup_content(content);$.ajax({type:"POST",url:this.getAttribute("action"),data:params,success:function(msg){display_child_popup();fade_child_popup("green");update_dashboards_menu();$("#importString").val(null);$("#whiteout").remove();},error:function(msg){alert('File Is Not a Valid Dashboard File!');location.reload();}});}
else{alert('File Is Not a Valid Dashboard File!');location.reload();}
return false;});$("#leftnav").on('click','a.mydashboardlink',function(){handle_dashboard_menu_click(this);return;});});function update_dashboards_menu()
{var html=get_ajax_data("getdashboardsmenuhtml","");if(inframe){$('ul#mydashboardsmenu',parent.document).html(html);}else{$("ul#mydashboardsmenu").html(html);}}
function handle_dashboard_menu_click(obj)
{var theparent=obj.parentNode;var url=obj.href;var title=obj.innerHTML;var rawid=obj.id;var id=rawid.substr(10);fill_dashboard_screen(title,url,id);var x=1;return;}
function fill_dashboard_screen(title,url,id,background)
{update_dashboards_menu();highlight_dashboards_menu_item("dashboard-"+id);$("#trashdashboard").css("visibility","visible");$("#editdashboard").css("visibility","visible");$("#clonedashboard").css("visibility","visible");$("#maincontentframe").attr({src:url});currentdashboardid=id;currentdashboardtitle=title;}
function show_new_dashboard(num)
{var viewdata=get_ajax_data("getdashboardbynum",num);eval('var viewobj='+viewdata);fill_dashboard_screen(viewobj.title,viewobj.url,viewobj.id,viewobj.background);currentdashboardnum=num;}
function show_new_dashboard_id(id)
{var viewdata=get_ajax_data("getdashboardbyid",id);eval('var viewobj='+viewdata);fill_dashboard_screen(viewobj.title,viewobj.url,viewobj.id,viewobj.background);currentdashboardnum=viewobj.number;}
function clear_dashboard_controls()
{$("#trashdashboard").css("visibility","hidden");$("#editdashboard").css("visibility","hidden");$("#clonedashboard").css("visibility","hidden");}
function highlight_dashboards_menu_item(id)
{$("#"+id).addClass("activemenulink");}
function unhighlight_dashboards_menu_items()
{$("#mydashboards-page #leftnav a.mydashboardlink").removeClass("activemenulink");}